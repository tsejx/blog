{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon.ico","path":"images/favicon.ico","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.jpeg","path":"images/avatar.jpeg","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"7b66274c41242c16c7c8801a7e5db64e796a5e57","modified":1629255132879},{"_id":"themes/next/.bowerrc","hash":"3228a58ed0ece9f85e1e3136352094080b8dece1","modified":1629255060834},{"_id":"themes/next/.DS_Store","hash":"1281139b003f6c7767a6f8fb1eb898dabfa6d9f6","modified":1629255060832},{"_id":"themes/next/.editorconfig","hash":"792fd2bd8174ece1a75d5fd24ab16594886f3a7f","modified":1629255060835},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1629255060835},{"_id":"themes/next/.stylintrc","hash":"b28e24704a5d8de08346c45286574c8e76cc109f","modified":1629255060836},{"_id":"themes/next/.travis.yml","hash":"3d1dc928c4a97933e64379cfde749dedf62f252c","modified":1629255060837},{"_id":"themes/next/LICENSE.md","hash":"fc7227c508af3351120181cbf2f9b99dc41f063e","modified":1629255060838},{"_id":"themes/next/README.md","hash":"c1d6d1c6b75736b892e179865833ea58da5ca9d2","modified":1629255060839},{"_id":"themes/next/bower.json","hash":"a8c832da6aad5245052aed7ff26c246f85d68c6c","modified":1629255060841},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1629255060842},{"_id":"themes/next/gulpfile.coffee","hash":"48d2f9fa88a4210308fc41cc7d3f6d53989f71b7","modified":1629255060868},{"_id":"themes/next/package.json","hash":"11a0b27f92da8abf1efbea6e7a0af4271d7bff9e","modified":1629255061039},{"_id":"themes/next/_config.yml","hash":"e6807ccf6cff340dd85e239f553997039e8c09a8","modified":1629270860650},{"_id":"source/_posts/analysis-of-vue-responsive-systrm.md","hash":"cb23ab8e095796269034c6d19b15369b66e3e820","modified":1629268692383},{"_id":"source/_posts/architect-design-based-on-rbac.md","hash":"d007e74208d8a24bf4abc88a17fb5e0ffe61bf8e","modified":1629257343052},{"_id":"source/_posts/about-content-delivery-network.md","hash":"783a8434d3d7896b7efd12e93f97f7fb180a5cb7","modified":1629268694302},{"_id":"source/_posts/building-performance-optimization-based-on-roadhog.md","hash":"1dceb40210bef6c51e744e3aae51568742cfdd89","modified":1629257623192},{"_id":"source/_posts/business-experience-summary-of-lading-page.md","hash":"7bd5a9a570134704c0be3183fa6431b6d64854b0","modified":1629257282003},{"_id":"source/_posts/event-chain-based-automatic-test-scheme-of-totorox.md","hash":"af39b85f2d60ea1cf5c77b04aafd33369ddd6b9b","modified":1629257385340},{"_id":"source/_posts/form-business-design-pratice-in-antd.md","hash":"f846073dd6dfe563ba5c5920113ddc6febe358c0","modified":1629257594534},{"_id":"source/_posts/means-for-performance-optimization.md","hash":"b2c6a444978a476a44650fe82f30be31b8a49104","modified":1629257486484},{"_id":"source/_posts/docker-deploy-pratice.md","hash":"d5c8b4e29dfd122edde3bc41a96bb4aa2a4d8310","modified":1629257359941},{"_id":"source/_posts/practice-of-page-batch-update-tool-in-visual-configuration-system.md","hash":"d39b7d05737db6362065645a8df480788b409ee8","modified":1629257443566},{"_id":"source/_posts/authentication.md","hash":"f10ae93d6cd5bb275982ba0499bb02f0225eb8f9","modified":1629257242377},{"_id":"source/images/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1629255132885},{"_id":"source/_posts/summary-of-common-development-and-debugging-methods-of-mobile-front-end.md","hash":"aa3df9644b131fb3a3f4d635872d8895cdf403bf","modified":1629257320175},{"_id":"source/tags/index.md","hash":"c038a75a44098c0e3aa4b8b03607265a8a42094d","modified":1629255132886},{"_id":"themes/next/docs/DATA-FILES.md","hash":"8e1962dd3e1b700169b3ae5bba43992f100651ce","modified":1629255060847},{"_id":"themes/next/docs/AUTHORS.md","hash":"7b24be2891167bdedb9284a682c2344ec63e50b5","modified":1629255060846},{"_id":"themes/next/docs/INSTALLATION.md","hash":"2bbdd6c1751b2b42ce9b9335da420c6026a483e9","modified":1629255060848},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"141e989844d0b5ae2e09fb162a280715afb39b0d","modified":1629255060845},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"120750c03ec30ccaa470b113bbe39f3d423c67f0","modified":1629255060850},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"ad57c168d12ba01cf144a1ea0627b2ffd1847d3e","modified":1629255060853},{"_id":"themes/next/docs/LICENSE","hash":"fe607fe22fc9308f6434b892a7f2d2c5514b8f0d","modified":1629255060851},{"_id":"themes/next/docs/MATH.md","hash":"0ae4258950de01a457ea8123a8d13ec6db496e53","modified":1629255060852},{"_id":"themes/next/languages/de.yml","hash":"fb478c5040a4e58a4c1ad5fb52a91e5983d65a3a","modified":1629255060869},{"_id":"themes/next/languages/default.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1629255060872},{"_id":"themes/next/languages/en.yml","hash":"c540c3a0d7db2d4239293c8783881962640b6c34","modified":1629255060872},{"_id":"themes/next/languages/it.yml","hash":"62ef41d0a9a3816939cb4d93a524e6930ab9c517","modified":1629255060888},{"_id":"themes/next/languages/id.yml","hash":"e7fb582e117a0785036dcdbb853a6551263d6aa6","modified":1629255060886},{"_id":"themes/next/languages/ko.yml","hash":"fae155018ae0efdf68669b2c7dd3f959c2e45cc9","modified":1629255060892},{"_id":"themes/next/languages/fr.yml","hash":"0162a85ae4175e66882a9ead1249fedb89200467","modified":1629255060880},{"_id":"themes/next/languages/pt-BR.yml","hash":"bfc80c8a363fa2e8dde38ea2bc85cd19e15ab653","modified":1629255060896},{"_id":"themes/next/languages/nl.yml","hash":"bb9ce8adfa5ee94bc6b5fac6ad24ba4605d180d3","modified":1629255060893},{"_id":"themes/next/languages/ja.yml","hash":"5f8e54c666393d1ca2e257f6b1e3b4116f6657d8","modified":1629255060891},{"_id":"themes/next/languages/pt.yml","hash":"3cb51937d13ff12fcce747f972ccb664840a9ef3","modified":1629255060903},{"_id":"themes/next/languages/tr.yml","hash":"c5f0c20743b1dd52ccb256050b1397d023e6bcd9","modified":1629255060906},{"_id":"themes/next/languages/ru.yml","hash":"db0644e738d2306ac38567aa183ca3e859a3980f","modified":1629255060905},{"_id":"themes/next/languages/zh-HK.yml","hash":"7903b96912c605e630fb695534012501b2fad805","modified":1629255060909},{"_id":"themes/next/languages/vi.yml","hash":"8da921dd8335dd676efce31bf75fdd4af7ce6448","modified":1629255060907},{"_id":"themes/next/languages/zh-CN.yml","hash":"fbbf3a0b664ae8e927c700b0a813692b94345156","modified":1629255060908},{"_id":"themes/next/languages/zh-TW.yml","hash":"6e6d2cd8f4244cb1b349b94904cb4770935acefd","modified":1629255060910},{"_id":"themes/next/layout/_layout.swig","hash":"1b59036ccb2ad571503b94587f458fad46775642","modified":1629255060917},{"_id":"themes/next/layout/category.swig","hash":"5d955284a42f802a48560b4452c80906a5d1da02","modified":1629255061034},{"_id":"themes/next/layout/index.swig","hash":"c2a3896c64e96790edc10426ef586b6186a87f46","modified":1629255061035},{"_id":"themes/next/layout/archive.swig","hash":"00348e37bff100ce1f538c4de2880c344403fa54","modified":1629256500053},{"_id":"themes/next/layout/page.swig","hash":"79040bae5ec14291441b33eea341a24a7c0e9f93","modified":1629255061036},{"_id":"themes/next/layout/post.swig","hash":"318249db246a57e9422875a2457c6acfce974ba5","modified":1629255061037},{"_id":"themes/next/layout/schedule.swig","hash":"3e9cba5313bf3b98a38ccb6ef78b56ffa11d66ee","modified":1629255061038},{"_id":"themes/next/scripts/helpers.js","hash":"a70bfad3efda76738dab12e28e8b75e3989ee3da","modified":1629255061040},{"_id":"themes/next/scripts/merge-configs.js","hash":"33afe97284d34542015d358a720823feeebef120","modified":1629255061041},{"_id":"themes/next/layout/tag.swig","hash":"ba402ce8fd55e80b240e019e8d8c48949b194373","modified":1629255061038},{"_id":"themes/next/scripts/merge.js","hash":"9130dabe6a674c54b535f322b17d75fe6081472f","modified":1629255061042},{"_id":"themes/next/source/.DS_Store","hash":"71fbfc7b99778a7affb4e31551c3bf7dbb20d65a","modified":1629255061054},{"_id":"themes/next/test/helpers.js","hash":"a1f5de25154c3724ffc24a91ddc576cdbd60864f","modified":1629255061225},{"_id":"themes/next/test/.jshintrc","hash":"19f93d13d1689fe033c82eb2d5f3ce30b6543cc0","modified":1629255061225},{"_id":"themes/next/test/intern.js","hash":"11fa8a4f5c3b4119a179ae0a2584c8187f907a73","modified":1629255061226},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1629255060844},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255061169},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"a45a791b49954331390d548ac34169d573ea5922","modified":1629255060859},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"6855402e2ef59aae307e8bd2a990647d3a605eb8","modified":1629255060858},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"b19a6e0ae96eb7c756fb5b1ba03934c7f9cbb3c3","modified":1629255060863},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"f3eec572a7d83542e2710a7404082014aaa1a5e7","modified":1629255060862},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"44e4fb7ce2eca20dfa98cdd1700b50d6def4086f","modified":1629255060861},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"24cf2618d164440b047bb9396263de83bee5b993","modified":1629255060864},{"_id":"themes/next/docs/zh-CN/README.md","hash":"46b264623af21211a0a9c4ba0cf1318a80eeb9fb","modified":1629255060866},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"e03607b608db4aa7d46f6726827c51ac16623339","modified":1629255060865},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"5da70d7fa0c988a66a469b9795d33d471a4a4433","modified":1629255060867},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"d6d20f60f77a76c77f8e65d0c9adbd79d0274557","modified":1629255060854},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"6c5d69e94961c793da156217ecf1179e868d7ba1","modified":1629255060855},{"_id":"themes/next/docs/ru/README.md","hash":"edfe0cfb8b2c9f0effd3beb868af9bfd0fabb3a6","modified":1629255060856},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"b1dd18d9b890b21718883ea1832e7e02a773104a","modified":1629255060857},{"_id":"themes/next/layout/_custom/head.swig","hash":"9e1b9666efa77f4cf8d8261bcfa445a9ac608e53","modified":1629255060911},{"_id":"themes/next/layout/_custom/header.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1629255060913},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1629255060913},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"31322a7f57936cf2dc62e824af5490da5354cf02","modified":1629255060921},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"0790ddbc349508d7ece45a9a4391d0a1cd7263cc","modified":1629255060922},{"_id":"themes/next/layout/_macro/post-related.swig","hash":"08fe30ce8909b920540231e36c97e28cfbce62b6","modified":1629255060923},{"_id":"themes/next/layout/_macro/reward.swig","hash":"bd5778d509c51f4b1d8da3a2bc35462929f08c75","modified":1629255060925},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"7cbe5e496de8755634528acdde18d453b6851a78","modified":1629258948984},{"_id":"themes/next/layout/_partials/comments.swig","hash":"eafff2d623af8991844f34819a60e37ac11ef245","modified":1629255060930},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"a9e1346b83cf99e06bed59a53fc069279751e52a","modified":1629255060927},{"_id":"themes/next/layout/_partials/breadcrumb.swig","hash":"6994d891e064f10607bce23f6e2997db7994010e","modified":1629255060929},{"_id":"themes/next/layout/_partials/footer.swig","hash":"cf8fe76993b513b97f379832222b6ec7e41a1c15","modified":1629255060935},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"1aaf32bed57b976c4c1913fd801be34d4838cc72","modified":1629255060943},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"dbe321bcf3cf45917cc11a3e3f50d8572bac2c70","modified":1629255060944},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"ac3ad2c0eccdf16edaa48816d111aaf51200a54b","modified":1629255060956},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"6fc63d5da49cb6157b8792f39c7305b55a0d1593","modified":1629255060955},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"0a0129e926c27fffc6e7ef87fe370016bc7a4564","modified":1629255060955},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"e0bdc723d1dc858b41fd66e44e2786e6519f259f","modified":1629255060968},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"60001c8e08b21bf3a7afaf029839e1455340e95d","modified":1629255060990},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"f532ce257fca6108e84b8f35329c53f272c2ce84","modified":1629255061001},{"_id":"themes/next/layout/_third-party/copy-code.swig","hash":"a8ab2035654dd06d94faf11a35750529e922d719","modified":1629255061000},{"_id":"themes/next/layout/_third-party/github-banner.swig","hash":"cabd9640dc3027a0b3ac06f5ebce777e50754065","modified":1629255061013},{"_id":"themes/next/layout/_third-party/pangu.swig","hash":"6b75c5fd76ae7cf0a7b04024510bd5221607eab3","modified":1629255061020},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"927f19160ae14e7030df306fc7114ba777476282","modified":1629255061020},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"fc93b1a7e6aed0dddb1f3910142b48d8ab61174e","modified":1629255061021},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"b0ca46e0d1ff4c08cb0a3a8c1994f20d0260cef9","modified":1629255061023},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"22369026c87fc23893c35a7f250b42f3bb1b60f1","modified":1629255061022},{"_id":"themes/next/scripts/tags/button.js","hash":"4b12c376bea894d23cca0f9fcb3d6518b6db279d","modified":1629255061044},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1629255061045},{"_id":"themes/next/scripts/tags/full-image.js","hash":"e282bf5a7c70b3d354001e8f66d3bef1a4fbb79e","modified":1629255061047},{"_id":"themes/next/scripts/tags/exturl.js","hash":"1412ce2ef59fa4137b697a507fd759ff067a2398","modified":1629255061046},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"1d59b968af4b8d147f8bc9bc295d596e41be8348","modified":1629255061047},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"545102e3aa3ce494f7046abf71cefb7aaf671559","modified":1629255061050},{"_id":"themes/next/scripts/tags/label.js","hash":"f0ecd3b5773b19a6bd93a819dfe0c49ee418e4de","modified":1629255061051},{"_id":"themes/next/scripts/tags/note.js","hash":"adb945ba93ac487d46b969ca4e59d3681b8f8d1c","modified":1629255061052},{"_id":"themes/next/scripts/tags/tabs.js","hash":"e37761253d68a29593fe9ed2fe403f49b6e971de","modified":1629255061053},{"_id":"themes/next/source/css/main.styl","hash":"c26ca6e7b5bd910b9046d6722c8e00be672890e0","modified":1629255061168},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1629255061171},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1629255061170},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1629255061172},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1629255061173},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1629255061176},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1629255061174},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1629255061177},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1629255061178},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1629255061180},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1629255061180},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1629255061179},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1629255061186},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1629255061184},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1629255061186},{"_id":"themes/next/source/images/favicon.ico","hash":"12c44eb7d5b9ba501ba51554c337a9c85b528871","modified":1629255061185},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1629255061187},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1629255061188},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1629255061188},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1629255061189},{"_id":"themes/next/layout/_macro/post.swig","hash":"27922af64ecb9db9a28bcf1c98fb68b26bf0b67a","modified":1629255060924},{"_id":"themes/next/source/images/avatar.jpeg","hash":"c2cb171a5aec9d9d9d0853bdc191a32793c9bfa3","modified":1629255061173},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255060959},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255060960},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255061136},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255061136},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255061138},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255061162},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629255061164},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"65c5e585982dae7ae1542cada71858b4ea1f73d6","modified":1629255060919},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"d1b73c926109145e52605929b75914cc8b60fb89","modified":1629255060920},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"7ce76358411184482bb0934e70037949dd0da8ca","modified":1629255060936},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"a7e376b087ae77f2e2a61ba6af81cde5af693174","modified":1629255060938},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"00bf33b3c557b8f7e9faf49b226ea6ff7df5cda0","modified":1629255060939},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"fd780171713aada5eb4f4ffed8e714617c8ae6be","modified":1629255060940},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"2082f5077551123e695e8afec471c9c44b436acb","modified":1629255060941},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"3db735d0cd2d449edf2674310ac1e7c0043cb357","modified":1629255060942},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"a33b29ccbdc2248aedff23b04e0627f435824406","modified":1629255060946},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"88b4b6051592d26bff59788acb76346ce4e398c2","modified":1629255060943},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"957701729b85fb0c5bfcf2fb99c19d54582f91ed","modified":1629255060947},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"959b7e04a96a5596056e4009b73b6489c117597e","modified":1629255060949},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"eefe2388ff3d424694045eda21346989b123977c","modified":1629255060950},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"1f1107468aaf03f7d0dcd7eb2b653e2813a675b4","modified":1629255060952},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"23e23dc0f76ef3c631f24c65277adf7ea517b383","modified":1629255060951},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"89c5a5240ecb223acfe1d12377df5562a943fd5d","modified":1629255060953},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"cc865af4a3cb6d25a0be171b7fc919ade306bb50","modified":1629255060957},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"ea03fe9c98ddcfcc0ecfdbe5a2b622f9cde3b3a1","modified":1629255060959},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"ea03fe9c98ddcfcc0ecfdbe5a2b622f9cde3b3a1","modified":1629255060963},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"98df9d72e37dd071e882f2d5623c9d817815b139","modified":1629255060972},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"60426bf73f8a89ba61fb1be2df3ad5398e32c4ef","modified":1629255060973},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"67f0cb55e6702c492e99a9f697827629da036a0c","modified":1629255060975},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"8160b27bee0aa372c7dc7c8476c05bae57f58d0f","modified":1629255060976},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"94b26dfbcd1cf2eb87dd9752d58213338926af27","modified":1629255060980},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"deda6a814ed48debc694c4e0c466f06c127163d0","modified":1629255060974},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"a234c5cd1f75ca5731e814d0dbb92fdcf9240d1b","modified":1629255060979},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"beb53371c035b62e1a2c7bb76c63afbb595fe6e5","modified":1629255060983},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"5e9bb24c750b49513d9a65799e832f07410002ac","modified":1629255060984},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"43f70cdc999c66b9c7889a13150ec63e99b1fdd0","modified":1629255060986},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"3658414379e0e8a34c45c40feadc3edc8dc55f88","modified":1629255060987},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"0ddc94ed4ba0c19627765fdf1abc4d8efbe53d5a","modified":1629255060988},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"c3971fd154d781088e1cc665035f8561a4098f4c","modified":1629255060989},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"fe8177e4698df764e470354b6acde8292a3515e0","modified":1629255060995},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"0e3378f7c39b2b0f69638290873ede6b6b6825c0","modified":1629255060991},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"8878241797f8494a70968756c57cacdfc77b61c7","modified":1629255060992},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"03e83f1311faafb7dddc2899042ed1cacd5c995e","modified":1629255060996},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"88b5a808b6b254c6122444e9dc180d5cc459cb19","modified":1629255060997},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"34421679cae6581697cd3ab7c3729eb220e3e3f5","modified":1629255060999},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"a6fc00ec7f5642aabd66aa1cf51c6acc5b10e012","modified":1629255061016},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"97dbc2035bcb5aa7eafb80a4202dc827cce34983","modified":1629255061017},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"9b9ff4cc6d5474ab03f09835a2be80e0dba9fe89","modified":1629255061019},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"c747fb5c6b1f500e8f0c583e44195878b66e4e29","modified":1629255061027},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"cb3a5d36dbe1630bab84e03a52733a46df7c219b","modified":1629255061029},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"b15e10abe85b4270860a56c970b559baa258b2a8","modified":1629255061028},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"c057b17f79e8261680fbae8dc4e81317a127c799","modified":1629255061030},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"328d9a9696cc2ccf59c67d3c26000d569f46344c","modified":1629255061134},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"2aa5b7166a85a8aa34b17792ae4f58a5a96df6cc","modified":1629255061135},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"51c2907e5c50c2614419b670fbdec183ae7f7f5d","modified":1629255061138},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"be087dcc060e8179f7e7f60ab4feb65817bd3d9f","modified":1629255061161},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"e1f6f59ad6e562dfe640ee4ed5d1ac9b6aba4114","modified":1629255061160},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"2640a54fa63bdd4c547eab7ce2fc1192cf0ccec8","modified":1629255061137},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"c167eeb6b736f7b021fba98c38c2c21032ee1255","modified":1629255061162},{"_id":"themes/next/source/css/_variables/base.styl","hash":"0b43ddd92e395342703550f629699c5e591fd68b","modified":1629255061163},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1629255061203},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1629255061202},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1629255061204},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1629255061204},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1629255061205},{"_id":"themes/next/source/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1629255061191},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1629255061191},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1629255061192},{"_id":"themes/next/source/js/src/motion.js","hash":"52fd093cb96b68229b38436c9b8ebcefc7e12cb2","modified":1629255061194},{"_id":"themes/next/source/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1629255061193},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1629255061193},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1629255061196},{"_id":"themes/next/source/js/src/post-details.js","hash":"9e9b078d7ec2505c15157c9fc588e042e34465fe","modified":1629261129900},{"_id":"themes/next/source/js/src/utils.js","hash":"e829806d054991d0324a339993082206ca6026e5","modified":1629255061200},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1629255061197},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1629255061224},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1629255061223},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1629255061224},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"6958a97fde63e03983ec2394a4f8e408860fb42b","modified":1629255061025},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"ba698f49dd3a868c95b240d802f5b1b24ff287e4","modified":1629255061026},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"4719ce717962663c5c33ef97b1119a0b3a4ecdc3","modified":1629255061056},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"31050fc7a25784805b4843550151c93bfa55c9c8","modified":1629255061061},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"471f1627891aca5c0e1973e09fbcb01e1510d193","modified":1629255061063},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"7e509c7c28c59f905b847304dd3d14d94b6f3b8e","modified":1629255061062},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"a6bb5256be6195e76addbda12f4ed7c662d65e7a","modified":1629255061066},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"c5d48863f332ff8ce7c88dec2c893f709d7331d3","modified":1629255061086},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"dd8a3b22fc2f222ac6e6c05bd8a773fb039169c0","modified":1629255061111},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"18309b68ff33163a6f76a39437e618bb6ed411f8","modified":1629255061128},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"47a46583a1f3731157a3f53f80ed1ed5e2753e8e","modified":1629255061130},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"aebbd86500d819c4532ab290c62b6f432bc2f878","modified":1629255061127},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"9c25c75311e1bd4d68df031d3f2ae6d141a90766","modified":1629255061129},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"0810e7c43d6c8adc8434a8fa66eabe0436ab8178","modified":1629255061132},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"ece571f38180febaf02ace8187ead8318a300ea7","modified":1629255061130},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a280a583b7615e939aaddbf778f5c108ef8a2a6c","modified":1629255061131},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"0bef9f0dc134215bc4d0984ba3a16a1a0b6f87ec","modified":1629255061141},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"fca5320e2644edcd663888863899d1b80352439b","modified":1629255061140},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"5ae7906dc7c1d9468c7f4b4a6feddddc555797a1","modified":1629255061141},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"38e5df90c8689a71c978fd83ba74af3d4e4e5386","modified":1629255061142},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"f43c821ea272f80703862260b140932fe4aa0e1f","modified":1629255061143},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1629255061144},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"2212511ae14258d93bec57993c0385e5ffbb382b","modified":1629255061143},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"5e12572b18846250e016a872a738026478ceef37","modified":1629255061145},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"0efa036a15c18f5abb058b7c0fad1dd9ac5eed4c","modified":1629255061150},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"8829bc556ca38bfec4add4f15a2f028092ac6d46","modified":1629255061151},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"1452cbe674cc1d008e1e9640eb4283841058fc64","modified":1629255061152},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"35f093fe4c1861661ac1542d6e8ea5a9bbfeb659","modified":1629255061151},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"d5e8ea6336bc2e237d501ed0d5bbcbbfe296c832","modified":1629255061153},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"05a5abf02e84ba8f639b6f9533418359f0ae4ecb","modified":1629255061157},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"876b5d99061025cf485a3cac440624ded5734319","modified":1629255061156},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"c4ed249798296f60bda02351fe6404fb3ef2126f","modified":1629255061155},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"2f878213cb24c5ddc18877f6d15ec5c5f57745ac","modified":1629255061157},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"41f9cdafa00e256561c50ae0b97ab7fcd7c1d6a2","modified":1629255061158},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"ffa870c3fa37a48b01dc6f967e66f5df508d02bf","modified":1629255061159},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"5779cc8086b1cfde9bc4f1afdd85223bdc45f0a0","modified":1629255061159},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1629255061208},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1629255061207},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1629255061209},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"ab6f13fae0513a9b39f8d8c4c3a4e3928014f046","modified":1629255061195},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1629255061220},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1629255061219},{"_id":"themes/next/source/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1629255061216},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1629255061213},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"ee37e6c465b9b2a7e39175fccfcbed14f2db039b","modified":1629255061070},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"39dee82d481dd9d44e33658960ec63e47cd0a715","modified":1629255061068},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d27448f199fc2f9980b601bc22b87f08b5d64dd1","modified":1629255061072},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"7cc3f36222494c9a1325c5347d7eb9ae53755a32","modified":1629255061071},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"6c00f6e0978f4d8f9a846a15579963728aaa6a17","modified":1629255061073},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"8a2421cb9005352905fae9d41a847ae56957247e","modified":1629255061072},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"49c2b2c14a1e7fcc810c6be4b632975d0204c281","modified":1629255061074},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"17b95828f9db7f131ec0361a8c0e89b0b5c9bff5","modified":1629255061077},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"96f32ea6c3265a3889e6abe57587f6e2a2a40dfb","modified":1629255061076},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"f5aa2ba3bfffc15475e7e72a55b5c9d18609fdf5","modified":1629255061079},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"b76387934fb6bb75212b23c1a194486892cc495e","modified":1629255061078},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"7dd9a0378ccff3e4a2003f486b1a34e74c20dac6","modified":1629255061080},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"4eff5b252d7b614e500fc7d52c97ce325e57d3ab","modified":1629255061081},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"9bf4362a4d0ae151ada84b219d39fbe5bb8c790e","modified":1629255061084},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"fb451dc4cc0355b57849c27d3eb110c73562f794","modified":1629255061083},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"a82afbb72d83ee394aedc7b37ac0008a9823b4f4","modified":1629255061085},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"e72a89e0f421444453e149ba32c77a64bd8e44e8","modified":1629255061089},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"0f7f522cc6bfb3401d5afd62b0fcdf48bb2d604b","modified":1629255061090},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f54367c0feda6986c030cc4d15a0ca6ceea14bcb","modified":1629255061091},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"2cdc094ecf907a02fce25ad4a607cd5c40da0f2b","modified":1629255061092},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"387ce23bba52b22a586b2dfb4ec618fe1ffd3926","modified":1629255061094},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"ca89b167d368eac50a4f808fa53ba67e69cbef94","modified":1629255061093},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"417f05ff12a2aaca6ceeac8b7e7eb26e9440c4c3","modified":1629255061095},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"a5d8617a24d7cb6c5ad91ea621183ca2c0917331","modified":1629255061095},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"f4e9f870baa56eae423a123062f00e24cc780be1","modified":1629255061096},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"36332c8a91f089f545f3c3e8ea90d08aa4d6e60c","modified":1629255061097},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"017074ef58166e2d69c53bb7590a0e7a8947a1ed","modified":1629255061098},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"a352ae5b1f8857393bf770d2e638bf15f0c9585d","modified":1629255061099},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"c0ac49fadd33ca4a9a0a04d5ff2ac6560d0ecd9e","modified":1629255061100},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"10251257aceecb117233c9554dcf8ecfef8e2104","modified":1629255061101},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"578bb2d5f24cad39205bbafb4c39c7e9962b9fa9","modified":1629255061101},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"ed9608d2740a33664eb703f806c218a4fc520087","modified":1629255061102},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"35c0350096921dd8e2222ec41b6c17a4ea6b44f2","modified":1629255061104},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"bbe0d111f6451fc04e52719fd538bd0753ec17f9","modified":1629255061104},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"89dd4f8b1f1cce3ad46cf2256038472712387d02","modified":1629255061105},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"efa5e5022e205b52786ce495d4879f5e7b8f84b2","modified":1629255061106},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"9486ddd2cb255227db102d09a7df4cae0fabad72","modified":1629255061107},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"45fa7193435a8eae9960267438750b4c9fa9587f","modified":1629255061107},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"4427ed3250483ed5b7baad74fa93474bd1eda729","modified":1629255061108},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"f7784aba0c1cd20d824c918c120012d57a5eaa2a","modified":1629255061109},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"43bc58daa8d35d5d515dc787ceb21dd77633fe49","modified":1629255061109},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"3623e7fa4324ec1307370f33d8f287a9e20a5578","modified":1629255061110},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"c2abe4d87148e23e15d49ee225bc650de60baf46","modified":1629255061112},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"cf2185a0ea170fd8450f592e859a6c941141e5ee","modified":1629255061113},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"6ec8ea7b11a146777b6b8da0f71f0cc1dbd129df","modified":1629255061114},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"4851b981020c5cbc354a1af9b831a2dcb3cf9d39","modified":1629255061116},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"4a457d265d62f287c63d48764ce45d9bcfc9ec5a","modified":1629255061117},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"ee7528900578ef4753effe05b346381c40de5499","modified":1629255061118},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"32c9156bea5bac9e9ad0b4c08ffbca8b3d9aac4b","modified":1629255061118},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"4ab5deed8c3b0c338212380f678f8382672e1bcb","modified":1629255061119},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"ead0d0f2321dc71505788c7f689f92257cf14947","modified":1629255061120},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"10e9bb3392826a5a8f4cabfc14c6d81645f33fe6","modified":1629255061121},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"d4e6d8d7b34dc69994593c208f875ae8f7e8a3ae","modified":1629255061122},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"34935b40237c074be5f5e8818c14ccfd802b7439","modified":1629255061123},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"d89c4b562b528e4746696b2ad8935764d133bdae","modified":1629255061124},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"cce6772e2cdb4db85d35486ae4c6c59367fbdd40","modified":1629255061123},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"a5e3e6b4b4b814a9fe40b34d784fed67d6d977fa","modified":1629255061125},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"76937db9702053d772f6758d9cea4088c2a6e2a3","modified":1629255061125},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"1c18c91ab3c60169ebe654c80c968fd8458786a3","modified":1629255061126},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"5dc4859c66305f871e56cba78f64bfe3bf1b5f01","modified":1629255061146},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1629255061148},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"817587e46df49e819858c8ecbafa08b53d5ff040","modified":1629255061154},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1629255061212},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1629255061222},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1629255061211},{"_id":"public/tags/index.html","hash":"43954945b9464230141935865c933d13ef2d8ee6","modified":1629281702071},{"_id":"public/archives/page/2/index.html","hash":"4161f0fc21352e57c05ed6d5cd442d9827dc310c","modified":1629281702071},{"_id":"public/archives/2019/index.html","hash":"1f185883409d4ebce5bc9fc63cf1f9b206ce1379","modified":1629281702071},{"_id":"public/archives/2019/01/index.html","hash":"56c082aa3d90bdd8f8dabb2a3af3ed509659c468","modified":1629281702071},{"_id":"public/archives/2019/04/index.html","hash":"656f531a705765a293595d15330727e1680cbff5","modified":1629281702071},{"_id":"public/archives/2019/05/index.html","hash":"49bad7997cb0bfa396e4e244535f3da2f945783d","modified":1629281702071},{"_id":"public/archives/2019/07/index.html","hash":"e9ba69ad901126df6d017fb746004ed91b4dd4f5","modified":1629281702071},{"_id":"public/archives/2019/11/index.html","hash":"4b01c3383a30795058a7e465817b1041ba4b12b0","modified":1629281702071},{"_id":"public/archives/2020/index.html","hash":"4969705f1f3df69bd34fbe647be4fac934cff1d6","modified":1629281702071},{"_id":"public/archives/2020/03/index.html","hash":"8c6d92deb819da705ea817e59a2bb5955b13c4d5","modified":1629281702071},{"_id":"public/archives/2020/04/index.html","hash":"f7277bae00efa4bcc3f16bc54d32bf5635fc4ac6","modified":1629281702071},{"_id":"public/archives/2020/05/index.html","hash":"de59606c1050ba1339c3df4d1008be213a09bc71","modified":1629281702071},{"_id":"public/archives/2020/06/index.html","hash":"4fe4d730dba8cae5e0ac1c95817dbc069acedc79","modified":1629281702071},{"_id":"public/archives/2020/08/index.html","hash":"9958bf7a48da1cf7f629fd26224c77816e759f9b","modified":1629281702071},{"_id":"public/about-content-delivery-network/index.html","hash":"7d6a7482bd8baa7b7d11cdd79815d1933c577d8c","modified":1629281702071},{"_id":"public/authentication/index.html","hash":"84c7b267d745960c5b0e0b4c784e46f196d2384f","modified":1629281702071},{"_id":"public/business-experience-summary-of-lading-page/index.html","hash":"f989a758e36de0dd8b60cbb520c4185c56f80326","modified":1629281702072},{"_id":"public/summary-of-common-development-and-debugging-methods-of-mobile-front-end/index.html","hash":"f950452551cdc648b9230d2087708597bc990ffa","modified":1629281702072},{"_id":"public/architect-design-based-on-rbac/index.html","hash":"7ccac683008e6b9f33a80550c3b450f9b707709a","modified":1629281702072},{"_id":"public/docker-deploy-pratice/index.html","hash":"54c4caa5a7e45d6d804bc051cccdb59e0fe96688","modified":1629281702072},{"_id":"public/event-chain-based-automatic-test-scheme-of-totorox/index.html","hash":"e5fdbf8e0f14009eff758153c038fcbb18348487","modified":1629281702072},{"_id":"public/practice-of-page-batch-update-tool-in-visual-configuration-system/index.html","hash":"9ff6afc6ce3366a8fc5353514910566a79fc2d9e","modified":1629281702072},{"_id":"public/analysis-of-vue-responsive-systrm/index.html","hash":"7cb49df0286be157df9ad011129c49d391917f08","modified":1629281702072},{"_id":"public/means-for-performance-optimization/index.html","hash":"d069b76934afe86cd56486a0e65f3e34f0cbf887","modified":1629281702072},{"_id":"public/form-business-design-pratice-in-antd/index.html","hash":"649b77246b380c032f38d0881ef9475e92b71977","modified":1629281702072},{"_id":"public/building-performance-optimization-based-on-roadhog/index.html","hash":"c585f870e4696e61628db84886bead67456f69de","modified":1629281702072},{"_id":"public/archives/index.html","hash":"c5c4e316c9072af36604929c1eecdde9a5482d34","modified":1629281702072},{"_id":"public/index.html","hash":"6b91a47c345c88f22228727d29d1f38dba057771","modified":1629281702072},{"_id":"public/page/2/index.html","hash":"276b8c13e3f5394dc4563af542ec2a11376d43fe","modified":1629281702072},{"_id":"public/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1629281702076},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1629281702076},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1629281702076},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1629281702076},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1629281702076},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1629281702076},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1629281702076},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1629281702076},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1629281702076},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1629281702076},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1629281702076},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1629281702076},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1629281702076},{"_id":"public/images/favicon.ico","hash":"12c44eb7d5b9ba501ba51554c337a9c85b528871","modified":1629281702076},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1629281702076},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1629281702076},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1629281702076},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1629281702077},{"_id":"public/images/avatar.jpeg","hash":"c2cb171a5aec9d9d9d0853bdc191a32793c9bfa3","modified":1629281702077},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1629281702077},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1629281702077},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1629281702661},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1629281702662},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1629281702663},{"_id":"public/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1629281702666},{"_id":"public/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1629281702666},{"_id":"public/js/src/motion.js","hash":"52fd093cb96b68229b38436c9b8ebcefc7e12cb2","modified":1629281702666},{"_id":"public/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1629281702666},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1629281702667},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1629281702667},{"_id":"public/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1629281702667},{"_id":"public/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1629281702667},{"_id":"public/js/src/post-details.js","hash":"9e9b078d7ec2505c15157c9fc588e042e34465fe","modified":1629281702667},{"_id":"public/js/src/utils.js","hash":"e829806d054991d0324a339993082206ca6026e5","modified":1629281702667},{"_id":"public/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1629281702667},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1629281702667},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1629281702667},{"_id":"public/js/src/schemes/pisces.js","hash":"ab6f13fae0513a9b39f8d8c4c3a4e3928014f046","modified":1629281702667},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1629281702667},{"_id":"public/css/main.css","hash":"7f9e8142fe1bfb6d25148509978fc9dd96e57b9f","modified":1629281702667},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1629281702667},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1629281702668},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1629281702668},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1629281702668},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1629281702668},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1629281702669},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1629281702669},{"_id":"source/_posts/rich-text-and-base64.md","hash":"578e35daf876778bb31cb4efcbe3559fb699205c","modified":1632934263489},{"_id":"source/_posts/web-video-editor-infra.md","hash":"fab3c70553c62eb01f7f7555ffb5d63fdbc7cba9","modified":1632934857556},{"_id":"source/_posts/web-video-editor-practise.md","hash":"89b9b9ffb153bffb53664b05547a5b1fc608e048","modified":1632938635803}],"Category":[],"Data":[],"Page":[{"title":"tags","date":"2018-07-24T07:01:57.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2018-07-24 15:01:57\ntype: \"tags\"\ncomments: false\n---\n","updated":"2021-08-18T02:52:12.886Z","path":"tags/index.html","layout":"page","_id":"ckshc99yp0001v31p9g9yutrc","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Vue ","date":"2019-07-04T00:00:00.000Z","_content":"\n Vue  Vue \n\n**** Vue \n\n [ustbhuangyi](https://github.com/ustbhuangyi) \n\nVue  datapropscomputed  watch Watcher Dep  Dependency********\n\n![Vue Reactive](http://img.mrsingsing.com/vue-reactive-workflow.png)\n\n<!-- more -->\n\n## \n\n Vue \n\n data  props Vue  observe  defineReactive  data  props \n\n data data  observe  Observer Observer  data \n\n-  data ****Observer Mutation Method pushpopshiftunshiftsplicesort  revers  observe \n-  data **** defineReactive \n\n props  vm  [defineReactive](https://github.com/vuejs/vue/blob/3b8925bc7973bb71b33374281db10a945ca9854e/src/core/observer/index.js#L132-L194) \n\ndefineReactive \n\ndefineReactive  [Dep](https://github.com/vuejs/vue/blob/3b8925bc79/src/core/observer/dep.js#L9-L50)  Watcher  Watcher  Object.defineProperty  get  set  get get  set  Dep  dep  dep get  dep  depend <span style=\"color:red;font-weight:bold\"></span> Watcher watcher  addDep  dep  addSub  dep  subs subs  Subscriber  set  dep  notify  subs  watcher  update  run <span style=\"color:red;font-weight:bold\"></span> dep  watcher  Watcher renderWatchercomputedWatcher  userWatcher\n\n get  set \n\n- get ******** Watcher ****\n- set ******** Watcher ****\n\n get set  Watcher \n\n## \n\n ****  JavaScript \n\n Data  View  View  Data  Vue  Data  template  View JavaScript  DOM  DOM  innerHTML  appendChildinsertBefore  DOM \n\n Vue  template  Compiler Render Function\n\n```html\n<div id=\"foo\">\n  <p>{{name}}</p>\n</div>\n```\n\n```js\n// \nfunction anonymous() {\n  with(this) {\n    return _c('div',\n      { attrs: {\"id\": \"foo\" }},\n      { _v(\"\\n      \"+s_(name)+\"\\n    \")}\n    )\n  }\n}\n```\n\n vm  `$options.render` \n\n getter  setter \n\n\n\n## \n\n Vue  `_init`  vm  `$mount`  `$mount`  `$mount`  mountComponent \n\nmountComponent  [updateComponent](https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L169-L192)  updateComponent  `vm._render()`  `vm._update()` \n\n- `vm._render` `vm.$options.render`\n- `vm._update`  `vm._render`  DOM \n\n updateComponent  DOM  DOM \n\n [mountComponet](https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L141-L213)  DOM  DOM  updateComponent  Watcher \n\n [Watcher ](https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L197-L203) render watcher<span style=\"color:red;font-weight:bold\"></span> Watcher  updateComponent  updateComponent `vm.$options.render` dataprops  computed  get  render watcher  dep  subs **** dep  set  dep.notify render watcher  update run  updateComponent  set ****\n\n\n\n mountComponent  Watcher Watcher  watcher ********\n\n## \n\n computed  [initComputed](https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L169-L208) \n\n computed  computed watcher computed watcher  Dep  computed  computed watcher  [evaluate](https://github.com/vuejs/vue/blob/dev/src/core/observer/watcher.js#L210-L213)  depend  watcher watcher  Dep  Subscriber  computed watcher  dep  notify  computed  watcher  lazy watcher  expression \n\n## \n\n watch  [Vue.prototype.\\$watch](https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L303-L317) \n\n watch  Watcher  user watcher watcher data  computed  watch  Dep  Dep  user watchers update  run user callback\n\n## \n\n-  Vue  API  What  Why\n-  JavaScript \n- \n\n## Todo\n\n- Vue Vue API \n-  Babel  JSX \n-  Virtual DOM  React  Virtual DOM \n\n## \n\n- [Vue ](https://cn.vuejs.org/)\n  - [](https://cn.vuejs.org/v2/guide/reactivity.html)\n  - [](https://cn.vuejs.org/v2/guide/render-function.html)\n- [Vue ](http://hcysun.me/vue-design/)\n  - [](http://hcysun.me/vue-design/art/7vue-reactive.html)\n  - [](http://hcysun.me/vue-design/art/8vue-reactive-dep-watch.html)\n- [Vue  - ](https://ustbhuangyi.github.io/vue-analysis/reactive/)\n- [Vue ](https://zhuanlan.zhihu.com/p/21706165?utm_source=wechat_session&utm_medium=social&utm_oi=58000878338048)\n","source":"_posts/analysis-of-vue-responsive-systrm.md","raw":"---\ntitle: Vue \ndate: '2019-07-04'\n---\n\n Vue  Vue \n\n**** Vue \n\n [ustbhuangyi](https://github.com/ustbhuangyi) \n\nVue  datapropscomputed  watch Watcher Dep  Dependency********\n\n![Vue Reactive](http://img.mrsingsing.com/vue-reactive-workflow.png)\n\n<!-- more -->\n\n## \n\n Vue \n\n data  props Vue  observe  defineReactive  data  props \n\n data data  observe  Observer Observer  data \n\n-  data ****Observer Mutation Method pushpopshiftunshiftsplicesort  revers  observe \n-  data **** defineReactive \n\n props  vm  [defineReactive](https://github.com/vuejs/vue/blob/3b8925bc7973bb71b33374281db10a945ca9854e/src/core/observer/index.js#L132-L194) \n\ndefineReactive \n\ndefineReactive  [Dep](https://github.com/vuejs/vue/blob/3b8925bc79/src/core/observer/dep.js#L9-L50)  Watcher  Watcher  Object.defineProperty  get  set  get get  set  Dep  dep  dep get  dep  depend <span style=\"color:red;font-weight:bold\"></span> Watcher watcher  addDep  dep  addSub  dep  subs subs  Subscriber  set  dep  notify  subs  watcher  update  run <span style=\"color:red;font-weight:bold\"></span> dep  watcher  Watcher renderWatchercomputedWatcher  userWatcher\n\n get  set \n\n- get ******** Watcher ****\n- set ******** Watcher ****\n\n get set  Watcher \n\n## \n\n ****  JavaScript \n\n Data  View  View  Data  Vue  Data  template  View JavaScript  DOM  DOM  innerHTML  appendChildinsertBefore  DOM \n\n Vue  template  Compiler Render Function\n\n```html\n<div id=\"foo\">\n  <p>{{name}}</p>\n</div>\n```\n\n```js\n// \nfunction anonymous() {\n  with(this) {\n    return _c('div',\n      { attrs: {\"id\": \"foo\" }},\n      { _v(\"\\n      \"+s_(name)+\"\\n    \")}\n    )\n  }\n}\n```\n\n vm  `$options.render` \n\n getter  setter \n\n\n\n## \n\n Vue  `_init`  vm  `$mount`  `$mount`  `$mount`  mountComponent \n\nmountComponent  [updateComponent](https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L169-L192)  updateComponent  `vm._render()`  `vm._update()` \n\n- `vm._render` `vm.$options.render`\n- `vm._update`  `vm._render`  DOM \n\n updateComponent  DOM  DOM \n\n [mountComponet](https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L141-L213)  DOM  DOM  updateComponent  Watcher \n\n [Watcher ](https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L197-L203) render watcher<span style=\"color:red;font-weight:bold\"></span> Watcher  updateComponent  updateComponent `vm.$options.render` dataprops  computed  get  render watcher  dep  subs **** dep  set  dep.notify render watcher  update run  updateComponent  set ****\n\n\n\n mountComponent  Watcher Watcher  watcher ********\n\n## \n\n computed  [initComputed](https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L169-L208) \n\n computed  computed watcher computed watcher  Dep  computed  computed watcher  [evaluate](https://github.com/vuejs/vue/blob/dev/src/core/observer/watcher.js#L210-L213)  depend  watcher watcher  Dep  Subscriber  computed watcher  dep  notify  computed  watcher  lazy watcher  expression \n\n## \n\n watch  [Vue.prototype.\\$watch](https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L303-L317) \n\n watch  Watcher  user watcher watcher data  computed  watch  Dep  Dep  user watchers update  run user callback\n\n## \n\n-  Vue  API  What  Why\n-  JavaScript \n- \n\n## Todo\n\n- Vue Vue API \n-  Babel  JSX \n-  Virtual DOM  React  Virtual DOM \n\n## \n\n- [Vue ](https://cn.vuejs.org/)\n  - [](https://cn.vuejs.org/v2/guide/reactivity.html)\n  - [](https://cn.vuejs.org/v2/guide/render-function.html)\n- [Vue ](http://hcysun.me/vue-design/)\n  - [](http://hcysun.me/vue-design/art/7vue-reactive.html)\n  - [](http://hcysun.me/vue-design/art/8vue-reactive-dep-watch.html)\n- [Vue  - ](https://ustbhuangyi.github.io/vue-analysis/reactive/)\n- [Vue ](https://zhuanlan.zhihu.com/p/21706165?utm_source=wechat_session&utm_medium=social&utm_oi=58000878338048)\n","slug":"analysis-of-vue-responsive-systrm","published":1,"updated":"2021-08-18T06:38:12.383Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99ym0000v31pm45hr2iy","content":"<p> Vue  Vue </p>\n<p><strong></strong> Vue </p>\n<p> <a href=\"https://github.com/ustbhuangyi\" target=\"_blank\" rel=\"noopener\">ustbhuangyi</a> </p>\n<p>Vue  datapropscomputed  watch Watcher Dep  Dependency<strong></strong><strong></strong></p>\n<p><img src=\"http://img.mrsingsing.com/vue-reactive-workflow.png\" alt=\"Vue Reactive\"></p>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Vue </p>\n<p> data  props Vue  observe  defineReactive  data  props </p>\n<p> data data  observe  Observer Observer  data </p>\n<ul>\n<li> data <strong></strong>Observer Mutation Method pushpopshiftunshiftsplicesort  revers  observe </li>\n<li> data <strong></strong> defineReactive </li>\n</ul>\n<p> props  vm  <a href=\"https://github.com/vuejs/vue/blob/3b8925bc7973bb71b33374281db10a945ca9854e/src/core/observer/index.js#L132-L194\" target=\"_blank\" rel=\"noopener\">defineReactive</a> </p>\n<p>defineReactive </p>\n<p>defineReactive  <a href=\"https://github.com/vuejs/vue/blob/3b8925bc79/src/core/observer/dep.js#L9-L50\" target=\"_blank\" rel=\"noopener\">Dep</a>  Watcher  Watcher  Object.defineProperty  get  set  get get  set  Dep  dep  dep get  dep  depend <span style=\"color:red;font-weight:bold\"></span> Watcher watcher  addDep  dep  addSub  dep  subs subs  Subscriber  set  dep  notify  subs  watcher  update  run <span style=\"color:red;font-weight:bold\"></span> dep  watcher  Watcher renderWatchercomputedWatcher  userWatcher</p>\n<p> get  set </p>\n<ul>\n<li>get <strong></strong><strong></strong> Watcher <strong></strong></li>\n<li>set <strong></strong><strong></strong> Watcher <strong></strong></li>\n</ul>\n<p> get set  Watcher </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <strong></strong>  JavaScript </p>\n<p> Data  View  View  Data  Vue  Data  template  View JavaScript  DOM  DOM  innerHTML  appendChildinsertBefore  DOM </p>\n<p> Vue  template  Compiler Render Function</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"foo\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">anonymous</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">with</span>(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _c(<span class=\"string\">'div'</span>,</span><br><span class=\"line\">      &#123; <span class=\"attr\">attrs</span>: &#123;<span class=\"string\">\"id\"</span>: <span class=\"string\">\"foo\"</span> &#125;&#125;,</span><br><span class=\"line\">      &#123; _v(<span class=\"string\">\"\\n      \"</span>+s_(name)+<span class=\"string\">\"\\n    \"</span>)&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> vm  <code>$options.render</code> </p>\n<p> getter  setter </p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Vue  <code>_init</code>  vm  <code>$mount</code>  <code>$mount</code>  <code>$mount</code>  mountComponent </p>\n<p>mountComponent  <a href=\"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L169-L192\" target=\"_blank\" rel=\"noopener\">updateComponent</a>  updateComponent  <code>vm._render()</code>  <code>vm._update()</code> </p>\n<ul>\n<li><code>vm._render</code> <code>vm.$options.render</code></li>\n<li><code>vm._update</code>  <code>vm._render</code>  DOM </li>\n</ul>\n<p> updateComponent  DOM  DOM </p>\n<p> <a href=\"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L141-L213\" target=\"_blank\" rel=\"noopener\">mountComponet</a>  DOM  DOM  updateComponent  Watcher </p>\n<p> <a href=\"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L197-L203\" target=\"_blank\" rel=\"noopener\">Watcher </a> render watcher<span style=\"color:red;font-weight:bold\"></span> Watcher  updateComponent  updateComponent <code>vm.$options.render</code> dataprops  computed  get  render watcher  dep  subs <strong></strong> dep  set  dep.notify render watcher  update run  updateComponent  set <strong></strong></p>\n<p></p>\n<p> mountComponent  Watcher Watcher  watcher <strong></strong><strong></strong></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> computed  <a href=\"https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L169-L208\" target=\"_blank\" rel=\"noopener\">initComputed</a> </p>\n<p> computed  computed watcher computed watcher  Dep  computed  computed watcher  <a href=\"https://github.com/vuejs/vue/blob/dev/src/core/observer/watcher.js#L210-L213\" target=\"_blank\" rel=\"noopener\">evaluate</a>  depend  watcher watcher  Dep  Subscriber  computed watcher  dep  notify  computed  watcher  lazy watcher  expression </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> watch  <a href=\"https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L303-L317\" target=\"_blank\" rel=\"noopener\">Vue.prototype.\\$watch</a> </p>\n<p> watch  Watcher  user watcher watcher data  computed  watch  Dep  Dep  user watchers update  run user callback</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> Vue  API  What  Why</li>\n<li> JavaScript </li>\n<li></li>\n</ul>\n<h2 id=\"Todo\"><a href=\"#Todo\" class=\"headerlink\" title=\"Todo\"></a>Todo</h2><ul>\n<li>Vue Vue API </li>\n<li> Babel  JSX </li>\n<li> Virtual DOM  React  Virtual DOM </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://cn.vuejs.org/\" target=\"_blank\" rel=\"noopener\">Vue </a><ul>\n<li><a href=\"https://cn.vuejs.org/v2/guide/reactivity.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://cn.vuejs.org/v2/guide/render-function.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n<li><a href=\"http://hcysun.me/vue-design/\" target=\"_blank\" rel=\"noopener\">Vue </a><ul>\n<li><a href=\"http://hcysun.me/vue-design/art/7vue-reactive.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"http://hcysun.me/vue-design/art/8vue-reactive-dep-watch.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n<li><a href=\"https://ustbhuangyi.github.io/vue-analysis/reactive/\" target=\"_blank\" rel=\"noopener\">Vue  - </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/21706165?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=58000878338048\" target=\"_blank\" rel=\"noopener\">Vue </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p> Vue  Vue </p>\n<p><strong></strong> Vue </p>\n<p> <a href=\"https://github.com/ustbhuangyi\" target=\"_blank\" rel=\"noopener\">ustbhuangyi</a> </p>\n<p>Vue  datapropscomputed  watch Watcher Dep  Dependency<strong></strong><strong></strong></p>\n<p><img src=\"http://img.mrsingsing.com/vue-reactive-workflow.png\" alt=\"Vue Reactive\"></p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Vue </p>\n<p> data  props Vue  observe  defineReactive  data  props </p>\n<p> data data  observe  Observer Observer  data </p>\n<ul>\n<li> data <strong></strong>Observer Mutation Method pushpopshiftunshiftsplicesort  revers  observe </li>\n<li> data <strong></strong> defineReactive </li>\n</ul>\n<p> props  vm  <a href=\"https://github.com/vuejs/vue/blob/3b8925bc7973bb71b33374281db10a945ca9854e/src/core/observer/index.js#L132-L194\" target=\"_blank\" rel=\"noopener\">defineReactive</a> </p>\n<p>defineReactive </p>\n<p>defineReactive  <a href=\"https://github.com/vuejs/vue/blob/3b8925bc79/src/core/observer/dep.js#L9-L50\" target=\"_blank\" rel=\"noopener\">Dep</a>  Watcher  Watcher  Object.defineProperty  get  set  get get  set  Dep  dep  dep get  dep  depend <span style=\"color:red;font-weight:bold\"></span> Watcher watcher  addDep  dep  addSub  dep  subs subs  Subscriber  set  dep  notify  subs  watcher  update  run <span style=\"color:red;font-weight:bold\"></span> dep  watcher  Watcher renderWatchercomputedWatcher  userWatcher</p>\n<p> get  set </p>\n<ul>\n<li>get <strong></strong><strong></strong> Watcher <strong></strong></li>\n<li>set <strong></strong><strong></strong> Watcher <strong></strong></li>\n</ul>\n<p> get set  Watcher </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <strong></strong>  JavaScript </p>\n<p> Data  View  View  Data  Vue  Data  template  View JavaScript  DOM  DOM  innerHTML  appendChildinsertBefore  DOM </p>\n<p> Vue  template  Compiler Render Function</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"foo\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">anonymous</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">with</span>(<span class=\"keyword\">this</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _c(<span class=\"string\">'div'</span>,</span><br><span class=\"line\">      &#123; <span class=\"attr\">attrs</span>: &#123;<span class=\"string\">\"id\"</span>: <span class=\"string\">\"foo\"</span> &#125;&#125;,</span><br><span class=\"line\">      &#123; _v(<span class=\"string\">\"\\n      \"</span>+s_(name)+<span class=\"string\">\"\\n    \"</span>)&#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> vm  <code>$options.render</code> </p>\n<p> getter  setter </p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Vue  <code>_init</code>  vm  <code>$mount</code>  <code>$mount</code>  <code>$mount</code>  mountComponent </p>\n<p>mountComponent  <a href=\"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L169-L192\" target=\"_blank\" rel=\"noopener\">updateComponent</a>  updateComponent  <code>vm._render()</code>  <code>vm._update()</code> </p>\n<ul>\n<li><code>vm._render</code> <code>vm.$options.render</code></li>\n<li><code>vm._update</code>  <code>vm._render</code>  DOM </li>\n</ul>\n<p> updateComponent  DOM  DOM </p>\n<p> <a href=\"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L141-L213\" target=\"_blank\" rel=\"noopener\">mountComponet</a>  DOM  DOM  updateComponent  Watcher </p>\n<p> <a href=\"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L197-L203\" target=\"_blank\" rel=\"noopener\">Watcher </a> render watcher<span style=\"color:red;font-weight:bold\"></span> Watcher  updateComponent  updateComponent <code>vm.$options.render</code> dataprops  computed  get  render watcher  dep  subs <strong></strong> dep  set  dep.notify render watcher  update run  updateComponent  set <strong></strong></p>\n<p></p>\n<p> mountComponent  Watcher Watcher  watcher <strong></strong><strong></strong></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> computed  <a href=\"https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L169-L208\" target=\"_blank\" rel=\"noopener\">initComputed</a> </p>\n<p> computed  computed watcher computed watcher  Dep  computed  computed watcher  <a href=\"https://github.com/vuejs/vue/blob/dev/src/core/observer/watcher.js#L210-L213\" target=\"_blank\" rel=\"noopener\">evaluate</a>  depend  watcher watcher  Dep  Subscriber  computed watcher  dep  notify  computed  watcher  lazy watcher  expression </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> watch  <a href=\"https://github.com/vuejs/vue/blob/dev/src/core/instance/state.js#L303-L317\" target=\"_blank\" rel=\"noopener\">Vue.prototype.\\$watch</a> </p>\n<p> watch  Watcher  user watcher watcher data  computed  watch  Dep  Dep  user watchers update  run user callback</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> Vue  API  What  Why</li>\n<li> JavaScript </li>\n<li></li>\n</ul>\n<h2 id=\"Todo\"><a href=\"#Todo\" class=\"headerlink\" title=\"Todo\"></a>Todo</h2><ul>\n<li>Vue Vue API </li>\n<li> Babel  JSX </li>\n<li> Virtual DOM  React  Virtual DOM </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://cn.vuejs.org/\" target=\"_blank\" rel=\"noopener\">Vue </a><ul>\n<li><a href=\"https://cn.vuejs.org/v2/guide/reactivity.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://cn.vuejs.org/v2/guide/render-function.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n<li><a href=\"http://hcysun.me/vue-design/\" target=\"_blank\" rel=\"noopener\">Vue </a><ul>\n<li><a href=\"http://hcysun.me/vue-design/art/7vue-reactive.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"http://hcysun.me/vue-design/art/8vue-reactive-dep-watch.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n<li><a href=\"https://ustbhuangyi.github.io/vue-analysis/reactive/\" target=\"_blank\" rel=\"noopener\">Vue  - </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/21706165?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=58000878338048\" target=\"_blank\" rel=\"noopener\">Vue </a></li>\n</ul>"},{"title":" RBAC ","date":"2020-05-15T00:00:00.000Z","_content":"\n QQ  RBAC \n\n## \n\n****  `+`\n\n\n\n- ACLAccess Control List ` -> `\n- RBACRole-Based Access Control ****  ` ->  -> `\n- ABACAttribute-Based Access Control ****  `-> `\n- PBACPolicy-Based Access Control **** ` ->  -> / + `\n\n ACL \n\n RBAC  ACL RBAC \n\n Google \n\n<!-- more -->\n\n## RBAC \n\n RBAC  RBAC 0~3\n\n### RBAC0 \n\nRBAC9 \n\n****\n\n![RBAC0 ](http://img.mrsingsing.com/authentication-rbac0)\n\n### RBAC1 \n\nRBAC1  RBAC0 \n\n![RBAC1 ](http://img.mrsingsing.com/authentication-rbac1)\n\n****\n\nRBAC1 \n\n### RBAC2 \n\n RBAC2 \n\n-  SSD\n  - \n  -  CEO \n  - \n-  DSD\n  - \n\n![RBAC2 ](http://img.mrsingsing.com/authentication-rbac2)\n\n### RBAC3 \n\nRBAC3  `RBAC1 + RBAC2`  RBAC3  RBAC1  RBAC2 \n\nRBAC \n\n****\n\n1. \n2. \n\n****\n\n1. RBAC \n\n## RBAC \n\n RBAC \n\n\n\n\n\n![RBAC ](http://img.mrsingsing.com/autification-rbac-architect)\n\n RBAC  **** \n\n## \n\n\n\n- user UID \n- role\n- permission\n- -\n- -\n\n![](http://img.mrsingsing.com/authentication-rbac-database-table-design)\n\n![](http://img.mrsingsing.com/authentication-rbac-feature-module)\n\n## \n\n\n\n DOM \n\n- \n- \n- \n\n![Ant Design Pro](http://img.mrsingsing.com/authentication-rbac-management-system)\n\n\n\n 404 \n\n\n\n React  Context API  HTTP \n\n [Ant Design Pro](https://pro.ant.design/docs/authority-management-cn) \n\n---\n\n****\n\n- [RBAC --](http://www.woshipm.com/pd/1150093.html)\n- [ RBAC ](https://juejin.im/post/5e048326f265da33f8653c27)\n- [ 100 ](https://www.uisdc.com/100-solutions-for-character-permission-design)\n- [](http://www.woshipm.com/pd/3745592.html)\n- [RBAC ](http://www.woshipm.com/pd/440765.html)\n- [](https://www.zhihu.com/question/20313385)\n- [ RBAC ](https://www.cnblogs.com/zwq194/archive/2011/03/07/1974821.html)\n- [RBAC ](https://juejin.im/post/5e72cfa16fb9a07cc01a4262)\n","source":"_posts/architect-design-based-on-rbac.md","raw":"---\ntitle:  RBAC \ndate: '2020-05-15'\n---\n\n QQ  RBAC \n\n## \n\n****  `+`\n\n\n\n- ACLAccess Control List ` -> `\n- RBACRole-Based Access Control ****  ` ->  -> `\n- ABACAttribute-Based Access Control ****  `-> `\n- PBACPolicy-Based Access Control **** ` ->  -> / + `\n\n ACL \n\n RBAC  ACL RBAC \n\n Google \n\n<!-- more -->\n\n## RBAC \n\n RBAC  RBAC 0~3\n\n### RBAC0 \n\nRBAC9 \n\n****\n\n![RBAC0 ](http://img.mrsingsing.com/authentication-rbac0)\n\n### RBAC1 \n\nRBAC1  RBAC0 \n\n![RBAC1 ](http://img.mrsingsing.com/authentication-rbac1)\n\n****\n\nRBAC1 \n\n### RBAC2 \n\n RBAC2 \n\n-  SSD\n  - \n  -  CEO \n  - \n-  DSD\n  - \n\n![RBAC2 ](http://img.mrsingsing.com/authentication-rbac2)\n\n### RBAC3 \n\nRBAC3  `RBAC1 + RBAC2`  RBAC3  RBAC1  RBAC2 \n\nRBAC \n\n****\n\n1. \n2. \n\n****\n\n1. RBAC \n\n## RBAC \n\n RBAC \n\n\n\n\n\n![RBAC ](http://img.mrsingsing.com/autification-rbac-architect)\n\n RBAC  **** \n\n## \n\n\n\n- user UID \n- role\n- permission\n- -\n- -\n\n![](http://img.mrsingsing.com/authentication-rbac-database-table-design)\n\n![](http://img.mrsingsing.com/authentication-rbac-feature-module)\n\n## \n\n\n\n DOM \n\n- \n- \n- \n\n![Ant Design Pro](http://img.mrsingsing.com/authentication-rbac-management-system)\n\n\n\n 404 \n\n\n\n React  Context API  HTTP \n\n [Ant Design Pro](https://pro.ant.design/docs/authority-management-cn) \n\n---\n\n****\n\n- [RBAC --](http://www.woshipm.com/pd/1150093.html)\n- [ RBAC ](https://juejin.im/post/5e048326f265da33f8653c27)\n- [ 100 ](https://www.uisdc.com/100-solutions-for-character-permission-design)\n- [](http://www.woshipm.com/pd/3745592.html)\n- [RBAC ](http://www.woshipm.com/pd/440765.html)\n- [](https://www.zhihu.com/question/20313385)\n- [ RBAC ](https://www.cnblogs.com/zwq194/archive/2011/03/07/1974821.html)\n- [RBAC ](https://juejin.im/post/5e72cfa16fb9a07cc01a4262)\n","slug":"architect-design-based-on-rbac","published":1,"updated":"2021-08-18T03:29:03.052Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99yq0002v31pmz6012x7","content":"<p> QQ  RBAC </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong>  <code>+</code></p>\n<p></p>\n<ul>\n<li>ACLAccess Control List <code> -&gt; </code></li>\n<li>RBACRole-Based Access Control <strong></strong>  <code> -&gt;  -&gt; </code></li>\n<li>ABACAttribute-Based Access Control <strong></strong>  <code>-&gt; </code></li>\n<li>PBACPolicy-Based Access Control <strong></strong> <code> -&gt;  -&gt; / + </code></li>\n</ul>\n<p> ACL </p>\n<p> RBAC  ACL RBAC </p>\n<p> Google </p>\n<a id=\"more\"></a>\n<h2 id=\"RBAC-\"><a href=\"#RBAC-\" class=\"headerlink\" title=\"RBAC \"></a>RBAC </h2><p> RBAC  RBAC 0~3</p>\n<h3 id=\"RBAC0-\"><a href=\"#RBAC0-\" class=\"headerlink\" title=\"RBAC0 \"></a>RBAC0 </h3><p>RBAC9 </p>\n<p><strong></strong></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac0\" alt=\"RBAC0 \"></p>\n<h3 id=\"RBAC1-\"><a href=\"#RBAC1-\" class=\"headerlink\" title=\"RBAC1 \"></a>RBAC1 </h3><p>RBAC1  RBAC0 </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac1\" alt=\"RBAC1 \"></p>\n<p><strong></strong></p>\n<p>RBAC1 </p>\n<h3 id=\"RBAC2-\"><a href=\"#RBAC2-\" class=\"headerlink\" title=\"RBAC2 \"></a>RBAC2 </h3><p> RBAC2 </p>\n<ul>\n<li> SSD<ul>\n<li></li>\n<li> CEO </li>\n<li></li>\n</ul>\n</li>\n<li> DSD<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac2\" alt=\"RBAC2 \"></p>\n<h3 id=\"RBAC3-\"><a href=\"#RBAC3-\" class=\"headerlink\" title=\"RBAC3 \"></a>RBAC3 </h3><p>RBAC3  <code>RBAC1 + RBAC2</code>  RBAC3  RBAC1  RBAC2 </p>\n<p>RBAC </p>\n<p><strong></strong></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p><strong></strong></p>\n<ol>\n<li>RBAC </li>\n</ol>\n<h2 id=\"RBAC-\"><a href=\"#RBAC-\" class=\"headerlink\" title=\"RBAC \"></a>RBAC </h2><p> RBAC </p>\n<p></p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/autification-rbac-architect\" alt=\"RBAC \"></p>\n<p> RBAC  <strong></strong> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li>user UID </li>\n<li>role</li>\n<li>permission</li>\n<li>-</li>\n<li>-</li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac-database-table-design\" alt=\"\"></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac-feature-module\" alt=\"\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> DOM </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac-management-system\" alt=\"Ant Design Pro\"></p>\n<p></p>\n<p> 404 </p>\n<p></p>\n<p> React  Context API  HTTP </p>\n<p> <a href=\"https://pro.ant.design/docs/authority-management-cn\" target=\"_blank\" rel=\"noopener\">Ant Design Pro</a> </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"http://www.woshipm.com/pd/1150093.html\" target=\"_blank\" rel=\"noopener\">RBAC --</a></li>\n<li><a href=\"https://juejin.im/post/5e048326f265da33f8653c27\" target=\"_blank\" rel=\"noopener\"> RBAC </a></li>\n<li><a href=\"https://www.uisdc.com/100-solutions-for-character-permission-design\" target=\"_blank\" rel=\"noopener\"> 100 </a></li>\n<li><a href=\"http://www.woshipm.com/pd/3745592.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"http://www.woshipm.com/pd/440765.html\" target=\"_blank\" rel=\"noopener\">RBAC </a></li>\n<li><a href=\"https://www.zhihu.com/question/20313385\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.cnblogs.com/zwq194/archive/2011/03/07/1974821.html\" target=\"_blank\" rel=\"noopener\"> RBAC </a></li>\n<li><a href=\"https://juejin.im/post/5e72cfa16fb9a07cc01a4262\" target=\"_blank\" rel=\"noopener\">RBAC </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p> QQ  RBAC </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong>  <code>+</code></p>\n<p></p>\n<ul>\n<li>ACLAccess Control List <code> -&gt; </code></li>\n<li>RBACRole-Based Access Control <strong></strong>  <code> -&gt;  -&gt; </code></li>\n<li>ABACAttribute-Based Access Control <strong></strong>  <code>-&gt; </code></li>\n<li>PBACPolicy-Based Access Control <strong></strong> <code> -&gt;  -&gt; / + </code></li>\n</ul>\n<p> ACL </p>\n<p> RBAC  ACL RBAC </p>\n<p> Google </p>","more":"<h2 id=\"RBAC-\"><a href=\"#RBAC-\" class=\"headerlink\" title=\"RBAC \"></a>RBAC </h2><p> RBAC  RBAC 0~3</p>\n<h3 id=\"RBAC0-\"><a href=\"#RBAC0-\" class=\"headerlink\" title=\"RBAC0 \"></a>RBAC0 </h3><p>RBAC9 </p>\n<p><strong></strong></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac0\" alt=\"RBAC0 \"></p>\n<h3 id=\"RBAC1-\"><a href=\"#RBAC1-\" class=\"headerlink\" title=\"RBAC1 \"></a>RBAC1 </h3><p>RBAC1  RBAC0 </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac1\" alt=\"RBAC1 \"></p>\n<p><strong></strong></p>\n<p>RBAC1 </p>\n<h3 id=\"RBAC2-\"><a href=\"#RBAC2-\" class=\"headerlink\" title=\"RBAC2 \"></a>RBAC2 </h3><p> RBAC2 </p>\n<ul>\n<li> SSD<ul>\n<li></li>\n<li> CEO </li>\n<li></li>\n</ul>\n</li>\n<li> DSD<ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac2\" alt=\"RBAC2 \"></p>\n<h3 id=\"RBAC3-\"><a href=\"#RBAC3-\" class=\"headerlink\" title=\"RBAC3 \"></a>RBAC3 </h3><p>RBAC3  <code>RBAC1 + RBAC2</code>  RBAC3  RBAC1  RBAC2 </p>\n<p>RBAC </p>\n<p><strong></strong></p>\n<ol>\n<li></li>\n<li></li>\n</ol>\n<p><strong></strong></p>\n<ol>\n<li>RBAC </li>\n</ol>\n<h2 id=\"RBAC-\"><a href=\"#RBAC-\" class=\"headerlink\" title=\"RBAC \"></a>RBAC </h2><p> RBAC </p>\n<p></p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/autification-rbac-architect\" alt=\"RBAC \"></p>\n<p> RBAC  <strong></strong> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li>user UID </li>\n<li>role</li>\n<li>permission</li>\n<li>-</li>\n<li>-</li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac-database-table-design\" alt=\"\"></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac-feature-module\" alt=\"\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> DOM </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/authentication-rbac-management-system\" alt=\"Ant Design Pro\"></p>\n<p></p>\n<p> 404 </p>\n<p></p>\n<p> React  Context API  HTTP </p>\n<p> <a href=\"https://pro.ant.design/docs/authority-management-cn\" target=\"_blank\" rel=\"noopener\">Ant Design Pro</a> </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"http://www.woshipm.com/pd/1150093.html\" target=\"_blank\" rel=\"noopener\">RBAC --</a></li>\n<li><a href=\"https://juejin.im/post/5e048326f265da33f8653c27\" target=\"_blank\" rel=\"noopener\"> RBAC </a></li>\n<li><a href=\"https://www.uisdc.com/100-solutions-for-character-permission-design\" target=\"_blank\" rel=\"noopener\"> 100 </a></li>\n<li><a href=\"http://www.woshipm.com/pd/3745592.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"http://www.woshipm.com/pd/440765.html\" target=\"_blank\" rel=\"noopener\">RBAC </a></li>\n<li><a href=\"https://www.zhihu.com/question/20313385\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.cnblogs.com/zwq194/archive/2011/03/07/1974821.html\" target=\"_blank\" rel=\"noopener\"> RBAC </a></li>\n<li><a href=\"https://juejin.im/post/5e72cfa16fb9a07cc01a4262\" target=\"_blank\" rel=\"noopener\">RBAC </a></li>\n</ul>"},{"title":" CDN ","date":"2020-08-20T00:00:00.000Z","_content":"\n**Content Delivery Network  Content Distribution Network CDN**  ****  ********\n\n## \n\nCDN  ****  ********  ****  **** \n\n CDN \n\n```js\nCDN =  +  + ;\n```\n\nCDN ************  **** 4 Traffic Management CDN \n\n## \n\n CDN  DNS  CDN  IP\n\n CDN  DNS  `www.taobao.com` CDN  HTTP \n\n![CDN Workflow](http://img.mrsingsing.com/about-cdn-cdn-workflow.jpg)\n\n<!-- more -->\n\n1.  `www.taobao.com`  LDNS DNS\n2. LDNS  `www.taobao.com`  IP  DNS \n3.  DNS  `www.taobao.com`  CNAME `www.taobao.alicdn.com`  IP \n4.  DNS  IP \n5. LDNS  DNS  IP \n6.  IP \n7.  IP \n   -  IP  7  8\n   -  IP \n\n> Local DNS  DNS\n>  HOST  CDN \n\nDNS \n\n1. CDN  IP  URL****\n2. ****\n   -  IP \n   - \n   -  URL \n   - \n      IP \n3.  IP \n\n## \n\n CDN \n\n- **** Cache Cache Cache Cache Cache  CDN \n- ****GSLBSLBGSLB  Cache SLB \n- ****\n\nCDN  BGP \n\n CDN  CDN  CDN \n\n**CDN **\n\n![CDN ](http://img.mrsingsing.com/about-cdn-section.jpg)\n\n**CDN **\n\n![CDN ](http://img.mrsingsing.com/about-cdn-data-flow.jpg)\n\n## \n\n### \n\n ECS HTMLCSSJS OSS \n\n![](http://img.mrsingsing.com/about-cdn-qiniu-accelerate.png)\n\n CDN  OSS \n\n****\n\n- \n- \n- \n- \n\n### \n\n App  `apk` `mp3` `exe` `zip`  20M  App \n\n![](http://img.mrsingsing.com/about-cdn-qiniu-file.png)\n\n****\n\n- \n- \n- \n- \n\n### \n\n App `mp4``flv``rmvb``wmv``HLS` \n\n\n\nCDN  RTMP \n\n **** \n\n CDN  **** \n\n****\n\n- \n- \n- \n- \n\n### \n\n\n\n### \n\n CDN  CDN ER  CDN  CDN  CDN \n\n- Geo IP\n- Fetch JS  api fetch  http  fetch \n- AB testAB \n- Precache/PrefetchCDN \n- Race\n- Log Server\n- 3xx 302 \n- Redirect\n- Deny bot\n- Waf waf \n\n CDN \n\n## \n\n CDN  CDN  CDN \n\n### \n\n CDN \n\n- ****\n- ****\n- ****\n- ****\n- ****\n  - ****\n  - **** `=/+`\n- ****\n\n>  CDN  CDN 100% 0\n\n CDN  CDN \n\nCDN \n\n### \n\n `html``js``jpg``css` \n\n 3 ****\n\n-  DNS  IP  TCP  **CDN **\n-  CDN \n\n DNS TCP SSL \n\n![CDN Upload Flow](http://img.mrsingsing.com/about-cdn-upload-flow.png)\n\n DNS TCP SSL \n\n![CDN Download Flow](http://img.mrsingsing.com/about-cdn-download-flow.png)\n\n### \n\n 20M  ****  ****\n\n### \n\n `flv``mp4``wmv``mkv` \n\n- ****\n- **** 100 \n\n## CDN \n\n CDN \n\n- [](https://www.aliyun.com/product/cdn)\n- [](https://cloud.tencent.com/product/cdn)\n- [](https://www.huaweicloud.com/product/cdn.html)\n- [](https://www.qiniu.com/products/fusion)\n\n###  CDN\n\n\n\n- **** ****\n- **** CDN  CDN  CDN \n\n TCP  TCP  TCP  CDN  TCP  TCP \n\n### \n\n-  URL CDN  CDN CDN \n-  URL  CDN  CDN \n\n## \n\n- [ ](https://zh.wikipedia.org/wiki/%E5%85%A7%E5%AE%B9%E5%82%B3%E9%81%9E%E7%B6%B2%E8%B7%AF)\n- [ CDN ](http://book.51cto.com/art/201205/338756.htm)\n- [ CDN ](https://zhuanlan.zhihu.com/p/28939811)\n- [ HTTP  CDN ](http://dopro.io/http-cache-and-cdn-cache.html)\n- [  CDN ](https://zhuanlan.zhihu.com/p/31167721?group_id=915177705310674944)\n- [ CDN HTTPS ](https://juejin.im/post/59f9538f6fb9a0450a66aa2b)\n- [  CDN ](https://github.com/renaesop/blog/issues/1)\n- [  CDN CDN ](https://help.aliyun.com/document_detail/140425.html)\n- [ SSR  CDN ](https://juejin.im/post/6847902220222988301)\n","source":"_posts/about-content-delivery-network.md","raw":"---\ntitle:  CDN \ndate: '2020-08-20'\n---\n\n**Content Delivery Network  Content Distribution Network CDN**  ****  ********\n\n## \n\nCDN  ****  ********  ****  **** \n\n CDN \n\n```js\nCDN =  +  + ;\n```\n\nCDN ************  **** 4 Traffic Management CDN \n\n## \n\n CDN  DNS  CDN  IP\n\n CDN  DNS  `www.taobao.com` CDN  HTTP \n\n![CDN Workflow](http://img.mrsingsing.com/about-cdn-cdn-workflow.jpg)\n\n<!-- more -->\n\n1.  `www.taobao.com`  LDNS DNS\n2. LDNS  `www.taobao.com`  IP  DNS \n3.  DNS  `www.taobao.com`  CNAME `www.taobao.alicdn.com`  IP \n4.  DNS  IP \n5. LDNS  DNS  IP \n6.  IP \n7.  IP \n   -  IP  7  8\n   -  IP \n\n> Local DNS  DNS\n>  HOST  CDN \n\nDNS \n\n1. CDN  IP  URL****\n2. ****\n   -  IP \n   - \n   -  URL \n   - \n      IP \n3.  IP \n\n## \n\n CDN \n\n- **** Cache Cache Cache Cache Cache  CDN \n- ****GSLBSLBGSLB  Cache SLB \n- ****\n\nCDN  BGP \n\n CDN  CDN  CDN \n\n**CDN **\n\n![CDN ](http://img.mrsingsing.com/about-cdn-section.jpg)\n\n**CDN **\n\n![CDN ](http://img.mrsingsing.com/about-cdn-data-flow.jpg)\n\n## \n\n### \n\n ECS HTMLCSSJS OSS \n\n![](http://img.mrsingsing.com/about-cdn-qiniu-accelerate.png)\n\n CDN  OSS \n\n****\n\n- \n- \n- \n- \n\n### \n\n App  `apk` `mp3` `exe` `zip`  20M  App \n\n![](http://img.mrsingsing.com/about-cdn-qiniu-file.png)\n\n****\n\n- \n- \n- \n- \n\n### \n\n App `mp4``flv``rmvb``wmv``HLS` \n\n\n\nCDN  RTMP \n\n **** \n\n CDN  **** \n\n****\n\n- \n- \n- \n- \n\n### \n\n\n\n### \n\n CDN  CDN ER  CDN  CDN  CDN \n\n- Geo IP\n- Fetch JS  api fetch  http  fetch \n- AB testAB \n- Precache/PrefetchCDN \n- Race\n- Log Server\n- 3xx 302 \n- Redirect\n- Deny bot\n- Waf waf \n\n CDN \n\n## \n\n CDN  CDN  CDN \n\n### \n\n CDN \n\n- ****\n- ****\n- ****\n- ****\n- ****\n  - ****\n  - **** `=/+`\n- ****\n\n>  CDN  CDN 100% 0\n\n CDN  CDN \n\nCDN \n\n### \n\n `html``js``jpg``css` \n\n 3 ****\n\n-  DNS  IP  TCP  **CDN **\n-  CDN \n\n DNS TCP SSL \n\n![CDN Upload Flow](http://img.mrsingsing.com/about-cdn-upload-flow.png)\n\n DNS TCP SSL \n\n![CDN Download Flow](http://img.mrsingsing.com/about-cdn-download-flow.png)\n\n### \n\n 20M  ****  ****\n\n### \n\n `flv``mp4``wmv``mkv` \n\n- ****\n- **** 100 \n\n## CDN \n\n CDN \n\n- [](https://www.aliyun.com/product/cdn)\n- [](https://cloud.tencent.com/product/cdn)\n- [](https://www.huaweicloud.com/product/cdn.html)\n- [](https://www.qiniu.com/products/fusion)\n\n###  CDN\n\n\n\n- **** ****\n- **** CDN  CDN  CDN \n\n TCP  TCP  TCP  CDN  TCP  TCP \n\n### \n\n-  URL CDN  CDN CDN \n-  URL  CDN  CDN \n\n## \n\n- [ ](https://zh.wikipedia.org/wiki/%E5%85%A7%E5%AE%B9%E5%82%B3%E9%81%9E%E7%B6%B2%E8%B7%AF)\n- [ CDN ](http://book.51cto.com/art/201205/338756.htm)\n- [ CDN ](https://zhuanlan.zhihu.com/p/28939811)\n- [ HTTP  CDN ](http://dopro.io/http-cache-and-cdn-cache.html)\n- [  CDN ](https://zhuanlan.zhihu.com/p/31167721?group_id=915177705310674944)\n- [ CDN HTTPS ](https://juejin.im/post/59f9538f6fb9a0450a66aa2b)\n- [  CDN ](https://github.com/renaesop/blog/issues/1)\n- [  CDN CDN ](https://help.aliyun.com/document_detail/140425.html)\n- [ SSR  CDN ](https://juejin.im/post/6847902220222988301)\n","slug":"about-content-delivery-network","published":1,"updated":"2021-08-18T06:38:14.302Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99yr0003v31pctz9u03g","content":"<p><strong>Content Delivery Network  Content Distribution Network CDN</strong>  <strong></strong>  <strong></strong><strong></strong></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CDN  <strong></strong>  <strong></strong><strong></strong>  <strong></strong>  <strong></strong> </p>\n<p> CDN </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CDN =  +  + ;</span><br></pre></td></tr></table></figure>\n<p>CDN <strong></strong><strong></strong><strong></strong>  <strong></strong> 4 Traffic Management CDN </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> CDN  DNS  CDN  IP</p>\n<p> CDN  DNS  <code>www.taobao.com</code> CDN  HTTP </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-cdn-workflow.jpg\" alt=\"CDN Workflow\"></p>\n<a id=\"more\"></a>\n<ol>\n<li> <code>www.taobao.com</code>  LDNS DNS</li>\n<li>LDNS  <code>www.taobao.com</code>  IP  DNS </li>\n<li> DNS  <code>www.taobao.com</code>  CNAME <code>www.taobao.alicdn.com</code>  IP </li>\n<li> DNS  IP </li>\n<li>LDNS  DNS  IP </li>\n<li> IP </li>\n<li> IP <ul>\n<li> IP  7  8</li>\n<li> IP </li>\n</ul>\n</li>\n</ol>\n<blockquote>\n<p>Local DNS  DNS<br> HOST  CDN </p>\n</blockquote>\n<p>DNS </p>\n<ol>\n<li>CDN  IP  URL<strong></strong></li>\n<li><strong></strong><ul>\n<li> IP </li>\n<li></li>\n<li> URL </li>\n<li><br> IP </li>\n</ul>\n</li>\n<li> IP </li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> CDN </p>\n<ul>\n<li><strong></strong> Cache Cache Cache Cache Cache  CDN </li>\n<li><strong></strong>GSLBSLBGSLB  Cache SLB </li>\n<li><strong></strong></li>\n</ul>\n<p>CDN  BGP </p>\n<p> CDN  CDN  CDN </p>\n<p><strong>CDN </strong></p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-section.jpg\" alt=\"CDN \"></p>\n<p><strong>CDN </strong></p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-data-flow.jpg\" alt=\"CDN \"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ECS HTMLCSSJS OSS </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-qiniu-accelerate.png\" alt=\"\"></p>\n<p> CDN  OSS </p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> App  <code>apk</code> <code>mp3</code> <code>exe</code> <code>zip</code>  20M  App </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-qiniu-file.png\" alt=\"\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> App <code>mp4</code><code>flv</code><code>rmvb</code><code>wmv</code><code>HLS</code> </p>\n<p></p>\n<p>CDN  RTMP </p>\n<p> <strong></strong> </p>\n<p> CDN  <strong></strong> </p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> CDN  CDN ER  CDN  CDN  CDN </p>\n<ul>\n<li>Geo IP</li>\n<li>Fetch JS  api fetch  http  fetch </li>\n<li>AB testAB </li>\n<li>Precache/PrefetchCDN </li>\n<li>Race</li>\n<li>Log Server</li>\n<li>3xx 302 </li>\n<li>Redirect</li>\n<li>Deny bot</li>\n<li>Waf waf </li>\n</ul>\n<p> CDN </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> CDN  CDN  CDN </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> CDN </p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong><ul>\n<li><strong></strong></li>\n<li><strong></strong> <code>=/+</code></li>\n</ul>\n</li>\n<li><strong></strong></li>\n</ul>\n<blockquote>\n<p> CDN  CDN 100% 0</p>\n</blockquote>\n<p> CDN  CDN </p>\n<p>CDN </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>html</code><code>js</code><code>jpg</code><code>css</code> </p>\n<p> 3 <strong></strong></p>\n<ul>\n<li> DNS  IP  TCP  <strong>CDN </strong></li>\n<li> CDN </li>\n</ul>\n<p> DNS TCP SSL </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-upload-flow.png\" alt=\"CDN Upload Flow\"></p>\n<p> DNS TCP SSL </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-download-flow.png\" alt=\"CDN Download Flow\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> 20M  <strong></strong>  <strong></strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>flv</code><code>mp4</code><code>wmv</code><code>mkv</code> </p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong> 100 </li>\n</ul>\n<h2 id=\"CDN-\"><a href=\"#CDN-\" class=\"headerlink\" title=\"CDN \"></a>CDN </h2><p> CDN </p>\n<ul>\n<li><a href=\"https://www.aliyun.com/product/cdn\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://cloud.tencent.com/product/cdn\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.huaweicloud.com/product/cdn.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.qiniu.com/products/fusion\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<h3 id=\"-CDN\"><a href=\"#-CDN\" class=\"headerlink\" title=\" CDN\"></a> CDN</h3><p></p>\n<ul>\n<li><strong></strong> <strong></strong></li>\n<li><strong></strong> CDN  CDN  CDN </li>\n</ul>\n<p> TCP  TCP  TCP  CDN  TCP  TCP </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li> URL CDN  CDN CDN </li>\n<li> URL  CDN  CDN </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://zh.wikipedia.org/wiki/%E5%85%A7%E5%AE%B9%E5%82%B3%E9%81%9E%E7%B6%B2%E8%B7%AF\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"http://book.51cto.com/art/201205/338756.htm\" target=\"_blank\" rel=\"noopener\"> CDN </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/28939811\" target=\"_blank\" rel=\"noopener\"> CDN </a></li>\n<li><a href=\"http://dopro.io/http-cache-and-cdn-cache.html\" target=\"_blank\" rel=\"noopener\"> HTTP  CDN </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/31167721?group_id=915177705310674944\" target=\"_blank\" rel=\"noopener\">  CDN </a></li>\n<li><a href=\"https://juejin.im/post/59f9538f6fb9a0450a66aa2b\" target=\"_blank\" rel=\"noopener\"> CDN HTTPS </a></li>\n<li><a href=\"https://github.com/renaesop/blog/issues/1\" target=\"_blank\" rel=\"noopener\">  CDN </a></li>\n<li><a href=\"https://help.aliyun.com/document_detail/140425.html\" target=\"_blank\" rel=\"noopener\">  CDN CDN </a></li>\n<li><a href=\"https://juejin.im/post/6847902220222988301\" target=\"_blank\" rel=\"noopener\"> SSR  CDN </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p><strong>Content Delivery Network  Content Distribution Network CDN</strong>  <strong></strong>  <strong></strong><strong></strong></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>CDN  <strong></strong>  <strong></strong><strong></strong>  <strong></strong>  <strong></strong> </p>\n<p> CDN </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CDN =  +  + ;</span><br></pre></td></tr></table></figure>\n<p>CDN <strong></strong><strong></strong><strong></strong>  <strong></strong> 4 Traffic Management CDN </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> CDN  DNS  CDN  IP</p>\n<p> CDN  DNS  <code>www.taobao.com</code> CDN  HTTP </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-cdn-workflow.jpg\" alt=\"CDN Workflow\"></p>","more":"<ol>\n<li> <code>www.taobao.com</code>  LDNS DNS</li>\n<li>LDNS  <code>www.taobao.com</code>  IP  DNS </li>\n<li> DNS  <code>www.taobao.com</code>  CNAME <code>www.taobao.alicdn.com</code>  IP </li>\n<li> DNS  IP </li>\n<li>LDNS  DNS  IP </li>\n<li> IP </li>\n<li> IP <ul>\n<li> IP  7  8</li>\n<li> IP </li>\n</ul>\n</li>\n</ol>\n<blockquote>\n<p>Local DNS  DNS<br> HOST  CDN </p>\n</blockquote>\n<p>DNS </p>\n<ol>\n<li>CDN  IP  URL<strong></strong></li>\n<li><strong></strong><ul>\n<li> IP </li>\n<li></li>\n<li> URL </li>\n<li><br> IP </li>\n</ul>\n</li>\n<li> IP </li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> CDN </p>\n<ul>\n<li><strong></strong> Cache Cache Cache Cache Cache  CDN </li>\n<li><strong></strong>GSLBSLBGSLB  Cache SLB </li>\n<li><strong></strong></li>\n</ul>\n<p>CDN  BGP </p>\n<p> CDN  CDN  CDN </p>\n<p><strong>CDN </strong></p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-section.jpg\" alt=\"CDN \"></p>\n<p><strong>CDN </strong></p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-data-flow.jpg\" alt=\"CDN \"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> ECS HTMLCSSJS OSS </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-qiniu-accelerate.png\" alt=\"\"></p>\n<p> CDN  OSS </p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> App  <code>apk</code> <code>mp3</code> <code>exe</code> <code>zip</code>  20M  App </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-qiniu-file.png\" alt=\"\"></p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> App <code>mp4</code><code>flv</code><code>rmvb</code><code>wmv</code><code>HLS</code> </p>\n<p></p>\n<p>CDN  RTMP </p>\n<p> <strong></strong> </p>\n<p> CDN  <strong></strong> </p>\n<p><strong></strong></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> CDN  CDN ER  CDN  CDN  CDN </p>\n<ul>\n<li>Geo IP</li>\n<li>Fetch JS  api fetch  http  fetch </li>\n<li>AB testAB </li>\n<li>Precache/PrefetchCDN </li>\n<li>Race</li>\n<li>Log Server</li>\n<li>3xx 302 </li>\n<li>Redirect</li>\n<li>Deny bot</li>\n<li>Waf waf </li>\n</ul>\n<p> CDN </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> CDN  CDN  CDN </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> CDN </p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong><ul>\n<li><strong></strong></li>\n<li><strong></strong> <code>=/+</code></li>\n</ul>\n</li>\n<li><strong></strong></li>\n</ul>\n<blockquote>\n<p> CDN  CDN 100% 0</p>\n</blockquote>\n<p> CDN  CDN </p>\n<p>CDN </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>html</code><code>js</code><code>jpg</code><code>css</code> </p>\n<p> 3 <strong></strong></p>\n<ul>\n<li> DNS  IP  TCP  <strong>CDN </strong></li>\n<li> CDN </li>\n</ul>\n<p> DNS TCP SSL </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-upload-flow.png\" alt=\"CDN Upload Flow\"></p>\n<p> DNS TCP SSL </p>\n<p><img src=\"http://img.mrsingsing.com/about-cdn-download-flow.png\" alt=\"CDN Download Flow\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> 20M  <strong></strong>  <strong></strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>flv</code><code>mp4</code><code>wmv</code><code>mkv</code> </p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong> 100 </li>\n</ul>\n<h2 id=\"CDN-\"><a href=\"#CDN-\" class=\"headerlink\" title=\"CDN \"></a>CDN </h2><p> CDN </p>\n<ul>\n<li><a href=\"https://www.aliyun.com/product/cdn\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://cloud.tencent.com/product/cdn\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.huaweicloud.com/product/cdn.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.qiniu.com/products/fusion\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<h3 id=\"-CDN\"><a href=\"#-CDN\" class=\"headerlink\" title=\" CDN\"></a> CDN</h3><p></p>\n<ul>\n<li><strong></strong> <strong></strong></li>\n<li><strong></strong> CDN  CDN  CDN </li>\n</ul>\n<p> TCP  TCP  TCP  CDN  TCP  TCP </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li> URL CDN  CDN CDN </li>\n<li> URL  CDN  CDN </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://zh.wikipedia.org/wiki/%E5%85%A7%E5%AE%B9%E5%82%B3%E9%81%9E%E7%B6%B2%E8%B7%AF\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"http://book.51cto.com/art/201205/338756.htm\" target=\"_blank\" rel=\"noopener\"> CDN </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/28939811\" target=\"_blank\" rel=\"noopener\"> CDN </a></li>\n<li><a href=\"http://dopro.io/http-cache-and-cdn-cache.html\" target=\"_blank\" rel=\"noopener\"> HTTP  CDN </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/31167721?group_id=915177705310674944\" target=\"_blank\" rel=\"noopener\">  CDN </a></li>\n<li><a href=\"https://juejin.im/post/59f9538f6fb9a0450a66aa2b\" target=\"_blank\" rel=\"noopener\"> CDN HTTPS </a></li>\n<li><a href=\"https://github.com/renaesop/blog/issues/1\" target=\"_blank\" rel=\"noopener\">  CDN </a></li>\n<li><a href=\"https://help.aliyun.com/document_detail/140425.html\" target=\"_blank\" rel=\"noopener\">  CDN CDN </a></li>\n<li><a href=\"https://juejin.im/post/6847902220222988301\" target=\"_blank\" rel=\"noopener\"> SSR  CDN </a></li>\n</ul>"},{"title":" roadhog^2.x ","date":"2019-01-20T00:00:00.000Z","_content":"\n## \n\n [Webpack](https://github.com/webpack/webpack)  [roadhog](https://github.com/sorrycc/roadhog) webpack  webpack  webpack \n\n `package.json` \n\n> roadhog^2.4.2 => af-webpack^0.23.0-beta.1 => webpack^3.56\n\nroadhog  [`umi/af-webpack`](https://github.com/umijs/umi/tree/master/packages/af-webpack) 2019.1 [umi](https://github.com/umijs/umi) roadhog  roadhog  webpack  3.5.6webpack4+ \n\n## \n\n>  release/2.29.0\n\n****\n\n-  [webpack-bundle-analyzer](https://github.com/webpack-contrib/webpack-bundle-analyzer) \n- \n- \n\n****\n\n- 130%  node \n-  10%86%**91%**\n- 407s 366s 386s 380s 372s =>  382s\n-  92 \n- \n  - Start 150MB 5.05MB\n  - Parsed 88MB 2.48MB\n  - Gzipped 25MB 686.48KB\n\n|  |  |\n| ------------ | ---- |\n| >2MB         | 5    |\n| >1MB         | 24   |\n| >500KB       | 60   |\n\n<!-- more -->\n\n## \n\n [Webpack ](https://github.com/pigcan/blog/issues/1) \n\n- \n- \n-  Webpack  Webpack \n-  Webpack \n\n### \n\n `package.json`\n\n### \n\n route  model  `react``dva``query-string``antd``moment` \n\n [AntDesign](https://github.com/ant-design/ant-design)  [babel-plugin-import](https://github.com/ant-design/babel-plugin-import)  AntDesign \n\n\n\n `package.json` \n\n- [antd](https://github.com/ant-design/ant-design)  UI  \n- [dva](https://github.com/dvajs/dva) \n- [moment](https://github.com/moment/moment)  \n- [ali-oss](https://github.com/ali-sdk/ali-oss)  OSS \n- [react](https://github.com/facebook/react) \n- react-dom\n- react-router-dom\n- universal-cookie\n- ...\n\nroadhog  commons  Webpack  plugins  `webpack.CommonsChunkPlugin` \n\n-  entry/page  common \n-  entry/page  common \n\n\n\n\n\n- [ CommonsChunkPlugin ](https://segmentfault.com/a/1190000012828879)\n\n- [webpack.optimize.CommonsChunkPlugin ](https://juejin.im/post/5c2205e15188257507558c5a)\n\n- [webpackmanifestruntime CommonsChunkPlugin](https://www.jianshu.com/p/95752b101582)\n\n### \n\n![](http://img.mrsingsing.com/roadhog-performance-build-analyze.jpg)\n\nvendor  antd.lib  `ant.lib`  AntDesign  `ant.es` \n\n- antd.es\n- antd.lib\n\n Antd  webpack-plugin-import  Antd  es  babel  vendor `import {message} from \"antd/lib/index\"`  Antd lib \n\n\n extraBabelPlugins \n\n```js\n// wrong\nimport { message } from 'antd/lib/index';\n\n// good\nimport { message } from 'antd';\n```\n\n###  moment \n\n![ moment ](http://img.mrsingsing.com/roadhog-performance-moment-locale.jpg)\n\n moment  locale  roadhog  `ignoreMomentLocale: true`  vendor \n\n AntDesign  `date-picker`\n\n moment \n\n```js\nimport moment from 'moment';\nimport 'moment/locale/zh-cn';\n\nmoment.locale('zh-cn');\n```\n\n moment  `date-picker` \n\n### \n\n 91% Webpack  Webpack  UglifyJS  ES6+  [babel-minify](https://github.com/babel/minify)  treeshaking  Webpack4  ES6+  Roadhog  Webpack3+\n\n[@sorrycc](https://hackmd.io/YHK_yuRtT0ePPVLY0_kUzw)\n\n\n\n- \n- \n\n\n\n- \n  -  common \n  - externals \n  -  webpack  TreeShaking + es module\n- \n\n### \n\nexternals  HMTL  CDN \n\n\n\n-  Webpack  Tree-Shaking\n-  lodash\n\n externals  HTML  JS \n\n-  CDN  Combo http/2\n-  CDN \n\n externals \n\n```js\nexternals: {\n    'ali-oss': 'window.OSS',\n    'react': 'window.react',\n    'react-dom': 'window.ReactDOM'\n}\n```\n\n### \n\nExtractTextPlugin  CSS (antd + )\n\n less \n\n### Gzip \n\ngzip \n\n Nginx [](https://blog.csdn.net/qq_36030288/article/details/54576503)\n\n[gzip ](https://www.cnblogs.com/zs-note/p/9556390.html)\n\n## \n\n![](http://img.mrsingsing.com/roadhog-performance-optimizition-result.jpg)\n\n- 70s => 20s  71%\n- 382s => 40s  89%\n- 88Mb Gzip => 25Mb Gzip => 1Mb Gzip \n\n## \n\n###  AntDesign \n\n-  rc-editor-core / draft.js \n-  rc-editor-mention => rc-editor-core => draft-js  Mention \n- \n\n `babel-plugin-import`  [](https://github.com/ant-design/ant-design/issues/10180)\n\n## \n\n- [ vendor  Issue #370](https://github.com/sorrycc/roadhog/issues/370)\n- [roadhog2  vendor  Issue #577](https://github.com/sorrycc/roadhog/issues/577)\n- [ #722](https://github.com/sorrycc/roadhog/issues/722)\n- [roadhog 1.3x ](https://github.com/liangxinwei/blog/blob/master/webpack/2.md)\n- [Roadhog ](http://www.mamicode.com/info-detail-2413081.html)\n- [JS/CSS  67%](https://www.itcodemonkey.com/article/12011.html)\n- [Webpack ](https://github.com/creeperyang/blog/issues/37)\n","source":"_posts/building-performance-optimization-based-on-roadhog.md","raw":"---\ntitle:  roadhog^2.x \ndate: '2019-01-20'\n---\n\n## \n\n [Webpack](https://github.com/webpack/webpack)  [roadhog](https://github.com/sorrycc/roadhog) webpack  webpack  webpack \n\n `package.json` \n\n> roadhog^2.4.2 => af-webpack^0.23.0-beta.1 => webpack^3.56\n\nroadhog  [`umi/af-webpack`](https://github.com/umijs/umi/tree/master/packages/af-webpack) 2019.1 [umi](https://github.com/umijs/umi) roadhog  roadhog  webpack  3.5.6webpack4+ \n\n## \n\n>  release/2.29.0\n\n****\n\n-  [webpack-bundle-analyzer](https://github.com/webpack-contrib/webpack-bundle-analyzer) \n- \n- \n\n****\n\n- 130%  node \n-  10%86%**91%**\n- 407s 366s 386s 380s 372s =>  382s\n-  92 \n- \n  - Start 150MB 5.05MB\n  - Parsed 88MB 2.48MB\n  - Gzipped 25MB 686.48KB\n\n|  |  |\n| ------------ | ---- |\n| >2MB         | 5    |\n| >1MB         | 24   |\n| >500KB       | 60   |\n\n<!-- more -->\n\n## \n\n [Webpack ](https://github.com/pigcan/blog/issues/1) \n\n- \n- \n-  Webpack  Webpack \n-  Webpack \n\n### \n\n `package.json`\n\n### \n\n route  model  `react``dva``query-string``antd``moment` \n\n [AntDesign](https://github.com/ant-design/ant-design)  [babel-plugin-import](https://github.com/ant-design/babel-plugin-import)  AntDesign \n\n\n\n `package.json` \n\n- [antd](https://github.com/ant-design/ant-design)  UI  \n- [dva](https://github.com/dvajs/dva) \n- [moment](https://github.com/moment/moment)  \n- [ali-oss](https://github.com/ali-sdk/ali-oss)  OSS \n- [react](https://github.com/facebook/react) \n- react-dom\n- react-router-dom\n- universal-cookie\n- ...\n\nroadhog  commons  Webpack  plugins  `webpack.CommonsChunkPlugin` \n\n-  entry/page  common \n-  entry/page  common \n\n\n\n\n\n- [ CommonsChunkPlugin ](https://segmentfault.com/a/1190000012828879)\n\n- [webpack.optimize.CommonsChunkPlugin ](https://juejin.im/post/5c2205e15188257507558c5a)\n\n- [webpackmanifestruntime CommonsChunkPlugin](https://www.jianshu.com/p/95752b101582)\n\n### \n\n![](http://img.mrsingsing.com/roadhog-performance-build-analyze.jpg)\n\nvendor  antd.lib  `ant.lib`  AntDesign  `ant.es` \n\n- antd.es\n- antd.lib\n\n Antd  webpack-plugin-import  Antd  es  babel  vendor `import {message} from \"antd/lib/index\"`  Antd lib \n\n\n extraBabelPlugins \n\n```js\n// wrong\nimport { message } from 'antd/lib/index';\n\n// good\nimport { message } from 'antd';\n```\n\n###  moment \n\n![ moment ](http://img.mrsingsing.com/roadhog-performance-moment-locale.jpg)\n\n moment  locale  roadhog  `ignoreMomentLocale: true`  vendor \n\n AntDesign  `date-picker`\n\n moment \n\n```js\nimport moment from 'moment';\nimport 'moment/locale/zh-cn';\n\nmoment.locale('zh-cn');\n```\n\n moment  `date-picker` \n\n### \n\n 91% Webpack  Webpack  UglifyJS  ES6+  [babel-minify](https://github.com/babel/minify)  treeshaking  Webpack4  ES6+  Roadhog  Webpack3+\n\n[@sorrycc](https://hackmd.io/YHK_yuRtT0ePPVLY0_kUzw)\n\n\n\n- \n- \n\n\n\n- \n  -  common \n  - externals \n  -  webpack  TreeShaking + es module\n- \n\n### \n\nexternals  HMTL  CDN \n\n\n\n-  Webpack  Tree-Shaking\n-  lodash\n\n externals  HTML  JS \n\n-  CDN  Combo http/2\n-  CDN \n\n externals \n\n```js\nexternals: {\n    'ali-oss': 'window.OSS',\n    'react': 'window.react',\n    'react-dom': 'window.ReactDOM'\n}\n```\n\n### \n\nExtractTextPlugin  CSS (antd + )\n\n less \n\n### Gzip \n\ngzip \n\n Nginx [](https://blog.csdn.net/qq_36030288/article/details/54576503)\n\n[gzip ](https://www.cnblogs.com/zs-note/p/9556390.html)\n\n## \n\n![](http://img.mrsingsing.com/roadhog-performance-optimizition-result.jpg)\n\n- 70s => 20s  71%\n- 382s => 40s  89%\n- 88Mb Gzip => 25Mb Gzip => 1Mb Gzip \n\n## \n\n###  AntDesign \n\n-  rc-editor-core / draft.js \n-  rc-editor-mention => rc-editor-core => draft-js  Mention \n- \n\n `babel-plugin-import`  [](https://github.com/ant-design/ant-design/issues/10180)\n\n## \n\n- [ vendor  Issue #370](https://github.com/sorrycc/roadhog/issues/370)\n- [roadhog2  vendor  Issue #577](https://github.com/sorrycc/roadhog/issues/577)\n- [ #722](https://github.com/sorrycc/roadhog/issues/722)\n- [roadhog 1.3x ](https://github.com/liangxinwei/blog/blob/master/webpack/2.md)\n- [Roadhog ](http://www.mamicode.com/info-detail-2413081.html)\n- [JS/CSS  67%](https://www.itcodemonkey.com/article/12011.html)\n- [Webpack ](https://github.com/creeperyang/blog/issues/37)\n","slug":"building-performance-optimization-based-on-roadhog","published":1,"updated":"2021-08-18T03:33:43.192Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99ys0004v31pg1kc0ist","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <a href=\"https://github.com/webpack/webpack\" target=\"_blank\" rel=\"noopener\">Webpack</a>  <a href=\"https://github.com/sorrycc/roadhog\" target=\"_blank\" rel=\"noopener\">roadhog</a> webpack  webpack  webpack </p>\n<p> <code>package.json</code> </p>\n<blockquote>\n<p>roadhog^2.4.2 =&gt; af-webpack^0.23.0-beta.1 =&gt; webpack^3.56</p>\n</blockquote>\n<p>roadhog  <a href=\"https://github.com/umijs/umi/tree/master/packages/af-webpack\" target=\"_blank\" rel=\"noopener\"><code>umi/af-webpack</code></a> 2019.1 <a href=\"https://github.com/umijs/umi\" target=\"_blank\" rel=\"noopener\">umi</a> roadhog  roadhog  webpack  3.5.6webpack4+ </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><blockquote>\n<p> release/2.29.0</p>\n</blockquote>\n<p><strong></strong></p>\n<ul>\n<li> <a href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\" target=\"_blank\" rel=\"noopener\">webpack-bundle-analyzer</a> </li>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li>130%  node </li>\n<li> 10%86%<strong>91%</strong></li>\n<li>407s 366s 386s 380s 372s =&gt;  382s</li>\n<li> 92 </li>\n<li><ul>\n<li>Start 150MB 5.05MB</li>\n<li>Parsed 88MB 2.48MB</li>\n<li>Gzipped 25MB 686.48KB</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&gt;2MB</td>\n<td>5</td>\n</tr>\n<tr>\n<td>&gt;1MB</td>\n<td>24</td>\n</tr>\n<tr>\n<td>&gt;500KB</td>\n<td>60</td>\n</tr>\n</tbody>\n</table>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <a href=\"https://github.com/pigcan/blog/issues/1\" target=\"_blank\" rel=\"noopener\">Webpack </a> </p>\n<ul>\n<li></li>\n<li></li>\n<li> Webpack  Webpack </li>\n<li> Webpack </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>package.json</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> route  model  <code>react</code><code>dva</code><code>query-string</code><code>antd</code><code>moment</code> </p>\n<p> <a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">AntDesign</a>  <a href=\"https://github.com/ant-design/babel-plugin-import\" target=\"_blank\" rel=\"noopener\">babel-plugin-import</a>  AntDesign </p>\n<p></p>\n<p> <code>package.json</code> </p>\n<ul>\n<li><a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">antd</a>  UI  </li>\n<li><a href=\"https://github.com/dvajs/dva\" target=\"_blank\" rel=\"noopener\">dva</a> </li>\n<li><a href=\"https://github.com/moment/moment\" target=\"_blank\" rel=\"noopener\">moment</a>  </li>\n<li><a href=\"https://github.com/ali-sdk/ali-oss\" target=\"_blank\" rel=\"noopener\">ali-oss</a>  OSS </li>\n<li><a href=\"https://github.com/facebook/react\" target=\"_blank\" rel=\"noopener\">react</a> </li>\n<li>react-dom</li>\n<li>react-router-dom</li>\n<li>universal-cookie</li>\n<li></li>\n</ul>\n<p>roadhog  commons  Webpack  plugins  <code>webpack.CommonsChunkPlugin</code> </p>\n<ul>\n<li> entry/page  common </li>\n<li> entry/page  common </li>\n</ul>\n<p></p>\n<p></p>\n<ul>\n<li><p><a href=\"https://segmentfault.com/a/1190000012828879\" target=\"_blank\" rel=\"noopener\"> CommonsChunkPlugin </a></p>\n</li>\n<li><p><a href=\"https://juejin.im/post/5c2205e15188257507558c5a\" target=\"_blank\" rel=\"noopener\">webpack.optimize.CommonsChunkPlugin </a></p>\n</li>\n<li><p><a href=\"https://www.jianshu.com/p/95752b101582\" target=\"_blank\" rel=\"noopener\">webpackmanifestruntime CommonsChunkPlugin</a></p>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/roadhog-performance-build-analyze.jpg\" alt=\"\"></p>\n<p>vendor  antd.lib  <code>ant.lib</code>  AntDesign  <code>ant.es</code> </p>\n<ul>\n<li>antd.es</li>\n<li>antd.lib</li>\n</ul>\n<p> Antd  webpack-plugin-import  Antd  es  babel  vendor <code>import {message} from &quot;antd/lib/index&quot;</code>  Antd lib </p>\n<p><br> extraBabelPlugins </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// wrong</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; message &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd/lib/index'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; message &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd'</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"-moment-\"><a href=\"#-moment-\" class=\"headerlink\" title=\" moment \"></a> moment </h3><p><img src=\"http://img.mrsingsing.com/roadhog-performance-moment-locale.jpg\" alt=\" moment \"></p>\n<p> moment  locale  roadhog  <code>ignoreMomentLocale: true</code>  vendor </p>\n<p> AntDesign  <code>date-picker</code></p>\n<p> moment </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> moment <span class=\"keyword\">from</span> <span class=\"string\">'moment'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'moment/locale/zh-cn'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">moment.locale(<span class=\"string\">'zh-cn'</span>);</span><br></pre></td></tr></table></figure>\n<p> moment  <code>date-picker</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> 91% Webpack  Webpack  UglifyJS  ES6+  <a href=\"https://github.com/babel/minify\" target=\"_blank\" rel=\"noopener\">babel-minify</a>  treeshaking  Webpack4  ES6+  Roadhog  Webpack3+</p>\n<p><a href=\"https://hackmd.io/YHK_yuRtT0ePPVLY0_kUzw\" target=\"_blank\" rel=\"noopener\">@sorrycc</a></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li><ul>\n<li> common </li>\n<li>externals </li>\n<li> webpack  TreeShaking + es module</li>\n</ul>\n</li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>externals  HMTL  CDN </p>\n<p></p>\n<ul>\n<li> Webpack  Tree-Shaking</li>\n<li> lodash</li>\n</ul>\n<p> externals  HTML  JS </p>\n<ul>\n<li> CDN  Combo http/2</li>\n<li> CDN </li>\n</ul>\n<p> externals </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">externals: &#123;</span><br><span class=\"line\">    <span class=\"string\">'ali-oss'</span>: <span class=\"string\">'window.OSS'</span>,</span><br><span class=\"line\">    <span class=\"string\">'react'</span>: <span class=\"string\">'window.react'</span>,</span><br><span class=\"line\">    <span class=\"string\">'react-dom'</span>: <span class=\"string\">'window.ReactDOM'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ExtractTextPlugin  CSS (antd + )</p>\n<p> less </p>\n<h3 id=\"Gzip-\"><a href=\"#Gzip-\" class=\"headerlink\" title=\"Gzip \"></a>Gzip </h3><p>gzip </p>\n<p> Nginx <a href=\"https://blog.csdn.net/qq_36030288/article/details/54576503\" target=\"_blank\" rel=\"noopener\"></a></p>\n<p><a href=\"https://www.cnblogs.com/zs-note/p/9556390.html\" target=\"_blank\" rel=\"noopener\">gzip </a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><img src=\"http://img.mrsingsing.com/roadhog-performance-optimizition-result.jpg\" alt=\"\"></p>\n<ul>\n<li>70s =&gt; 20s  71%</li>\n<li>382s =&gt; 40s  89%</li>\n<li>88Mb Gzip =&gt; 25Mb Gzip =&gt; 1Mb Gzip </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-AntDesign-\"><a href=\"#-AntDesign-\" class=\"headerlink\" title=\" AntDesign \"></a> AntDesign </h3><ul>\n<li> rc-editor-core / draft.js </li>\n<li> rc-editor-mention =&gt; rc-editor-core =&gt; draft-js  Mention </li>\n<li></li>\n</ul>\n<p> <code>babel-plugin-import</code>  <a href=\"https://github.com/ant-design/ant-design/issues/10180\" target=\"_blank\" rel=\"noopener\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://github.com/sorrycc/roadhog/issues/370\" target=\"_blank\" rel=\"noopener\"> vendor  Issue #370</a></li>\n<li><a href=\"https://github.com/sorrycc/roadhog/issues/577\" target=\"_blank\" rel=\"noopener\">roadhog2  vendor  Issue #577</a></li>\n<li><a href=\"https://github.com/sorrycc/roadhog/issues/722\" target=\"_blank\" rel=\"noopener\"> #722</a></li>\n<li><a href=\"https://github.com/liangxinwei/blog/blob/master/webpack/2.md\" target=\"_blank\" rel=\"noopener\">roadhog 1.3x </a></li>\n<li><a href=\"http://www.mamicode.com/info-detail-2413081.html\" target=\"_blank\" rel=\"noopener\">Roadhog </a></li>\n<li><a href=\"https://www.itcodemonkey.com/article/12011.html\" target=\"_blank\" rel=\"noopener\">JS/CSS  67%</a></li>\n<li><a href=\"https://github.com/creeperyang/blog/issues/37\" target=\"_blank\" rel=\"noopener\">Webpack </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <a href=\"https://github.com/webpack/webpack\" target=\"_blank\" rel=\"noopener\">Webpack</a>  <a href=\"https://github.com/sorrycc/roadhog\" target=\"_blank\" rel=\"noopener\">roadhog</a> webpack  webpack  webpack </p>\n<p> <code>package.json</code> </p>\n<blockquote>\n<p>roadhog^2.4.2 =&gt; af-webpack^0.23.0-beta.1 =&gt; webpack^3.56</p>\n</blockquote>\n<p>roadhog  <a href=\"https://github.com/umijs/umi/tree/master/packages/af-webpack\" target=\"_blank\" rel=\"noopener\"><code>umi/af-webpack</code></a> 2019.1 <a href=\"https://github.com/umijs/umi\" target=\"_blank\" rel=\"noopener\">umi</a> roadhog  roadhog  webpack  3.5.6webpack4+ </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><blockquote>\n<p> release/2.29.0</p>\n</blockquote>\n<p><strong></strong></p>\n<ul>\n<li> <a href=\"https://github.com/webpack-contrib/webpack-bundle-analyzer\" target=\"_blank\" rel=\"noopener\">webpack-bundle-analyzer</a> </li>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li>130%  node </li>\n<li> 10%86%<strong>91%</strong></li>\n<li>407s 366s 386s 380s 372s =&gt;  382s</li>\n<li> 92 </li>\n<li><ul>\n<li>Start 150MB 5.05MB</li>\n<li>Parsed 88MB 2.48MB</li>\n<li>Gzipped 25MB 686.48KB</li>\n</ul>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&gt;2MB</td>\n<td>5</td>\n</tr>\n<tr>\n<td>&gt;1MB</td>\n<td>24</td>\n</tr>\n<tr>\n<td>&gt;500KB</td>\n<td>60</td>\n</tr>\n</tbody>\n</table>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <a href=\"https://github.com/pigcan/blog/issues/1\" target=\"_blank\" rel=\"noopener\">Webpack </a> </p>\n<ul>\n<li></li>\n<li></li>\n<li> Webpack  Webpack </li>\n<li> Webpack </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>package.json</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> route  model  <code>react</code><code>dva</code><code>query-string</code><code>antd</code><code>moment</code> </p>\n<p> <a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">AntDesign</a>  <a href=\"https://github.com/ant-design/babel-plugin-import\" target=\"_blank\" rel=\"noopener\">babel-plugin-import</a>  AntDesign </p>\n<p></p>\n<p> <code>package.json</code> </p>\n<ul>\n<li><a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">antd</a>  UI  </li>\n<li><a href=\"https://github.com/dvajs/dva\" target=\"_blank\" rel=\"noopener\">dva</a> </li>\n<li><a href=\"https://github.com/moment/moment\" target=\"_blank\" rel=\"noopener\">moment</a>  </li>\n<li><a href=\"https://github.com/ali-sdk/ali-oss\" target=\"_blank\" rel=\"noopener\">ali-oss</a>  OSS </li>\n<li><a href=\"https://github.com/facebook/react\" target=\"_blank\" rel=\"noopener\">react</a> </li>\n<li>react-dom</li>\n<li>react-router-dom</li>\n<li>universal-cookie</li>\n<li></li>\n</ul>\n<p>roadhog  commons  Webpack  plugins  <code>webpack.CommonsChunkPlugin</code> </p>\n<ul>\n<li> entry/page  common </li>\n<li> entry/page  common </li>\n</ul>\n<p></p>\n<p></p>\n<ul>\n<li><p><a href=\"https://segmentfault.com/a/1190000012828879\" target=\"_blank\" rel=\"noopener\"> CommonsChunkPlugin </a></p>\n</li>\n<li><p><a href=\"https://juejin.im/post/5c2205e15188257507558c5a\" target=\"_blank\" rel=\"noopener\">webpack.optimize.CommonsChunkPlugin </a></p>\n</li>\n<li><p><a href=\"https://www.jianshu.com/p/95752b101582\" target=\"_blank\" rel=\"noopener\">webpackmanifestruntime CommonsChunkPlugin</a></p>\n</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/roadhog-performance-build-analyze.jpg\" alt=\"\"></p>\n<p>vendor  antd.lib  <code>ant.lib</code>  AntDesign  <code>ant.es</code> </p>\n<ul>\n<li>antd.es</li>\n<li>antd.lib</li>\n</ul>\n<p> Antd  webpack-plugin-import  Antd  es  babel  vendor <code>import {message} from &quot;antd/lib/index&quot;</code>  Antd lib </p>\n<p><br> extraBabelPlugins </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// wrong</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; message &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd/lib/index'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// good</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; message &#125; <span class=\"keyword\">from</span> <span class=\"string\">'antd'</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"-moment-\"><a href=\"#-moment-\" class=\"headerlink\" title=\" moment \"></a> moment </h3><p><img src=\"http://img.mrsingsing.com/roadhog-performance-moment-locale.jpg\" alt=\" moment \"></p>\n<p> moment  locale  roadhog  <code>ignoreMomentLocale: true</code>  vendor </p>\n<p> AntDesign  <code>date-picker</code></p>\n<p> moment </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> moment <span class=\"keyword\">from</span> <span class=\"string\">'moment'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'moment/locale/zh-cn'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">moment.locale(<span class=\"string\">'zh-cn'</span>);</span><br></pre></td></tr></table></figure>\n<p> moment  <code>date-picker</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> 91% Webpack  Webpack  UglifyJS  ES6+  <a href=\"https://github.com/babel/minify\" target=\"_blank\" rel=\"noopener\">babel-minify</a>  treeshaking  Webpack4  ES6+  Roadhog  Webpack3+</p>\n<p><a href=\"https://hackmd.io/YHK_yuRtT0ePPVLY0_kUzw\" target=\"_blank\" rel=\"noopener\">@sorrycc</a></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li><ul>\n<li> common </li>\n<li>externals </li>\n<li> webpack  TreeShaking + es module</li>\n</ul>\n</li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>externals  HMTL  CDN </p>\n<p></p>\n<ul>\n<li> Webpack  Tree-Shaking</li>\n<li> lodash</li>\n</ul>\n<p> externals  HTML  JS </p>\n<ul>\n<li> CDN  Combo http/2</li>\n<li> CDN </li>\n</ul>\n<p> externals </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">externals: &#123;</span><br><span class=\"line\">    <span class=\"string\">'ali-oss'</span>: <span class=\"string\">'window.OSS'</span>,</span><br><span class=\"line\">    <span class=\"string\">'react'</span>: <span class=\"string\">'window.react'</span>,</span><br><span class=\"line\">    <span class=\"string\">'react-dom'</span>: <span class=\"string\">'window.ReactDOM'</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>ExtractTextPlugin  CSS (antd + )</p>\n<p> less </p>\n<h3 id=\"Gzip-\"><a href=\"#Gzip-\" class=\"headerlink\" title=\"Gzip \"></a>Gzip </h3><p>gzip </p>\n<p> Nginx <a href=\"https://blog.csdn.net/qq_36030288/article/details/54576503\" target=\"_blank\" rel=\"noopener\"></a></p>\n<p><a href=\"https://www.cnblogs.com/zs-note/p/9556390.html\" target=\"_blank\" rel=\"noopener\">gzip </a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><img src=\"http://img.mrsingsing.com/roadhog-performance-optimizition-result.jpg\" alt=\"\"></p>\n<ul>\n<li>70s =&gt; 20s  71%</li>\n<li>382s =&gt; 40s  89%</li>\n<li>88Mb Gzip =&gt; 25Mb Gzip =&gt; 1Mb Gzip </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-AntDesign-\"><a href=\"#-AntDesign-\" class=\"headerlink\" title=\" AntDesign \"></a> AntDesign </h3><ul>\n<li> rc-editor-core / draft.js </li>\n<li> rc-editor-mention =&gt; rc-editor-core =&gt; draft-js  Mention </li>\n<li></li>\n</ul>\n<p> <code>babel-plugin-import</code>  <a href=\"https://github.com/ant-design/ant-design/issues/10180\" target=\"_blank\" rel=\"noopener\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://github.com/sorrycc/roadhog/issues/370\" target=\"_blank\" rel=\"noopener\"> vendor  Issue #370</a></li>\n<li><a href=\"https://github.com/sorrycc/roadhog/issues/577\" target=\"_blank\" rel=\"noopener\">roadhog2  vendor  Issue #577</a></li>\n<li><a href=\"https://github.com/sorrycc/roadhog/issues/722\" target=\"_blank\" rel=\"noopener\"> #722</a></li>\n<li><a href=\"https://github.com/liangxinwei/blog/blob/master/webpack/2.md\" target=\"_blank\" rel=\"noopener\">roadhog 1.3x </a></li>\n<li><a href=\"http://www.mamicode.com/info-detail-2413081.html\" target=\"_blank\" rel=\"noopener\">Roadhog </a></li>\n<li><a href=\"https://www.itcodemonkey.com/article/12011.html\" target=\"_blank\" rel=\"noopener\">JS/CSS  67%</a></li>\n<li><a href=\"https://github.com/creeperyang/blog/issues/37\" target=\"_blank\" rel=\"noopener\">Webpack </a></li>\n</ul>"},{"title":"","date":"2020-06-07T00:00:00.000Z","_content":"\n\n\n\n\n\n\n<!-- more -->\n\n## \n\nLanding Page\n\n\n\n\n\n### \n\n APP \n\n![](http://img.mrsingsing.com/landing-page-marketing.jpg)\n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-information.jpg)\n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-application-promotion.jpg)\n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-awaken.jpg)\n\n## \n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-pointer.jpg)\n\n- ****\n- ****\n- ****\n- ****/APP \n- **** APP  APP \n   Session \n\n\n\n- **DAUDaily Activited Users**\n- **MAUMonthly Activited Users**\n- **PVPage View**\n- **UVUnique View**\n- ****\n- ****\n\n### \n\n\n\n\n\n```\n ->  ->  ->  ->  ->  ->  -> \n```\n\n ``  ``  ``  ``  ``  `` \n\n **** ``  ``  40%**** 38% 36% ``  ` APP `  62% 90% 91% APP \n\n ****  Android  iOSChromeSafariFirefox  \n\n\n\n- **Trend** `` \n- **Compare** `` \n- **Segment** ``  ROI\n\n### A/B \n\nA/B  Web  App \n\n A/B  A/B \n\n\n\n-  UI \n- \n-  ROI\n\n A/B test  A/B test  A/B \n\n A/B  CMS  A/B  A/B \n\n### \n\n\n\n\n\n1. \n2. \n3. \n4. \n5. \n\n\n\n1. \n2.  ID \n3. \n\n\n\n`` -> `` -> ` ID` \n\n---\n\n****\n\n- \n  - [ APP ](http://www.woshipm.com/pd/3079851.html)\n  - [](https://www.jianshu.com/p/21db3a53b9e7)\n  - [](https://www.shujike.com/blog/77744)\n  - [](https://zhuanlan.zhihu.com/p/33882407)\n  - [ 12 ](https://www.27sem.com/article/3634.html)\n  - [](https://zhuanlan.zhihu.com/p/36165204)\n- \n  - [ ](https://www.yunyingpai.com/user/199.html)\n  - [ ](https://www.sohu.com/a/345808493_165070)\n  - [](http://menvscode.com/detail/5bfc20d030be6232a69c5d94)\n  - [](https://www.niaogebiji.com/article-26780-1.html)\n  - [ Sensors Analytics  A/B Test](https://www.sensorsdata.cn/blog/shi-yong-sensors-analytics-jin-xing-a-b-test/)\n  - [ A/B ](https://juejin.im/post/585b7fc161ff4b0058032b84)\n  - [ A/B ](https://www.infoq.cn/article/PyOwiqA1zmuIcXqySb7V)\n- \n  - [](https://www.jianshu.com/p/4f64d739fba2)\n  - [ DSP ](https://tech.meituan.com/2017/05/05/mt-dsp.html)\n  - [](https://www.jianshu.com/p/ab04b1e3a512)\n","source":"_posts/business-experience-summary-of-lading-page.md","raw":"---\ntitle: \ndate: '2020-06-07'\n---\n\n\n\n\n\n\n\n<!-- more -->\n\n## \n\nLanding Page\n\n\n\n\n\n### \n\n APP \n\n![](http://img.mrsingsing.com/landing-page-marketing.jpg)\n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-information.jpg)\n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-application-promotion.jpg)\n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-awaken.jpg)\n\n## \n\n### \n\n\n\n![](http://img.mrsingsing.com/landing-page-pointer.jpg)\n\n- ****\n- ****\n- ****\n- ****/APP \n- **** APP  APP \n   Session \n\n\n\n- **DAUDaily Activited Users**\n- **MAUMonthly Activited Users**\n- **PVPage View**\n- **UVUnique View**\n- ****\n- ****\n\n### \n\n\n\n\n\n```\n ->  ->  ->  ->  ->  ->  -> \n```\n\n ``  ``  ``  ``  ``  `` \n\n **** ``  ``  40%**** 38% 36% ``  ` APP `  62% 90% 91% APP \n\n ****  Android  iOSChromeSafariFirefox  \n\n\n\n- **Trend** `` \n- **Compare** `` \n- **Segment** ``  ROI\n\n### A/B \n\nA/B  Web  App \n\n A/B  A/B \n\n\n\n-  UI \n- \n-  ROI\n\n A/B test  A/B test  A/B \n\n A/B  CMS  A/B  A/B \n\n### \n\n\n\n\n\n1. \n2. \n3. \n4. \n5. \n\n\n\n1. \n2.  ID \n3. \n\n\n\n`` -> `` -> ` ID` \n\n---\n\n****\n\n- \n  - [ APP ](http://www.woshipm.com/pd/3079851.html)\n  - [](https://www.jianshu.com/p/21db3a53b9e7)\n  - [](https://www.shujike.com/blog/77744)\n  - [](https://zhuanlan.zhihu.com/p/33882407)\n  - [ 12 ](https://www.27sem.com/article/3634.html)\n  - [](https://zhuanlan.zhihu.com/p/36165204)\n- \n  - [ ](https://www.yunyingpai.com/user/199.html)\n  - [ ](https://www.sohu.com/a/345808493_165070)\n  - [](http://menvscode.com/detail/5bfc20d030be6232a69c5d94)\n  - [](https://www.niaogebiji.com/article-26780-1.html)\n  - [ Sensors Analytics  A/B Test](https://www.sensorsdata.cn/blog/shi-yong-sensors-analytics-jin-xing-a-b-test/)\n  - [ A/B ](https://juejin.im/post/585b7fc161ff4b0058032b84)\n  - [ A/B ](https://www.infoq.cn/article/PyOwiqA1zmuIcXqySb7V)\n- \n  - [](https://www.jianshu.com/p/4f64d739fba2)\n  - [ DSP ](https://tech.meituan.com/2017/05/05/mt-dsp.html)\n  - [](https://www.jianshu.com/p/ab04b1e3a512)\n","slug":"business-experience-summary-of-lading-page","published":1,"updated":"2021-08-18T03:28:02.003Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99yt0005v31pieo7x0eh","content":"<p></p>\n<p></p>\n<p></p>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Landing Page</p>\n<p></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> APP </p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-marketing.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-information.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-application-promotion.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-awaken.jpg\" alt=\"\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-pointer.jpg\" alt=\"\"></p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong>/APP </li>\n<li><strong></strong> APP  APP <br> Session </li>\n</ul>\n<p></p>\n<ul>\n<li><strong>DAUDaily Activited Users</strong></li>\n<li><strong>MAUMonthly Activited Users</strong></li>\n<li><strong>PVPage View</strong></li>\n<li><strong>UVUnique View</strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> -&gt;  -&gt;  -&gt;  -&gt;  -&gt;  -&gt;  -&gt; </span><br></pre></td></tr></table></figure>\n<p> <code></code>  <code></code>  <code></code>  <code></code>  <code></code>  <code></code> </p>\n<p> <strong></strong> <code></code>  <code></code>  40%<strong></strong> 38% 36% <code></code>  <code> APP </code>  62% 90% 91% APP </p>\n<p> <strong></strong>  Android  iOSChromeSafariFirefox  </p>\n<p></p>\n<ul>\n<li><strong>Trend</strong> <code></code> </li>\n<li><strong>Compare</strong> <code></code> </li>\n<li><strong>Segment</strong> <code></code>  ROI</li>\n</ul>\n<h3 id=\"A-B-\"><a href=\"#A-B-\" class=\"headerlink\" title=\"A/B \"></a>A/B </h3><p>A/B  Web  App </p>\n<p> A/B  A/B </p>\n<p></p>\n<ul>\n<li> UI </li>\n<li></li>\n<li> ROI</li>\n</ul>\n<p> A/B test  A/B test  A/B </p>\n<p> A/B  CMS  A/B  A/B </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<ol>\n<li></li>\n<li> ID </li>\n<li></li>\n</ol>\n<p></p>\n<p><code></code> -&gt; <code></code> -&gt; <code> ID</code> </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><ul>\n<li><a href=\"http://www.woshipm.com/pd/3079851.html\" target=\"_blank\" rel=\"noopener\"> APP </a></li>\n<li><a href=\"https://www.jianshu.com/p/21db3a53b9e7\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.shujike.com/blog/77744\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/33882407\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.27sem.com/article/3634.html\" target=\"_blank\" rel=\"noopener\"> 12 </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/36165204\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://www.yunyingpai.com/user/199.html\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://www.sohu.com/a/345808493_165070\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"http://menvscode.com/detail/5bfc20d030be6232a69c5d94\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.niaogebiji.com/article-26780-1.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.sensorsdata.cn/blog/shi-yong-sensors-analytics-jin-xing-a-b-test/\" target=\"_blank\" rel=\"noopener\"> Sensors Analytics  A/B Test</a></li>\n<li><a href=\"https://juejin.im/post/585b7fc161ff4b0058032b84\" target=\"_blank\" rel=\"noopener\"> A/B </a></li>\n<li><a href=\"https://www.infoq.cn/article/PyOwiqA1zmuIcXqySb7V\" target=\"_blank\" rel=\"noopener\"> A/B </a></li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://www.jianshu.com/p/4f64d739fba2\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://tech.meituan.com/2017/05/05/mt-dsp.html\" target=\"_blank\" rel=\"noopener\"> DSP </a></li>\n<li><a href=\"https://www.jianshu.com/p/ab04b1e3a512\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p></p>\n<p></p>\n<p></p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Landing Page</p>\n<p></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> APP </p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-marketing.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-information.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-application-promotion.jpg\" alt=\"\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-awaken.jpg\" alt=\"\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/landing-page-pointer.jpg\" alt=\"\"></p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n<li><strong></strong>/APP </li>\n<li><strong></strong> APP  APP <br> Session </li>\n</ul>\n<p></p>\n<ul>\n<li><strong>DAUDaily Activited Users</strong></li>\n<li><strong>MAUMonthly Activited Users</strong></li>\n<li><strong>PVPage View</strong></li>\n<li><strong>UVUnique View</strong></li>\n<li><strong></strong></li>\n<li><strong></strong></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> -&gt;  -&gt;  -&gt;  -&gt;  -&gt;  -&gt;  -&gt; </span><br></pre></td></tr></table></figure>\n<p> <code></code>  <code></code>  <code></code>  <code></code>  <code></code>  <code></code> </p>\n<p> <strong></strong> <code></code>  <code></code>  40%<strong></strong> 38% 36% <code></code>  <code> APP </code>  62% 90% 91% APP </p>\n<p> <strong></strong>  Android  iOSChromeSafariFirefox  </p>\n<p></p>\n<ul>\n<li><strong>Trend</strong> <code></code> </li>\n<li><strong>Compare</strong> <code></code> </li>\n<li><strong>Segment</strong> <code></code>  ROI</li>\n</ul>\n<h3 id=\"A-B-\"><a href=\"#A-B-\" class=\"headerlink\" title=\"A/B \"></a>A/B </h3><p>A/B  Web  App </p>\n<p> A/B  A/B </p>\n<p></p>\n<ul>\n<li> UI </li>\n<li></li>\n<li> ROI</li>\n</ul>\n<p> A/B test  A/B test  A/B </p>\n<p> A/B  CMS  A/B  A/B </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<p></p>\n<ol>\n<li></li>\n<li> ID </li>\n<li></li>\n</ol>\n<p></p>\n<p><code></code> -&gt; <code></code> -&gt; <code> ID</code> </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><ul>\n<li><a href=\"http://www.woshipm.com/pd/3079851.html\" target=\"_blank\" rel=\"noopener\"> APP </a></li>\n<li><a href=\"https://www.jianshu.com/p/21db3a53b9e7\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.shujike.com/blog/77744\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/33882407\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.27sem.com/article/3634.html\" target=\"_blank\" rel=\"noopener\"> 12 </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/36165204\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://www.yunyingpai.com/user/199.html\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://www.sohu.com/a/345808493_165070\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"http://menvscode.com/detail/5bfc20d030be6232a69c5d94\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.niaogebiji.com/article-26780-1.html\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://www.sensorsdata.cn/blog/shi-yong-sensors-analytics-jin-xing-a-b-test/\" target=\"_blank\" rel=\"noopener\"> Sensors Analytics  A/B Test</a></li>\n<li><a href=\"https://juejin.im/post/585b7fc161ff4b0058032b84\" target=\"_blank\" rel=\"noopener\"> A/B </a></li>\n<li><a href=\"https://www.infoq.cn/article/PyOwiqA1zmuIcXqySb7V\" target=\"_blank\" rel=\"noopener\"> A/B </a></li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://www.jianshu.com/p/4f64d739fba2\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://tech.meituan.com/2017/05/05/mt-dsp.html\" target=\"_blank\" rel=\"noopener\"> DSP </a></li>\n<li><a href=\"https://www.jianshu.com/p/ab04b1e3a512\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n</li>\n</ul>"},{"title":" X ","date":"2020-03-01T00:00:00.000Z","_content":"\n****\n\n-  X \n-  Egg  Socket.IO \n-  Puppeteer \n- \n\n X  X  X  X  X \n\n X \n\n<!-- more -->\n\n\n\n![](http://img.mrsingsing.com/automatation-test-workflow.jpg)\n\n X \n\n\n\n##  X \n\n X \n\n X \n\n```\nA A1 ->  ->  -> B B1 \n\nB B2 -> C C1 \n\nButton -> FixedContainer \n\nButton -> Interface \n\nInterface -> Interface \n```\n\n\n\n A  A1  B  B1  B1 /\n\n B1  B2  `fetchSuccess`  C  C1 \n\n X  ` A  A1 -> BB1``BB2 => CC1`\n\n B  B  B1  B2 X \n\n1. \n2.  X \n\n![](http://img.mrsingsing.com/automatation-test-events-chain.jpg)\n\n Button  Input  Input  Message \n\n\n\n- \n- \n- \n\n\n\n-  SDK \n- \n- //// SDK  Ready \n\n JavaScript \n\n-  Timer\n- HTML Parsing\n- HTTP Request\n- I/OMouseEvent\n- Promisethen\n\n\n\n- JavaScript UI RenderingI/OHTTP Request\n- \n\n\n\n##  Puppeteer \n\n Egg  Socket.IO \n\nSocket.IO \n\n- `socket.io-client`\n- `egg-socket.io`\n\n```\nchat\n app\n    extend\n       helper.js\n    io\n       controller\n          default.js\n       middleware\n           connection.js\n           packet.js\n    router.js\n config\n package.json\n```\n\nEgg \n\n [Egg - Socket.IO ](https://eggjs.org/zh-cn/tutorials/socketio.html)\n\n Puppeteer  Google \n\nPuppeteer  Chrome DevTool Protocol CDP CDP  WebSocket WebSocket \n\n![Puppeteer ](http://img.mrsingsing.com/automatation-test-puppeteer-pyramid.png)\n\nPuppeteer \n\n- \n  -  PDF\n  - \n  - \n  - \n- \n  - [ 99 ](https://yq.aliyun.com/articles/718188)\n  - [ Puppeteer ](https://www.infoq.cn/article/dcSBL_9AzCwVPsaQ70dh)\n  - [ Puppeteer ](https://www.jianshu.com/p/42585c78eeec)\n\n Node  Puppeteer \n\nPuppeteer  `page.exposeFunction`  Node  Puppeteer  `window` \n\n Node  Node \n\n![](http://img.mrsingsing.com/automatation-test-case.jpg)\n\n Node \n\n** Node.js **\n\n\n\n- \n  - \n  - Puppeteer  => Chromium Command Line\n- \n  -  => \n\n Tab \n\n-  Headless Chrome  WS URL `browser.connect` \n- Radis \n- \n-  Egg App Config \n\n\n\n1. \n2. \n3. \n4. \n5. \n6. \n","source":"_posts/event-chain-based-automatic-test-scheme-of-totorox.md","raw":"---\ntitle:  X \ndate: '2020-03-01'\n---\n\n****\n\n-  X \n-  Egg  Socket.IO \n-  Puppeteer \n- \n\n X  X  X  X  X \n\n X \n\n<!-- more -->\n\n\n\n![](http://img.mrsingsing.com/automatation-test-workflow.jpg)\n\n X \n\n\n\n##  X \n\n X \n\n X \n\n```\nA A1 ->  ->  -> B B1 \n\nB B2 -> C C1 \n\nButton -> FixedContainer \n\nButton -> Interface \n\nInterface -> Interface \n```\n\n\n\n A  A1  B  B1  B1 /\n\n B1  B2  `fetchSuccess`  C  C1 \n\n X  ` A  A1 -> BB1``BB2 => CC1`\n\n B  B  B1  B2 X \n\n1. \n2.  X \n\n![](http://img.mrsingsing.com/automatation-test-events-chain.jpg)\n\n Button  Input  Input  Message \n\n\n\n- \n- \n- \n\n\n\n-  SDK \n- \n- //// SDK  Ready \n\n JavaScript \n\n-  Timer\n- HTML Parsing\n- HTTP Request\n- I/OMouseEvent\n- Promisethen\n\n\n\n- JavaScript UI RenderingI/OHTTP Request\n- \n\n\n\n##  Puppeteer \n\n Egg  Socket.IO \n\nSocket.IO \n\n- `socket.io-client`\n- `egg-socket.io`\n\n```\nchat\n app\n    extend\n       helper.js\n    io\n       controller\n          default.js\n       middleware\n           connection.js\n           packet.js\n    router.js\n config\n package.json\n```\n\nEgg \n\n [Egg - Socket.IO ](https://eggjs.org/zh-cn/tutorials/socketio.html)\n\n Puppeteer  Google \n\nPuppeteer  Chrome DevTool Protocol CDP CDP  WebSocket WebSocket \n\n![Puppeteer ](http://img.mrsingsing.com/automatation-test-puppeteer-pyramid.png)\n\nPuppeteer \n\n- \n  -  PDF\n  - \n  - \n  - \n- \n  - [ 99 ](https://yq.aliyun.com/articles/718188)\n  - [ Puppeteer ](https://www.infoq.cn/article/dcSBL_9AzCwVPsaQ70dh)\n  - [ Puppeteer ](https://www.jianshu.com/p/42585c78eeec)\n\n Node  Puppeteer \n\nPuppeteer  `page.exposeFunction`  Node  Puppeteer  `window` \n\n Node  Node \n\n![](http://img.mrsingsing.com/automatation-test-case.jpg)\n\n Node \n\n** Node.js **\n\n\n\n- \n  - \n  - Puppeteer  => Chromium Command Line\n- \n  -  => \n\n Tab \n\n-  Headless Chrome  WS URL `browser.connect` \n- Radis \n- \n-  Egg App Config \n\n\n\n1. \n2. \n3. \n4. \n5. \n6. \n","slug":"event-chain-based-automatic-test-scheme-of-totorox","published":1,"updated":"2021-08-18T03:29:45.340Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99yu0006v31pmc3qrgqv","content":"<p><strong></strong></p>\n<ul>\n<li> X </li>\n<li> Egg  Socket.IO </li>\n<li> Puppeteer </li>\n<li></li>\n</ul>\n<p> X  X  X  X  X </p>\n<p> X </p>\n<a id=\"more\"></a>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-workflow.jpg\" alt=\"\"></p>\n<p> X </p>\n<p></p>\n<h2 id=\"-X-\"><a href=\"#-X-\" class=\"headerlink\" title=\" X \"></a> X </h2><p> X </p>\n<p> X </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A A1 -&gt;  -&gt;  -&gt; B B1 </span><br><span class=\"line\"></span><br><span class=\"line\">B B2 -&gt; C C1 </span><br><span class=\"line\"></span><br><span class=\"line\">Button -&gt; FixedContainer </span><br><span class=\"line\"></span><br><span class=\"line\">Button -&gt; Interface </span><br><span class=\"line\"></span><br><span class=\"line\">Interface -&gt; Interface </span><br></pre></td></tr></table></figure>\n<p></p>\n<p> A  A1  B  B1  B1 /</p>\n<p> B1  B2  <code>fetchSuccess</code>  C  C1 </p>\n<p> X  <code> A  A1 -&gt; BB1</code><code>BB2 =&gt; CC1</code></p>\n<p> B  B  B1  B2 X </p>\n<ol>\n<li></li>\n<li> X </li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-events-chain.jpg\" alt=\"\"></p>\n<p> Button  Input  Input  Message </p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li> SDK </li>\n<li></li>\n<li>//// SDK  Ready </li>\n</ul>\n<p> JavaScript </p>\n<ul>\n<li> Timer</li>\n<li>HTML Parsing</li>\n<li>HTTP Request</li>\n<li>I/OMouseEvent</li>\n<li>Promisethen</li>\n</ul>\n<p></p>\n<ul>\n<li>JavaScript UI RenderingI/OHTTP Request</li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"-Puppeteer-\"><a href=\"#-Puppeteer-\" class=\"headerlink\" title=\" Puppeteer \"></a> Puppeteer </h2><p> Egg  Socket.IO </p>\n<p>Socket.IO </p>\n<ul>\n<li><code>socket.io-client</code></li>\n<li><code>egg-socket.io</code></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chat</span><br><span class=\"line\"> app</span><br><span class=\"line\">    extend</span><br><span class=\"line\">       helper.js</span><br><span class=\"line\">    io</span><br><span class=\"line\">       controller</span><br><span class=\"line\">          default.js</span><br><span class=\"line\">       middleware</span><br><span class=\"line\">           connection.js</span><br><span class=\"line\">           packet.js</span><br><span class=\"line\">    router.js</span><br><span class=\"line\"> config</span><br><span class=\"line\"> package.json</span><br></pre></td></tr></table></figure>\n<p>Egg </p>\n<p> <a href=\"https://eggjs.org/zh-cn/tutorials/socketio.html\" target=\"_blank\" rel=\"noopener\">Egg - Socket.IO </a></p>\n<p> Puppeteer  Google </p>\n<p>Puppeteer  Chrome DevTool Protocol CDP CDP  WebSocket WebSocket </p>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-puppeteer-pyramid.png\" alt=\"Puppeteer \"></p>\n<p>Puppeteer </p>\n<ul>\n<li><ul>\n<li> PDF</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://yq.aliyun.com/articles/718188\" target=\"_blank\" rel=\"noopener\"> 99 </a></li>\n<li><a href=\"https://www.infoq.cn/article/dcSBL_9AzCwVPsaQ70dh\" target=\"_blank\" rel=\"noopener\"> Puppeteer </a></li>\n<li><a href=\"https://www.jianshu.com/p/42585c78eeec\" target=\"_blank\" rel=\"noopener\"> Puppeteer </a></li>\n</ul>\n</li>\n</ul>\n<p> Node  Puppeteer </p>\n<p>Puppeteer  <code>page.exposeFunction</code>  Node  Puppeteer  <code>window</code> </p>\n<p> Node  Node </p>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-case.jpg\" alt=\"\"></p>\n<p> Node </p>\n<p><strong> Node.js </strong></p>\n<p></p>\n<ul>\n<li><ul>\n<li></li>\n<li>Puppeteer  =&gt; Chromium Command Line</li>\n</ul>\n</li>\n<li><ul>\n<li> =&gt; </li>\n</ul>\n</li>\n</ul>\n<p> Tab </p>\n<ul>\n<li> Headless Chrome  WS URL <code>browser.connect</code> </li>\n<li>Radis </li>\n<li></li>\n<li> Egg App Config </li>\n</ul>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p><strong></strong></p>\n<ul>\n<li> X </li>\n<li> Egg  Socket.IO </li>\n<li> Puppeteer </li>\n<li></li>\n</ul>\n<p> X  X  X  X  X </p>\n<p> X </p>","more":"<p></p>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-workflow.jpg\" alt=\"\"></p>\n<p> X </p>\n<p></p>\n<h2 id=\"-X-\"><a href=\"#-X-\" class=\"headerlink\" title=\" X \"></a> X </h2><p> X </p>\n<p> X </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A A1 -&gt;  -&gt;  -&gt; B B1 </span><br><span class=\"line\"></span><br><span class=\"line\">B B2 -&gt; C C1 </span><br><span class=\"line\"></span><br><span class=\"line\">Button -&gt; FixedContainer </span><br><span class=\"line\"></span><br><span class=\"line\">Button -&gt; Interface </span><br><span class=\"line\"></span><br><span class=\"line\">Interface -&gt; Interface </span><br></pre></td></tr></table></figure>\n<p></p>\n<p> A  A1  B  B1  B1 /</p>\n<p> B1  B2  <code>fetchSuccess</code>  C  C1 </p>\n<p> X  <code> A  A1 -&gt; BB1</code><code>BB2 =&gt; CC1</code></p>\n<p> B  B  B1  B2 X </p>\n<ol>\n<li></li>\n<li> X </li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-events-chain.jpg\" alt=\"\"></p>\n<p> Button  Input  Input  Message </p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li> SDK </li>\n<li></li>\n<li>//// SDK  Ready </li>\n</ul>\n<p> JavaScript </p>\n<ul>\n<li> Timer</li>\n<li>HTML Parsing</li>\n<li>HTTP Request</li>\n<li>I/OMouseEvent</li>\n<li>Promisethen</li>\n</ul>\n<p></p>\n<ul>\n<li>JavaScript UI RenderingI/OHTTP Request</li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"-Puppeteer-\"><a href=\"#-Puppeteer-\" class=\"headerlink\" title=\" Puppeteer \"></a> Puppeteer </h2><p> Egg  Socket.IO </p>\n<p>Socket.IO </p>\n<ul>\n<li><code>socket.io-client</code></li>\n<li><code>egg-socket.io</code></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chat</span><br><span class=\"line\"> app</span><br><span class=\"line\">    extend</span><br><span class=\"line\">       helper.js</span><br><span class=\"line\">    io</span><br><span class=\"line\">       controller</span><br><span class=\"line\">          default.js</span><br><span class=\"line\">       middleware</span><br><span class=\"line\">           connection.js</span><br><span class=\"line\">           packet.js</span><br><span class=\"line\">    router.js</span><br><span class=\"line\"> config</span><br><span class=\"line\"> package.json</span><br></pre></td></tr></table></figure>\n<p>Egg </p>\n<p> <a href=\"https://eggjs.org/zh-cn/tutorials/socketio.html\" target=\"_blank\" rel=\"noopener\">Egg - Socket.IO </a></p>\n<p> Puppeteer  Google </p>\n<p>Puppeteer  Chrome DevTool Protocol CDP CDP  WebSocket WebSocket </p>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-puppeteer-pyramid.png\" alt=\"Puppeteer \"></p>\n<p>Puppeteer </p>\n<ul>\n<li><ul>\n<li> PDF</li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://yq.aliyun.com/articles/718188\" target=\"_blank\" rel=\"noopener\"> 99 </a></li>\n<li><a href=\"https://www.infoq.cn/article/dcSBL_9AzCwVPsaQ70dh\" target=\"_blank\" rel=\"noopener\"> Puppeteer </a></li>\n<li><a href=\"https://www.jianshu.com/p/42585c78eeec\" target=\"_blank\" rel=\"noopener\"> Puppeteer </a></li>\n</ul>\n</li>\n</ul>\n<p> Node  Puppeteer </p>\n<p>Puppeteer  <code>page.exposeFunction</code>  Node  Puppeteer  <code>window</code> </p>\n<p> Node  Node </p>\n<p><img src=\"http://img.mrsingsing.com/automatation-test-case.jpg\" alt=\"\"></p>\n<p> Node </p>\n<p><strong> Node.js </strong></p>\n<p></p>\n<ul>\n<li><ul>\n<li></li>\n<li>Puppeteer  =&gt; Chromium Command Line</li>\n</ul>\n</li>\n<li><ul>\n<li> =&gt; </li>\n</ul>\n</li>\n</ul>\n<p> Tab </p>\n<ul>\n<li> Headless Chrome  WS URL <code>browser.connect</code> </li>\n<li>Radis </li>\n<li></li>\n<li> Egg App Config </li>\n</ul>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>"},{"title":"AntDesign ","date":"2019-04-05T00:00:00.000Z","_content":"\n## \n\n\n\n\n\n\n\n\n\n- \n- \n-  antd ++\n  - \n  - \n- \n\n<!-- more -->\n\n## \n\n### \n\n UI \n\n `antd`  Form  `Form.create()`  `getFieldDecorator` \n\n`Form.create()` \n\n```jsx\nclass Basic extends React.Component {\n  render(){\n    <Form>\n      <Form.Item>\n        {\n          getFieldDecorator('expiration', {\n            initialValue: fields.expiration ? fields.expiration : undefined,\n            validateFirst: true,\n            rules: [\n              { required: true, message: '' }\n            ]\n          })(<SuffixInput unit=\"\" placeholder=\"\" />)\n        }\n      </Form.Item>\n    <Form>\n  }\n}\n\nForm.create()(Basic)\n```\n\n\n\n### \n\n****\n\n****  Form  `getFieldDecorator` `validateFields`  Props \n\n**** \n\n****\n\n****  State  Form  Props  `initialValue`  Form \n\n**** \n\n****  `initialValue` \n\n### \n\n Form \n\n AntDesign  [](https://ant.design/components/form-cn/#components-form-demo-global-state)  Re-Render \n\n\n\n-  Form  onFieldsChange  `handleFormChange`  State \n-  State  Props  Form  `mapPropsToFields`  `Form.createFormField` \n\n![real-time-synchronization](http://img.mrsingsing.com/ant-form-real-time-synchronization.png)\n\n\n\n-  Form  FieldsStore  Child  Re-Render\n-  handleFormChange \n\n Re-Render\n\n![verifying-synchronization](http://img.mrsingsing.com/ant-form-verifying-synchronization.png)\n\n### \n\n Model  DOM \n\n `initialValue` \n\n\n\n****\n\n```jsx\nstatic getDerviedStateFromProps(nextProps, prevState){\n  if (\n    !isEmptyObject(dataDetail) &&\n    !isEmptyArray(dataList) &&\n    !prevState.isInitial\n  ){\n    // ...Logic Disposal\n\n    return {\n      basic, receipt, usage, isInitial: true\n    }\n  }\n  return null\n}\n```\n\n `getDerivedStateFromProps`  Model  Store  `isInitial`  Props \n\n `getDerivedStateFromProps`  State \n\n```jsx\ngetCurrentStepComponent(current) {\n  const canRendering = [basic, receipt, usage].every(item => !isEmptyObject(item));\n  if (!canRendering) {\n    return (\n      <div className={styles.spin}>\n        <Spin style={{ margin: 32 }}/>\n      </div>\n    );\n  }\n  // Return SubComponent to render\n}\n```\n\n## \n\n### \n\n\n\n\n\n- \n  - \n  - \n  - \n- \n- \n\n AntDesign \n\n- \n\n```jsx\nconst data = {\n  name: 'Foo',\n  interval: {\n    type: 'ALL',\n    week: ['1', '2', '3']\n    interval: [\n      { startTime: '08:00', endTime: '10:00'},\n      { startTime: '12:00', endTime: '14: 00'}\n    ]\n  }\n}\n```\n\n- [](https://ant.design/components/form-cn/#components-form-demo-dynamic-form-item)\n\n Ant Design \n\n![time-interval-exhibition](http://img.mrsingsing.com/ant-form-time-interval-exhibition.gif)\n\n## Form \n\n-  Radio / Checked  feedback #issue\n- input  Tab  input  tabindex  -1\n- input  readonly \n- input  `autoComplete=off`\n-  getFieldDecorator  `undefined`  `null`  `''`\n\n\n\n```jsx\ngetFieldDecorator('name', {\n  initialValue: fields.name ? fields.name : undefined,\n  rules: [],\n})(<Input />);\n```\n\n-  `validateFirst: true`\n-  `props` \n-  `push`  `concat`  `filter` Immutable \n\n## \n\n- \n-  antd  antd  React \n- \n\n## \n\n### \n\n- [antd: ^3.12.0](https://github.com/ant-design/ant-design)\n  - [FormComponent](https://github.com/ant-design/ant-design/blob/master/components/form/index.en-US.md)\n  - [rc-form](https://github.com/react-component/form)\n  - [async-validator](https://github.com/yiminghe/async-validator)\n- [moment: ^2.22.1](https://github.com/moment/moment)\n\n### \n\n- [](https://github.com/ant-design/ant-design/blob/master/components/form/docs/tutorial.md)\n- [10  Ant Design Form ](https://juejin.im/post/5c47ffff51882533e05ef4f9)\n- [antd ](https://zhuanlan.zhihu.com/p/27740483?utm_medium=hao.caibaojian.com&utm_source=hao.caibaojian.com)\n- [Redux-sage API](https://redux-saga-in-chinese.js.org/docs/api/)\n","source":"_posts/form-business-design-pratice-in-antd.md","raw":"---\ntitle: AntDesign \ndate: '2019-04-05'\n---\n\n## \n\n\n\n\n\n\n\n\n\n- \n- \n-  antd ++\n  - \n  - \n- \n\n<!-- more -->\n\n## \n\n### \n\n UI \n\n `antd`  Form  `Form.create()`  `getFieldDecorator` \n\n`Form.create()` \n\n```jsx\nclass Basic extends React.Component {\n  render(){\n    <Form>\n      <Form.Item>\n        {\n          getFieldDecorator('expiration', {\n            initialValue: fields.expiration ? fields.expiration : undefined,\n            validateFirst: true,\n            rules: [\n              { required: true, message: '' }\n            ]\n          })(<SuffixInput unit=\"\" placeholder=\"\" />)\n        }\n      </Form.Item>\n    <Form>\n  }\n}\n\nForm.create()(Basic)\n```\n\n\n\n### \n\n****\n\n****  Form  `getFieldDecorator` `validateFields`  Props \n\n**** \n\n****\n\n****  State  Form  Props  `initialValue`  Form \n\n**** \n\n****  `initialValue` \n\n### \n\n Form \n\n AntDesign  [](https://ant.design/components/form-cn/#components-form-demo-global-state)  Re-Render \n\n\n\n-  Form  onFieldsChange  `handleFormChange`  State \n-  State  Props  Form  `mapPropsToFields`  `Form.createFormField` \n\n![real-time-synchronization](http://img.mrsingsing.com/ant-form-real-time-synchronization.png)\n\n\n\n-  Form  FieldsStore  Child  Re-Render\n-  handleFormChange \n\n Re-Render\n\n![verifying-synchronization](http://img.mrsingsing.com/ant-form-verifying-synchronization.png)\n\n### \n\n Model  DOM \n\n `initialValue` \n\n\n\n****\n\n```jsx\nstatic getDerviedStateFromProps(nextProps, prevState){\n  if (\n    !isEmptyObject(dataDetail) &&\n    !isEmptyArray(dataList) &&\n    !prevState.isInitial\n  ){\n    // ...Logic Disposal\n\n    return {\n      basic, receipt, usage, isInitial: true\n    }\n  }\n  return null\n}\n```\n\n `getDerivedStateFromProps`  Model  Store  `isInitial`  Props \n\n `getDerivedStateFromProps`  State \n\n```jsx\ngetCurrentStepComponent(current) {\n  const canRendering = [basic, receipt, usage].every(item => !isEmptyObject(item));\n  if (!canRendering) {\n    return (\n      <div className={styles.spin}>\n        <Spin style={{ margin: 32 }}/>\n      </div>\n    );\n  }\n  // Return SubComponent to render\n}\n```\n\n## \n\n### \n\n\n\n\n\n- \n  - \n  - \n  - \n- \n- \n\n AntDesign \n\n- \n\n```jsx\nconst data = {\n  name: 'Foo',\n  interval: {\n    type: 'ALL',\n    week: ['1', '2', '3']\n    interval: [\n      { startTime: '08:00', endTime: '10:00'},\n      { startTime: '12:00', endTime: '14: 00'}\n    ]\n  }\n}\n```\n\n- [](https://ant.design/components/form-cn/#components-form-demo-dynamic-form-item)\n\n Ant Design \n\n![time-interval-exhibition](http://img.mrsingsing.com/ant-form-time-interval-exhibition.gif)\n\n## Form \n\n-  Radio / Checked  feedback #issue\n- input  Tab  input  tabindex  -1\n- input  readonly \n- input  `autoComplete=off`\n-  getFieldDecorator  `undefined`  `null`  `''`\n\n\n\n```jsx\ngetFieldDecorator('name', {\n  initialValue: fields.name ? fields.name : undefined,\n  rules: [],\n})(<Input />);\n```\n\n-  `validateFirst: true`\n-  `props` \n-  `push`  `concat`  `filter` Immutable \n\n## \n\n- \n-  antd  antd  React \n- \n\n## \n\n### \n\n- [antd: ^3.12.0](https://github.com/ant-design/ant-design)\n  - [FormComponent](https://github.com/ant-design/ant-design/blob/master/components/form/index.en-US.md)\n  - [rc-form](https://github.com/react-component/form)\n  - [async-validator](https://github.com/yiminghe/async-validator)\n- [moment: ^2.22.1](https://github.com/moment/moment)\n\n### \n\n- [](https://github.com/ant-design/ant-design/blob/master/components/form/docs/tutorial.md)\n- [10  Ant Design Form ](https://juejin.im/post/5c47ffff51882533e05ef4f9)\n- [antd ](https://zhuanlan.zhihu.com/p/27740483?utm_medium=hao.caibaojian.com&utm_source=hao.caibaojian.com)\n- [Redux-sage API](https://redux-saga-in-chinese.js.org/docs/api/)\n","slug":"form-business-design-pratice-in-antd","published":1,"updated":"2021-08-18T03:33:14.534Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99yv0007v31pxvnu7yu6","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li> antd ++<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li></li>\n</ul>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> UI </p>\n<p> <code>antd</code>  Form  <code>Form.create()</code>  <code>getFieldDecorator</code> </p>\n<p><code>Form.create()</code> </p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Basic</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render()&#123;</span><br><span class=\"line\">    &lt;Form&gt;</span><br><span class=\"line\">      &lt;Form.Item&gt;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          getFieldDecorator(<span class=\"string\">'expiration'</span>, &#123;</span><br><span class=\"line\">            initialValue: fields.expiration ? fields.expiration : <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">            validateFirst: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            rules: [</span><br><span class=\"line\">              &#123; <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">message</span>: <span class=\"string\">''</span> &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;)(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">SuffixInput</span> <span class=\"attr\">unit</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"\"</span> /&gt;</span></span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/Form.Item&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;Form&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">Form.create()(Basic)</span></span><br></pre></td></tr></table></figure>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong></p>\n<p><strong></strong>  Form  <code>getFieldDecorator</code> <code>validateFields</code>  Props </p>\n<p><strong></strong> </p>\n<p><strong></strong></p>\n<p><strong></strong>  State  Form  Props  <code>initialValue</code>  Form </p>\n<p><strong></strong> </p>\n<p><strong></strong>  <code>initialValue</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Form </p>\n<p> AntDesign  <a href=\"https://ant.design/components/form-cn/#components-form-demo-global-state\" target=\"_blank\" rel=\"noopener\"></a>  Re-Render </p>\n<p></p>\n<ul>\n<li> Form  onFieldsChange  <code>handleFormChange</code>  State </li>\n<li> State  Props  Form  <code>mapPropsToFields</code>  <code>Form.createFormField</code> </li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/ant-form-real-time-synchronization.png\" alt=\"real-time-synchronization\"></p>\n<p></p>\n<ul>\n<li> Form  FieldsStore  Child  Re-Render</li>\n<li> handleFormChange </li>\n</ul>\n<p> Re-Render</p>\n<p><img src=\"http://img.mrsingsing.com/ant-form-verifying-synchronization.png\" alt=\"verifying-synchronization\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Model  DOM </p>\n<p> <code>initialValue</code> </p>\n<p></p>\n<p><strong></strong></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> getDerviedStateFromProps(nextProps, prevState)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (</span><br><span class=\"line\">    !isEmptyObject(dataDetail) &amp;&amp;</span><br><span class=\"line\">    !isEmptyArray(dataList) &amp;&amp;</span><br><span class=\"line\">    !prevState.isInitial</span><br><span class=\"line\">  )&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...Logic Disposal</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      basic, receipt, usage, <span class=\"attr\">isInitial</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>getDerivedStateFromProps</code>  Model  Store  <code>isInitial</code>  Props </p>\n<p> <code>getDerivedStateFromProps</code>  State </p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getCurrentStepComponent(current) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> canRendering = [basic, receipt, usage].every(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> !isEmptyObject(item));</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!canRendering) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=&#123;styles.spin&#125;&gt;</span><br><span class=\"line\">        &lt;Spin style=&#123;&#123; <span class=\"attr\">margin</span>: <span class=\"number\">32</span> &#125;&#125;/&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ Return SubComponent to render</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li></li>\n<li></li>\n</ul>\n<p> AntDesign </p>\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> data = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'Foo'</span>,</span><br><span class=\"line\">  interval: &#123;</span><br><span class=\"line\">    type: <span class=\"string\">'ALL'</span>,</span><br><span class=\"line\">    week: [<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>]</span><br><span class=\"line\">    interval: [</span><br><span class=\"line\">      &#123; <span class=\"attr\">startTime</span>: <span class=\"string\">'08:00'</span>, <span class=\"attr\">endTime</span>: <span class=\"string\">'10:00'</span>&#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">startTime</span>: <span class=\"string\">'12:00'</span>, <span class=\"attr\">endTime</span>: <span class=\"string\">'14: 00'</span>&#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><a href=\"https://ant.design/components/form-cn/#components-form-demo-dynamic-form-item\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<p> Ant Design </p>\n<p><img src=\"http://img.mrsingsing.com/ant-form-time-interval-exhibition.gif\" alt=\"time-interval-exhibition\"></p>\n<h2 id=\"Form-\"><a href=\"#Form-\" class=\"headerlink\" title=\"Form \"></a>Form </h2><ul>\n<li> Radio / Checked  feedback #issue</li>\n<li>input  Tab  input  tabindex  -1</li>\n<li>input  readonly </li>\n<li>input  <code>autoComplete=off</code></li>\n<li> getFieldDecorator  <code>undefined</code>  <code>null</code>  <code>&#39;&#39;</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getFieldDecorator(<span class=\"string\">'name'</span>, &#123;</span><br><span class=\"line\">  initialValue: fields.name ? fields.name : <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">  rules: [],</span><br><span class=\"line\">&#125;)(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Input</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li> <code>validateFirst: true</code></li>\n<li> <code>props</code> </li>\n<li> <code>push</code>  <code>concat</code>  <code>filter</code> Immutable </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li> antd  antd  React </li>\n<li></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">antd: ^3.12.0</a><ul>\n<li><a href=\"https://github.com/ant-design/ant-design/blob/master/components/form/index.en-US.md\" target=\"_blank\" rel=\"noopener\">FormComponent</a></li>\n<li><a href=\"https://github.com/react-component/form\" target=\"_blank\" rel=\"noopener\">rc-form</a></li>\n<li><a href=\"https://github.com/yiminghe/async-validator\" target=\"_blank\" rel=\"noopener\">async-validator</a></li>\n</ul>\n</li>\n<li><a href=\"https://github.com/moment/moment\" target=\"_blank\" rel=\"noopener\">moment: ^2.22.1</a></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><a href=\"https://github.com/ant-design/ant-design/blob/master/components/form/docs/tutorial.md\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://juejin.im/post/5c47ffff51882533e05ef4f9\" target=\"_blank\" rel=\"noopener\">10  Ant Design Form </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/27740483?utm_medium=hao.caibaojian.com&amp;utm_source=hao.caibaojian.com\" target=\"_blank\" rel=\"noopener\">antd </a></li>\n<li><a href=\"https://redux-saga-in-chinese.js.org/docs/api/\" target=\"_blank\" rel=\"noopener\">Redux-sage API</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li> antd ++<ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li></li>\n</ul>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> UI </p>\n<p> <code>antd</code>  Form  <code>Form.create()</code>  <code>getFieldDecorator</code> </p>\n<p><code>Form.create()</code> </p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Basic</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render()&#123;</span><br><span class=\"line\">    &lt;Form&gt;</span><br><span class=\"line\">      &lt;Form.Item&gt;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          getFieldDecorator(<span class=\"string\">'expiration'</span>, &#123;</span><br><span class=\"line\">            initialValue: fields.expiration ? fields.expiration : <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">            validateFirst: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            rules: [</span><br><span class=\"line\">              &#123; <span class=\"attr\">required</span>: <span class=\"literal\">true</span>, <span class=\"attr\">message</span>: <span class=\"string\">''</span> &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;)(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">SuffixInput</span> <span class=\"attr\">unit</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"\"</span> /&gt;</span></span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/Form.Item&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;Form&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">Form.create()(Basic)</span></span><br></pre></td></tr></table></figure>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong></p>\n<p><strong></strong>  Form  <code>getFieldDecorator</code> <code>validateFields</code>  Props </p>\n<p><strong></strong> </p>\n<p><strong></strong></p>\n<p><strong></strong>  State  Form  Props  <code>initialValue</code>  Form </p>\n<p><strong></strong> </p>\n<p><strong></strong>  <code>initialValue</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Form </p>\n<p> AntDesign  <a href=\"https://ant.design/components/form-cn/#components-form-demo-global-state\" target=\"_blank\" rel=\"noopener\"></a>  Re-Render </p>\n<p></p>\n<ul>\n<li> Form  onFieldsChange  <code>handleFormChange</code>  State </li>\n<li> State  Props  Form  <code>mapPropsToFields</code>  <code>Form.createFormField</code> </li>\n</ul>\n<p><img src=\"http://img.mrsingsing.com/ant-form-real-time-synchronization.png\" alt=\"real-time-synchronization\"></p>\n<p></p>\n<ul>\n<li> Form  FieldsStore  Child  Re-Render</li>\n<li> handleFormChange </li>\n</ul>\n<p> Re-Render</p>\n<p><img src=\"http://img.mrsingsing.com/ant-form-verifying-synchronization.png\" alt=\"verifying-synchronization\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Model  DOM </p>\n<p> <code>initialValue</code> </p>\n<p></p>\n<p><strong></strong></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> getDerviedStateFromProps(nextProps, prevState)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (</span><br><span class=\"line\">    !isEmptyObject(dataDetail) &amp;&amp;</span><br><span class=\"line\">    !isEmptyArray(dataList) &amp;&amp;</span><br><span class=\"line\">    !prevState.isInitial</span><br><span class=\"line\">  )&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...Logic Disposal</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      basic, receipt, usage, <span class=\"attr\">isInitial</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">null</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>getDerivedStateFromProps</code>  Model  Store  <code>isInitial</code>  Props </p>\n<p> <code>getDerivedStateFromProps</code>  State </p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getCurrentStepComponent(current) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> canRendering = [basic, receipt, usage].every(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> !isEmptyObject(item));</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!canRendering) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=&#123;styles.spin&#125;&gt;</span><br><span class=\"line\">        &lt;Spin style=&#123;&#123; <span class=\"attr\">margin</span>: <span class=\"number\">32</span> &#125;&#125;/&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ Return SubComponent to render</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li></li>\n<li></li>\n</ul>\n<p> AntDesign </p>\n<ul>\n<li></li>\n</ul>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> data = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'Foo'</span>,</span><br><span class=\"line\">  interval: &#123;</span><br><span class=\"line\">    type: <span class=\"string\">'ALL'</span>,</span><br><span class=\"line\">    week: [<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>]</span><br><span class=\"line\">    interval: [</span><br><span class=\"line\">      &#123; <span class=\"attr\">startTime</span>: <span class=\"string\">'08:00'</span>, <span class=\"attr\">endTime</span>: <span class=\"string\">'10:00'</span>&#125;,</span><br><span class=\"line\">      &#123; <span class=\"attr\">startTime</span>: <span class=\"string\">'12:00'</span>, <span class=\"attr\">endTime</span>: <span class=\"string\">'14: 00'</span>&#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><a href=\"https://ant.design/components/form-cn/#components-form-demo-dynamic-form-item\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<p> Ant Design </p>\n<p><img src=\"http://img.mrsingsing.com/ant-form-time-interval-exhibition.gif\" alt=\"time-interval-exhibition\"></p>\n<h2 id=\"Form-\"><a href=\"#Form-\" class=\"headerlink\" title=\"Form \"></a>Form </h2><ul>\n<li> Radio / Checked  feedback #issue</li>\n<li>input  Tab  input  tabindex  -1</li>\n<li>input  readonly </li>\n<li>input  <code>autoComplete=off</code></li>\n<li> getFieldDecorator  <code>undefined</code>  <code>null</code>  <code>&#39;&#39;</code></li>\n</ul>\n<p></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getFieldDecorator(<span class=\"string\">'name'</span>, &#123;</span><br><span class=\"line\">  initialValue: fields.name ? fields.name : <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">  rules: [],</span><br><span class=\"line\">&#125;)(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Input</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li> <code>validateFirst: true</code></li>\n<li> <code>props</code> </li>\n<li> <code>push</code>  <code>concat</code>  <code>filter</code> Immutable </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li> antd  antd  React </li>\n<li></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">antd: ^3.12.0</a><ul>\n<li><a href=\"https://github.com/ant-design/ant-design/blob/master/components/form/index.en-US.md\" target=\"_blank\" rel=\"noopener\">FormComponent</a></li>\n<li><a href=\"https://github.com/react-component/form\" target=\"_blank\" rel=\"noopener\">rc-form</a></li>\n<li><a href=\"https://github.com/yiminghe/async-validator\" target=\"_blank\" rel=\"noopener\">async-validator</a></li>\n</ul>\n</li>\n<li><a href=\"https://github.com/moment/moment\" target=\"_blank\" rel=\"noopener\">moment: ^2.22.1</a></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li><a href=\"https://github.com/ant-design/ant-design/blob/master/components/form/docs/tutorial.md\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://juejin.im/post/5c47ffff51882533e05ef4f9\" target=\"_blank\" rel=\"noopener\">10  Ant Design Form </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/27740483?utm_medium=hao.caibaojian.com&amp;utm_source=hao.caibaojian.com\" target=\"_blank\" rel=\"noopener\">antd </a></li>\n<li><a href=\"https://redux-saga-in-chinese.js.org/docs/api/\" target=\"_blank\" rel=\"noopener\">Redux-sage API</a></li>\n</ul>"},{"title":"","date":"2019-05-19T00:00:00.000Z","_content":"\n\n\n\n\n- \n- \n- \n- \n\n****\n\n```\n =>  => () => ()\n```\n\n<!-- more -->\n\n# \n\n\n\n Google \n[ Optimizing the Critical Rendering Path](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/optimizing-critical-rendering-path)\n\n\n\n- \n- \n- \n\n CPU \n\n\n\n\n\n****\n\n1. \n2. \n3. \n4. \n\n# \n\n\n\n## \n\n### DNS \n\nDNS  URL  IP [DNS ](https://tsejx.github.io/JavaScript-Guidebook/computer-networks/dns.html)\n\nDNS \n\n- ** DNS **\n- **DNS **\n\n `http-equiv`  `<meta>`  DNS \n\n```html\n<meta http-equiv=\"x-dns-prefetch-control\" content=\"on\" />\n```\n\n `rel`  `dns-prefetch`  `<link>` \n\n```html\n<link rel='dns-prefetch\" href=\"//host_name_to_prefetch.com\"/>\n```\n\n****\n\n- [MDNX-DNS-Prefetch-Control](https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching)\n- [DNS Prefetching](https://dev.chromium.org/developers/design-documents/dns-prefetching)\n- [DNS Prefetching for Firefox](https://bitsup.blogspot.com/2008/11/dns-prefetching-for-firefox.html)\n\n### TCP \n\n**** TCP HTTP/1.1 HTTP/1.0 \n\nKeep-Alive \n\n```http\nConnection: keep-alive\n```\n\n### HTTP \n\n- ** HTTP **\n  - \n  - CSS Sprites \n  -  Base64 \n- ****\n  - **** HTTP  4~8  HTTP \n  - ****\n- ****\n  - URL  `/` \n- ****\n- **Cookie**\n  -  Cookie \n    -  Cookie\n    -  Cookie  domain \n    - \n  -  Cookie \n- [HTTP/2](https://tsejx.github.io/JavaScript-Guidebook/computer-networks/http/http2.html)\n  - \n  - \n  - \n  - \n  -  [HTTP/2]\n- [HTTP/3](https://zh.wikipedia.org/wiki/HTTP/3)\n\n****\n\n- [ - ](http://bubkoo.com/2015/11/19/prefetching-preloading-prebrowsing/)\n- [HTTP/2  HTTP/2  Web ](https://github.com/creeperyang/blog/issues/23)\n\n## \n\n\n\n- [HTTP ](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html)\n  - [](<[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#)>)\n    - Expires  `Expires: Thu, 21 Jan 2017 23:59:59 GMT` \n    - Cache-Control  `Cache-Control: max-age=3600`\n  - [](<[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#)>)\n    - Last-Modified / If-Modified-Since  `Expires: Wed, 26 Jan 2017 00:35:11 GMT` \n    - Etag / If-None-Match \n  - \n    - \n    -  [](https://link.zhihu.com/?target=http%3A//baike.baidu.com/view/10961371.htm) \n- [CDN ](https://tsejx.github.io/JavaScript-Guidebook/computer-networks/cdn.html) \n  - HTML \n  -  / JavaScript  / CSS  CDN  Hash \n  -  CDN \n  - CDN  Cookie CDN  Cookie\n  - CDN \n  - CDN \n- ************ Redis \n- ****: \n  - [Cookie](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/cookie.html)\n  - [WebStorage](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/web-storage.html)\n    - LocalStorage\n    - SessionStorage\n  - IndexDB\n  - [ServiceWorker](https://tsejx.github.io/JavaScript-Guidebook/html5-scripting-programming/offline-and-storage/service-worker.html)\n  - AppCache mainfest \n\n****\n\n- [](https://www.zhihu.com/question/20790576)\n- [ SRI  LocalStorage ](https://link.juejin.im/?target=https%3A%2F%2Fimququ.com%2Fpost%2Fenhance-security-for-ls-code.html)\n\n# \n\n\n\n- \n- \n- \n- \n\n# \n\n- /\n- \n- \n\n## /\n\n- ****\n  - Tree Shaking \n  - UglifyJs  / \n  - Code Spliting \n- ** Gzip **\n  -  `Accept-Encoding: gzip, deflate`\n  -  `Content-Encoding: gzip`\n  - Gzip  HTMlXML  JSON\n  -  PDF  Gzip Gzip  CPU \n- ****\n  -  ES6  ES5 \n  -  `<script type=\"module\"> / <script type=\"module\">`\n- ** Polyfill**\n  -  Polyfill\n- ****\n  -  UI  ****\n  -  **** jpg webp\n  -  ** CSS Sprite** 5K  B**ase64** \n  -  I**confont**  **SVG**\n  -  favicon.ico \n  -  Blob \n  -  [img-2](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FRevillWeb%2Fimg-2)  img \n  - Base64 \n- ****\n  -  FOUTFlash Of Unstyled Text FOITFlash Of Invisible Text \n  - \n  -  CSS\n- ****\n  - \n\n## \n\n- ****\n  - CSS  `<head>` \n    -  `<head>` \n  - JavaScript  `<body>` \n    - ****\n    - ****\n      - \n      -  `defer`  HTML \n      -  `async`  HTML  HTML \n  -  `<head>`  `<body>`  `style`  `script` \n- ****\n\n  - ****\n  - ****\n    - Preload\n    - Prefetch\n    - Preconnect\n    - Subresource\n  - ****\n    - \n    - \n    - Preload  W3CPreload\n      - rel  preload \n      - as  JavaScriptImagesCSSMedia \n  - ****\n    - \n      - \n      - \n    - ****\n      -  loading \n      - \n    - ****\n      - \n      -  AJAX \n    - JavaScript  JavaScript  JavaScript\n    -  HTML  `<textarea>` `type`  `<script>`  DOM \n\n- ****\n  - \n  -  [CSS Trigger](https://csstriggers.com/) \n  - ****\n    - \n    -  DOM \n    -  DOM \n    -  DOM \n    -  DOM \n      -  DOM \n      -  DOM \n    - \n    - \n    -  style \n    -  class \n    - \n      -  `offsetWidth``offsetHeight`  `getComputedStyle` \n      - \n    -  HTML \n    - \n      - \n      - \n      - \n    -  GPU \n      - transform\n      - opacity\n      - filter\n\n****\n\n- [](https://juejin.im/post/59b73ef75188253db70acdb5#heading-5)\n- [ PreloadPrefetch  Preconnect](https://juejin.im/post/5b5984b851882561da216311)\n- [preload-webpack-plugin](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FGoogleChrome%2Fpreload-webpack-plugin)\n- [Preload ](https://link.juejin.im/?target=https%3A%2F%2Fwww.smashingmagazine.com%2F2016%2F02%2Fpreload-what-is-it-good-for%2F)\n\n## \n\n-  Web \n  - \n  - \n- \n  - \n  - \n- SSR\n  - \n  - /\n  - \n- \n  -  ****\n  -  **Skeleton/ Loading** \n  -  **30 ** \n  - JavaScript  100ms \n    - \n    -  web worker \n\n# \n\n ********\n\n## JavaScript \n\n- ****\n  -  / \n  - \n  - \n    -  ****\n    - **** \n- ****\n  - \n  - :\n    -  \n      - \n      - \n    - \n    - JavaScript  **** \n    -  for-in \n- ****Map / Object > switch > if-else\n- **** `import()`\n\n## DOM \n\n-  DOM \n-  DOM  DOM \n- \n-  `requestAnimationFrame`  `setTimeout`  `setInterval` \n\n## CSS \n\n- ****\n- ****`.xxx-child-text{}`  `.xxx .child .text{}`\n- ****\n  - \n- ****\n-  ****  CSS \n-  `<link>`  @import\n-  `font-color: expression((new Date()).getHours()%3?\"#FFF\":\"#AAA\")` \n\n## HTML \n\n-  `<!DOCTYPE html>` \n- ** DOM **\n-  `src`  `href` `src`  `href` \n  - IE ****\n  - SafariChromeFirefox  URL \n  - Opera \n-  ****  ****\n- ****  SEO \n-  table  `<br/>`  `<hr/>`\n\n# \n\n****\n\n-  [2018 ](https://juejin.im/post/5a966bd16fb9a0635172a50a)\n-  [ Web ](https://github.com/berwin/Blog/issues/23)\n-  [Web ](https://segmentfault.com/a/1190000018263418?utm_medium=hao.caibaojian.com&utm_source=hao.caibaojian.com&share_user=1030000000178452)\n-  [](https://juejin.im/post/5b025d856fb9a07aa0484e54)\n-  [CSS  8 ](https://juejin.im/post/5b6133a351882519d346853f)\n-  [  JavaScript](https://juejin.im/post/5b7e1f81f265da436a075db4)\n-  [Web ](https://juejin.im/post/5c011e0c5188252ea66afdfa)\n-  [](https://github.com/barretlee/performance-column/milestone/1)\n-  [](https://github.com/liangsenzhi/awesome-wpo-chinese)\n-  [awesome-wpo](https://github.com/davidsonfellipe/awesome-wpo)\n-  [A Frontend Checklist for Websites](https://github.com/drublic/checklist)\n\n****\n\n-  [](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/)\n-  [16 ](http://velocity.oreilly.com.cn/2013/ppts/16_ms_optimization--web_front-end_performance_optimization.pdf)\n-  [Optimize JavaScript Execution  JavaScript ](https://developers.google.com/web/fundamentals/performance/rendering/optimize-javascript-execution)\n","source":"_posts/means-for-performance-optimization.md","raw":"---\ntitle: \ndate: '2019-05-19'\n---\n\n\n\n\n\n- \n- \n- \n- \n\n****\n\n```\n =>  => () => ()\n```\n\n<!-- more -->\n\n# \n\n\n\n Google \n[ Optimizing the Critical Rendering Path](https://developers.google.com/web/fundamentals/performance/critical-rendering-path/optimizing-critical-rendering-path)\n\n\n\n- \n- \n- \n\n CPU \n\n\n\n\n\n****\n\n1. \n2. \n3. \n4. \n\n# \n\n\n\n## \n\n### DNS \n\nDNS  URL  IP [DNS ](https://tsejx.github.io/JavaScript-Guidebook/computer-networks/dns.html)\n\nDNS \n\n- ** DNS **\n- **DNS **\n\n `http-equiv`  `<meta>`  DNS \n\n```html\n<meta http-equiv=\"x-dns-prefetch-control\" content=\"on\" />\n```\n\n `rel`  `dns-prefetch`  `<link>` \n\n```html\n<link rel='dns-prefetch\" href=\"//host_name_to_prefetch.com\"/>\n```\n\n****\n\n- [MDNX-DNS-Prefetch-Control](https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching)\n- [DNS Prefetching](https://dev.chromium.org/developers/design-documents/dns-prefetching)\n- [DNS Prefetching for Firefox](https://bitsup.blogspot.com/2008/11/dns-prefetching-for-firefox.html)\n\n### TCP \n\n**** TCP HTTP/1.1 HTTP/1.0 \n\nKeep-Alive \n\n```http\nConnection: keep-alive\n```\n\n### HTTP \n\n- ** HTTP **\n  - \n  - CSS Sprites \n  -  Base64 \n- ****\n  - **** HTTP  4~8  HTTP \n  - ****\n- ****\n  - URL  `/` \n- ****\n- **Cookie**\n  -  Cookie \n    -  Cookie\n    -  Cookie  domain \n    - \n  -  Cookie \n- [HTTP/2](https://tsejx.github.io/JavaScript-Guidebook/computer-networks/http/http2.html)\n  - \n  - \n  - \n  - \n  -  [HTTP/2]\n- [HTTP/3](https://zh.wikipedia.org/wiki/HTTP/3)\n\n****\n\n- [ - ](http://bubkoo.com/2015/11/19/prefetching-preloading-prebrowsing/)\n- [HTTP/2  HTTP/2  Web ](https://github.com/creeperyang/blog/issues/23)\n\n## \n\n\n\n- [HTTP ](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html)\n  - [](<[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#)>)\n    - Expires  `Expires: Thu, 21 Jan 2017 23:59:59 GMT` \n    - Cache-Control  `Cache-Control: max-age=3600`\n  - [](<[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#)>)\n    - Last-Modified / If-Modified-Since  `Expires: Wed, 26 Jan 2017 00:35:11 GMT` \n    - Etag / If-None-Match \n  - \n    - \n    -  [](https://link.zhihu.com/?target=http%3A//baike.baidu.com/view/10961371.htm) \n- [CDN ](https://tsejx.github.io/JavaScript-Guidebook/computer-networks/cdn.html) \n  - HTML \n  -  / JavaScript  / CSS  CDN  Hash \n  -  CDN \n  - CDN  Cookie CDN  Cookie\n  - CDN \n  - CDN \n- ************ Redis \n- ****: \n  - [Cookie](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/cookie.html)\n  - [WebStorage](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/web-storage.html)\n    - LocalStorage\n    - SessionStorage\n  - IndexDB\n  - [ServiceWorker](https://tsejx.github.io/JavaScript-Guidebook/html5-scripting-programming/offline-and-storage/service-worker.html)\n  - AppCache mainfest \n\n****\n\n- [](https://www.zhihu.com/question/20790576)\n- [ SRI  LocalStorage ](https://link.juejin.im/?target=https%3A%2F%2Fimququ.com%2Fpost%2Fenhance-security-for-ls-code.html)\n\n# \n\n\n\n- \n- \n- \n- \n\n# \n\n- /\n- \n- \n\n## /\n\n- ****\n  - Tree Shaking \n  - UglifyJs  / \n  - Code Spliting \n- ** Gzip **\n  -  `Accept-Encoding: gzip, deflate`\n  -  `Content-Encoding: gzip`\n  - Gzip  HTMlXML  JSON\n  -  PDF  Gzip Gzip  CPU \n- ****\n  -  ES6  ES5 \n  -  `<script type=\"module\"> / <script type=\"module\">`\n- ** Polyfill**\n  -  Polyfill\n- ****\n  -  UI  ****\n  -  **** jpg webp\n  -  ** CSS Sprite** 5K  B**ase64** \n  -  I**confont**  **SVG**\n  -  favicon.ico \n  -  Blob \n  -  [img-2](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FRevillWeb%2Fimg-2)  img \n  - Base64 \n- ****\n  -  FOUTFlash Of Unstyled Text FOITFlash Of Invisible Text \n  - \n  -  CSS\n- ****\n  - \n\n## \n\n- ****\n  - CSS  `<head>` \n    -  `<head>` \n  - JavaScript  `<body>` \n    - ****\n    - ****\n      - \n      -  `defer`  HTML \n      -  `async`  HTML  HTML \n  -  `<head>`  `<body>`  `style`  `script` \n- ****\n\n  - ****\n  - ****\n    - Preload\n    - Prefetch\n    - Preconnect\n    - Subresource\n  - ****\n    - \n    - \n    - Preload  W3CPreload\n      - rel  preload \n      - as  JavaScriptImagesCSSMedia \n  - ****\n    - \n      - \n      - \n    - ****\n      -  loading \n      - \n    - ****\n      - \n      -  AJAX \n    - JavaScript  JavaScript  JavaScript\n    -  HTML  `<textarea>` `type`  `<script>`  DOM \n\n- ****\n  - \n  -  [CSS Trigger](https://csstriggers.com/) \n  - ****\n    - \n    -  DOM \n    -  DOM \n    -  DOM \n    -  DOM \n      -  DOM \n      -  DOM \n    - \n    - \n    -  style \n    -  class \n    - \n      -  `offsetWidth``offsetHeight`  `getComputedStyle` \n      - \n    -  HTML \n    - \n      - \n      - \n      - \n    -  GPU \n      - transform\n      - opacity\n      - filter\n\n****\n\n- [](https://juejin.im/post/59b73ef75188253db70acdb5#heading-5)\n- [ PreloadPrefetch  Preconnect](https://juejin.im/post/5b5984b851882561da216311)\n- [preload-webpack-plugin](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FGoogleChrome%2Fpreload-webpack-plugin)\n- [Preload ](https://link.juejin.im/?target=https%3A%2F%2Fwww.smashingmagazine.com%2F2016%2F02%2Fpreload-what-is-it-good-for%2F)\n\n## \n\n-  Web \n  - \n  - \n- \n  - \n  - \n- SSR\n  - \n  - /\n  - \n- \n  -  ****\n  -  **Skeleton/ Loading** \n  -  **30 ** \n  - JavaScript  100ms \n    - \n    -  web worker \n\n# \n\n ********\n\n## JavaScript \n\n- ****\n  -  / \n  - \n  - \n    -  ****\n    - **** \n- ****\n  - \n  - :\n    -  \n      - \n      - \n    - \n    - JavaScript  **** \n    -  for-in \n- ****Map / Object > switch > if-else\n- **** `import()`\n\n## DOM \n\n-  DOM \n-  DOM  DOM \n- \n-  `requestAnimationFrame`  `setTimeout`  `setInterval` \n\n## CSS \n\n- ****\n- ****`.xxx-child-text{}`  `.xxx .child .text{}`\n- ****\n  - \n- ****\n-  ****  CSS \n-  `<link>`  @import\n-  `font-color: expression((new Date()).getHours()%3?\"#FFF\":\"#AAA\")` \n\n## HTML \n\n-  `<!DOCTYPE html>` \n- ** DOM **\n-  `src`  `href` `src`  `href` \n  - IE ****\n  - SafariChromeFirefox  URL \n  - Opera \n-  ****  ****\n- ****  SEO \n-  table  `<br/>`  `<hr/>`\n\n# \n\n****\n\n-  [2018 ](https://juejin.im/post/5a966bd16fb9a0635172a50a)\n-  [ Web ](https://github.com/berwin/Blog/issues/23)\n-  [Web ](https://segmentfault.com/a/1190000018263418?utm_medium=hao.caibaojian.com&utm_source=hao.caibaojian.com&share_user=1030000000178452)\n-  [](https://juejin.im/post/5b025d856fb9a07aa0484e54)\n-  [CSS  8 ](https://juejin.im/post/5b6133a351882519d346853f)\n-  [  JavaScript](https://juejin.im/post/5b7e1f81f265da436a075db4)\n-  [Web ](https://juejin.im/post/5c011e0c5188252ea66afdfa)\n-  [](https://github.com/barretlee/performance-column/milestone/1)\n-  [](https://github.com/liangsenzhi/awesome-wpo-chinese)\n-  [awesome-wpo](https://github.com/davidsonfellipe/awesome-wpo)\n-  [A Frontend Checklist for Websites](https://github.com/drublic/checklist)\n\n****\n\n-  [](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/)\n-  [16 ](http://velocity.oreilly.com.cn/2013/ppts/16_ms_optimization--web_front-end_performance_optimization.pdf)\n-  [Optimize JavaScript Execution  JavaScript ](https://developers.google.com/web/fundamentals/performance/rendering/optimize-javascript-execution)\n","slug":"means-for-performance-optimization","published":1,"updated":"2021-08-18T03:31:26.484Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99yw0008v31p980c7ska","content":"<p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> =&gt;  =&gt; () =&gt; ()</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p> Google <br><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/optimizing-critical-rendering-path\" target=\"_blank\" rel=\"noopener\"> Optimizing the Critical Rendering Path</a></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> CPU </p>\n<p></p>\n<p></p>\n<p><strong></strong></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"DNS-\"><a href=\"#DNS-\" class=\"headerlink\" title=\"DNS \"></a>DNS </h3><p>DNS  URL  IP <a href=\"https://tsejx.github.io/JavaScript-Guidebook/computer-networks/dns.html\">DNS </a></p>\n<p>DNS </p>\n<ul>\n<li><strong> DNS </strong></li>\n<li><strong>DNS </strong></li>\n</ul>\n<p> <code>http-equiv</code>  <code>&lt;meta&gt;</code>  DNS </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"x-dns-prefetch-control\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"on\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p> <code>rel</code>  <code>dns-prefetch</code>  <code>&lt;link&gt;</code> </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">'dns-prefetch\" href=\"//host_name_to_prefetch.com\"/&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching\" target=\"_blank\" rel=\"noopener\">MDNX-DNS-Prefetch-Control</a></li>\n<li><a href=\"https://dev.chromium.org/developers/design-documents/dns-prefetching\" target=\"_blank\" rel=\"noopener\">DNS Prefetching</a></li>\n<li><a href=\"https://bitsup.blogspot.com/2008/11/dns-prefetching-for-firefox.html\" target=\"_blank\" rel=\"noopener\">DNS Prefetching for Firefox</a></li>\n</ul>\n<h3 id=\"TCP-\"><a href=\"#TCP-\" class=\"headerlink\" title=\"TCP \"></a>TCP </h3><p><strong></strong> TCP HTTP/1.1 HTTP/1.0 </p>\n<p>Keep-Alive </p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n<h3 id=\"HTTP-\"><a href=\"#HTTP-\" class=\"headerlink\" title=\"HTTP \"></a>HTTP </h3><ul>\n<li><strong> HTTP </strong><ul>\n<li></li>\n<li>CSS Sprites </li>\n<li> Base64 </li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li><strong></strong> HTTP  4~8  HTTP </li>\n<li><strong></strong></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li>URL  <code>/</code> </li>\n</ul>\n</li>\n<li><strong></strong></li>\n<li><strong>Cookie</strong><ul>\n<li> Cookie <ul>\n<li> Cookie</li>\n<li> Cookie  domain </li>\n<li></li>\n</ul>\n</li>\n<li> Cookie </li>\n</ul>\n</li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/computer-networks/http/http2.html\">HTTP/2</a><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> [HTTP/2]</li>\n</ul>\n</li>\n<li><a href=\"https://zh.wikipedia.org/wiki/HTTP/3\" target=\"_blank\" rel=\"noopener\">HTTP/3</a></li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"http://bubkoo.com/2015/11/19/prefetching-preloading-prebrowsing/\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"https://github.com/creeperyang/blog/issues/23\" target=\"_blank\" rel=\"noopener\">HTTP/2  HTTP/2  Web </a></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html\">HTTP </a><ul>\n<li><a href=\"[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#\"></a>&gt;)<ul>\n<li>Expires  <code>Expires: Thu, 21 Jan 2017 23:59:59 GMT</code> </li>\n<li>Cache-Control  <code>Cache-Control: max-age=3600</code></li>\n</ul>\n</li>\n<li><a href=\"[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#\"></a>&gt;)<ul>\n<li>Last-Modified / If-Modified-Since  <code>Expires: Wed, 26 Jan 2017 00:35:11 GMT</code> </li>\n<li>Etag / If-None-Match </li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li> <a href=\"https://link.zhihu.com/?target=http%3A//baike.baidu.com/view/10961371.htm\" target=\"_blank\" rel=\"noopener\"></a> </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/computer-networks/cdn.html\">CDN </a> <ul>\n<li>HTML </li>\n<li> / JavaScript  / CSS  CDN  Hash </li>\n<li> CDN </li>\n<li>CDN  Cookie CDN  Cookie</li>\n<li>CDN </li>\n<li>CDN </li>\n</ul>\n</li>\n<li><strong></strong><strong></strong><strong></strong> Redis </li>\n<li><strong></strong>: <ul>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/cookie.html\">Cookie</a></li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/web-storage.html\">WebStorage</a><ul>\n<li>LocalStorage</li>\n<li>SessionStorage</li>\n</ul>\n</li>\n<li>IndexDB</li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/html5-scripting-programming/offline-and-storage/service-worker.html\">ServiceWorker</a></li>\n<li>AppCache mainfest </li>\n</ul>\n</li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://www.zhihu.com/question/20790576\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://link.juejin.im/?target=https%3A%2F%2Fimququ.com%2Fpost%2Fenhance-security-for-ls-code.html\" target=\"_blank\" rel=\"noopener\"> SRI  LocalStorage </a></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li>/</li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\"/\"></a>/</h2><ul>\n<li><strong></strong><ul>\n<li>Tree Shaking </li>\n<li>UglifyJs  / </li>\n<li>Code Spliting </li>\n</ul>\n</li>\n<li><strong> Gzip </strong><ul>\n<li> <code>Accept-Encoding: gzip, deflate</code></li>\n<li> <code>Content-Encoding: gzip</code></li>\n<li>Gzip  HTMlXML  JSON</li>\n<li> PDF  Gzip Gzip  CPU </li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> ES6  ES5 </li>\n<li> <code>&lt;script type=&quot;module&quot;&gt; / &lt;script type=&quot;module&quot;&gt;</code></li>\n</ul>\n</li>\n<li><strong> Polyfill</strong><ul>\n<li> Polyfill</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> UI  <strong></strong></li>\n<li> <strong></strong> jpg webp</li>\n<li> <strong> CSS Sprite</strong> 5K  B<strong>ase64</strong> </li>\n<li> I<strong>confont</strong>  <strong>SVG</strong></li>\n<li> favicon.ico </li>\n<li> Blob </li>\n<li> <a href=\"https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FRevillWeb%2Fimg-2\" target=\"_blank\" rel=\"noopener\">img-2</a>  img </li>\n<li>Base64 </li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> FOUTFlash Of Unstyled Text FOITFlash Of Invisible Text </li>\n<li></li>\n<li> CSS</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong><ul>\n<li>CSS  <code>&lt;head&gt;</code> <ul>\n<li> <code>&lt;head&gt;</code> </li>\n</ul>\n</li>\n<li>JavaScript  <code>&lt;body&gt;</code> <ul>\n<li><strong></strong></li>\n<li><strong></strong><ul>\n<li></li>\n<li> <code>defer</code>  HTML </li>\n<li> <code>async</code>  HTML  HTML </li>\n</ul>\n</li>\n</ul>\n</li>\n<li> <code>&lt;head&gt;</code>  <code>&lt;body&gt;</code>  <code>style</code>  <code>script</code> </li>\n</ul>\n</li>\n<li><p><strong></strong></p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong><ul>\n<li>Preload</li>\n<li>Prefetch</li>\n<li>Preconnect</li>\n<li>Subresource</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n<li></li>\n<li>Preload  W3CPreload<ul>\n<li>rel  preload </li>\n<li>as  JavaScriptImagesCSSMedia </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li><ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> loading </li>\n<li></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n<li> AJAX </li>\n</ul>\n</li>\n<li>JavaScript  JavaScript  JavaScript</li>\n<li> HTML  <code>&lt;textarea&gt;</code> <code>type</code>  <code>&lt;script&gt;</code>  DOM </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><strong></strong></p>\n<ul>\n<li></li>\n<li> <a href=\"https://csstriggers.com/\" target=\"_blank\" rel=\"noopener\">CSS Trigger</a> </li>\n<li><strong></strong><ul>\n<li></li>\n<li> DOM </li>\n<li> DOM </li>\n<li> DOM </li>\n<li> DOM <ul>\n<li> DOM </li>\n<li> DOM </li>\n</ul>\n</li>\n<li></li>\n<li></li>\n<li> style </li>\n<li> class </li>\n<li><ul>\n<li> <code>offsetWidth</code><code>offsetHeight</code>  <code>getComputedStyle</code> </li>\n<li></li>\n</ul>\n</li>\n<li> HTML </li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li> GPU <ul>\n<li>transform</li>\n<li>opacity</li>\n<li>filter</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://juejin.im/post/59b73ef75188253db70acdb5#heading-5\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://juejin.im/post/5b5984b851882561da216311\" target=\"_blank\" rel=\"noopener\"> PreloadPrefetch  Preconnect</a></li>\n<li><a href=\"https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FGoogleChrome%2Fpreload-webpack-plugin\" target=\"_blank\" rel=\"noopener\">preload-webpack-plugin</a></li>\n<li><a href=\"https://link.juejin.im/?target=https%3A%2F%2Fwww.smashingmagazine.com%2F2016%2F02%2Fpreload-what-is-it-good-for%2F\" target=\"_blank\" rel=\"noopener\">Preload </a></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> Web <ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>SSR<ul>\n<li></li>\n<li>/</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li> <strong></strong></li>\n<li> <strong>Skeleton/ Loading</strong> </li>\n<li> <strong>30 </strong> </li>\n<li>JavaScript  100ms <ul>\n<li></li>\n<li> web worker </li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> <strong></strong><strong></strong></p>\n<h2 id=\"JavaScript-\"><a href=\"#JavaScript-\" class=\"headerlink\" title=\"JavaScript \"></a>JavaScript </h2><ul>\n<li><strong></strong><ul>\n<li> / </li>\n<li></li>\n<li><ul>\n<li> <strong></strong></li>\n<li><strong></strong> </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n<li>:<ul>\n<li> <ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li></li>\n<li>JavaScript  <strong></strong> </li>\n<li> for-in </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong></strong>Map / Object &gt; switch &gt; if-else</li>\n<li><strong></strong> <code>import()</code></li>\n</ul>\n<h2 id=\"DOM-\"><a href=\"#DOM-\" class=\"headerlink\" title=\"DOM \"></a>DOM </h2><ul>\n<li> DOM </li>\n<li> DOM  DOM </li>\n<li></li>\n<li> <code>requestAnimationFrame</code>  <code>setTimeout</code>  <code>setInterval</code> </li>\n</ul>\n<h2 id=\"CSS-\"><a href=\"#CSS-\" class=\"headerlink\" title=\"CSS \"></a>CSS </h2><ul>\n<li><strong></strong></li>\n<li><strong></strong><code>.xxx-child-text{}</code>  <code>.xxx .child .text{}</code></li>\n<li><strong></strong><ul>\n<li></li>\n</ul>\n</li>\n<li><strong></strong></li>\n<li> <strong></strong>  CSS </li>\n<li> <code>&lt;link&gt;</code>  @import</li>\n<li> <code>font-color: expression((new Date()).getHours()%3?&quot;#FFF&quot;:&quot;#AAA&quot;)</code> </li>\n</ul>\n<h2 id=\"HTML-\"><a href=\"#HTML-\" class=\"headerlink\" title=\"HTML \"></a>HTML </h2><ul>\n<li> <code>&lt;!DOCTYPE html&gt;</code> </li>\n<li><strong> DOM </strong></li>\n<li> <code>src</code>  <code>href</code> <code>src</code>  <code>href</code> <ul>\n<li>IE <strong></strong></li>\n<li>SafariChromeFirefox  URL </li>\n<li>Opera </li>\n</ul>\n</li>\n<li> <strong></strong>  <strong></strong></li>\n<li><strong></strong>  SEO </li>\n<li> table  <code>&lt;br/&gt;</code>  <code>&lt;hr/&gt;</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><strong></strong></p>\n<ul>\n<li> <a href=\"https://juejin.im/post/5a966bd16fb9a0635172a50a\" target=\"_blank\" rel=\"noopener\">2018 </a></li>\n<li> <a href=\"https://github.com/berwin/Blog/issues/23\" target=\"_blank\" rel=\"noopener\"> Web </a></li>\n<li> <a href=\"https://segmentfault.com/a/1190000018263418?utm_medium=hao.caibaojian.com&amp;utm_source=hao.caibaojian.com&amp;share_user=1030000000178452\" target=\"_blank\" rel=\"noopener\">Web </a></li>\n<li> <a href=\"https://juejin.im/post/5b025d856fb9a07aa0484e54\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"https://juejin.im/post/5b6133a351882519d346853f\" target=\"_blank\" rel=\"noopener\">CSS  8 </a></li>\n<li> <a href=\"https://juejin.im/post/5b7e1f81f265da436a075db4\" target=\"_blank\" rel=\"noopener\">  JavaScript</a></li>\n<li> <a href=\"https://juejin.im/post/5c011e0c5188252ea66afdfa\" target=\"_blank\" rel=\"noopener\">Web </a></li>\n<li> <a href=\"https://github.com/barretlee/performance-column/milestone/1\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"https://github.com/liangsenzhi/awesome-wpo-chinese\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"https://github.com/davidsonfellipe/awesome-wpo\" target=\"_blank\" rel=\"noopener\">awesome-wpo</a></li>\n<li> <a href=\"https://github.com/drublic/checklist\" target=\"_blank\" rel=\"noopener\">A Frontend Checklist for Websites</a></li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li> <a href=\"https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"http://velocity.oreilly.com.cn/2013/ppts/16_ms_optimization--web_front-end_performance_optimization.pdf\" target=\"_blank\" rel=\"noopener\">16 </a></li>\n<li> <a href=\"https://developers.google.com/web/fundamentals/performance/rendering/optimize-javascript-execution\" target=\"_blank\" rel=\"noopener\">Optimize JavaScript Execution  JavaScript </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><strong></strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> =&gt;  =&gt; () =&gt; ()</span><br></pre></td></tr></table></figure>","more":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p> Google <br><a href=\"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/optimizing-critical-rendering-path\" target=\"_blank\" rel=\"noopener\"> Optimizing the Critical Rendering Path</a></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> CPU </p>\n<p></p>\n<p></p>\n<p><strong></strong></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"DNS-\"><a href=\"#DNS-\" class=\"headerlink\" title=\"DNS \"></a>DNS </h3><p>DNS  URL  IP <a href=\"https://tsejx.github.io/JavaScript-Guidebook/computer-networks/dns.html\">DNS </a></p>\n<p>DNS </p>\n<ul>\n<li><strong> DNS </strong></li>\n<li><strong>DNS </strong></li>\n</ul>\n<p> <code>http-equiv</code>  <code>&lt;meta&gt;</code>  DNS </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"x-dns-prefetch-control\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"on\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<p> <code>rel</code>  <code>dns-prefetch</code>  <code>&lt;link&gt;</code> </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">rel</span>=<span class=\"string\">'dns-prefetch\" href=\"//host_name_to_prefetch.com\"/&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Controlling_DNS_prefetching\" target=\"_blank\" rel=\"noopener\">MDNX-DNS-Prefetch-Control</a></li>\n<li><a href=\"https://dev.chromium.org/developers/design-documents/dns-prefetching\" target=\"_blank\" rel=\"noopener\">DNS Prefetching</a></li>\n<li><a href=\"https://bitsup.blogspot.com/2008/11/dns-prefetching-for-firefox.html\" target=\"_blank\" rel=\"noopener\">DNS Prefetching for Firefox</a></li>\n</ul>\n<h3 id=\"TCP-\"><a href=\"#TCP-\" class=\"headerlink\" title=\"TCP \"></a>TCP </h3><p><strong></strong> TCP HTTP/1.1 HTTP/1.0 </p>\n<p>Keep-Alive </p>\n<figure class=\"highlight http\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">Connection</span>: keep-alive</span><br></pre></td></tr></table></figure>\n<h3 id=\"HTTP-\"><a href=\"#HTTP-\" class=\"headerlink\" title=\"HTTP \"></a>HTTP </h3><ul>\n<li><strong> HTTP </strong><ul>\n<li></li>\n<li>CSS Sprites </li>\n<li> Base64 </li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li><strong></strong> HTTP  4~8  HTTP </li>\n<li><strong></strong></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li>URL  <code>/</code> </li>\n</ul>\n</li>\n<li><strong></strong></li>\n<li><strong>Cookie</strong><ul>\n<li> Cookie <ul>\n<li> Cookie</li>\n<li> Cookie  domain </li>\n<li></li>\n</ul>\n</li>\n<li> Cookie </li>\n</ul>\n</li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/computer-networks/http/http2.html\">HTTP/2</a><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> [HTTP/2]</li>\n</ul>\n</li>\n<li><a href=\"https://zh.wikipedia.org/wiki/HTTP/3\" target=\"_blank\" rel=\"noopener\">HTTP/3</a></li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"http://bubkoo.com/2015/11/19/prefetching-preloading-prebrowsing/\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"https://github.com/creeperyang/blog/issues/23\" target=\"_blank\" rel=\"noopener\">HTTP/2  HTTP/2  Web </a></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html\">HTTP </a><ul>\n<li><a href=\"[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#\"></a>&gt;)<ul>\n<li>Expires  <code>Expires: Thu, 21 Jan 2017 23:59:59 GMT</code> </li>\n<li>Cache-Control  <code>Cache-Control: max-age=3600</code></li>\n</ul>\n</li>\n<li><a href=\"[https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98](https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/http-cache.html#\"></a>&gt;)<ul>\n<li>Last-Modified / If-Modified-Since  <code>Expires: Wed, 26 Jan 2017 00:35:11 GMT</code> </li>\n<li>Etag / If-None-Match </li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li> <a href=\"https://link.zhihu.com/?target=http%3A//baike.baidu.com/view/10961371.htm\" target=\"_blank\" rel=\"noopener\"></a> </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/computer-networks/cdn.html\">CDN </a> <ul>\n<li>HTML </li>\n<li> / JavaScript  / CSS  CDN  Hash </li>\n<li> CDN </li>\n<li>CDN  Cookie CDN  Cookie</li>\n<li>CDN </li>\n<li>CDN </li>\n</ul>\n</li>\n<li><strong></strong><strong></strong><strong></strong> Redis </li>\n<li><strong></strong>: <ul>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/cookie.html\">Cookie</a></li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/browser-object-model/browser-cache/web-storage.html\">WebStorage</a><ul>\n<li>LocalStorage</li>\n<li>SessionStorage</li>\n</ul>\n</li>\n<li>IndexDB</li>\n<li><a href=\"https://tsejx.github.io/JavaScript-Guidebook/html5-scripting-programming/offline-and-storage/service-worker.html\">ServiceWorker</a></li>\n<li>AppCache mainfest </li>\n</ul>\n</li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://www.zhihu.com/question/20790576\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://link.juejin.im/?target=https%3A%2F%2Fimququ.com%2Fpost%2Fenhance-security-for-ls-code.html\" target=\"_blank\" rel=\"noopener\"> SRI  LocalStorage </a></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><ul>\n<li>/</li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\"/\"></a>/</h2><ul>\n<li><strong></strong><ul>\n<li>Tree Shaking </li>\n<li>UglifyJs  / </li>\n<li>Code Spliting </li>\n</ul>\n</li>\n<li><strong> Gzip </strong><ul>\n<li> <code>Accept-Encoding: gzip, deflate</code></li>\n<li> <code>Content-Encoding: gzip</code></li>\n<li>Gzip  HTMlXML  JSON</li>\n<li> PDF  Gzip Gzip  CPU </li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> ES6  ES5 </li>\n<li> <code>&lt;script type=&quot;module&quot;&gt; / &lt;script type=&quot;module&quot;&gt;</code></li>\n</ul>\n</li>\n<li><strong> Polyfill</strong><ul>\n<li> Polyfill</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> UI  <strong></strong></li>\n<li> <strong></strong> jpg webp</li>\n<li> <strong> CSS Sprite</strong> 5K  B<strong>ase64</strong> </li>\n<li> I<strong>confont</strong>  <strong>SVG</strong></li>\n<li> favicon.ico </li>\n<li> Blob </li>\n<li> <a href=\"https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FRevillWeb%2Fimg-2\" target=\"_blank\" rel=\"noopener\">img-2</a>  img </li>\n<li>Base64 </li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> FOUTFlash Of Unstyled Text FOITFlash Of Invisible Text </li>\n<li></li>\n<li> CSS</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><strong></strong><ul>\n<li>CSS  <code>&lt;head&gt;</code> <ul>\n<li> <code>&lt;head&gt;</code> </li>\n</ul>\n</li>\n<li>JavaScript  <code>&lt;body&gt;</code> <ul>\n<li><strong></strong></li>\n<li><strong></strong><ul>\n<li></li>\n<li> <code>defer</code>  HTML </li>\n<li> <code>async</code>  HTML  HTML </li>\n</ul>\n</li>\n</ul>\n</li>\n<li> <code>&lt;head&gt;</code>  <code>&lt;body&gt;</code>  <code>style</code>  <code>script</code> </li>\n</ul>\n</li>\n<li><p><strong></strong></p>\n<ul>\n<li><strong></strong></li>\n<li><strong></strong><ul>\n<li>Preload</li>\n<li>Prefetch</li>\n<li>Preconnect</li>\n<li>Subresource</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n<li></li>\n<li>Preload  W3CPreload<ul>\n<li>rel  preload </li>\n<li>as  JavaScriptImagesCSSMedia </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li><ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li> loading </li>\n<li></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n<li> AJAX </li>\n</ul>\n</li>\n<li>JavaScript  JavaScript  JavaScript</li>\n<li> HTML  <code>&lt;textarea&gt;</code> <code>type</code>  <code>&lt;script&gt;</code>  DOM </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><strong></strong></p>\n<ul>\n<li></li>\n<li> <a href=\"https://csstriggers.com/\" target=\"_blank\" rel=\"noopener\">CSS Trigger</a> </li>\n<li><strong></strong><ul>\n<li></li>\n<li> DOM </li>\n<li> DOM </li>\n<li> DOM </li>\n<li> DOM <ul>\n<li> DOM </li>\n<li> DOM </li>\n</ul>\n</li>\n<li></li>\n<li></li>\n<li> style </li>\n<li> class </li>\n<li><ul>\n<li> <code>offsetWidth</code><code>offsetHeight</code>  <code>getComputedStyle</code> </li>\n<li></li>\n</ul>\n</li>\n<li> HTML </li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li> GPU <ul>\n<li>transform</li>\n<li>opacity</li>\n<li>filter</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://juejin.im/post/59b73ef75188253db70acdb5#heading-5\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://juejin.im/post/5b5984b851882561da216311\" target=\"_blank\" rel=\"noopener\"> PreloadPrefetch  Preconnect</a></li>\n<li><a href=\"https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2FGoogleChrome%2Fpreload-webpack-plugin\" target=\"_blank\" rel=\"noopener\">preload-webpack-plugin</a></li>\n<li><a href=\"https://link.juejin.im/?target=https%3A%2F%2Fwww.smashingmagazine.com%2F2016%2F02%2Fpreload-what-is-it-good-for%2F\" target=\"_blank\" rel=\"noopener\">Preload </a></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li> Web <ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>SSR<ul>\n<li></li>\n<li>/</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li> <strong></strong></li>\n<li> <strong>Skeleton/ Loading</strong> </li>\n<li> <strong>30 </strong> </li>\n<li>JavaScript  100ms <ul>\n<li></li>\n<li> web worker </li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> <strong></strong><strong></strong></p>\n<h2 id=\"JavaScript-\"><a href=\"#JavaScript-\" class=\"headerlink\" title=\"JavaScript \"></a>JavaScript </h2><ul>\n<li><strong></strong><ul>\n<li> / </li>\n<li></li>\n<li><ul>\n<li> <strong></strong></li>\n<li><strong></strong> </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n<li>:<ul>\n<li> <ul>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li></li>\n<li>JavaScript  <strong></strong> </li>\n<li> for-in </li>\n</ul>\n</li>\n</ul>\n</li>\n<li><strong></strong>Map / Object &gt; switch &gt; if-else</li>\n<li><strong></strong> <code>import()</code></li>\n</ul>\n<h2 id=\"DOM-\"><a href=\"#DOM-\" class=\"headerlink\" title=\"DOM \"></a>DOM </h2><ul>\n<li> DOM </li>\n<li> DOM  DOM </li>\n<li></li>\n<li> <code>requestAnimationFrame</code>  <code>setTimeout</code>  <code>setInterval</code> </li>\n</ul>\n<h2 id=\"CSS-\"><a href=\"#CSS-\" class=\"headerlink\" title=\"CSS \"></a>CSS </h2><ul>\n<li><strong></strong></li>\n<li><strong></strong><code>.xxx-child-text{}</code>  <code>.xxx .child .text{}</code></li>\n<li><strong></strong><ul>\n<li></li>\n</ul>\n</li>\n<li><strong></strong></li>\n<li> <strong></strong>  CSS </li>\n<li> <code>&lt;link&gt;</code>  @import</li>\n<li> <code>font-color: expression((new Date()).getHours()%3?&quot;#FFF&quot;:&quot;#AAA&quot;)</code> </li>\n</ul>\n<h2 id=\"HTML-\"><a href=\"#HTML-\" class=\"headerlink\" title=\"HTML \"></a>HTML </h2><ul>\n<li> <code>&lt;!DOCTYPE html&gt;</code> </li>\n<li><strong> DOM </strong></li>\n<li> <code>src</code>  <code>href</code> <code>src</code>  <code>href</code> <ul>\n<li>IE <strong></strong></li>\n<li>SafariChromeFirefox  URL </li>\n<li>Opera </li>\n</ul>\n</li>\n<li> <strong></strong>  <strong></strong></li>\n<li><strong></strong>  SEO </li>\n<li> table  <code>&lt;br/&gt;</code>  <code>&lt;hr/&gt;</code></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><strong></strong></p>\n<ul>\n<li> <a href=\"https://juejin.im/post/5a966bd16fb9a0635172a50a\" target=\"_blank\" rel=\"noopener\">2018 </a></li>\n<li> <a href=\"https://github.com/berwin/Blog/issues/23\" target=\"_blank\" rel=\"noopener\"> Web </a></li>\n<li> <a href=\"https://segmentfault.com/a/1190000018263418?utm_medium=hao.caibaojian.com&amp;utm_source=hao.caibaojian.com&amp;share_user=1030000000178452\" target=\"_blank\" rel=\"noopener\">Web </a></li>\n<li> <a href=\"https://juejin.im/post/5b025d856fb9a07aa0484e54\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"https://juejin.im/post/5b6133a351882519d346853f\" target=\"_blank\" rel=\"noopener\">CSS  8 </a></li>\n<li> <a href=\"https://juejin.im/post/5b7e1f81f265da436a075db4\" target=\"_blank\" rel=\"noopener\">  JavaScript</a></li>\n<li> <a href=\"https://juejin.im/post/5c011e0c5188252ea66afdfa\" target=\"_blank\" rel=\"noopener\">Web </a></li>\n<li> <a href=\"https://github.com/barretlee/performance-column/milestone/1\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"https://github.com/liangsenzhi/awesome-wpo-chinese\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"https://github.com/davidsonfellipe/awesome-wpo\" target=\"_blank\" rel=\"noopener\">awesome-wpo</a></li>\n<li> <a href=\"https://github.com/drublic/checklist\" target=\"_blank\" rel=\"noopener\">A Frontend Checklist for Websites</a></li>\n</ul>\n<p><strong></strong></p>\n<ul>\n<li> <a href=\"https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li> <a href=\"http://velocity.oreilly.com.cn/2013/ppts/16_ms_optimization--web_front-end_performance_optimization.pdf\" target=\"_blank\" rel=\"noopener\">16 </a></li>\n<li> <a href=\"https://developers.google.com/web/fundamentals/performance/rendering/optimize-javascript-execution\" target=\"_blank\" rel=\"noopener\">Optimize JavaScript Execution  JavaScript </a></li>\n</ul>"},{"title":"Web  Docker ","date":"2020-04-20T00:00:00.000Z","_content":"\n\n\n PPmoney  X  X  X \n\n X  Docker  Docker \n\n\n\n<!-- more -->\n\n## \n\n\n\n![](http://img.mrsingsing.com/docker-in-server.png)\n\nDocker \n\n-  Image\n-  Container\n-  Repository\n\n ****  **** \n\n tag git commit  tag \n\nDocker Hub  Docker  HarborDao Cloud  Harbor \n\n Docker  [](https://docs.docker.com/) \n\n## \n\n X  React Koa  MongoDB \n\n Docker  Dockerfile \n\n```bash\n# docker build -t <> <>\n$ docker build -t totorox-admin .\n```\n\n`-t`  `totorox-admin`\n\n### \n\n\n\n![Dockerfile in Frontend Project](http://img.mrsingsing.com/frontend-dockerfile.png)\n\n Dockerfile  `FROM`  `FROM` \n\n`COPY`  `.dockerignore`  `.gitignore`  `.npmignore`  Docker  `.vscode``.eslint``dist` \n\n`npm install` \n\n Sass Webpack  `node-sass`  `win32-x64-57_binding.node`  `.npmrc`  `node-sass` [](https://developer.aliyun.com/mirror/NPM?from=tnpm)  `phantomjs` \n\n![.npmrc](http://img.mrsingsing.com/npmrc.jpg)\n\n Nginx  Web  Nginx Express  Web \n\nNginx  Nginx \n\n![Nginx](http://img.mrsingsing.com/nginx-conf.png)\n\n `CMD` \n\n `CMD`  API  API  Shell  Shell  JavaScript HTML \n\n\n\n![](http://img.mrsingsing.com/removeing-intermediate-container.jpg)\n\n\n\n `docker images`  Docker \n\n![](http://img.mrsingsing.com/docker-images.jpg)\n\n Docker Hub  Docker Daemon  `/etc/docker/daemon.json` Docker \n\n ****\n\n\n\n![](http://img.mrsingsing.com/docker-image-acceleration.png)\n\n Docker  Docker  CentOS 7  Docker  13 `FROM AS`  Docker  17  Docker \n\n Docker \n\n[CentOS  Docker](https://www.jianshu.com/p/2e208721aa39)\n\n Docker  `Unknown runtime specified docker runc` \n\n```bash\n$ grep -rl 'docker-runc' /var/lib/docker/containers/ | xargs sed -i 's/docker-runc/runc/g'\n\n$ systemctl stop docker\n\n$ systemctl start docker\n```\n\n### \n\n Koa \n\n![Dockerfile](http://img.mrsingsing.com/backend-dockerfile.png)\n\n Webpack  Webpack\n\n `wait-for-it.sh`  `CMD` Docker  root  `chmod a+x` \n\n Dockerfile  `ARG` `ENV`  Dockerfile / `CMD` \n\n `ARG`  `docker build`  `--build-arg <varname>=<value>` \n\n```dockerfile\nARG env\n\n# \nARG env=local\n```\n\n `ARG` \n\nDockerfile  `ENV` \n\n```dockerfile\nENV <key> <value>\n\n# /\nENV <key>=<value>\n\n#  \\ \nENV API_URL=example.com \\\n    NODE_ENV=production \\\n    COMMAND=dev\n```\n\n `ARG` `ENV`  `ARG` \n\n dockerfile  [](https://docs.docker.com/engine/reference/builder/#environment-replacement) \n\n`CMD` \n\n```dockerfile\n#  exec  JSON \nCMD [\"command\", \"instructions\", \"options\"]\n\n#  /bin/sh \n#  sh -c \nCMD command param1 param2\n```\n\n Dockerfile  `CMD`  `CMD` \n\n API  Docker `exec`  `CMD`  Docker  `shell`  `CMD`  Docker  `sh``sh`  `sh` \n\n Dockerfile  `ENV`  `ARG`  `CMD`  `shell` \n\n```dockerfile\n# docker run \nARG env=production\n\n#  shell  ENV  dockerfile  env \nENV env=${ENV}\n\n#  /scripts/setup.sh\n#  env dockerfile \nCMD /scripts/setup.sh ${env}\n```\n\n### \n\n\n\n X  HTML \n\n Linux  PhantomJS  PhantomJS \n\n\n\n![ Dockerfile](http://img.mrsingsing.com/spider-dockerfile.png)\n\n### \n\n MongoDB  MongoDB  Dockerfile \n\n![](http://img.mrsingsing.com/mongodb-dockerfile.png)\n\n X  Dockerfile  `RUN`  shell \n\n![MongoDB ](http://img.mrsingsing.com/docker-entrypoint-initdb.png)\n\n\n\n `docker build`  `docker images`  `docker history <image-id>`  Dockerfile \n\n![](http://img.mrsingsing.com/docker-history.jpg)\n\n `docker tag`  `docker push` \n\n## \n\n Docker \n\n Docker  `docker0`  Linux  bridge\n\n![](http://img.mrsingsing.com/docker-network.png)\n\ntalk is cheapshow you the code\n\n```bash\n#  `totorox-net` \ndocker network create -d bridge totorox-net\n\n#  `--network <>` \ndocker run -d --name totorox-server -p 3012:3012 --network totorox-net ...\n```\n\n\n\n<!-- ![docker network ls  docker]() -->\n\n `xxx.xxx.xxx.xxx`  `docker network ls` \n\ndocker  IP  DNS  IP  docker \n\n Mongoose  MongoDB\n\n```js\n// username \n// password \n// containerName \n// databaseName \nconst uri = `mongodb://${username}:${password}@${containerName}/${databaseName}`;\n\nmongoose.connect(uri, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n  autoIndex: false,\n});\n```\n\nMongoose  MongoDB  IP \n\n MongoDB \n\n `docker run`  MongoDB  `docker run` `docker run` \n\n mongoose \n\n```js\nconst connect = () => {\n  mongoose.connect(uri, {\n    useNewUrlParser: true,\n    useUnifiedTopology: true,\n    autoIndex: false,\n  });\n};\ndb.on('error', error => {\n  console.error('Error in MongoDB connection:' + error);\n  mongoose.disconnect();\n});\ndb.on('disconnected', () => {\n  console.log('MongoDB disconnected!');\n  connect();\n});\ndb.on('close', () => {\n  console.log('Lost MongoDB connection...');\n  connect();\n  console.log('Reconnect to MongoDB, wait...');\n});\n```\n\nserver  database `docker-compose.yml`  `depends_on` `docker run` \n\n [Control startup and shutdown order in Compose](https://docs.docker.com/compose/startup-order/)  [wait-for-it.sh](https://github.com/vishnubob/wait-for-it)[dockerize](https://github.com/jwilder/dockerize)  [wait-for](https://github.com/Eficode/wait-for)\n\n## \n\n Nginx  Nginx \n\n\n\n```bash\n# \n$ docker run -d --name totorox-admin -p 8200:80 hub.ppmoney.io/telescope/totorox-admin\nStarting nginx ... done\nAttating to nginx\n```\n\n `Attating to nginx`\n\n `/etc/nginx/conf.d/default.conf`  `default.conf`  Nginx  `volumes` `conf.d`  `docker exec -it totorox-admin .` \n\n\n\n![](http://img.mrsingsing.com/docker-run.png)\n\n `docker ps -a` \n\n![](http://img.mrsingsing.com/docker-container-list.jpg)\n\n STATUS  PORTS  MongoDB \n\n `docker logs <container-name>` \n\n PM2 \n\n  `CMD service nginx start`  `CMD [ \"bash\", \"-c\", \"service nginx start\"]`  `bash``bash` `bash`  PM2  Forever \n\n/\n\n## \n\ndocker-compose  Docker  `docker-compose.yml`  `docker compose up -d` \n\n![](http://img.mrsingsing.com/docker-compose.png)\n\n `docker-compose`  version2.0  version3.0  [Compose file versions and upgrading](https://docs.docker.com/compose/compose-file/compose-versioning/) \n\n`docker-compose.yml` \n\n`docker-compose` \n\n`restart: always` \n\n\n\n```bash\n$ docker run -e VARIABLE1 --env VARIABLE2=foo --env-file ./env.list ubuntu bash\n```\n\n---\n\n****\n\n- [Passing variables to Docker](https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file)\n- [Pass Docker Environment Variables During The Image Build](https://vsupalov.com/docker-build-pass-environment-variables/)\n- [How To Pass Environment Info During Docker Builds](https://blog.bitsrc.io/how-to-pass-environment-info-during-docker-builds-1f7c5566dd0e)\n- [How to setup Node environment variable in Dockerfile for running node.js application?](https://stackoverflow.com/questions/42992397/how-to-setup-node-environment-variable-in-dockerfile-for-running-node-js-applica)\n- [How to create a Node App within a Docker container with Mongo](https://hn.werick.codes/how-to-create-a-node-app-within-a-docker-container-with-mongo-cjwjd3l4t00067rs18w7035oc)\n- [Cannot connect from node to mongo replicaset in docker](http://quabr.com/57123227/cannot-connect-from-node-to-mongo-replicaset-in-docker)\n- [Docker Node  MongoDB](https://blog.csdn.net/weixin_30466953/article/details/97366689)\n- [ Docker  Unknown runtime specified docker-runc](https://blog.csdn.net/wxb880114/article/details/88869215)\n- [Mongoose  MongoDB topology was destoryed](https://segmentfault.com/q/1010000010768993)\n- [ Docker+Node+Nginx+MongoDB +](https://juejin.im/post/5ddb3f85e51d45231576af3c)\n","source":"_posts/docker-deploy-pratice.md","raw":"---\ntitle: Web  Docker \ndate: '2020-04-20'\n---\n\n\n\n PPmoney  X  X  X \n\n X  Docker  Docker \n\n\n\n<!-- more -->\n\n## \n\n\n\n![](http://img.mrsingsing.com/docker-in-server.png)\n\nDocker \n\n-  Image\n-  Container\n-  Repository\n\n ****  **** \n\n tag git commit  tag \n\nDocker Hub  Docker  HarborDao Cloud  Harbor \n\n Docker  [](https://docs.docker.com/) \n\n## \n\n X  React Koa  MongoDB \n\n Docker  Dockerfile \n\n```bash\n# docker build -t <> <>\n$ docker build -t totorox-admin .\n```\n\n`-t`  `totorox-admin`\n\n### \n\n\n\n![Dockerfile in Frontend Project](http://img.mrsingsing.com/frontend-dockerfile.png)\n\n Dockerfile  `FROM`  `FROM` \n\n`COPY`  `.dockerignore`  `.gitignore`  `.npmignore`  Docker  `.vscode``.eslint``dist` \n\n`npm install` \n\n Sass Webpack  `node-sass`  `win32-x64-57_binding.node`  `.npmrc`  `node-sass` [](https://developer.aliyun.com/mirror/NPM?from=tnpm)  `phantomjs` \n\n![.npmrc](http://img.mrsingsing.com/npmrc.jpg)\n\n Nginx  Web  Nginx Express  Web \n\nNginx  Nginx \n\n![Nginx](http://img.mrsingsing.com/nginx-conf.png)\n\n `CMD` \n\n `CMD`  API  API  Shell  Shell  JavaScript HTML \n\n\n\n![](http://img.mrsingsing.com/removeing-intermediate-container.jpg)\n\n\n\n `docker images`  Docker \n\n![](http://img.mrsingsing.com/docker-images.jpg)\n\n Docker Hub  Docker Daemon  `/etc/docker/daemon.json` Docker \n\n ****\n\n\n\n![](http://img.mrsingsing.com/docker-image-acceleration.png)\n\n Docker  Docker  CentOS 7  Docker  13 `FROM AS`  Docker  17  Docker \n\n Docker \n\n[CentOS  Docker](https://www.jianshu.com/p/2e208721aa39)\n\n Docker  `Unknown runtime specified docker runc` \n\n```bash\n$ grep -rl 'docker-runc' /var/lib/docker/containers/ | xargs sed -i 's/docker-runc/runc/g'\n\n$ systemctl stop docker\n\n$ systemctl start docker\n```\n\n### \n\n Koa \n\n![Dockerfile](http://img.mrsingsing.com/backend-dockerfile.png)\n\n Webpack  Webpack\n\n `wait-for-it.sh`  `CMD` Docker  root  `chmod a+x` \n\n Dockerfile  `ARG` `ENV`  Dockerfile / `CMD` \n\n `ARG`  `docker build`  `--build-arg <varname>=<value>` \n\n```dockerfile\nARG env\n\n# \nARG env=local\n```\n\n `ARG` \n\nDockerfile  `ENV` \n\n```dockerfile\nENV <key> <value>\n\n# /\nENV <key>=<value>\n\n#  \\ \nENV API_URL=example.com \\\n    NODE_ENV=production \\\n    COMMAND=dev\n```\n\n `ARG` `ENV`  `ARG` \n\n dockerfile  [](https://docs.docker.com/engine/reference/builder/#environment-replacement) \n\n`CMD` \n\n```dockerfile\n#  exec  JSON \nCMD [\"command\", \"instructions\", \"options\"]\n\n#  /bin/sh \n#  sh -c \nCMD command param1 param2\n```\n\n Dockerfile  `CMD`  `CMD` \n\n API  Docker `exec`  `CMD`  Docker  `shell`  `CMD`  Docker  `sh``sh`  `sh` \n\n Dockerfile  `ENV`  `ARG`  `CMD`  `shell` \n\n```dockerfile\n# docker run \nARG env=production\n\n#  shell  ENV  dockerfile  env \nENV env=${ENV}\n\n#  /scripts/setup.sh\n#  env dockerfile \nCMD /scripts/setup.sh ${env}\n```\n\n### \n\n\n\n X  HTML \n\n Linux  PhantomJS  PhantomJS \n\n\n\n![ Dockerfile](http://img.mrsingsing.com/spider-dockerfile.png)\n\n### \n\n MongoDB  MongoDB  Dockerfile \n\n![](http://img.mrsingsing.com/mongodb-dockerfile.png)\n\n X  Dockerfile  `RUN`  shell \n\n![MongoDB ](http://img.mrsingsing.com/docker-entrypoint-initdb.png)\n\n\n\n `docker build`  `docker images`  `docker history <image-id>`  Dockerfile \n\n![](http://img.mrsingsing.com/docker-history.jpg)\n\n `docker tag`  `docker push` \n\n## \n\n Docker \n\n Docker  `docker0`  Linux  bridge\n\n![](http://img.mrsingsing.com/docker-network.png)\n\ntalk is cheapshow you the code\n\n```bash\n#  `totorox-net` \ndocker network create -d bridge totorox-net\n\n#  `--network <>` \ndocker run -d --name totorox-server -p 3012:3012 --network totorox-net ...\n```\n\n\n\n<!-- ![docker network ls  docker]() -->\n\n `xxx.xxx.xxx.xxx`  `docker network ls` \n\ndocker  IP  DNS  IP  docker \n\n Mongoose  MongoDB\n\n```js\n// username \n// password \n// containerName \n// databaseName \nconst uri = `mongodb://${username}:${password}@${containerName}/${databaseName}`;\n\nmongoose.connect(uri, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n  autoIndex: false,\n});\n```\n\nMongoose  MongoDB  IP \n\n MongoDB \n\n `docker run`  MongoDB  `docker run` `docker run` \n\n mongoose \n\n```js\nconst connect = () => {\n  mongoose.connect(uri, {\n    useNewUrlParser: true,\n    useUnifiedTopology: true,\n    autoIndex: false,\n  });\n};\ndb.on('error', error => {\n  console.error('Error in MongoDB connection:' + error);\n  mongoose.disconnect();\n});\ndb.on('disconnected', () => {\n  console.log('MongoDB disconnected!');\n  connect();\n});\ndb.on('close', () => {\n  console.log('Lost MongoDB connection...');\n  connect();\n  console.log('Reconnect to MongoDB, wait...');\n});\n```\n\nserver  database `docker-compose.yml`  `depends_on` `docker run` \n\n [Control startup and shutdown order in Compose](https://docs.docker.com/compose/startup-order/)  [wait-for-it.sh](https://github.com/vishnubob/wait-for-it)[dockerize](https://github.com/jwilder/dockerize)  [wait-for](https://github.com/Eficode/wait-for)\n\n## \n\n Nginx  Nginx \n\n\n\n```bash\n# \n$ docker run -d --name totorox-admin -p 8200:80 hub.ppmoney.io/telescope/totorox-admin\nStarting nginx ... done\nAttating to nginx\n```\n\n `Attating to nginx`\n\n `/etc/nginx/conf.d/default.conf`  `default.conf`  Nginx  `volumes` `conf.d`  `docker exec -it totorox-admin .` \n\n\n\n![](http://img.mrsingsing.com/docker-run.png)\n\n `docker ps -a` \n\n![](http://img.mrsingsing.com/docker-container-list.jpg)\n\n STATUS  PORTS  MongoDB \n\n `docker logs <container-name>` \n\n PM2 \n\n  `CMD service nginx start`  `CMD [ \"bash\", \"-c\", \"service nginx start\"]`  `bash``bash` `bash`  PM2  Forever \n\n/\n\n## \n\ndocker-compose  Docker  `docker-compose.yml`  `docker compose up -d` \n\n![](http://img.mrsingsing.com/docker-compose.png)\n\n `docker-compose`  version2.0  version3.0  [Compose file versions and upgrading](https://docs.docker.com/compose/compose-file/compose-versioning/) \n\n`docker-compose.yml` \n\n`docker-compose` \n\n`restart: always` \n\n\n\n```bash\n$ docker run -e VARIABLE1 --env VARIABLE2=foo --env-file ./env.list ubuntu bash\n```\n\n---\n\n****\n\n- [Passing variables to Docker](https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file)\n- [Pass Docker Environment Variables During The Image Build](https://vsupalov.com/docker-build-pass-environment-variables/)\n- [How To Pass Environment Info During Docker Builds](https://blog.bitsrc.io/how-to-pass-environment-info-during-docker-builds-1f7c5566dd0e)\n- [How to setup Node environment variable in Dockerfile for running node.js application?](https://stackoverflow.com/questions/42992397/how-to-setup-node-environment-variable-in-dockerfile-for-running-node-js-applica)\n- [How to create a Node App within a Docker container with Mongo](https://hn.werick.codes/how-to-create-a-node-app-within-a-docker-container-with-mongo-cjwjd3l4t00067rs18w7035oc)\n- [Cannot connect from node to mongo replicaset in docker](http://quabr.com/57123227/cannot-connect-from-node-to-mongo-replicaset-in-docker)\n- [Docker Node  MongoDB](https://blog.csdn.net/weixin_30466953/article/details/97366689)\n- [ Docker  Unknown runtime specified docker-runc](https://blog.csdn.net/wxb880114/article/details/88869215)\n- [Mongoose  MongoDB topology was destoryed](https://segmentfault.com/q/1010000010768993)\n- [ Docker+Node+Nginx+MongoDB +](https://juejin.im/post/5ddb3f85e51d45231576af3c)\n","slug":"docker-deploy-pratice","published":1,"updated":"2021-08-18T03:29:19.941Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99yy0009v31p0crbfq3t","content":"<p></p>\n<p> PPmoney  X  X  X </p>\n<p> X  Docker  Docker </p>\n<p></p>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p><img src=\"http://img.mrsingsing.com/docker-in-server.png\" alt=\"\"></p>\n<p>Docker </p>\n<ul>\n<li> Image</li>\n<li> Container</li>\n<li> Repository</li>\n</ul>\n<p> <strong></strong>  <strong></strong> </p>\n<p> tag git commit  tag </p>\n<p>Docker Hub  Docker  HarborDao Cloud  Harbor </p>\n<p> Docker  <a href=\"https://docs.docker.com/\" target=\"_blank\" rel=\"noopener\"></a> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> X  React Koa  MongoDB </p>\n<p> Docker  Dockerfile </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker build -t &lt;&gt; &lt;&gt;</span></span><br><span class=\"line\">$ docker build -t totorox-admin .</span><br></pre></td></tr></table></figure>\n<p><code>-t</code>  <code>totorox-admin</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/frontend-dockerfile.png\" alt=\"Dockerfile in Frontend Project\"></p>\n<p> Dockerfile  <code>FROM</code>  <code>FROM</code> </p>\n<p><code>COPY</code>  <code>.dockerignore</code>  <code>.gitignore</code>  <code>.npmignore</code>  Docker  <code>.vscode</code><code>.eslint</code><code>dist</code> </p>\n<p><code>npm install</code> </p>\n<p> Sass Webpack  <code>node-sass</code>  <code>win32-x64-57_binding.node</code>  <code>.npmrc</code>  <code>node-sass</code> <a href=\"https://developer.aliyun.com/mirror/NPM?from=tnpm\" target=\"_blank\" rel=\"noopener\"></a>  <code>phantomjs</code> </p>\n<p><img src=\"http://img.mrsingsing.com/npmrc.jpg\" alt=\".npmrc\"></p>\n<p> Nginx  Web  Nginx Express  Web </p>\n<p>Nginx  Nginx </p>\n<p><img src=\"http://img.mrsingsing.com/nginx-conf.png\" alt=\"Nginx\"></p>\n<p> <code>CMD</code> </p>\n<p> <code>CMD</code>  API  API  Shell  Shell  JavaScript HTML </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/removeing-intermediate-container.jpg\" alt=\"\"></p>\n<p></p>\n<p> <code>docker images</code>  Docker </p>\n<p><img src=\"http://img.mrsingsing.com/docker-images.jpg\" alt=\"\"></p>\n<p> Docker Hub  Docker Daemon  <code>/etc/docker/daemon.json</code> Docker </p>\n<p> <strong></strong></p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/docker-image-acceleration.png\" alt=\"\"></p>\n<p> Docker  Docker  CentOS 7  Docker  13 <code>FROM AS</code>  Docker  17  Docker </p>\n<p> Docker </p>\n<p><a href=\"https://www.jianshu.com/p/2e208721aa39\" target=\"_blank\" rel=\"noopener\">CentOS  Docker</a></p>\n<p> Docker  <code>Unknown runtime specified docker runc</code> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep -rl <span class=\"string\">'docker-runc'</span> /var/lib/docker/containers/ | xargs sed -i <span class=\"string\">'s/docker-runc/runc/g'</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ systemctl stop docker</span><br><span class=\"line\"></span><br><span class=\"line\">$ systemctl start docker</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Koa </p>\n<p><img src=\"http://img.mrsingsing.com/backend-dockerfile.png\" alt=\"Dockerfile\"></p>\n<p> Webpack  Webpack</p>\n<p> <code>wait-for-it.sh</code>  <code>CMD</code> Docker  root  <code>chmod a+x</code> </p>\n<p> Dockerfile  <code>ARG</code> <code>ENV</code>  Dockerfile / <code>CMD</code> </p>\n<p> <code>ARG</code>  <code>docker build</code>  <code>--build-arg &lt;varname&gt;=&lt;value&gt;</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ARG</span> <span class=\"keyword\">env</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> <span class=\"keyword\">env</span>=local</span><br></pre></td></tr></table></figure>\n<p> <code>ARG</code> </p>\n<p>Dockerfile  <code>ENV</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># /</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> &lt;key&gt;=&lt;value&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  \\ </span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> API_URL=example.com \\</span><br><span class=\"line\">    NODE_ENV=production \\</span><br><span class=\"line\">    COMMAND=dev</span><br></pre></td></tr></table></figure>\n<p> <code>ARG</code> <code>ENV</code>  <code>ARG</code> </p>\n<p> dockerfile  <a href=\"https://docs.docker.com/engine/reference/builder/#environment-replacement\" target=\"_blank\" rel=\"noopener\"></a> </p>\n<p><code>CMD</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  exec  JSON </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"command\"</span>, <span class=\"string\">\"instructions\"</span>, <span class=\"string\">\"options\"</span>]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  /bin/sh </span></span><br><span class=\"line\"><span class=\"comment\">#  sh -c </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> <span class=\"built_in\">command</span> param1 param2</span></span><br></pre></td></tr></table></figure>\n<p> Dockerfile  <code>CMD</code>  <code>CMD</code> </p>\n<p> API  Docker <code>exec</code>  <code>CMD</code>  Docker  <code>shell</code>  <code>CMD</code>  Docker  <code>sh</code><code>sh</code>  <code>sh</code> </p>\n<p> Dockerfile  <code>ENV</code>  <code>ARG</code>  <code>CMD</code>  <code>shell</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker run </span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> <span class=\"keyword\">env</span>=production</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  shell  ENV  dockerfile  env </span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> <span class=\"keyword\">env</span>=$&#123;<span class=\"keyword\">ENV</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  /scripts/setup.sh</span></span><br><span class=\"line\"><span class=\"comment\">#  env dockerfile </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> /scripts/setup.sh <span class=\"variable\">$&#123;env&#125;</span></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p> X  HTML </p>\n<p> Linux  PhantomJS  PhantomJS </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/spider-dockerfile.png\" alt=\" Dockerfile\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> MongoDB  MongoDB  Dockerfile </p>\n<p><img src=\"http://img.mrsingsing.com/mongodb-dockerfile.png\" alt></p>\n<p> X  Dockerfile  <code>RUN</code>  shell </p>\n<p><img src=\"http://img.mrsingsing.com/docker-entrypoint-initdb.png\" alt=\"MongoDB \"></p>\n<p></p>\n<p> <code>docker build</code>  <code>docker images</code>  <code>docker history &lt;image-id&gt;</code>  Dockerfile </p>\n<p><img src=\"http://img.mrsingsing.com/docker-history.jpg\" alt=\"\"></p>\n<p> <code>docker tag</code>  <code>docker push</code> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Docker </p>\n<p> Docker  <code>docker0</code>  Linux  bridge</p>\n<p><img src=\"http://img.mrsingsing.com/docker-network.png\" alt=\"\"></p>\n<p>talk is cheapshow you the code</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  `totorox-net` </span></span><br><span class=\"line\">docker network create -d bridge totorox-net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  `--network &lt;&gt;` </span></span><br><span class=\"line\">docker run -d --name totorox-server -p 3012:3012 --network totorox-net ...</span><br></pre></td></tr></table></figure>\n<p></p>\n<!-- ![docker network ls  docker]() -->\n<p> <code>xxx.xxx.xxx.xxx</code>  <code>docker network ls</code> </p>\n<p>docker  IP  DNS  IP  docker </p>\n<p> Mongoose  MongoDB</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// username </span></span><br><span class=\"line\"><span class=\"comment\">// password </span></span><br><span class=\"line\"><span class=\"comment\">// containerName </span></span><br><span class=\"line\"><span class=\"comment\">// databaseName </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> uri = <span class=\"string\">`mongodb://<span class=\"subst\">$&#123;username&#125;</span>:<span class=\"subst\">$&#123;password&#125;</span>@<span class=\"subst\">$&#123;containerName&#125;</span>/<span class=\"subst\">$&#123;databaseName&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.connect(uri, &#123;</span><br><span class=\"line\">  useNewUrlParser: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  useUnifiedTopology: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  autoIndex: <span class=\"literal\">false</span>,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Mongoose  MongoDB  IP </p>\n<p> MongoDB </p>\n<p> <code>docker run</code>  MongoDB  <code>docker run</code> <code>docker run</code> </p>\n<p> mongoose </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> connect = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  mongoose.connect(uri, &#123;</span><br><span class=\"line\">    useNewUrlParser: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    useUnifiedTopology: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    autoIndex: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">db.on(<span class=\"string\">'error'</span>, error =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">'Error in MongoDB connection:'</span> + error);</span><br><span class=\"line\">  mongoose.disconnect();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">db.on(<span class=\"string\">'disconnected'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'MongoDB disconnected!'</span>);</span><br><span class=\"line\">  connect();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">db.on(<span class=\"string\">'close'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Lost MongoDB connection...'</span>);</span><br><span class=\"line\">  connect();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Reconnect to MongoDB, wait...'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>server  database <code>docker-compose.yml</code>  <code>depends_on</code> <code>docker run</code> </p>\n<p> <a href=\"https://docs.docker.com/compose/startup-order/\" target=\"_blank\" rel=\"noopener\">Control startup and shutdown order in Compose</a>  <a href=\"https://github.com/vishnubob/wait-for-it\" target=\"_blank\" rel=\"noopener\">wait-for-it.sh</a><a href=\"https://github.com/jwilder/dockerize\" target=\"_blank\" rel=\"noopener\">dockerize</a>  <a href=\"https://github.com/Eficode/wait-for\" target=\"_blank\" rel=\"noopener\">wait-for</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Nginx  Nginx </p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">$ docker run -d --name totorox-admin -p 8200:80 hub.ppmoney.io/telescope/totorox-admin</span><br><span class=\"line\">Starting nginx ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Attating to nginx</span><br></pre></td></tr></table></figure>\n<p> <code>Attating to nginx</code></p>\n<p> <code>/etc/nginx/conf.d/default.conf</code>  <code>default.conf</code>  Nginx  <code>volumes</code> <code>conf.d</code>  <code>docker exec -it totorox-admin .</code> </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/docker-run.png\" alt=\"\"></p>\n<p> <code>docker ps -a</code> </p>\n<p><img src=\"http://img.mrsingsing.com/docker-container-list.jpg\" alt=\"\"></p>\n<p> STATUS  PORTS  MongoDB </p>\n<p> <code>docker logs &lt;container-name&gt;</code> </p>\n<p> PM2 </p>\n<p>  <code>CMD service nginx start</code>  <code>CMD [ &quot;bash&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]</code>  <code>bash</code><code>bash</code> <code>bash</code>  PM2  Forever </p>\n<p>/</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>docker-compose  Docker  <code>docker-compose.yml</code>  <code>docker compose up -d</code> </p>\n<p><img src=\"http://img.mrsingsing.com/docker-compose.png\" alt=\"\"></p>\n<p> <code>docker-compose</code>  version2.0  version3.0  <a href=\"https://docs.docker.com/compose/compose-file/compose-versioning/\" target=\"_blank\" rel=\"noopener\">Compose file versions and upgrading</a> </p>\n<p><code>docker-compose.yml</code> </p>\n<p><code>docker-compose</code> </p>\n<p><code>restart: always</code> </p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker run -e VARIABLE1 --env VARIABLE2=foo --env-file ./env.list ubuntu bash</span><br></pre></td></tr></table></figure>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file\" target=\"_blank\" rel=\"noopener\">Passing variables to Docker</a></li>\n<li><a href=\"https://vsupalov.com/docker-build-pass-environment-variables/\" target=\"_blank\" rel=\"noopener\">Pass Docker Environment Variables During The Image Build</a></li>\n<li><a href=\"https://blog.bitsrc.io/how-to-pass-environment-info-during-docker-builds-1f7c5566dd0e\" target=\"_blank\" rel=\"noopener\">How To Pass Environment Info During Docker Builds</a></li>\n<li><a href=\"https://stackoverflow.com/questions/42992397/how-to-setup-node-environment-variable-in-dockerfile-for-running-node-js-applica\" target=\"_blank\" rel=\"noopener\">How to setup Node environment variable in Dockerfile for running node.js application?</a></li>\n<li><a href=\"https://hn.werick.codes/how-to-create-a-node-app-within-a-docker-container-with-mongo-cjwjd3l4t00067rs18w7035oc\" target=\"_blank\" rel=\"noopener\">How to create a Node App within a Docker container with Mongo</a></li>\n<li><a href=\"http://quabr.com/57123227/cannot-connect-from-node-to-mongo-replicaset-in-docker\" target=\"_blank\" rel=\"noopener\">Cannot connect from node to mongo replicaset in docker</a></li>\n<li><a href=\"https://blog.csdn.net/weixin_30466953/article/details/97366689\" target=\"_blank\" rel=\"noopener\">Docker Node  MongoDB</a></li>\n<li><a href=\"https://blog.csdn.net/wxb880114/article/details/88869215\" target=\"_blank\" rel=\"noopener\"> Docker  Unknown runtime specified docker-runc</a></li>\n<li><a href=\"https://segmentfault.com/q/1010000010768993\" target=\"_blank\" rel=\"noopener\">Mongoose  MongoDB topology was destoryed</a></li>\n<li><a href=\"https://juejin.im/post/5ddb3f85e51d45231576af3c\" target=\"_blank\" rel=\"noopener\"> Docker+Node+Nginx+MongoDB +</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p></p>\n<p> PPmoney  X  X  X </p>\n<p> X  Docker  Docker </p>\n<p></p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p><img src=\"http://img.mrsingsing.com/docker-in-server.png\" alt=\"\"></p>\n<p>Docker </p>\n<ul>\n<li> Image</li>\n<li> Container</li>\n<li> Repository</li>\n</ul>\n<p> <strong></strong>  <strong></strong> </p>\n<p> tag git commit  tag </p>\n<p>Docker Hub  Docker  HarborDao Cloud  Harbor </p>\n<p> Docker  <a href=\"https://docs.docker.com/\" target=\"_blank\" rel=\"noopener\"></a> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> X  React Koa  MongoDB </p>\n<p> Docker  Dockerfile </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker build -t &lt;&gt; &lt;&gt;</span></span><br><span class=\"line\">$ docker build -t totorox-admin .</span><br></pre></td></tr></table></figure>\n<p><code>-t</code>  <code>totorox-admin</code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"http://img.mrsingsing.com/frontend-dockerfile.png\" alt=\"Dockerfile in Frontend Project\"></p>\n<p> Dockerfile  <code>FROM</code>  <code>FROM</code> </p>\n<p><code>COPY</code>  <code>.dockerignore</code>  <code>.gitignore</code>  <code>.npmignore</code>  Docker  <code>.vscode</code><code>.eslint</code><code>dist</code> </p>\n<p><code>npm install</code> </p>\n<p> Sass Webpack  <code>node-sass</code>  <code>win32-x64-57_binding.node</code>  <code>.npmrc</code>  <code>node-sass</code> <a href=\"https://developer.aliyun.com/mirror/NPM?from=tnpm\" target=\"_blank\" rel=\"noopener\"></a>  <code>phantomjs</code> </p>\n<p><img src=\"http://img.mrsingsing.com/npmrc.jpg\" alt=\".npmrc\"></p>\n<p> Nginx  Web  Nginx Express  Web </p>\n<p>Nginx  Nginx </p>\n<p><img src=\"http://img.mrsingsing.com/nginx-conf.png\" alt=\"Nginx\"></p>\n<p> <code>CMD</code> </p>\n<p> <code>CMD</code>  API  API  Shell  Shell  JavaScript HTML </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/removeing-intermediate-container.jpg\" alt=\"\"></p>\n<p></p>\n<p> <code>docker images</code>  Docker </p>\n<p><img src=\"http://img.mrsingsing.com/docker-images.jpg\" alt=\"\"></p>\n<p> Docker Hub  Docker Daemon  <code>/etc/docker/daemon.json</code> Docker </p>\n<p> <strong></strong></p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/docker-image-acceleration.png\" alt=\"\"></p>\n<p> Docker  Docker  CentOS 7  Docker  13 <code>FROM AS</code>  Docker  17  Docker </p>\n<p> Docker </p>\n<p><a href=\"https://www.jianshu.com/p/2e208721aa39\" target=\"_blank\" rel=\"noopener\">CentOS  Docker</a></p>\n<p> Docker  <code>Unknown runtime specified docker runc</code> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep -rl <span class=\"string\">'docker-runc'</span> /var/lib/docker/containers/ | xargs sed -i <span class=\"string\">'s/docker-runc/runc/g'</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ systemctl stop docker</span><br><span class=\"line\"></span><br><span class=\"line\">$ systemctl start docker</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> Koa </p>\n<p><img src=\"http://img.mrsingsing.com/backend-dockerfile.png\" alt=\"Dockerfile\"></p>\n<p> Webpack  Webpack</p>\n<p> <code>wait-for-it.sh</code>  <code>CMD</code> Docker  root  <code>chmod a+x</code> </p>\n<p> Dockerfile  <code>ARG</code> <code>ENV</code>  Dockerfile / <code>CMD</code> </p>\n<p> <code>ARG</code>  <code>docker build</code>  <code>--build-arg &lt;varname&gt;=&lt;value&gt;</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ARG</span> <span class=\"keyword\">env</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> <span class=\"keyword\">env</span>=local</span><br></pre></td></tr></table></figure>\n<p> <code>ARG</code> </p>\n<p>Dockerfile  <code>ENV</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># /</span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> &lt;key&gt;=&lt;value&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  \\ </span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> API_URL=example.com \\</span><br><span class=\"line\">    NODE_ENV=production \\</span><br><span class=\"line\">    COMMAND=dev</span><br></pre></td></tr></table></figure>\n<p> <code>ARG</code> <code>ENV</code>  <code>ARG</code> </p>\n<p> dockerfile  <a href=\"https://docs.docker.com/engine/reference/builder/#environment-replacement\" target=\"_blank\" rel=\"noopener\"></a> </p>\n<p><code>CMD</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  exec  JSON </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> [<span class=\"string\">\"command\"</span>, <span class=\"string\">\"instructions\"</span>, <span class=\"string\">\"options\"</span>]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  /bin/sh </span></span><br><span class=\"line\"><span class=\"comment\">#  sh -c </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> <span class=\"built_in\">command</span> param1 param2</span></span><br></pre></td></tr></table></figure>\n<p> Dockerfile  <code>CMD</code>  <code>CMD</code> </p>\n<p> API  Docker <code>exec</code>  <code>CMD</code>  Docker  <code>shell</code>  <code>CMD</code>  Docker  <code>sh</code><code>sh</code>  <code>sh</code> </p>\n<p> Dockerfile  <code>ENV</code>  <code>ARG</code>  <code>CMD</code>  <code>shell</code> </p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># docker run </span></span><br><span class=\"line\"><span class=\"keyword\">ARG</span> <span class=\"keyword\">env</span>=production</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  shell  ENV  dockerfile  env </span></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> <span class=\"keyword\">env</span>=$&#123;<span class=\"keyword\">ENV</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  /scripts/setup.sh</span></span><br><span class=\"line\"><span class=\"comment\">#  env dockerfile </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"bash\"> /scripts/setup.sh <span class=\"variable\">$&#123;env&#125;</span></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p> X  HTML </p>\n<p> Linux  PhantomJS  PhantomJS </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/spider-dockerfile.png\" alt=\" Dockerfile\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> MongoDB  MongoDB  Dockerfile </p>\n<p><img src=\"http://img.mrsingsing.com/mongodb-dockerfile.png\" alt></p>\n<p> X  Dockerfile  <code>RUN</code>  shell </p>\n<p><img src=\"http://img.mrsingsing.com/docker-entrypoint-initdb.png\" alt=\"MongoDB \"></p>\n<p></p>\n<p> <code>docker build</code>  <code>docker images</code>  <code>docker history &lt;image-id&gt;</code>  Dockerfile </p>\n<p><img src=\"http://img.mrsingsing.com/docker-history.jpg\" alt=\"\"></p>\n<p> <code>docker tag</code>  <code>docker push</code> </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Docker </p>\n<p> Docker  <code>docker0</code>  Linux  bridge</p>\n<p><img src=\"http://img.mrsingsing.com/docker-network.png\" alt=\"\"></p>\n<p>talk is cheapshow you the code</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  `totorox-net` </span></span><br><span class=\"line\">docker network create -d bridge totorox-net</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  `--network &lt;&gt;` </span></span><br><span class=\"line\">docker run -d --name totorox-server -p 3012:3012 --network totorox-net ...</span><br></pre></td></tr></table></figure>\n<p></p>\n<!-- ![docker network ls  docker]() -->\n<p> <code>xxx.xxx.xxx.xxx</code>  <code>docker network ls</code> </p>\n<p>docker  IP  DNS  IP  docker </p>\n<p> Mongoose  MongoDB</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// username </span></span><br><span class=\"line\"><span class=\"comment\">// password </span></span><br><span class=\"line\"><span class=\"comment\">// containerName </span></span><br><span class=\"line\"><span class=\"comment\">// databaseName </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> uri = <span class=\"string\">`mongodb://<span class=\"subst\">$&#123;username&#125;</span>:<span class=\"subst\">$&#123;password&#125;</span>@<span class=\"subst\">$&#123;containerName&#125;</span>/<span class=\"subst\">$&#123;databaseName&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.connect(uri, &#123;</span><br><span class=\"line\">  useNewUrlParser: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  useUnifiedTopology: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  autoIndex: <span class=\"literal\">false</span>,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Mongoose  MongoDB  IP </p>\n<p> MongoDB </p>\n<p> <code>docker run</code>  MongoDB  <code>docker run</code> <code>docker run</code> </p>\n<p> mongoose </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> connect = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  mongoose.connect(uri, &#123;</span><br><span class=\"line\">    useNewUrlParser: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    useUnifiedTopology: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    autoIndex: <span class=\"literal\">false</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">db.on(<span class=\"string\">'error'</span>, error =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.error(<span class=\"string\">'Error in MongoDB connection:'</span> + error);</span><br><span class=\"line\">  mongoose.disconnect();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">db.on(<span class=\"string\">'disconnected'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'MongoDB disconnected!'</span>);</span><br><span class=\"line\">  connect();</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">db.on(<span class=\"string\">'close'</span>, () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Lost MongoDB connection...'</span>);</span><br><span class=\"line\">  connect();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Reconnect to MongoDB, wait...'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>server  database <code>docker-compose.yml</code>  <code>depends_on</code> <code>docker run</code> </p>\n<p> <a href=\"https://docs.docker.com/compose/startup-order/\" target=\"_blank\" rel=\"noopener\">Control startup and shutdown order in Compose</a>  <a href=\"https://github.com/vishnubob/wait-for-it\" target=\"_blank\" rel=\"noopener\">wait-for-it.sh</a><a href=\"https://github.com/jwilder/dockerize\" target=\"_blank\" rel=\"noopener\">dockerize</a>  <a href=\"https://github.com/Eficode/wait-for\" target=\"_blank\" rel=\"noopener\">wait-for</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Nginx  Nginx </p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">$ docker run -d --name totorox-admin -p 8200:80 hub.ppmoney.io/telescope/totorox-admin</span><br><span class=\"line\">Starting nginx ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Attating to nginx</span><br></pre></td></tr></table></figure>\n<p> <code>Attating to nginx</code></p>\n<p> <code>/etc/nginx/conf.d/default.conf</code>  <code>default.conf</code>  Nginx  <code>volumes</code> <code>conf.d</code>  <code>docker exec -it totorox-admin .</code> </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/docker-run.png\" alt=\"\"></p>\n<p> <code>docker ps -a</code> </p>\n<p><img src=\"http://img.mrsingsing.com/docker-container-list.jpg\" alt=\"\"></p>\n<p> STATUS  PORTS  MongoDB </p>\n<p> <code>docker logs &lt;container-name&gt;</code> </p>\n<p> PM2 </p>\n<p>  <code>CMD service nginx start</code>  <code>CMD [ &quot;bash&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]</code>  <code>bash</code><code>bash</code> <code>bash</code>  PM2  Forever </p>\n<p>/</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>docker-compose  Docker  <code>docker-compose.yml</code>  <code>docker compose up -d</code> </p>\n<p><img src=\"http://img.mrsingsing.com/docker-compose.png\" alt=\"\"></p>\n<p> <code>docker-compose</code>  version2.0  version3.0  <a href=\"https://docs.docker.com/compose/compose-file/compose-versioning/\" target=\"_blank\" rel=\"noopener\">Compose file versions and upgrading</a> </p>\n<p><code>docker-compose.yml</code> </p>\n<p><code>docker-compose</code> </p>\n<p><code>restart: always</code> </p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker run -e VARIABLE1 --env VARIABLE2=foo --env-file ./env.list ubuntu bash</span><br></pre></td></tr></table></figure>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file\" target=\"_blank\" rel=\"noopener\">Passing variables to Docker</a></li>\n<li><a href=\"https://vsupalov.com/docker-build-pass-environment-variables/\" target=\"_blank\" rel=\"noopener\">Pass Docker Environment Variables During The Image Build</a></li>\n<li><a href=\"https://blog.bitsrc.io/how-to-pass-environment-info-during-docker-builds-1f7c5566dd0e\" target=\"_blank\" rel=\"noopener\">How To Pass Environment Info During Docker Builds</a></li>\n<li><a href=\"https://stackoverflow.com/questions/42992397/how-to-setup-node-environment-variable-in-dockerfile-for-running-node-js-applica\" target=\"_blank\" rel=\"noopener\">How to setup Node environment variable in Dockerfile for running node.js application?</a></li>\n<li><a href=\"https://hn.werick.codes/how-to-create-a-node-app-within-a-docker-container-with-mongo-cjwjd3l4t00067rs18w7035oc\" target=\"_blank\" rel=\"noopener\">How to create a Node App within a Docker container with Mongo</a></li>\n<li><a href=\"http://quabr.com/57123227/cannot-connect-from-node-to-mongo-replicaset-in-docker\" target=\"_blank\" rel=\"noopener\">Cannot connect from node to mongo replicaset in docker</a></li>\n<li><a href=\"https://blog.csdn.net/weixin_30466953/article/details/97366689\" target=\"_blank\" rel=\"noopener\">Docker Node  MongoDB</a></li>\n<li><a href=\"https://blog.csdn.net/wxb880114/article/details/88869215\" target=\"_blank\" rel=\"noopener\"> Docker  Unknown runtime specified docker-runc</a></li>\n<li><a href=\"https://segmentfault.com/q/1010000010768993\" target=\"_blank\" rel=\"noopener\">Mongoose  MongoDB topology was destoryed</a></li>\n<li><a href=\"https://juejin.im/post/5ddb3f85e51d45231576af3c\" target=\"_blank\" rel=\"noopener\"> Docker+Node+Nginx+MongoDB +</a></li>\n</ul>"},{"title":"","date":"2019-11-15T00:00:00.000Z","_content":"\n> [](https://juejin.im/post/5dc8fd92f265da4d287f4551)\n\nTotoroX  PPmoney  UI  850+\n\n## \n\n\n\n UI \n\n UI  `git diff` \n\n![AB Test](http://img.mrsingsing.com/diff-tool-abtest.jpg)\n\nTotoroX \n\n<!-- more -->\n\n## \n\n\n\n TotoroX  JSON  JSON \n\n JSON \n\n- null\n- \n- \n- \n- \n- \n\n DateFunctionSymbolSet \n\n `null`\n\n\n\n- \n- \n\n JSON \n\nJSON  JSON Schema  JSON  JSON Schema \n\n JSON Schema \n\n```json\n{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$id\": \"http://example.com/product.schema.json\",\n  \"title\": \"Product\",\n  \"description\": \"A product from Acme's catalog\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"productId\": {\n      \"description\": \"The unique identifier for a product\",\n      \"type\": \"integer\"\n    },\n    \"productName\": {\n      \"description\": \"Name of the product\",\n      \"type\": \"string\"\n    },\n    \"price\": {\n      \"description\": \"The price of the product\",\n      \"type\": \"number\",\n      \"exclusiveMinimum\": 0\n    },\n    \"tags\": {\n      \"description\": \"Tags for the product\",\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      },\n      \"minItems\": 1,\n      \"uniqueItems\": true\n    },\n    \"dimensions\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"length\": {\n          \"type\": \"number\"\n        },\n        \"width\": {\n          \"type\": \"number\"\n        },\n        \"height\": {\n          \"type\": \"number\"\n        }\n      },\n      \"required\": [\"length\", \"width\", \"height\"]\n    }\n  },\n  \"required\": [\"productId\", \"productName\", \"price\"]\n}\n```\n\nJSON Schema  JSON JSON Schema  JSON \n\n JSON Schema \n\n Git \n\n- **Equal**\n- **Add**\n- **Delete**\n- **Conflict**\n\n\n\n![](http://img.mrsingsing.com/diff-tool-data-structure-comparation-.jpg)\n\n diff \n\n![](http://img.mrsingsing.com/diff-tool-result-data-structure.jpg)\n\n\n\n-  `_properties` \n-  `_status` \n  - Equal `_origin` \n  - Add `_target` \n  - Delete `_origin` \n  - Conflict `_orign` `_target` \n\n `_status` **** `style`  `height`  Schema  `_status` ConflictConflict\n\n> \n\n![](http://img.mrsingsing.com/diff-tool-status-display-tatics.jpg)\n\n\n\n![](http://img.mrsingsing.com/diff-tool-path-to-root.jpg)\n\n## Diff \n\n\n\n diff \n\n\n\n TotoroX  TotoroX  `eventList`  `name`  `eventList`  `name`  diff `name` \n\n![Button](http://img.mrsingsing.com/diff-tool-button-data.jpeg)\n\n### \n\n\n\n****\n\n\n\n```js\nfunction getDifference(a, b) {\n  return [...new Set(a.filter(x => !new Set(b).has(x)))];\n}\n```\n\n `a` \n\n```js\nfunction getDifferenceWith(a, b, comparator = (x, y) => x === y) {\n  return a.filter(x => b.findIndex(y => comparator(x, y)) === -1);\n}\n```\n\n****\n\n\n\n```js\nfunction getIntersection(a, b) {\n  return [...new Set(a.filter(x => new Set(b).has(x)))];\n}\n```\n\n `a` \n\n```js\nfunction getIntersectionWith(a, b, comparator = (x, y) => x === y) {\n  return a.filter(x => b.findIndex(y => comparator(x, y)) !== -1);\n}\n```\n\n****\n\n```js\nfunction getUnionWith(a, b, comparator = (x, y) => x === y) {\n  return Array.from(new Set([...a, ...b.filter(x => a.findIndex(y => comparator(x, y)) === -1)]));\n}\n```\n\n****\n\n```js\nfunction getDedupeBy(arr, comparator = (x, y) => x === y) {\n  return arr.reduce((acc, v) => {\n    if (!acc.some(x => comparator(v, x))) {\n      acc.push(v);\n    }\n    return acc;\n  }, []);\n}\n```\n\n `comparator` `comparator`  `filter` \n\n```js\nconst comparator = (x, y) => x.id === y.id;\n```\n\n `x`  `id`  `y`  `id`  `x`  `y` \n\n `comparator` \n\n### \n\n JSON \n\n- `diffObject` `Object.keys` \n- `diffArray` `comparator` \n- `diffValue`EqualConflict\n\n `diffObject`  `diffArray`\n\n// `getRecursion` \n\n![diff](http://img.mrsingsing.com/diff-tool-workflow.jpg)\n\n `Object.keys()`  `origin`  `target` \n\n `origin`  `target`  `origin`  `target`  `origin`  `target` \n\n `comparator`  `comparator` diff  `comparator`  `diff` \n\n `Array.prototype.join()`  `comparator`  `diffArray` \n\n```js\nconst comparator = {\n  //  init  comparator \n  init: (a, b) => a.name === b.name && a.id === b.id,\n  eventList: (a, b) => a.name === b.name,\n  'eventList.value': (a, b) => a === b,\n  'eventList.subEvents': (a, b) => a.id === b.id,\n  'eventList.subEvents.actions': (a, b) => a.id === b.id,\n  animation: (a, b) => a.antType === b.antType,\n};\n```\n\n**** `init` \n\n diff  diff  TotoroX  `origin` `target`  merge \n\n## Merge \n\n merge  git \n\ngit \n\n```\nB - C - D master(*)\n \\\n  E - F dev\n```\n\n `master` `dev`  `master`  commitB commit  `base``master`  commitD  `ours` `dev`  commitF  `theirs`\n\n git  `ours`  `theirs` \n\n `base`\n\n| base | HEADours | theirs |      |                                                              |\n| ------------ | ------------ | -------------- | -------- | ---------------------------------------------------------------- |\n| A            | A            | A              | A        |                                                                  |\n| A            | A            | B              | B        |                        |\n| A            | B            | A              | B        |                                                              |\n| A            | B            | B              | B        |                    |\n| A            | B            | C              | conflict |  |\n\n\n\n![](http://img.mrsingsing.com/diff-tool-merge-strategy.png)\n\n git \n\n### \n\n merge  merge ****base **Head**ours****theirs `base` \n\n `base`  diff  JSON Schema  mergeBranch \n\n```js\nfunction merge(base, ours, theirs, diffComparator, mergeComparator) {\n  const originDiff = diff(base, ours, diffComparator);\n  const targetDiff = diff(base, theris, diffComparator);\n\n  const newDataSchema = mergeBranch(originDiff, targetDiff, mergeComparator);\n\n  return newDataSchema;\n}\n```\n\n merge  diff  Schema  JSON**** `_status` \n\n|  |  |                                                                                                                                   |\n| -------------------- | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |\n| Equal                | Equal                  |  `base`  `ours` `base`  `theirs`                                                        |\n| Equal                | Updated                |  `base`  `ours` `base`  `theirs`                                      |\n| Updated              | Equal                  |  `base`  `ours` `base`  `theirs`                                      |\n| Updated              | Updated                |  `base`  `ours` `base`  `theirs`                                      |\n| Updated              | Updated                |  `base`  `ours` `base`  `theirs`  `ours`  `theirs`  `base`  |\n\n![](http://img.mrsingsing.com/diff-tool-merge-venn-diagram.jpg)\n\n\n\n1. A-A-A=> `mergeUnmodified` `equal` \n2. A-A-BA-B-A=> `mergeUpdated` `base` \n3. A-B-BA-B-C=> `mergeConflict`\n\n `_status` `equal`\n\n `_status` `equal`\n\n****\n\n1.  `comparator`  `base``ours`  `theirs`  `conflict` \n2.  `_status` `add` `add` \n\n### \n\n\n\n\n\n| base_ours  | base_theirs  |                                                                                                                                                 |\n| -------------------- | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |\n| Add                  | Add                    |  `base`  `ours`  `theris`                                                                                   |\n| Conflict             | Conflict               |  `base` `ours`  `base` `theris`  `base`  `ours` / |\n| Conflict             | Delete                 |  `base` `ours`  `base`  `theris`                                              |\n| Delete               | Conflict               |  `base` `ours`  `theris`  `base`                                                    |\n| Delete               | Delete                 |  base `ours`  `theris`                                                                                        |\n\n\n\n![](http://img.mrsingsing.com/diff-tool-merge-code-demo.jpg)\n\n\n\n- `color` `base`  `ours`  `theirs` \n- `width` `base`  `ours`  `theirs`  `ours`  `theirs` \n- `height`  `width` `ours`  `theirs` \n- `translateX` `base`  `ours`  `theirs` \n- `translateX` `base`  `theirs`  `ours` \n- `line-height`  `base` `ours`  `theirs` \n\n> \n\n `base`  diff  JSON Schema \n\n![diff-between-base-and-ours](http://img.mrsingsing.com/diff-between-base-and-ours.jpg)\n\n![diff-between-base-and-theirs](http://img.mrsingsing.com/diff-between-base-and-theirs.jpg)\n\n JSON Schema \n\n![Merge base and ours and theirs](http://img.mrsingsing.com/diff-tool-merge-base-ours-and-theirs.jpeg)\n\n## Revert \n\n JSON Schema \n\n---\n\n****\n\n- [ Git  17](https://blog.csdn.net/longintchar/article/details/83049840)\n","source":"_posts/practice-of-page-batch-update-tool-in-visual-configuration-system.md","raw":"---\ntitle: \ndate: '2019-11-15'\n---\n\n> [](https://juejin.im/post/5dc8fd92f265da4d287f4551)\n\nTotoroX  PPmoney  UI  850+\n\n## \n\n\n\n UI \n\n UI  `git diff` \n\n![AB Test](http://img.mrsingsing.com/diff-tool-abtest.jpg)\n\nTotoroX \n\n<!-- more -->\n\n## \n\n\n\n TotoroX  JSON  JSON \n\n JSON \n\n- null\n- \n- \n- \n- \n- \n\n DateFunctionSymbolSet \n\n `null`\n\n\n\n- \n- \n\n JSON \n\nJSON  JSON Schema  JSON  JSON Schema \n\n JSON Schema \n\n```json\n{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"$id\": \"http://example.com/product.schema.json\",\n  \"title\": \"Product\",\n  \"description\": \"A product from Acme's catalog\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"productId\": {\n      \"description\": \"The unique identifier for a product\",\n      \"type\": \"integer\"\n    },\n    \"productName\": {\n      \"description\": \"Name of the product\",\n      \"type\": \"string\"\n    },\n    \"price\": {\n      \"description\": \"The price of the product\",\n      \"type\": \"number\",\n      \"exclusiveMinimum\": 0\n    },\n    \"tags\": {\n      \"description\": \"Tags for the product\",\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      },\n      \"minItems\": 1,\n      \"uniqueItems\": true\n    },\n    \"dimensions\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"length\": {\n          \"type\": \"number\"\n        },\n        \"width\": {\n          \"type\": \"number\"\n        },\n        \"height\": {\n          \"type\": \"number\"\n        }\n      },\n      \"required\": [\"length\", \"width\", \"height\"]\n    }\n  },\n  \"required\": [\"productId\", \"productName\", \"price\"]\n}\n```\n\nJSON Schema  JSON JSON Schema  JSON \n\n JSON Schema \n\n Git \n\n- **Equal**\n- **Add**\n- **Delete**\n- **Conflict**\n\n\n\n![](http://img.mrsingsing.com/diff-tool-data-structure-comparation-.jpg)\n\n diff \n\n![](http://img.mrsingsing.com/diff-tool-result-data-structure.jpg)\n\n\n\n-  `_properties` \n-  `_status` \n  - Equal `_origin` \n  - Add `_target` \n  - Delete `_origin` \n  - Conflict `_orign` `_target` \n\n `_status` **** `style`  `height`  Schema  `_status` ConflictConflict\n\n> \n\n![](http://img.mrsingsing.com/diff-tool-status-display-tatics.jpg)\n\n\n\n![](http://img.mrsingsing.com/diff-tool-path-to-root.jpg)\n\n## Diff \n\n\n\n diff \n\n\n\n TotoroX  TotoroX  `eventList`  `name`  `eventList`  `name`  diff `name` \n\n![Button](http://img.mrsingsing.com/diff-tool-button-data.jpeg)\n\n### \n\n\n\n****\n\n\n\n```js\nfunction getDifference(a, b) {\n  return [...new Set(a.filter(x => !new Set(b).has(x)))];\n}\n```\n\n `a` \n\n```js\nfunction getDifferenceWith(a, b, comparator = (x, y) => x === y) {\n  return a.filter(x => b.findIndex(y => comparator(x, y)) === -1);\n}\n```\n\n****\n\n\n\n```js\nfunction getIntersection(a, b) {\n  return [...new Set(a.filter(x => new Set(b).has(x)))];\n}\n```\n\n `a` \n\n```js\nfunction getIntersectionWith(a, b, comparator = (x, y) => x === y) {\n  return a.filter(x => b.findIndex(y => comparator(x, y)) !== -1);\n}\n```\n\n****\n\n```js\nfunction getUnionWith(a, b, comparator = (x, y) => x === y) {\n  return Array.from(new Set([...a, ...b.filter(x => a.findIndex(y => comparator(x, y)) === -1)]));\n}\n```\n\n****\n\n```js\nfunction getDedupeBy(arr, comparator = (x, y) => x === y) {\n  return arr.reduce((acc, v) => {\n    if (!acc.some(x => comparator(v, x))) {\n      acc.push(v);\n    }\n    return acc;\n  }, []);\n}\n```\n\n `comparator` `comparator`  `filter` \n\n```js\nconst comparator = (x, y) => x.id === y.id;\n```\n\n `x`  `id`  `y`  `id`  `x`  `y` \n\n `comparator` \n\n### \n\n JSON \n\n- `diffObject` `Object.keys` \n- `diffArray` `comparator` \n- `diffValue`EqualConflict\n\n `diffObject`  `diffArray`\n\n// `getRecursion` \n\n![diff](http://img.mrsingsing.com/diff-tool-workflow.jpg)\n\n `Object.keys()`  `origin`  `target` \n\n `origin`  `target`  `origin`  `target`  `origin`  `target` \n\n `comparator`  `comparator` diff  `comparator`  `diff` \n\n `Array.prototype.join()`  `comparator`  `diffArray` \n\n```js\nconst comparator = {\n  //  init  comparator \n  init: (a, b) => a.name === b.name && a.id === b.id,\n  eventList: (a, b) => a.name === b.name,\n  'eventList.value': (a, b) => a === b,\n  'eventList.subEvents': (a, b) => a.id === b.id,\n  'eventList.subEvents.actions': (a, b) => a.id === b.id,\n  animation: (a, b) => a.antType === b.antType,\n};\n```\n\n**** `init` \n\n diff  diff  TotoroX  `origin` `target`  merge \n\n## Merge \n\n merge  git \n\ngit \n\n```\nB - C - D master(*)\n \\\n  E - F dev\n```\n\n `master` `dev`  `master`  commitB commit  `base``master`  commitD  `ours` `dev`  commitF  `theirs`\n\n git  `ours`  `theirs` \n\n `base`\n\n| base | HEADours | theirs |      |                                                              |\n| ------------ | ------------ | -------------- | -------- | ---------------------------------------------------------------- |\n| A            | A            | A              | A        |                                                                  |\n| A            | A            | B              | B        |                        |\n| A            | B            | A              | B        |                                                              |\n| A            | B            | B              | B        |                    |\n| A            | B            | C              | conflict |  |\n\n\n\n![](http://img.mrsingsing.com/diff-tool-merge-strategy.png)\n\n git \n\n### \n\n merge  merge ****base **Head**ours****theirs `base` \n\n `base`  diff  JSON Schema  mergeBranch \n\n```js\nfunction merge(base, ours, theirs, diffComparator, mergeComparator) {\n  const originDiff = diff(base, ours, diffComparator);\n  const targetDiff = diff(base, theris, diffComparator);\n\n  const newDataSchema = mergeBranch(originDiff, targetDiff, mergeComparator);\n\n  return newDataSchema;\n}\n```\n\n merge  diff  Schema  JSON**** `_status` \n\n|  |  |                                                                                                                                   |\n| -------------------- | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |\n| Equal                | Equal                  |  `base`  `ours` `base`  `theirs`                                                        |\n| Equal                | Updated                |  `base`  `ours` `base`  `theirs`                                      |\n| Updated              | Equal                  |  `base`  `ours` `base`  `theirs`                                      |\n| Updated              | Updated                |  `base`  `ours` `base`  `theirs`                                      |\n| Updated              | Updated                |  `base`  `ours` `base`  `theirs`  `ours`  `theirs`  `base`  |\n\n![](http://img.mrsingsing.com/diff-tool-merge-venn-diagram.jpg)\n\n\n\n1. A-A-A=> `mergeUnmodified` `equal` \n2. A-A-BA-B-A=> `mergeUpdated` `base` \n3. A-B-BA-B-C=> `mergeConflict`\n\n `_status` `equal`\n\n `_status` `equal`\n\n****\n\n1.  `comparator`  `base``ours`  `theirs`  `conflict` \n2.  `_status` `add` `add` \n\n### \n\n\n\n\n\n| base_ours  | base_theirs  |                                                                                                                                                 |\n| -------------------- | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |\n| Add                  | Add                    |  `base`  `ours`  `theris`                                                                                   |\n| Conflict             | Conflict               |  `base` `ours`  `base` `theris`  `base`  `ours` / |\n| Conflict             | Delete                 |  `base` `ours`  `base`  `theris`                                              |\n| Delete               | Conflict               |  `base` `ours`  `theris`  `base`                                                    |\n| Delete               | Delete                 |  base `ours`  `theris`                                                                                        |\n\n\n\n![](http://img.mrsingsing.com/diff-tool-merge-code-demo.jpg)\n\n\n\n- `color` `base`  `ours`  `theirs` \n- `width` `base`  `ours`  `theirs`  `ours`  `theirs` \n- `height`  `width` `ours`  `theirs` \n- `translateX` `base`  `ours`  `theirs` \n- `translateX` `base`  `theirs`  `ours` \n- `line-height`  `base` `ours`  `theirs` \n\n> \n\n `base`  diff  JSON Schema \n\n![diff-between-base-and-ours](http://img.mrsingsing.com/diff-between-base-and-ours.jpg)\n\n![diff-between-base-and-theirs](http://img.mrsingsing.com/diff-between-base-and-theirs.jpg)\n\n JSON Schema \n\n![Merge base and ours and theirs](http://img.mrsingsing.com/diff-tool-merge-base-ours-and-theirs.jpeg)\n\n## Revert \n\n JSON Schema \n\n---\n\n****\n\n- [ Git  17](https://blog.csdn.net/longintchar/article/details/83049840)\n","slug":"practice-of-page-batch-update-tool-in-visual-configuration-system","published":1,"updated":"2021-08-18T03:30:43.566Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99z0000av31p77r2jv2z","content":"<blockquote>\n<p><a href=\"https://juejin.im/post/5dc8fd92f265da4d287f4551\" target=\"_blank\" rel=\"noopener\"></a></p>\n</blockquote>\n<p>TotoroX  PPmoney  UI  850+</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> UI </p>\n<p> UI  <code>git diff</code> </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-abtest.jpg\" alt=\"AB Test\"></p>\n<p>TotoroX </p>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> TotoroX  JSON  JSON </p>\n<p> JSON </p>\n<ul>\n<li>null</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> DateFunctionSymbolSet </p>\n<p> <code>null</code></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> JSON </p>\n<p>JSON  JSON Schema  JSON  JSON Schema </p>\n<p> JSON Schema </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"$schema\"</span>: <span class=\"string\">\"http://json-schema.org/draft-07/schema#\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"$id\"</span>: <span class=\"string\">\"http://example.com/product.schema.json\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"Product\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"A product from Acme's catalog\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"object\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"properties\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"productId\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"The unique identifier for a product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"integer\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"productName\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Name of the product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"string\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"price\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"The price of the product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"exclusiveMinimum\"</span>: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"tags\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Tags for the product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"array\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"items\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"string\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"minItems\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"uniqueItems\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"dimensions\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"object\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"properties\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"length\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">\"width\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">\"height\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"required\"</span>: [<span class=\"string\">\"length\"</span>, <span class=\"string\">\"width\"</span>, <span class=\"string\">\"height\"</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"required\"</span>: [<span class=\"string\">\"productId\"</span>, <span class=\"string\">\"productName\"</span>, <span class=\"string\">\"price\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>JSON Schema  JSON JSON Schema  JSON </p>\n<p> JSON Schema </p>\n<p> Git </p>\n<ul>\n<li><strong>Equal</strong></li>\n<li><strong>Add</strong></li>\n<li><strong>Delete</strong></li>\n<li><strong>Conflict</strong></li>\n</ul>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-data-structure-comparation-.jpg\" alt=\"\"></p>\n<p> diff </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-result-data-structure.jpg\" alt=\"\"></p>\n<p></p>\n<ul>\n<li> <code>_properties</code> </li>\n<li> <code>_status</code> <ul>\n<li>Equal <code>_origin</code> </li>\n<li>Add <code>_target</code> </li>\n<li>Delete <code>_origin</code> </li>\n<li>Conflict <code>_orign</code> <code>_target</code> </li>\n</ul>\n</li>\n</ul>\n<p> <code>_status</code> <strong></strong> <code>style</code>  <code>height</code>  Schema  <code>_status</code> ConflictConflict</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-status-display-tatics.jpg\" alt=\"\"></p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-path-to-root.jpg\" alt=\"\"></p>\n<h2 id=\"Diff-\"><a href=\"#Diff-\" class=\"headerlink\" title=\"Diff \"></a>Diff </h2><p></p>\n<p> diff </p>\n<p></p>\n<p> TotoroX  TotoroX  <code>eventList</code>  <code>name</code>  <code>eventList</code>  <code>name</code>  diff <code>name</code> </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-button-data.jpeg\" alt=\"Button\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><strong></strong></p>\n<p></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDifference</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [...new <span class=\"built_in\">Set</span>(a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>(b).has(x)))];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>a</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDifferenceWith</span>(<span class=\"params\">a, b, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> b.findIndex(<span class=\"function\"><span class=\"params\">y</span> =&gt;</span> comparator(x, y)) === <span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<p></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIntersection</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [...new <span class=\"built_in\">Set</span>(a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>(b).has(x)))];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>a</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIntersectionWith</span>(<span class=\"params\">a, b, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> b.findIndex(<span class=\"function\"><span class=\"params\">y</span> =&gt;</span> comparator(x, y)) !== <span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getUnionWith</span>(<span class=\"params\">a, b, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.from(<span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>([...a, ...b.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> a.findIndex(<span class=\"function\"><span class=\"params\">y</span> =&gt;</span> comparator(x, y)) === <span class=\"number\">-1</span>)]));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDedupeBy</span>(<span class=\"params\">arr, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.reduce(<span class=\"function\">(<span class=\"params\">acc, v</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!acc.some(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> comparator(v, x))) &#123;</span><br><span class=\"line\">      acc.push(v);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc;</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>comparator</code> <code>comparator</code>  <code>filter</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> comparator = <span class=\"function\">(<span class=\"params\">x, y</span>) =&gt;</span> x.id === y.id;</span><br></pre></td></tr></table></figure>\n<p> <code>x</code>  <code>id</code>  <code>y</code>  <code>id</code>  <code>x</code>  <code>y</code> </p>\n<p> <code>comparator</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> JSON </p>\n<ul>\n<li><code>diffObject</code> <code>Object.keys</code> </li>\n<li><code>diffArray</code> <code>comparator</code> </li>\n<li><code>diffValue</code>EqualConflict</li>\n</ul>\n<p> <code>diffObject</code>  <code>diffArray</code></p>\n<p>// <code>getRecursion</code> </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-workflow.jpg\" alt=\"diff\"></p>\n<p> <code>Object.keys()</code>  <code>origin</code>  <code>target</code> </p>\n<p> <code>origin</code>  <code>target</code>  <code>origin</code>  <code>target</code>  <code>origin</code>  <code>target</code> </p>\n<p> <code>comparator</code>  <code>comparator</code> diff  <code>comparator</code>  <code>diff</code> </p>\n<p> <code>Array.prototype.join()</code>  <code>comparator</code>  <code>diffArray</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> comparator = &#123;</span><br><span class=\"line\">  <span class=\"comment\">//  init  comparator </span></span><br><span class=\"line\">  init: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.name === b.name &amp;&amp; a.id === b.id,</span><br><span class=\"line\">  eventList: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.name === b.name,</span><br><span class=\"line\">  <span class=\"string\">'eventList.value'</span>: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a === b,</span><br><span class=\"line\">  <span class=\"string\">'eventList.subEvents'</span>: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.id === b.id,</span><br><span class=\"line\">  <span class=\"string\">'eventList.subEvents.actions'</span>: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.id === b.id,</span><br><span class=\"line\">  animation: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.antType === b.antType,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong></strong> <code>init</code> </p>\n<p> diff  diff  TotoroX  <code>origin</code> <code>target</code>  merge </p>\n<h2 id=\"Merge-\"><a href=\"#Merge-\" class=\"headerlink\" title=\"Merge \"></a>Merge </h2><p> merge  git </p>\n<p>git </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">B - C - D master(*)</span><br><span class=\"line\"> \\</span><br><span class=\"line\">  E - F dev</span><br></pre></td></tr></table></figure>\n<p> <code>master</code> <code>dev</code>  <code>master</code>  commitB commit  <code>base</code><code>master</code>  commitD  <code>ours</code> <code>dev</code>  commitF  <code>theirs</code></p>\n<p> git  <code>ours</code>  <code>theirs</code> </p>\n<p> <code>base</code></p>\n<table>\n<thead>\n<tr>\n<th>base</th>\n<th>HEADours</th>\n<th>theirs</th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>A</td>\n<td>A</td>\n<td>A</td>\n<td>A</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>A</td>\n<td>B</td>\n<td>B</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>B</td>\n<td>A</td>\n<td>B</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>B</td>\n<td>B</td>\n<td>B</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>B</td>\n<td>C</td>\n<td>conflict</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-strategy.png\" alt=\"\"></p>\n<p> git </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> merge  merge <strong></strong>base <strong>Head</strong>ours<strong></strong>theirs <code>base</code> </p>\n<p> <code>base</code>  diff  JSON Schema  mergeBranch </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">merge</span>(<span class=\"params\">base, ours, theirs, diffComparator, mergeComparator</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> originDiff = diff(base, ours, diffComparator);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> targetDiff = diff(base, theris, diffComparator);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> newDataSchema = mergeBranch(originDiff, targetDiff, mergeComparator);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> newDataSchema;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> merge  diff  Schema  JSON<strong></strong> <code>_status</code> </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Equal</td>\n<td>Equal</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Equal</td>\n<td>Updated</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Updated</td>\n<td>Equal</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Updated</td>\n<td>Updated</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Updated</td>\n<td>Updated</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code>  <code>ours</code>  <code>theirs</code>  <code>base</code> </td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-venn-diagram.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>A-A-A=&gt; <code>mergeUnmodified</code> <code>equal</code> </li>\n<li>A-A-BA-B-A=&gt; <code>mergeUpdated</code> <code>base</code> </li>\n<li>A-B-BA-B-C=&gt; <code>mergeConflict</code></li>\n</ol>\n<p> <code>_status</code> <code>equal</code></p>\n<p> <code>_status</code> <code>equal</code></p>\n<p><strong></strong></p>\n<ol>\n<li> <code>comparator</code>  <code>base</code><code>ours</code>  <code>theirs</code>  <code>conflict</code> </li>\n<li> <code>_status</code> <code>add</code> <code>add</code> </li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<table>\n<thead>\n<tr>\n<th>base_ours </th>\n<th>base_theirs </th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Add</td>\n<td>Add</td>\n<td> <code>base</code>  <code>ours</code>  <code>theris</code> </td>\n</tr>\n<tr>\n<td>Conflict</td>\n<td>Conflict</td>\n<td> <code>base</code> <code>ours</code>  <code>base</code> <code>theris</code>  <code>base</code>  <code>ours</code> /</td>\n</tr>\n<tr>\n<td>Conflict</td>\n<td>Delete</td>\n<td> <code>base</code> <code>ours</code>  <code>base</code>  <code>theris</code> </td>\n</tr>\n<tr>\n<td>Delete</td>\n<td>Conflict</td>\n<td> <code>base</code> <code>ours</code>  <code>theris</code>  <code>base</code> </td>\n</tr>\n<tr>\n<td>Delete</td>\n<td>Delete</td>\n<td> base <code>ours</code>  <code>theris</code> </td>\n</tr>\n</tbody>\n</table>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-code-demo.jpg\" alt=\"\"></p>\n<p></p>\n<ul>\n<li><code>color</code> <code>base</code>  <code>ours</code>  <code>theirs</code> </li>\n<li><code>width</code> <code>base</code>  <code>ours</code>  <code>theirs</code>  <code>ours</code>  <code>theirs</code> </li>\n<li><code>height</code>  <code>width</code> <code>ours</code>  <code>theirs</code> </li>\n<li><code>translateX</code> <code>base</code>  <code>ours</code>  <code>theirs</code> </li>\n<li><code>translateX</code> <code>base</code>  <code>theirs</code>  <code>ours</code> </li>\n<li><code>line-height</code>  <code>base</code> <code>ours</code>  <code>theirs</code> </li>\n</ul>\n<blockquote>\n<p></p>\n</blockquote>\n<p> <code>base</code>  diff  JSON Schema </p>\n<p><img src=\"http://img.mrsingsing.com/diff-between-base-and-ours.jpg\" alt=\"diff-between-base-and-ours\"></p>\n<p><img src=\"http://img.mrsingsing.com/diff-between-base-and-theirs.jpg\" alt=\"diff-between-base-and-theirs\"></p>\n<p> JSON Schema </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-base-ours-and-theirs.jpeg\" alt=\"Merge base and ours and theirs\"></p>\n<h2 id=\"Revert-\"><a href=\"#Revert-\" class=\"headerlink\" title=\"Revert \"></a>Revert </h2><p> JSON Schema </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://blog.csdn.net/longintchar/article/details/83049840\" target=\"_blank\" rel=\"noopener\"> Git  17</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p><a href=\"https://juejin.im/post/5dc8fd92f265da4d287f4551\" target=\"_blank\" rel=\"noopener\"></a></p>\n</blockquote>\n<p>TotoroX  PPmoney  UI  850+</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> UI </p>\n<p> UI  <code>git diff</code> </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-abtest.jpg\" alt=\"AB Test\"></p>\n<p>TotoroX </p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> TotoroX  JSON  JSON </p>\n<p> JSON </p>\n<ul>\n<li>null</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> DateFunctionSymbolSet </p>\n<p> <code>null</code></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> JSON </p>\n<p>JSON  JSON Schema  JSON  JSON Schema </p>\n<p> JSON Schema </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"$schema\"</span>: <span class=\"string\">\"http://json-schema.org/draft-07/schema#\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"$id\"</span>: <span class=\"string\">\"http://example.com/product.schema.json\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"title\"</span>: <span class=\"string\">\"Product\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"A product from Acme's catalog\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"object\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"properties\"</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">\"productId\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"The unique identifier for a product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"integer\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"productName\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Name of the product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"string\"</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"price\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"The price of the product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"exclusiveMinimum\"</span>: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"tags\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"description\"</span>: <span class=\"string\">\"Tags for the product\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"array\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"items\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"string\"</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"minItems\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"uniqueItems\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">\"dimensions\"</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"object\"</span>,</span><br><span class=\"line\">      <span class=\"attr\">\"properties\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"length\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">\"width\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">\"height\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">\"type\"</span>: <span class=\"string\">\"number\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">\"required\"</span>: [<span class=\"string\">\"length\"</span>, <span class=\"string\">\"width\"</span>, <span class=\"string\">\"height\"</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">\"required\"</span>: [<span class=\"string\">\"productId\"</span>, <span class=\"string\">\"productName\"</span>, <span class=\"string\">\"price\"</span>]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>JSON Schema  JSON JSON Schema  JSON </p>\n<p> JSON Schema </p>\n<p> Git </p>\n<ul>\n<li><strong>Equal</strong></li>\n<li><strong>Add</strong></li>\n<li><strong>Delete</strong></li>\n<li><strong>Conflict</strong></li>\n</ul>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-data-structure-comparation-.jpg\" alt=\"\"></p>\n<p> diff </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-result-data-structure.jpg\" alt=\"\"></p>\n<p></p>\n<ul>\n<li> <code>_properties</code> </li>\n<li> <code>_status</code> <ul>\n<li>Equal <code>_origin</code> </li>\n<li>Add <code>_target</code> </li>\n<li>Delete <code>_origin</code> </li>\n<li>Conflict <code>_orign</code> <code>_target</code> </li>\n</ul>\n</li>\n</ul>\n<p> <code>_status</code> <strong></strong> <code>style</code>  <code>height</code>  Schema  <code>_status</code> ConflictConflict</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-status-display-tatics.jpg\" alt=\"\"></p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-path-to-root.jpg\" alt=\"\"></p>\n<h2 id=\"Diff-\"><a href=\"#Diff-\" class=\"headerlink\" title=\"Diff \"></a>Diff </h2><p></p>\n<p> diff </p>\n<p></p>\n<p> TotoroX  TotoroX  <code>eventList</code>  <code>name</code>  <code>eventList</code>  <code>name</code>  diff <code>name</code> </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-button-data.jpeg\" alt=\"Button\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><strong></strong></p>\n<p></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDifference</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [...new <span class=\"built_in\">Set</span>(a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> !<span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>(b).has(x)))];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>a</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDifferenceWith</span>(<span class=\"params\">a, b, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> b.findIndex(<span class=\"function\"><span class=\"params\">y</span> =&gt;</span> comparator(x, y)) === <span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<p></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIntersection</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [...new <span class=\"built_in\">Set</span>(a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>(b).has(x)))];</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>a</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIntersectionWith</span>(<span class=\"params\">a, b, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> b.findIndex(<span class=\"function\"><span class=\"params\">y</span> =&gt;</span> comparator(x, y)) !== <span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getUnionWith</span>(<span class=\"params\">a, b, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">Array</span>.from(<span class=\"keyword\">new</span> <span class=\"built_in\">Set</span>([...a, ...b.filter(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> a.findIndex(<span class=\"function\"><span class=\"params\">y</span> =&gt;</span> comparator(x, y)) === <span class=\"number\">-1</span>)]));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong></strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getDedupeBy</span>(<span class=\"params\">arr, comparator = (x, y</span>) =&gt; <span class=\"title\">x</span> === <span class=\"title\">y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> arr.reduce(<span class=\"function\">(<span class=\"params\">acc, v</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!acc.some(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> comparator(v, x))) &#123;</span><br><span class=\"line\">      acc.push(v);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> acc;</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> <code>comparator</code> <code>comparator</code>  <code>filter</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> comparator = <span class=\"function\">(<span class=\"params\">x, y</span>) =&gt;</span> x.id === y.id;</span><br></pre></td></tr></table></figure>\n<p> <code>x</code>  <code>id</code>  <code>y</code>  <code>id</code>  <code>x</code>  <code>y</code> </p>\n<p> <code>comparator</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> JSON </p>\n<ul>\n<li><code>diffObject</code> <code>Object.keys</code> </li>\n<li><code>diffArray</code> <code>comparator</code> </li>\n<li><code>diffValue</code>EqualConflict</li>\n</ul>\n<p> <code>diffObject</code>  <code>diffArray</code></p>\n<p>// <code>getRecursion</code> </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-workflow.jpg\" alt=\"diff\"></p>\n<p> <code>Object.keys()</code>  <code>origin</code>  <code>target</code> </p>\n<p> <code>origin</code>  <code>target</code>  <code>origin</code>  <code>target</code>  <code>origin</code>  <code>target</code> </p>\n<p> <code>comparator</code>  <code>comparator</code> diff  <code>comparator</code>  <code>diff</code> </p>\n<p> <code>Array.prototype.join()</code>  <code>comparator</code>  <code>diffArray</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> comparator = &#123;</span><br><span class=\"line\">  <span class=\"comment\">//  init  comparator </span></span><br><span class=\"line\">  init: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.name === b.name &amp;&amp; a.id === b.id,</span><br><span class=\"line\">  eventList: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.name === b.name,</span><br><span class=\"line\">  <span class=\"string\">'eventList.value'</span>: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a === b,</span><br><span class=\"line\">  <span class=\"string\">'eventList.subEvents'</span>: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.id === b.id,</span><br><span class=\"line\">  <span class=\"string\">'eventList.subEvents.actions'</span>: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.id === b.id,</span><br><span class=\"line\">  animation: <span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.antType === b.antType,</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong></strong> <code>init</code> </p>\n<p> diff  diff  TotoroX  <code>origin</code> <code>target</code>  merge </p>\n<h2 id=\"Merge-\"><a href=\"#Merge-\" class=\"headerlink\" title=\"Merge \"></a>Merge </h2><p> merge  git </p>\n<p>git </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">B - C - D master(*)</span><br><span class=\"line\"> \\</span><br><span class=\"line\">  E - F dev</span><br></pre></td></tr></table></figure>\n<p> <code>master</code> <code>dev</code>  <code>master</code>  commitB commit  <code>base</code><code>master</code>  commitD  <code>ours</code> <code>dev</code>  commitF  <code>theirs</code></p>\n<p> git  <code>ours</code>  <code>theirs</code> </p>\n<p> <code>base</code></p>\n<table>\n<thead>\n<tr>\n<th>base</th>\n<th>HEADours</th>\n<th>theirs</th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>A</td>\n<td>A</td>\n<td>A</td>\n<td>A</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>A</td>\n<td>B</td>\n<td>B</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>B</td>\n<td>A</td>\n<td>B</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>B</td>\n<td>B</td>\n<td>B</td>\n<td></td>\n</tr>\n<tr>\n<td>A</td>\n<td>B</td>\n<td>C</td>\n<td>conflict</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-strategy.png\" alt=\"\"></p>\n<p> git </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> merge  merge <strong></strong>base <strong>Head</strong>ours<strong></strong>theirs <code>base</code> </p>\n<p> <code>base</code>  diff  JSON Schema  mergeBranch </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">merge</span>(<span class=\"params\">base, ours, theirs, diffComparator, mergeComparator</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> originDiff = diff(base, ours, diffComparator);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> targetDiff = diff(base, theris, diffComparator);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> newDataSchema = mergeBranch(originDiff, targetDiff, mergeComparator);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> newDataSchema;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> merge  diff  Schema  JSON<strong></strong> <code>_status</code> </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Equal</td>\n<td>Equal</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Equal</td>\n<td>Updated</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Updated</td>\n<td>Equal</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Updated</td>\n<td>Updated</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code> </td>\n</tr>\n<tr>\n<td>Updated</td>\n<td>Updated</td>\n<td> <code>base</code>  <code>ours</code> <code>base</code>  <code>theirs</code>  <code>ours</code>  <code>theirs</code>  <code>base</code> </td>\n</tr>\n</tbody>\n</table>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-venn-diagram.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>A-A-A=&gt; <code>mergeUnmodified</code> <code>equal</code> </li>\n<li>A-A-BA-B-A=&gt; <code>mergeUpdated</code> <code>base</code> </li>\n<li>A-B-BA-B-C=&gt; <code>mergeConflict</code></li>\n</ol>\n<p> <code>_status</code> <code>equal</code></p>\n<p> <code>_status</code> <code>equal</code></p>\n<p><strong></strong></p>\n<ol>\n<li> <code>comparator</code>  <code>base</code><code>ours</code>  <code>theirs</code>  <code>conflict</code> </li>\n<li> <code>_status</code> <code>add</code> <code>add</code> </li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p></p>\n<table>\n<thead>\n<tr>\n<th>base_ours </th>\n<th>base_theirs </th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Add</td>\n<td>Add</td>\n<td> <code>base</code>  <code>ours</code>  <code>theris</code> </td>\n</tr>\n<tr>\n<td>Conflict</td>\n<td>Conflict</td>\n<td> <code>base</code> <code>ours</code>  <code>base</code> <code>theris</code>  <code>base</code>  <code>ours</code> /</td>\n</tr>\n<tr>\n<td>Conflict</td>\n<td>Delete</td>\n<td> <code>base</code> <code>ours</code>  <code>base</code>  <code>theris</code> </td>\n</tr>\n<tr>\n<td>Delete</td>\n<td>Conflict</td>\n<td> <code>base</code> <code>ours</code>  <code>theris</code>  <code>base</code> </td>\n</tr>\n<tr>\n<td>Delete</td>\n<td>Delete</td>\n<td> base <code>ours</code>  <code>theris</code> </td>\n</tr>\n</tbody>\n</table>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-code-demo.jpg\" alt=\"\"></p>\n<p></p>\n<ul>\n<li><code>color</code> <code>base</code>  <code>ours</code>  <code>theirs</code> </li>\n<li><code>width</code> <code>base</code>  <code>ours</code>  <code>theirs</code>  <code>ours</code>  <code>theirs</code> </li>\n<li><code>height</code>  <code>width</code> <code>ours</code>  <code>theirs</code> </li>\n<li><code>translateX</code> <code>base</code>  <code>ours</code>  <code>theirs</code> </li>\n<li><code>translateX</code> <code>base</code>  <code>theirs</code>  <code>ours</code> </li>\n<li><code>line-height</code>  <code>base</code> <code>ours</code>  <code>theirs</code> </li>\n</ul>\n<blockquote>\n<p></p>\n</blockquote>\n<p> <code>base</code>  diff  JSON Schema </p>\n<p><img src=\"http://img.mrsingsing.com/diff-between-base-and-ours.jpg\" alt=\"diff-between-base-and-ours\"></p>\n<p><img src=\"http://img.mrsingsing.com/diff-between-base-and-theirs.jpg\" alt=\"diff-between-base-and-theirs\"></p>\n<p> JSON Schema </p>\n<p><img src=\"http://img.mrsingsing.com/diff-tool-merge-base-ours-and-theirs.jpeg\" alt=\"Merge base and ours and theirs\"></p>\n<h2 id=\"Revert-\"><a href=\"#Revert-\" class=\"headerlink\" title=\"Revert \"></a>Revert </h2><p> JSON Schema </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://blog.csdn.net/longintchar/article/details/83049840\" target=\"_blank\" rel=\"noopener\"> Git  17</a></li>\n</ul>"},{"title":"","date":"2020-06-25T00:00:00.000Z","_content":"\n SSO \n\nAuthentication\n\n\n\n Web \n\n<!-- more -->\n\n\n\n- HTTP \n- Session-Cookie \n  - koa-session\n- Token \n  - JWT \n  - koa-jwt\n- OAuth2 \n- SSO \n- LDAP \n- \n- \n- \n- \n\n## HTTP \n\n HTTP Basic Access Authentication HTTP \n\n\n\n1. `uid` ID\n2. `password`\n3. `realm`\n\nHTTP  Authorization `Authorization: Basic <>` ``  ``  **Base64 **\n\n```\nGET /securefiles/ HTTP/1.1\nHost: www.example.com\nAuthorization: Basic aHR0cHdhdGNoOmY=\n```\n\n![HTTP ](http://img.mrsingsing.com/authentication-http-basic-access-authentication.jpg)\n\n1. \n2.  401 UnauthorizedAccess Authentication`WWW-Authenticate`  `WWW-Authenticate: Basic realm=\"Secure Area\"``Basic`  `realm=\"Secure Area\"`  URI \n3. \n4.  `Authorization` \n\n-  `:` \n-  `WWW-Authenticate` \n-  Base64\n-  `Basic` `Authorization`  `admin` `password` `admin:password` Base64  `YWRtaW46cGFzc3dvcmQ=` HTTP `Authorization: Basic YWRtaW46cGFzc3dvcmQ=`\n\n```js\nBuffer.from('admin:password').toString('base64');\n// YWRtaW46cGFzc3dvcmQ=\n```\n\n5.  401 \n\n\n\n1.  `realm`\n2.  Authorization \n3.  `realm` \n4. \n\n> \n\n\n\n- \n\n\n\n- \n- Base64  HTTP \n- \n- Basic \n\n> HTTP  HTTPS / TLS \n\n\n\n## Session-Cookie \n\n`Session-Cookie`  Session Cookie \n\n HTTP  Session  Session \n\nCookie \n\n- \n- \n- \n\n Session-Cookie \n\n![Session-Cookie ](http://img.mrsingsing.com/authentication-session-cookie.jpg)\n\n1.  Session Session  Redis  Session  `session_id` `sid` `Set-Cookie` \n2.  `sid`  `secret` \n3.  `sid`  Cookie  HTTP  Cookie \n4.  Cookie  `sid` `sid`  `sid`\n5.  ID\n\n>   ``  Cookie  APP  Cookie /\n\n\n\n1. Cookie Cookie \n2. Session  JWT  Session \n\n\n\n1. Cookie  CSRF \n2. Session \n3. \n\n### koa-session\n\n Koa  `koa-session2`  Session-Cookie \n\n Redis  NoSQL \n\n`koa-session2`  `koa-session2`  Redis  Session-Cookie \n\n```js\nconst Redis = require('ioredis');\nconst { Store } = require('koa-session2');\n\nclass RedisStore extends Store {\n  constructor() {\n    super();\n    //  Redis\n    this.redis = new Redis();\n  }\n\n  //  sid \n  async get(sid, ctx) {\n    let data = await this.redis.get(`SESSION: ${sid}`);\n    return JSON.parse(data);\n  }\n\n  //  sid \n  async set(session, { sid = this.getID(24), maxAge = 1000000 } = {}, ctx) {\n    try {\n      await this.redis.set(`SESSION: ${sid}`, JSON.stringfy(session));\n    } catch (e) {}\n\n    return sid;\n  }\n\n  // \n  async destroy(sid, ctx) {\n    return await this.redis.del(`SESSION: ${sid}`);\n  }\n}\n\nmodule.exports = RedisStore;\n```\n\n```js\n// app.js\nconst Koa = require('koa');\nconst session = require('koa-session2');\nconst Store = require('./Store.js');\n\nconst app = new Koa();\n\napp.use(\n  session({\n    //  Cookie \n    key: 'SESSIONID',\n    //  JS  Cookie\n    httpOnly: true,\n    // Cookie \n    signed: true,\n    store: new Store(),\n  })\n);\n\napp.use(ctx => {\n  // Ignore favicon.ico\n  if (ctx.path === '/favicon.ico') return;\n\n  let user = this.session.user;\n\n  ctx.session.view = 'index';\n});\n\napp.use(ctx => {\n  // \n  ctx.session.refresh();\n});\n```\n\n `koa-session`  Cookie  IP  ID \n\nKoa  Cookie  `signed`  `true`  Cookie  SHA256  `koa:sess=pjadZtLAVtiO6-Haw1vnZZWrRm8` Cookie \n\n Session `koa-session` \n\n```js\nconst encode = json => CrytoJS.AES.encrypt(json, 'Secret Passphrase');\n\nconst decode = encrypted => CryptoJS.AES.decrypt(encrypted, 'Secret Passphrase');\n```\n\n`koa-session`  Koa \n\n `koa-session2`  Github \n\n- [koa-session](https://github.com/koajs/session)\n- [koa-session2](https://github.com/Secbone/koa-session2)\n- [koa-session ](https://segmentfault.com/a/1190000013039187)\n- [koa-session ](https://www.jianshu.com/p/c1eff1b50d23)\n- [ koa-session  session ](https://juejin.im/post/5c148fd551882530544f341f)\n- [ koa-session  cookie  session](https://segmentfault.com/a/1190000012412299)\n\n## Token \n\n Restful API Token Token  Session-Cookie  Session ID Token  `` Token  TwitterQQGithub  API  OpenStackKubernetes  API  Token \n\n![Token ](http://img.mrsingsing.com/authentication-token-authencation.jpg)\n\n Token \n\n1. \n2. \n3.  `` Token Token \n4.  Token  localStorage  sessionStorage  Cookie \n5.  Token  HTTP  Authorization \n6.  Token\n\n\n\n- ****Token Session Token \n- **** Token \n- \n-  Cookie  Token \n-  CSRF  Cookie XSS  Token  `httpOnly`  Cookie  JS  Cookie \n\n\n\n-  `sid` \n-  Session-Cookie Token  Token  Token  SessionCookie \n\n> Session-Cookie  Token \n\nSession-Cookie  Token  Token  Session-Cookie \n\nSession-Cookie  `sid`  `sid`  Session  Session-Cookie  Cookie  NativeAPP  Cookie \n\n Token  ``  Cookie Web Storage Session-Cookie  Token \n\nToken  JWT  Token \n\n### JWT \n\nJWTJSON Web Token Auth0  JSON  JSON  Token token \n\nJWT  JSON \n\n```\nJSON Data + Signature = JWT\n```\n\nJWT \n\n1. Headerstypalg\n\n JWT \n\n```json\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n```\n\n JWT HS256 \n\n2. Claims\n\n\n\n```json\n{\n  \"iss\": \"Jehoshaphat Tse\",\n  \"iat\": 1441593502,\n  \"exp\": 1441594722,\n  \"aud\": \"www.example.com\",\n  \"sub\": \"mrsingsing@example.com\",\n  \"name\": \"John Doe\",\n  \"admin\": true\n}\n```\n\n JWT :\n\n- `iss` JWT \n- `sub` JWT \n- `aud` JWT \n- `exp`expires Unix \n- `iat`issued at Base64 \n\n3. Signature\n\n `alg` HS256Secret JWTHeader  Claims  Signature  JWT \n\n```js\nHMACSHA256(base64UrlEncode(Headers) + '.' + base64UrlEncode(Claims), SECREATE_KEY);\n```\n\n\n\n1. RESTful API  Session \n2. JWT  JWT\n\n\n\n1. **** Session  Token Token  JWT  JWT  JWT \n2. **** JWT  Claims  Base64  JWT \n3. ****JWT Cookie  4k JWT  LocalStorage  HTTP  JWT  Header HTTP  Header  Body \n\n### koa-jwt\n\n Koa  `koa-jwt`  Token \n\n Token\n\n```js\nconst router = require('koa-router')();\nconst jwt = require('koa-jwt');\n//  MongoDB \nconst userModel = require('../model/userModel');\n\nconst secretOrPublicKey = 'TOKEN_EXAMPLE';\n\nrouter.post('/login', async ctx => {\n  const data = ctx.request.body;\n\n  // \n  const userInfo = await userModel.findOne({ name: data.name, password: data.password });\n\n  let result = null;\n  if (userInfo !== null) {\n    //  Token 2h\n    const token = jwt.sign({ name: userInfo.name, _id: userInfo._id }, secretOrPublicKey, {\n      expiresIn: '2h',\n    });\n\n    result = {\n      code: 200,\n      token: token,\n      msg: '',\n    };\n  } else {\n    result = {\n      code: 400,\n      token: null,\n      msg: '',\n    };\n  }\n\n  return (ctx.body = result);\n});\n```\n\n Token\n\n```js\n// \nfunction login(userName, password) {\n  return axios\n    .post('/login', {\n      name: userName,\n      password: password,\n    })\n    .then(res => {\n      if (res.code === 200) {\n        localStorage.setItem('access_token', res.data.token);\n      } else {\n        console.log('');\n      }\n    })\n    .catch(e => console.error(e));\n}\n\n//  Token  API \n//  Axios  Authorization \naxios.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n\n  config.headers.common['Authorization'] = 'Bearer ' + token;\n\n  return config;\n});\n```\n\n\n\n```js\nconst koa = require('koa');\nconst jwt = require('koa-jwt');\nconst app = new Koa();\nconst secretOrPublicKey = 'TOKEN_EXAMPLE';\n\napp\n  .use(\n    jwt({\n      secret: secretOrPublicKey,\n    })\n  )\n  .unless({\n    path: [/\\register/, /\\/login/],\n  });\n```\n\n `koa-jwt`  Token  Authorization\n\n-  `token`  Authorization Token  Bearer \n-  Token  401 \n\n `verify.js`  `jsonwebtoken`  `verify()` \n\n[jsonwebtoken](https://github.com/auth0/node-jsonwebtoken)  `sign()`  `token` `verify()`  `token` JWT  `koa-jwt`  `jsonwebtoken`  `verify()`  `token` `koa-jwt`  `index.js` `koa-jwt`  `koa-unless` \n\n- [Koa2  JWT ](http://www.uxys.com/html/JavaScript/20190722/52733.html)\n\n### Token \n\n#### \n\n Token \n\n- \n- \n- \n- /\n- \n\n Token  Session-Cookie  Session  Token  Token \n\n\n\n- ** Token ** Token  Redis  Token  Redis  Token  Token  DB  Token  JWT \n- **** Token  Token  Token  Token \n- ** Secret** Token \n  -  Token  Session \n  - \n- ****\n  - \n\n#### \n\nToken \n\nToken  Token  `` Token \n\n Session-Cookie  Session  30  30  Session  30 \n\n- ** Session ** Token  Token \n- ** Token**\n- **Token **\n- ** Token** `accessToken` `refreshToken` 1  `accessToken`  `refreshToken`  `accessToken`  `accessToken`  `refreshToken`  `accessToken` \n  - \n  -  Token \n  -  Token  Token  `accessToken`  `refreshToken`  `accessToken`\n\nJWT  Token  Token  Session-Cookie \n\n## \n\n****Single Sign-on SSO\n\n All-in-one  Session \n\n Session  SessionIDTomcat  `JSESSIONID` SessionID \n\n Redis  Token  Redis  SSO  Redis  `` \n\n SSO \n\n###  SSO\n\n A `a.abc.com`  B `b.abc.com`  SSO \n\n1.  `a.abc.com` SSO \n2.  Session  `Set-Cookie` \n3.  B  A  B  `abc.com` Cookie Cookie \n\n Session-Cookie \n\n###  SSO\n\n SSO \n\n**CAS**Central Authentication Service 1.0  2.0 1.0 2.0  Web \n\nCAS \n\n- Client\n- Server SSO \n- Service A / B\n\nCAS \n\n- `/login`\n- `/logout`\n- `/validate`\n- `/serviceValidate` Service \n\nCAS \n\n- **TGTTicket Grangting Ticket**TGT  CAS  `` TGT CAS TGT  Cookie  Cookie  HTTP CAS  Cookie TGC `key`  TGT\n- **TGCTicket Granting Cookie**CAS Service  TGC  Session  TGC  Session SessionID Cookie  CAS Service \n- **STService Ticket**ST  CAS  Service  Service Service  ST CAS  ST CAS  ST CAS  TGT ST ST  ServiceService  ST  CAS \n\n TGC  TGT  `key-value`  ST \n\n\n\n![CAS ](http://img.mrsingsing.com/authentication-cas-workflow.png)\n\n1.  A  `a.abc.com` A  ``  302 SSO  A  `sso.abc.com/login?service=https%3A%2F%2Fwww.a.abc.com`\n2.  SSO TGC SSO  ``  SSO  SSO \n3. SSO  SSO  `` ``STSSO  A \n\n-  `query`  A \n-  `query`  SSO  ST\n-  HTTP  Cookie  Header Cookie  SSO  TGC\n\n5.  A  URL  SSO  ST\n6.  A  ST  SSO SSO  A  SSO  A  ``\n7.  B  `b.abc.com` B  ``  SSO  ST ST \n8. SSO  B \n9.  B  SSO SSO  B\n10.  B \n\n CAS  CAS Server  ST  ST  Hacker  Client  ST Hacker  ST ST  IPSessionID \n\n### LDAP \n\nLDAP  Lightweight Directory Access Protocol****IEFTRFC \\*_ LDAP_-  JiraConfluenceOpenVPN  LDAP  LDAP  SSO\n\n- \n  - \n  - \n  - \n  - \n- \n  - \n  -  LDAP  LDAP BIND \n  - \n\n## \n\n\n\n1.  \\*__- \n2.  \\*__- \n\nQQ \n\n\n\n OAuth OAuth OAuth \n\n## OAuth2 \n\nOAuth ``  `` OAuth QQ\n\nOAuth  1.0  2.0 2.0 \n\n\n\n\n\n- Authorization Code Grant\n- Implicit Grant\n- Resource Owner Password Credentials Grant\n- Client Credentials Grant\n\n`````` ``\n\n- Resource Owner\n- Third-party Application Web App Web \n- Authorization Server\n- Resource Server\n\n### \n\n OAuth 2.0 \n\n![](http://img.mrsingsing.com/authentication-authorization-code-grant.jpg)\n\n\n\n1. Client Side+\n2. Server Side\n3. Check Access Token' + \n\n Token Token \n\n> \n>\n> -  IDclient_idclient_secret\n> -  `scope``state`  Spring Security OAuth2 \n\n**Client Server **\n\n\n\n1.  `client_id + client_secret + grant_type+ redirect_uri`  URL \n2.  ``\n3. `` \n4.  ``\n\n**Server Side  Token**\n\n1.  ` + client_id + client_secret`  Token \n2.  Token \n3.  Token \n\n**Check Access Token  Token **\n\n1.  Token\n2.  Token  Token\n3. \n\n OAuth2.0  OAuth2.0  AppID  AppSecret\n\n```\n1.  code \n2.  code  AppId  AppSecret  API  access_token\n3.  access_token \n```\n\n![ OAuth2.0  access_token ](http://img.mrsingsing.com/authentication-wx-oauth2-access-token.png)\n\n [ - ](https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Development_Guide.html)\n\n### \n\n![](http://img.mrsingsing.com/authentication-implicit-grant.jpg)\n\n\n\n1. Client Side+\n2. Check Access Token + \n\n Token Token \n\n**Client Side  Token**\n\n1.  `client_id + grant_type+ redirect_url`  URL \n2. \n3. \n4.  ``  Token \n\n**Check Access Token  Token **\n\n1.  Token \n2.  Token  Token\n3. \n\n### \n\n![](http://img.mrsingsing.com/authentication-resource-owner-password-credentials-grant.jpg)\n\n\n\n1. Client Side\n2. Check Access Token' + \n\n Token Token \n\n**Client Server  Token**\n\n1. \n2.  `client_id + client_secret`  Token \n3. `client_id`  `client_secret` Token \n4.  Token\n\n**Check Access Token  Token **\n\n1.  Token\n2.  Token  Token\n3. \n\n### \n\n![](http://img.mrsingsing.com/authentication-client-credentials-grant.jpg)\n\n\n\n1. Server Side\n2. Check Access Token'\n\n Token Token \n\n**Client Server  Token**\n\n1.  `client_id + client_secret + `  Token \n2.  Token \n3.  Token\n\n**Check Access Token  Token **\n\n1.  Token\n2.  Token  Token\n3. \n\n### \n\n\n\n- \n- \n\n\n\n|                               |  |  |  |  |\n| :-------------------------------- | :------- | :------- | :----------- | :------------- |\n|  Authorization Code     |         |         |             |               |\n|  Implicit Grant       |         |         |             |               |\n|  Password Grant       |         |         |             |               |\n|  Client Credentials |         |         |             |               |\n\n\n\n![OAuth2.0 ](http://img.mrsingsing.com/authentication-oauth2-mode-selection.jpg)\n\n## \n\n OAuth2.0 \n\n APP  H5  APP  H5  APP  H5 \n\n H5  Token  URL  H5 \n\n## \n\n **\\*-  **\\*\\*\n\n APP  PC \n\n![](http://img.mrsingsing.com/authentication-scan-qrcode-login-workflow.jpg)\n\n\n\n### \n\n**** 1~5  PC \n\n PC  `UUID`  ID UUID  `PC `  Redis  PC \n\n PC  ID  ID  ``  PC  WebSocket /\n\n### \n\n**** 6~10  PC PC \n\n IDToken ID \n\n `Token  ID` PC  Token Token  Token \n\nPC  PC \n\n### \n\n**** 11~15 ` Token`  PC  ` Token` PC  Token \n\nPC  Token Token \n\n Token PC \n\n## \n\n\n\n\n\n APP  H5  SIM  SDK \n\n\n\n![](http://img.mrsingsing.com/authentication-one-click-login-workflow.png)\n\n\n\n1. SDK  SDK  AppKey  AppSecret\n2.  SDK SDK \n3. SDK  Token Token \n4.  Token  Token \n\n SDK\n\n- [ - ](https://help.aliyun.com/product/75010.html)\n- [ - ](http://shanyan.253.com/)\n- [ - ](https://www.jiguang.cn/identify)\n- [mob - ](https://www.mob.com/mobService/secverify)\n\n SIM \n\n## \n\nIdentificationAuthorizationAuthentication\n\n- Authorization \n- Authentication \n\n```\n ->  -> \n```\n\n Linux \n\n---\n\n****\n\n- [ WikipediaBasic Access Authentication](https://en.wikipedia.org/wiki/Basic_access_authentication)\n- [ HTTP  Authentication](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication)\n- [ RFC 7019 - JSON Web TokenJWT](https://tools.ietf.org/html/rfc7519)\n- [ CAS ](https://apereo.github.io/cas/4.2.x/index.html)\n- [  HTTP Basic ](https://juejin.im/entry/5ac175baf265da239e4e3999)\n- [  JWT  Session](https://zhuanlan.zhihu.com/p/43527568)\n- [  JWT  Session ](https://juejin.im/post/5cefad23e51d4510774a87f4#heading-4)\n- [ JWT ](https://zhuanlan.zhihu.com/p/85873228)\n- [  SSO  CAS ](https://juejin.im/post/5a002b536fb9a045132a1727)\n- [  SSO](https://juejin.im/post/5b51f39b5188251a9f24a264)\n- [ ](https://zhuanlan.zhihu.com/p/102898335)\n- [ ](https://zhuanlan.zhihu.com/p/60376970)\n- [ ](https://www.cnblogs.com/ywlaker/p/6113927.html)\n- [  LDAP ](https://zhuanlan.zhihu.com/p/92263756)\n- [ ](https://www.zhihu.com/question/21387523)\n- [ OAuth2.0 ](https://juejin.im/entry/5a93506e6fb9a0634c268da8)\n- [ OAuth 2.0 ](https://www.cnblogs.com/hellxz/p/oauth2_process.html)\n- [  H5  APP ](https://juejin.im/post/5d15d3336fb9a07efb69994f)\n- [ ](https://juejin.im/post/5e83e716e51d4546c27bb559)\n- [ ](https://mp.weixin.qq.com/s/gA0JQp4j2ym9qOyQkC3qkA)\n- [ ](https://juejin.im/post/5d197adff265da1bb31c4fa9)\n- [ ](https://learnku.com/articles/30704)\n- [ ](http://www.hyhblog.cn/2018/04/25/user_login_auth_terms/)\n","source":"_posts/authentication.md","raw":"---\ntitle: \ndate: '2020-06-25'\n---\n\n SSO \n\nAuthentication\n\n\n\n Web \n\n<!-- more -->\n\n\n\n- HTTP \n- Session-Cookie \n  - koa-session\n- Token \n  - JWT \n  - koa-jwt\n- OAuth2 \n- SSO \n- LDAP \n- \n- \n- \n- \n\n## HTTP \n\n HTTP Basic Access Authentication HTTP \n\n\n\n1. `uid` ID\n2. `password`\n3. `realm`\n\nHTTP  Authorization `Authorization: Basic <>` ``  ``  **Base64 **\n\n```\nGET /securefiles/ HTTP/1.1\nHost: www.example.com\nAuthorization: Basic aHR0cHdhdGNoOmY=\n```\n\n![HTTP ](http://img.mrsingsing.com/authentication-http-basic-access-authentication.jpg)\n\n1. \n2.  401 UnauthorizedAccess Authentication`WWW-Authenticate`  `WWW-Authenticate: Basic realm=\"Secure Area\"``Basic`  `realm=\"Secure Area\"`  URI \n3. \n4.  `Authorization` \n\n-  `:` \n-  `WWW-Authenticate` \n-  Base64\n-  `Basic` `Authorization`  `admin` `password` `admin:password` Base64  `YWRtaW46cGFzc3dvcmQ=` HTTP `Authorization: Basic YWRtaW46cGFzc3dvcmQ=`\n\n```js\nBuffer.from('admin:password').toString('base64');\n// YWRtaW46cGFzc3dvcmQ=\n```\n\n5.  401 \n\n\n\n1.  `realm`\n2.  Authorization \n3.  `realm` \n4. \n\n> \n\n\n\n- \n\n\n\n- \n- Base64  HTTP \n- \n- Basic \n\n> HTTP  HTTPS / TLS \n\n\n\n## Session-Cookie \n\n`Session-Cookie`  Session Cookie \n\n HTTP  Session  Session \n\nCookie \n\n- \n- \n- \n\n Session-Cookie \n\n![Session-Cookie ](http://img.mrsingsing.com/authentication-session-cookie.jpg)\n\n1.  Session Session  Redis  Session  `session_id` `sid` `Set-Cookie` \n2.  `sid`  `secret` \n3.  `sid`  Cookie  HTTP  Cookie \n4.  Cookie  `sid` `sid`  `sid`\n5.  ID\n\n>   ``  Cookie  APP  Cookie /\n\n\n\n1. Cookie Cookie \n2. Session  JWT  Session \n\n\n\n1. Cookie  CSRF \n2. Session \n3. \n\n### koa-session\n\n Koa  `koa-session2`  Session-Cookie \n\n Redis  NoSQL \n\n`koa-session2`  `koa-session2`  Redis  Session-Cookie \n\n```js\nconst Redis = require('ioredis');\nconst { Store } = require('koa-session2');\n\nclass RedisStore extends Store {\n  constructor() {\n    super();\n    //  Redis\n    this.redis = new Redis();\n  }\n\n  //  sid \n  async get(sid, ctx) {\n    let data = await this.redis.get(`SESSION: ${sid}`);\n    return JSON.parse(data);\n  }\n\n  //  sid \n  async set(session, { sid = this.getID(24), maxAge = 1000000 } = {}, ctx) {\n    try {\n      await this.redis.set(`SESSION: ${sid}`, JSON.stringfy(session));\n    } catch (e) {}\n\n    return sid;\n  }\n\n  // \n  async destroy(sid, ctx) {\n    return await this.redis.del(`SESSION: ${sid}`);\n  }\n}\n\nmodule.exports = RedisStore;\n```\n\n```js\n// app.js\nconst Koa = require('koa');\nconst session = require('koa-session2');\nconst Store = require('./Store.js');\n\nconst app = new Koa();\n\napp.use(\n  session({\n    //  Cookie \n    key: 'SESSIONID',\n    //  JS  Cookie\n    httpOnly: true,\n    // Cookie \n    signed: true,\n    store: new Store(),\n  })\n);\n\napp.use(ctx => {\n  // Ignore favicon.ico\n  if (ctx.path === '/favicon.ico') return;\n\n  let user = this.session.user;\n\n  ctx.session.view = 'index';\n});\n\napp.use(ctx => {\n  // \n  ctx.session.refresh();\n});\n```\n\n `koa-session`  Cookie  IP  ID \n\nKoa  Cookie  `signed`  `true`  Cookie  SHA256  `koa:sess=pjadZtLAVtiO6-Haw1vnZZWrRm8` Cookie \n\n Session `koa-session` \n\n```js\nconst encode = json => CrytoJS.AES.encrypt(json, 'Secret Passphrase');\n\nconst decode = encrypted => CryptoJS.AES.decrypt(encrypted, 'Secret Passphrase');\n```\n\n`koa-session`  Koa \n\n `koa-session2`  Github \n\n- [koa-session](https://github.com/koajs/session)\n- [koa-session2](https://github.com/Secbone/koa-session2)\n- [koa-session ](https://segmentfault.com/a/1190000013039187)\n- [koa-session ](https://www.jianshu.com/p/c1eff1b50d23)\n- [ koa-session  session ](https://juejin.im/post/5c148fd551882530544f341f)\n- [ koa-session  cookie  session](https://segmentfault.com/a/1190000012412299)\n\n## Token \n\n Restful API Token Token  Session-Cookie  Session ID Token  `` Token  TwitterQQGithub  API  OpenStackKubernetes  API  Token \n\n![Token ](http://img.mrsingsing.com/authentication-token-authencation.jpg)\n\n Token \n\n1. \n2. \n3.  `` Token Token \n4.  Token  localStorage  sessionStorage  Cookie \n5.  Token  HTTP  Authorization \n6.  Token\n\n\n\n- ****Token Session Token \n- **** Token \n- \n-  Cookie  Token \n-  CSRF  Cookie XSS  Token  `httpOnly`  Cookie  JS  Cookie \n\n\n\n-  `sid` \n-  Session-Cookie Token  Token  Token  SessionCookie \n\n> Session-Cookie  Token \n\nSession-Cookie  Token  Token  Session-Cookie \n\nSession-Cookie  `sid`  `sid`  Session  Session-Cookie  Cookie  NativeAPP  Cookie \n\n Token  ``  Cookie Web Storage Session-Cookie  Token \n\nToken  JWT  Token \n\n### JWT \n\nJWTJSON Web Token Auth0  JSON  JSON  Token token \n\nJWT  JSON \n\n```\nJSON Data + Signature = JWT\n```\n\nJWT \n\n1. Headerstypalg\n\n JWT \n\n```json\n{\n  \"alg\": \"HS256\",\n  \"typ\": \"JWT\"\n}\n```\n\n JWT HS256 \n\n2. Claims\n\n\n\n```json\n{\n  \"iss\": \"Jehoshaphat Tse\",\n  \"iat\": 1441593502,\n  \"exp\": 1441594722,\n  \"aud\": \"www.example.com\",\n  \"sub\": \"mrsingsing@example.com\",\n  \"name\": \"John Doe\",\n  \"admin\": true\n}\n```\n\n JWT :\n\n- `iss` JWT \n- `sub` JWT \n- `aud` JWT \n- `exp`expires Unix \n- `iat`issued at Base64 \n\n3. Signature\n\n `alg` HS256Secret JWTHeader  Claims  Signature  JWT \n\n```js\nHMACSHA256(base64UrlEncode(Headers) + '.' + base64UrlEncode(Claims), SECREATE_KEY);\n```\n\n\n\n1. RESTful API  Session \n2. JWT  JWT\n\n\n\n1. **** Session  Token Token  JWT  JWT  JWT \n2. **** JWT  Claims  Base64  JWT \n3. ****JWT Cookie  4k JWT  LocalStorage  HTTP  JWT  Header HTTP  Header  Body \n\n### koa-jwt\n\n Koa  `koa-jwt`  Token \n\n Token\n\n```js\nconst router = require('koa-router')();\nconst jwt = require('koa-jwt');\n//  MongoDB \nconst userModel = require('../model/userModel');\n\nconst secretOrPublicKey = 'TOKEN_EXAMPLE';\n\nrouter.post('/login', async ctx => {\n  const data = ctx.request.body;\n\n  // \n  const userInfo = await userModel.findOne({ name: data.name, password: data.password });\n\n  let result = null;\n  if (userInfo !== null) {\n    //  Token 2h\n    const token = jwt.sign({ name: userInfo.name, _id: userInfo._id }, secretOrPublicKey, {\n      expiresIn: '2h',\n    });\n\n    result = {\n      code: 200,\n      token: token,\n      msg: '',\n    };\n  } else {\n    result = {\n      code: 400,\n      token: null,\n      msg: '',\n    };\n  }\n\n  return (ctx.body = result);\n});\n```\n\n Token\n\n```js\n// \nfunction login(userName, password) {\n  return axios\n    .post('/login', {\n      name: userName,\n      password: password,\n    })\n    .then(res => {\n      if (res.code === 200) {\n        localStorage.setItem('access_token', res.data.token);\n      } else {\n        console.log('');\n      }\n    })\n    .catch(e => console.error(e));\n}\n\n//  Token  API \n//  Axios  Authorization \naxios.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n\n  config.headers.common['Authorization'] = 'Bearer ' + token;\n\n  return config;\n});\n```\n\n\n\n```js\nconst koa = require('koa');\nconst jwt = require('koa-jwt');\nconst app = new Koa();\nconst secretOrPublicKey = 'TOKEN_EXAMPLE';\n\napp\n  .use(\n    jwt({\n      secret: secretOrPublicKey,\n    })\n  )\n  .unless({\n    path: [/\\register/, /\\/login/],\n  });\n```\n\n `koa-jwt`  Token  Authorization\n\n-  `token`  Authorization Token  Bearer \n-  Token  401 \n\n `verify.js`  `jsonwebtoken`  `verify()` \n\n[jsonwebtoken](https://github.com/auth0/node-jsonwebtoken)  `sign()`  `token` `verify()`  `token` JWT  `koa-jwt`  `jsonwebtoken`  `verify()`  `token` `koa-jwt`  `index.js` `koa-jwt`  `koa-unless` \n\n- [Koa2  JWT ](http://www.uxys.com/html/JavaScript/20190722/52733.html)\n\n### Token \n\n#### \n\n Token \n\n- \n- \n- \n- /\n- \n\n Token  Session-Cookie  Session  Token  Token \n\n\n\n- ** Token ** Token  Redis  Token  Redis  Token  Token  DB  Token  JWT \n- **** Token  Token  Token  Token \n- ** Secret** Token \n  -  Token  Session \n  - \n- ****\n  - \n\n#### \n\nToken \n\nToken  Token  `` Token \n\n Session-Cookie  Session  30  30  Session  30 \n\n- ** Session ** Token  Token \n- ** Token**\n- **Token **\n- ** Token** `accessToken` `refreshToken` 1  `accessToken`  `refreshToken`  `accessToken`  `accessToken`  `refreshToken`  `accessToken` \n  - \n  -  Token \n  -  Token  Token  `accessToken`  `refreshToken`  `accessToken`\n\nJWT  Token  Token  Session-Cookie \n\n## \n\n****Single Sign-on SSO\n\n All-in-one  Session \n\n Session  SessionIDTomcat  `JSESSIONID` SessionID \n\n Redis  Token  Redis  SSO  Redis  `` \n\n SSO \n\n###  SSO\n\n A `a.abc.com`  B `b.abc.com`  SSO \n\n1.  `a.abc.com` SSO \n2.  Session  `Set-Cookie` \n3.  B  A  B  `abc.com` Cookie Cookie \n\n Session-Cookie \n\n###  SSO\n\n SSO \n\n**CAS**Central Authentication Service 1.0  2.0 1.0 2.0  Web \n\nCAS \n\n- Client\n- Server SSO \n- Service A / B\n\nCAS \n\n- `/login`\n- `/logout`\n- `/validate`\n- `/serviceValidate` Service \n\nCAS \n\n- **TGTTicket Grangting Ticket**TGT  CAS  `` TGT CAS TGT  Cookie  Cookie  HTTP CAS  Cookie TGC `key`  TGT\n- **TGCTicket Granting Cookie**CAS Service  TGC  Session  TGC  Session SessionID Cookie  CAS Service \n- **STService Ticket**ST  CAS  Service  Service Service  ST CAS  ST CAS  ST CAS  TGT ST ST  ServiceService  ST  CAS \n\n TGC  TGT  `key-value`  ST \n\n\n\n![CAS ](http://img.mrsingsing.com/authentication-cas-workflow.png)\n\n1.  A  `a.abc.com` A  ``  302 SSO  A  `sso.abc.com/login?service=https%3A%2F%2Fwww.a.abc.com`\n2.  SSO TGC SSO  ``  SSO  SSO \n3. SSO  SSO  `` ``STSSO  A \n\n-  `query`  A \n-  `query`  SSO  ST\n-  HTTP  Cookie  Header Cookie  SSO  TGC\n\n5.  A  URL  SSO  ST\n6.  A  ST  SSO SSO  A  SSO  A  ``\n7.  B  `b.abc.com` B  ``  SSO  ST ST \n8. SSO  B \n9.  B  SSO SSO  B\n10.  B \n\n CAS  CAS Server  ST  ST  Hacker  Client  ST Hacker  ST ST  IPSessionID \n\n### LDAP \n\nLDAP  Lightweight Directory Access Protocol****IEFTRFC \\*_ LDAP_-  JiraConfluenceOpenVPN  LDAP  LDAP  SSO\n\n- \n  - \n  - \n  - \n  - \n- \n  - \n  -  LDAP  LDAP BIND \n  - \n\n## \n\n\n\n1.  \\*__- \n2.  \\*__- \n\nQQ \n\n\n\n OAuth OAuth OAuth \n\n## OAuth2 \n\nOAuth ``  `` OAuth QQ\n\nOAuth  1.0  2.0 2.0 \n\n\n\n\n\n- Authorization Code Grant\n- Implicit Grant\n- Resource Owner Password Credentials Grant\n- Client Credentials Grant\n\n`````` ``\n\n- Resource Owner\n- Third-party Application Web App Web \n- Authorization Server\n- Resource Server\n\n### \n\n OAuth 2.0 \n\n![](http://img.mrsingsing.com/authentication-authorization-code-grant.jpg)\n\n\n\n1. Client Side+\n2. Server Side\n3. Check Access Token' + \n\n Token Token \n\n> \n>\n> -  IDclient_idclient_secret\n> -  `scope``state`  Spring Security OAuth2 \n\n**Client Server **\n\n\n\n1.  `client_id + client_secret + grant_type+ redirect_uri`  URL \n2.  ``\n3. `` \n4.  ``\n\n**Server Side  Token**\n\n1.  ` + client_id + client_secret`  Token \n2.  Token \n3.  Token \n\n**Check Access Token  Token **\n\n1.  Token\n2.  Token  Token\n3. \n\n OAuth2.0  OAuth2.0  AppID  AppSecret\n\n```\n1.  code \n2.  code  AppId  AppSecret  API  access_token\n3.  access_token \n```\n\n![ OAuth2.0  access_token ](http://img.mrsingsing.com/authentication-wx-oauth2-access-token.png)\n\n [ - ](https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Development_Guide.html)\n\n### \n\n![](http://img.mrsingsing.com/authentication-implicit-grant.jpg)\n\n\n\n1. Client Side+\n2. Check Access Token + \n\n Token Token \n\n**Client Side  Token**\n\n1.  `client_id + grant_type+ redirect_url`  URL \n2. \n3. \n4.  ``  Token \n\n**Check Access Token  Token **\n\n1.  Token \n2.  Token  Token\n3. \n\n### \n\n![](http://img.mrsingsing.com/authentication-resource-owner-password-credentials-grant.jpg)\n\n\n\n1. Client Side\n2. Check Access Token' + \n\n Token Token \n\n**Client Server  Token**\n\n1. \n2.  `client_id + client_secret`  Token \n3. `client_id`  `client_secret` Token \n4.  Token\n\n**Check Access Token  Token **\n\n1.  Token\n2.  Token  Token\n3. \n\n### \n\n![](http://img.mrsingsing.com/authentication-client-credentials-grant.jpg)\n\n\n\n1. Server Side\n2. Check Access Token'\n\n Token Token \n\n**Client Server  Token**\n\n1.  `client_id + client_secret + `  Token \n2.  Token \n3.  Token\n\n**Check Access Token  Token **\n\n1.  Token\n2.  Token  Token\n3. \n\n### \n\n\n\n- \n- \n\n\n\n|                               |  |  |  |  |\n| :-------------------------------- | :------- | :------- | :----------- | :------------- |\n|  Authorization Code     |         |         |             |               |\n|  Implicit Grant       |         |         |             |               |\n|  Password Grant       |         |         |             |               |\n|  Client Credentials |         |         |             |               |\n\n\n\n![OAuth2.0 ](http://img.mrsingsing.com/authentication-oauth2-mode-selection.jpg)\n\n## \n\n OAuth2.0 \n\n APP  H5  APP  H5  APP  H5 \n\n H5  Token  URL  H5 \n\n## \n\n **\\*-  **\\*\\*\n\n APP  PC \n\n![](http://img.mrsingsing.com/authentication-scan-qrcode-login-workflow.jpg)\n\n\n\n### \n\n**** 1~5  PC \n\n PC  `UUID`  ID UUID  `PC `  Redis  PC \n\n PC  ID  ID  ``  PC  WebSocket /\n\n### \n\n**** 6~10  PC PC \n\n IDToken ID \n\n `Token  ID` PC  Token Token  Token \n\nPC  PC \n\n### \n\n**** 11~15 ` Token`  PC  ` Token` PC  Token \n\nPC  Token Token \n\n Token PC \n\n## \n\n\n\n\n\n APP  H5  SIM  SDK \n\n\n\n![](http://img.mrsingsing.com/authentication-one-click-login-workflow.png)\n\n\n\n1. SDK  SDK  AppKey  AppSecret\n2.  SDK SDK \n3. SDK  Token Token \n4.  Token  Token \n\n SDK\n\n- [ - ](https://help.aliyun.com/product/75010.html)\n- [ - ](http://shanyan.253.com/)\n- [ - ](https://www.jiguang.cn/identify)\n- [mob - ](https://www.mob.com/mobService/secverify)\n\n SIM \n\n## \n\nIdentificationAuthorizationAuthentication\n\n- Authorization \n- Authentication \n\n```\n ->  -> \n```\n\n Linux \n\n---\n\n****\n\n- [ WikipediaBasic Access Authentication](https://en.wikipedia.org/wiki/Basic_access_authentication)\n- [ HTTP  Authentication](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication)\n- [ RFC 7019 - JSON Web TokenJWT](https://tools.ietf.org/html/rfc7519)\n- [ CAS ](https://apereo.github.io/cas/4.2.x/index.html)\n- [  HTTP Basic ](https://juejin.im/entry/5ac175baf265da239e4e3999)\n- [  JWT  Session](https://zhuanlan.zhihu.com/p/43527568)\n- [  JWT  Session ](https://juejin.im/post/5cefad23e51d4510774a87f4#heading-4)\n- [ JWT ](https://zhuanlan.zhihu.com/p/85873228)\n- [  SSO  CAS ](https://juejin.im/post/5a002b536fb9a045132a1727)\n- [  SSO](https://juejin.im/post/5b51f39b5188251a9f24a264)\n- [ ](https://zhuanlan.zhihu.com/p/102898335)\n- [ ](https://zhuanlan.zhihu.com/p/60376970)\n- [ ](https://www.cnblogs.com/ywlaker/p/6113927.html)\n- [  LDAP ](https://zhuanlan.zhihu.com/p/92263756)\n- [ ](https://www.zhihu.com/question/21387523)\n- [ OAuth2.0 ](https://juejin.im/entry/5a93506e6fb9a0634c268da8)\n- [ OAuth 2.0 ](https://www.cnblogs.com/hellxz/p/oauth2_process.html)\n- [  H5  APP ](https://juejin.im/post/5d15d3336fb9a07efb69994f)\n- [ ](https://juejin.im/post/5e83e716e51d4546c27bb559)\n- [ ](https://mp.weixin.qq.com/s/gA0JQp4j2ym9qOyQkC3qkA)\n- [ ](https://juejin.im/post/5d197adff265da1bb31c4fa9)\n- [ ](https://learnku.com/articles/30704)\n- [ ](http://www.hyhblog.cn/2018/04/25/user_login_auth_terms/)\n","slug":"authentication","published":1,"updated":"2021-08-18T03:27:22.377Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99z3000bv31pjclouwqx","content":"<p> SSO </p>\n<p>Authentication</p>\n<p></p>\n<p> Web </p>\n<a id=\"more\"></a>\n<p></p>\n<ul>\n<li>HTTP </li>\n<li>Session-Cookie <ul>\n<li>koa-session</li>\n</ul>\n</li>\n<li>Token <ul>\n<li>JWT </li>\n<li>koa-jwt</li>\n</ul>\n</li>\n<li>OAuth2 </li>\n<li>SSO </li>\n<li>LDAP </li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"HTTP-\"><a href=\"#HTTP-\" class=\"headerlink\" title=\"HTTP \"></a>HTTP </h2><p> HTTP Basic Access Authentication HTTP </p>\n<p></p>\n<ol>\n<li><code>uid</code> ID</li>\n<li><code>password</code></li>\n<li><code>realm</code></li>\n</ol>\n<p>HTTP  Authorization <code>Authorization: Basic &lt;&gt;</code> <code></code>  <code></code>  <strong>Base64 </strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /securefiles/ HTTP/1.1</span><br><span class=\"line\">Host: www.example.com</span><br><span class=\"line\">Authorization: Basic aHR0cHdhdGNoOmY=</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://img.mrsingsing.com/authentication-http-basic-access-authentication.jpg\" alt=\"HTTP \"></p>\n<ol>\n<li></li>\n<li> 401 UnauthorizedAccess Authentication<code>WWW-Authenticate</code>  <code>WWW-Authenticate: Basic realm=&quot;Secure Area&quot;</code><code>Basic</code>  <code>realm=&quot;Secure Area&quot;</code>  URI </li>\n<li></li>\n<li> <code>Authorization</code> </li>\n</ol>\n<ul>\n<li> <code>:</code> </li>\n<li> <code>WWW-Authenticate</code> </li>\n<li> Base64</li>\n<li> <code>Basic</code> <code>Authorization</code>  <code>admin</code> <code>password</code> <code>admin:password</code> Base64  <code>YWRtaW46cGFzc3dvcmQ=</code> HTTP <code>Authorization: Basic YWRtaW46cGFzc3dvcmQ=</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Buffer.from(<span class=\"string\">'admin:password'</span>).toString(<span class=\"string\">'base64'</span>);</span><br><span class=\"line\"><span class=\"comment\">// YWRtaW46cGFzc3dvcmQ=</span></span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li> 401 </li>\n</ol>\n<p></p>\n<ol>\n<li> <code>realm</code></li>\n<li> Authorization </li>\n<li> <code>realm</code> </li>\n<li></li>\n</ol>\n<blockquote>\n<p></p>\n</blockquote>\n<p></p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li></li>\n<li>Base64  HTTP </li>\n<li></li>\n<li>Basic </li>\n</ul>\n<blockquote>\n<p>HTTP  HTTPS / TLS </p>\n</blockquote>\n<p></p>\n<h2 id=\"Session-Cookie-\"><a href=\"#Session-Cookie-\" class=\"headerlink\" title=\"Session-Cookie \"></a>Session-Cookie </h2><p><code>Session-Cookie</code>  Session Cookie </p>\n<p> HTTP  Session  Session </p>\n<p>Cookie </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> Session-Cookie </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-session-cookie.jpg\" alt=\"Session-Cookie \"></p>\n<ol>\n<li> Session Session  Redis  Session  <code>session_id</code> <code>sid</code> <code>Set-Cookie</code> </li>\n<li> <code>sid</code>  <code>secret</code> </li>\n<li> <code>sid</code>  Cookie  HTTP  Cookie </li>\n<li> Cookie  <code>sid</code> <code>sid</code>  <code>sid</code></li>\n<li> ID</li>\n</ol>\n<blockquote>\n<p>  <code></code>  Cookie  APP  Cookie /</p>\n</blockquote>\n<p></p>\n<ol>\n<li>Cookie Cookie </li>\n<li>Session  JWT  Session </li>\n</ol>\n<p></p>\n<ol>\n<li>Cookie  CSRF </li>\n<li>Session </li>\n<li></li>\n</ol>\n<h3 id=\"koa-session\"><a href=\"#koa-session\" class=\"headerlink\" title=\"koa-session\"></a>koa-session</h3><p> Koa  <code>koa-session2</code>  Session-Cookie </p>\n<p> Redis  NoSQL </p>\n<p><code>koa-session2</code>  <code>koa-session2</code>  Redis  Session-Cookie </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Redis = <span class=\"built_in\">require</span>(<span class=\"string\">'ioredis'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; Store &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-session2'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisStore</span> <span class=\"keyword\">extends</span> <span class=\"title\">Store</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>();</span><br><span class=\"line\">    <span class=\"comment\">//  Redis</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.redis = <span class=\"keyword\">new</span> Redis();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  sid </span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"keyword\">get</span>(sid, ctx) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.redis.get(<span class=\"string\">`SESSION: <span class=\"subst\">$&#123;sid&#125;</span>`</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">JSON</span>.parse(data);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  sid </span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"keyword\">set</span>(session, &#123; sid = <span class=\"keyword\">this</span>.getID(<span class=\"number\">24</span>), maxAge = <span class=\"number\">1000000</span> &#125; = &#123;&#125;, ctx) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.redis.set(<span class=\"string\">`SESSION: <span class=\"subst\">$&#123;sid&#125;</span>`</span>, <span class=\"built_in\">JSON</span>.stringfy(session));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> sid;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> destroy(sid, ctx) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.redis.del(<span class=\"string\">`SESSION: <span class=\"subst\">$&#123;sid&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = RedisStore;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// app.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> session = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-session2'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> Store = <span class=\"built_in\">require</span>(<span class=\"string\">'./Store.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa();</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(</span><br><span class=\"line\">  session(&#123;</span><br><span class=\"line\">    <span class=\"comment\">//  Cookie </span></span><br><span class=\"line\">    key: <span class=\"string\">'SESSIONID'</span>,</span><br><span class=\"line\">    <span class=\"comment\">//  JS  Cookie</span></span><br><span class=\"line\">    httpOnly: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// Cookie </span></span><br><span class=\"line\">    signed: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    store: <span class=\"keyword\">new</span> Store(),</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"params\">ctx</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Ignore favicon.ico</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (ctx.path === <span class=\"string\">'/favicon.ico'</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> user = <span class=\"keyword\">this</span>.session.user;</span><br><span class=\"line\"></span><br><span class=\"line\">  ctx.session.view = <span class=\"string\">'index'</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"params\">ctx</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  ctx.session.refresh();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p> <code>koa-session</code>  Cookie  IP  ID </p>\n<p>Koa  Cookie  <code>signed</code>  <code>true</code>  Cookie  SHA256  <code>koa:sess=pjadZtLAVtiO6-Haw1vnZZWrRm8</code> Cookie </p>\n<p> Session <code>koa-session</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> encode = <span class=\"function\"><span class=\"params\">json</span> =&gt;</span> CrytoJS.AES.encrypt(json, <span class=\"string\">'Secret Passphrase'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> decode = <span class=\"function\"><span class=\"params\">encrypted</span> =&gt;</span> CryptoJS.AES.decrypt(encrypted, <span class=\"string\">'Secret Passphrase'</span>);</span><br></pre></td></tr></table></figure>\n<p><code>koa-session</code>  Koa </p>\n<p> <code>koa-session2</code>  Github </p>\n<ul>\n<li><a href=\"https://github.com/koajs/session\" target=\"_blank\" rel=\"noopener\">koa-session</a></li>\n<li><a href=\"https://github.com/Secbone/koa-session2\" target=\"_blank\" rel=\"noopener\">koa-session2</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000013039187\" target=\"_blank\" rel=\"noopener\">koa-session </a></li>\n<li><a href=\"https://www.jianshu.com/p/c1eff1b50d23\" target=\"_blank\" rel=\"noopener\">koa-session </a></li>\n<li><a href=\"https://juejin.im/post/5c148fd551882530544f341f\" target=\"_blank\" rel=\"noopener\"> koa-session  session </a></li>\n<li><a href=\"https://segmentfault.com/a/1190000012412299\" target=\"_blank\" rel=\"noopener\"> koa-session  cookie  session</a></li>\n</ul>\n<h2 id=\"Token-\"><a href=\"#Token-\" class=\"headerlink\" title=\"Token \"></a>Token </h2><p> Restful API Token Token  Session-Cookie  Session ID Token  <code></code> Token  TwitterQQGithub  API  OpenStackKubernetes  API  Token </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-token-authencation.jpg\" alt=\"Token \"></p>\n<p> Token </p>\n<ol>\n<li></li>\n<li></li>\n<li> <code></code> Token Token </li>\n<li> Token  localStorage  sessionStorage  Cookie </li>\n<li> Token  HTTP  Authorization </li>\n<li> Token</li>\n</ol>\n<p></p>\n<ul>\n<li><strong></strong>Token Session Token </li>\n<li><strong></strong> Token </li>\n<li></li>\n<li> Cookie  Token </li>\n<li> CSRF  Cookie XSS  Token  <code>httpOnly</code>  Cookie  JS  Cookie </li>\n</ul>\n<p></p>\n<ul>\n<li> <code>sid</code> </li>\n<li> Session-Cookie Token  Token  Token  SessionCookie </li>\n</ul>\n<blockquote>\n<p>Session-Cookie  Token </p>\n</blockquote>\n<p>Session-Cookie  Token  Token  Session-Cookie </p>\n<p>Session-Cookie  <code>sid</code>  <code>sid</code>  Session  Session-Cookie  Cookie  NativeAPP  Cookie </p>\n<p> Token  <code></code>  Cookie Web Storage Session-Cookie  Token </p>\n<p>Token  JWT  Token </p>\n<h3 id=\"JWT-\"><a href=\"#JWT-\" class=\"headerlink\" title=\"JWT \"></a>JWT </h3><p>JWTJSON Web Token Auth0  JSON  JSON  Token token </p>\n<p>JWT  JSON </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JSON Data + Signature = JWT</span><br></pre></td></tr></table></figure>\n<p>JWT </p>\n<ol>\n<li>Headerstypalg</li>\n</ol>\n<p> JWT </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"alg\"</span>: <span class=\"string\">\"HS256\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"typ\"</span>: <span class=\"string\">\"JWT\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> JWT HS256 </p>\n<ol start=\"2\">\n<li>Claims</li>\n</ol>\n<p></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"iss\"</span>: <span class=\"string\">\"Jehoshaphat Tse\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"iat\"</span>: <span class=\"number\">1441593502</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"exp\"</span>: <span class=\"number\">1441594722</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"aud\"</span>: <span class=\"string\">\"www.example.com\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"sub\"</span>: <span class=\"string\">\"mrsingsing@example.com\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"John Doe\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"admin\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> JWT :</p>\n<ul>\n<li><code>iss</code> JWT </li>\n<li><code>sub</code> JWT </li>\n<li><code>aud</code> JWT </li>\n<li><code>exp</code>expires Unix </li>\n<li><code>iat</code>issued at Base64 </li>\n</ul>\n<ol start=\"3\">\n<li>Signature</li>\n</ol>\n<p> <code>alg</code> HS256Secret JWTHeader  Claims  Signature  JWT </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HMACSHA256(base64UrlEncode(Headers) + <span class=\"string\">'.'</span> + base64UrlEncode(Claims), SECREATE_KEY);</span><br></pre></td></tr></table></figure>\n<p></p>\n<ol>\n<li>RESTful API  Session </li>\n<li>JWT  JWT</li>\n</ol>\n<p></p>\n<ol>\n<li><strong></strong> Session  Token Token  JWT  JWT  JWT </li>\n<li><strong></strong> JWT  Claims  Base64  JWT </li>\n<li><strong></strong>JWT Cookie  4k JWT  LocalStorage  HTTP  JWT  Header HTTP  Header  Body </li>\n</ol>\n<h3 id=\"koa-jwt\"><a href=\"#koa-jwt\" class=\"headerlink\" title=\"koa-jwt\"></a>koa-jwt</h3><p> Koa  <code>koa-jwt</code>  Token </p>\n<p> Token</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)();</span><br><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-jwt'</span>);</span><br><span class=\"line\"><span class=\"comment\">//  MongoDB </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> userModel = <span class=\"built_in\">require</span>(<span class=\"string\">'../model/userModel'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> secretOrPublicKey = <span class=\"string\">'TOKEN_EXAMPLE'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">'/login'</span>, <span class=\"keyword\">async</span> ctx =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> data = ctx.request.body;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> userInfo = <span class=\"keyword\">await</span> userModel.findOne(&#123; <span class=\"attr\">name</span>: data.name, <span class=\"attr\">password</span>: data.password &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (userInfo !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//  Token 2h</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = jwt.sign(&#123; <span class=\"attr\">name</span>: userInfo.name, <span class=\"attr\">_id</span>: userInfo._id &#125;, secretOrPublicKey, &#123;</span><br><span class=\"line\">      expiresIn: <span class=\"string\">'2h'</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    result = &#123;</span><br><span class=\"line\">      code: <span class=\"number\">200</span>,</span><br><span class=\"line\">      token: token,</span><br><span class=\"line\">      msg: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    result = &#123;</span><br><span class=\"line\">      code: <span class=\"number\">400</span>,</span><br><span class=\"line\">      token: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      msg: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (ctx.body = result);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p> Token</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span>(<span class=\"params\">userName, password</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> axios</span><br><span class=\"line\">    .post(<span class=\"string\">'/login'</span>, &#123;</span><br><span class=\"line\">      name: userName,</span><br><span class=\"line\">      password: password,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (res.code === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">        localStorage.setItem(<span class=\"string\">'access_token'</span>, res.data.token);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">''</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"params\">e</span> =&gt;</span> <span class=\"built_in\">console</span>.error(e));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  Token  API </span></span><br><span class=\"line\"><span class=\"comment\">//  Axios  Authorization </span></span><br><span class=\"line\">axios.interceptors.request.use(<span class=\"function\"><span class=\"params\">config</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> token = localStorage.getItem(<span class=\"string\">'token'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  config.headers.common[<span class=\"string\">'Authorization'</span>] = <span class=\"string\">'Bearer '</span> + token;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-jwt'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa();</span><br><span class=\"line\"><span class=\"keyword\">const</span> secretOrPublicKey = <span class=\"string\">'TOKEN_EXAMPLE'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">app</span><br><span class=\"line\">  .use(</span><br><span class=\"line\">    jwt(&#123;</span><br><span class=\"line\">      secret: secretOrPublicKey,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">  .unless(&#123;</span><br><span class=\"line\">    path: [<span class=\"regexp\">/\\register/</span>, /\\/login/],</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<p> <code>koa-jwt</code>  Token  Authorization</p>\n<ul>\n<li> <code>token</code>  Authorization Token  Bearer </li>\n<li> Token  401 </li>\n</ul>\n<p> <code>verify.js</code>  <code>jsonwebtoken</code>  <code>verify()</code> </p>\n<p><a href=\"https://github.com/auth0/node-jsonwebtoken\" target=\"_blank\" rel=\"noopener\">jsonwebtoken</a>  <code>sign()</code>  <code>token</code> <code>verify()</code>  <code>token</code> JWT  <code>koa-jwt</code>  <code>jsonwebtoken</code>  <code>verify()</code>  <code>token</code> <code>koa-jwt</code>  <code>index.js</code> <code>koa-jwt</code>  <code>koa-unless</code> </p>\n<ul>\n<li><a href=\"http://www.uxys.com/html/JavaScript/20190722/52733.html\" target=\"_blank\" rel=\"noopener\">Koa2  JWT </a></li>\n</ul>\n<h3 id=\"Token-\"><a href=\"#Token-\" class=\"headerlink\" title=\"Token \"></a>Token </h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Token </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>/</li>\n<li></li>\n</ul>\n<p> Token  Session-Cookie  Session  Token  Token </p>\n<p></p>\n<ul>\n<li><strong> Token </strong> Token  Redis  Token  Redis  Token  Token  DB  Token  JWT </li>\n<li><strong></strong> Token  Token  Token  Token </li>\n<li><strong> Secret</strong> Token <ul>\n<li> Token  Session </li>\n<li></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Token </p>\n<p>Token  Token  <code></code> Token </p>\n<p> Session-Cookie  Session  30  30  Session  30 </p>\n<ul>\n<li><strong> Session </strong> Token  Token </li>\n<li><strong> Token</strong></li>\n<li><strong>Token </strong></li>\n<li><strong> Token</strong> <code>accessToken</code> <code>refreshToken</code> 1  <code>accessToken</code>  <code>refreshToken</code>  <code>accessToken</code>  <code>accessToken</code>  <code>refreshToken</code>  <code>accessToken</code> <ul>\n<li></li>\n<li> Token </li>\n<li> Token  Token  <code>accessToken</code>  <code>refreshToken</code>  <code>accessToken</code></li>\n</ul>\n</li>\n</ul>\n<p>JWT  Token  Token  Session-Cookie </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong>Single Sign-on SSO</p>\n<p> All-in-one  Session </p>\n<p> Session  SessionIDTomcat  <code>JSESSIONID</code> SessionID </p>\n<p> Redis  Token  Redis  SSO  Redis  <code></code> </p>\n<p> SSO </p>\n<h3 id=\"-SSO\"><a href=\"#-SSO\" class=\"headerlink\" title=\" SSO\"></a> SSO</h3><p> A <code>a.abc.com</code>  B <code>b.abc.com</code>  SSO </p>\n<ol>\n<li> <code>a.abc.com</code> SSO </li>\n<li> Session  <code>Set-Cookie</code> </li>\n<li> B  A  B  <code>abc.com</code> Cookie Cookie </li>\n</ol>\n<p> Session-Cookie </p>\n<h3 id=\"-SSO\"><a href=\"#-SSO\" class=\"headerlink\" title=\" SSO\"></a> SSO</h3><p> SSO </p>\n<p><strong>CAS</strong>Central Authentication Service 1.0  2.0 1.0 2.0  Web </p>\n<p>CAS </p>\n<ul>\n<li>Client</li>\n<li>Server SSO </li>\n<li>Service A / B</li>\n</ul>\n<p>CAS </p>\n<ul>\n<li><code>/login</code></li>\n<li><code>/logout</code></li>\n<li><code>/validate</code></li>\n<li><code>/serviceValidate</code> Service </li>\n</ul>\n<p>CAS </p>\n<ul>\n<li><strong>TGTTicket Grangting Ticket</strong>TGT  CAS  <code></code> TGT CAS TGT  Cookie  Cookie  HTTP CAS  Cookie TGC <code>key</code>  TGT</li>\n<li><strong>TGCTicket Granting Cookie</strong>CAS Service  TGC  Session  TGC  Session SessionID Cookie  CAS Service </li>\n<li><strong>STService Ticket</strong>ST  CAS  Service  Service Service  ST CAS  ST CAS  ST CAS  TGT ST ST  ServiceService  ST  CAS </li>\n</ul>\n<p> TGC  TGT  <code>key-value</code>  ST </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-cas-workflow.png\" alt=\"CAS \"></p>\n<ol>\n<li> A  <code>a.abc.com</code> A  <code></code>  302 SSO  A  <code>sso.abc.com/login?service=https%3A%2F%2Fwww.a.abc.com</code></li>\n<li> SSO TGC SSO  <code></code>  SSO  SSO </li>\n<li>SSO  SSO  <code></code> <code></code>STSSO  A </li>\n</ol>\n<ul>\n<li> <code>query</code>  A </li>\n<li> <code>query</code>  SSO  ST</li>\n<li> HTTP  Cookie  Header Cookie  SSO  TGC</li>\n</ul>\n<ol start=\"5\">\n<li> A  URL  SSO  ST</li>\n<li> A  ST  SSO SSO  A  SSO  A  <code></code></li>\n<li> B  <code>b.abc.com</code> B  <code></code>  SSO  ST ST </li>\n<li>SSO  B </li>\n<li> B  SSO SSO  B</li>\n<li> B </li>\n</ol>\n<p> CAS  CAS Server  ST  ST  Hacker  Client  ST Hacker  ST ST  IPSessionID </p>\n<h3 id=\"LDAP-\"><a href=\"#LDAP-\" class=\"headerlink\" title=\"LDAP \"></a>LDAP </h3><p>LDAP  Lightweight Directory Access Protocol<strong></strong>IEFTRFC *<em> LDAP</em>-  JiraConfluenceOpenVPN  LDAP  LDAP  SSO</p>\n<ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li> LDAP  LDAP BIND </li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ol>\n<li> *<em></em>- </li>\n<li> *<em></em>- </li>\n</ol>\n<p>QQ </p>\n<p></p>\n<p> OAuth OAuth OAuth </p>\n<h2 id=\"OAuth2-\"><a href=\"#OAuth2-\" class=\"headerlink\" title=\"OAuth2 \"></a>OAuth2 </h2><p>OAuth <code></code>  <code></code> OAuth QQ</p>\n<p>OAuth  1.0  2.0 2.0 </p>\n<p></p>\n<p></p>\n<ul>\n<li>Authorization Code Grant</li>\n<li>Implicit Grant</li>\n<li>Resource Owner Password Credentials Grant</li>\n<li>Client Credentials Grant</li>\n</ul>\n<p><code></code><code></code><code></code> <code></code></p>\n<ul>\n<li>Resource Owner</li>\n<li>Third-party Application Web App Web </li>\n<li>Authorization Server</li>\n<li>Resource Server</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> OAuth 2.0 </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-authorization-code-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Client Side+</li>\n<li>Server Side</li>\n<li>Check Access Token + </li>\n</ol>\n<p> Token Token </p>\n<blockquote>\n<p></p>\n<ul>\n<li> IDclient_idclient_secret</li>\n<li> <code>scope</code><code>state</code>  Spring Security OAuth2 </li>\n</ul>\n</blockquote>\n<p><strong>Client Server </strong></p>\n<p></p>\n<ol>\n<li> <code>client_id + client_secret + grant_type+ redirect_uri</code>  URL </li>\n<li> <code></code></li>\n<li><code></code> </li>\n<li> <code></code></li>\n</ol>\n<p><strong>Server Side  Token</strong></p>\n<ol>\n<li> <code> + client_id + client_secret</code>  Token </li>\n<li> Token </li>\n<li> Token </li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token</li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<p> OAuth2.0  OAuth2.0  AppID  AppSecret</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.  code </span><br><span class=\"line\">2.  code  AppId  AppSecret  API  access_token</span><br><span class=\"line\">3.  access_token </span><br></pre></td></tr></table></figure>\n<p><img src=\"http://img.mrsingsing.com/authentication-wx-oauth2-access-token.png\" alt=\" OAuth2.0  access_token \"></p>\n<p> <a href=\"https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Development_Guide.html\" target=\"_blank\" rel=\"noopener\"> - </a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/authentication-implicit-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Client Side+</li>\n<li>Check Access Token + </li>\n</ol>\n<p> Token Token </p>\n<p><strong>Client Side  Token</strong></p>\n<ol>\n<li> <code>client_id + grant_type+ redirect_url</code>  URL </li>\n<li></li>\n<li></li>\n<li> <code></code>  Token </li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token </li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/authentication-resource-owner-password-credentials-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Client Side</li>\n<li>Check Access Token + </li>\n</ol>\n<p> Token Token </p>\n<p><strong>Client Server  Token</strong></p>\n<ol>\n<li></li>\n<li> <code>client_id + client_secret</code>  Token </li>\n<li><code>client_id</code>  <code>client_secret</code> Token </li>\n<li> Token</li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token</li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/authentication-client-credentials-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Server Side</li>\n<li>Check Access Token</li>\n</ol>\n<p> Token Token </p>\n<p><strong>Client Server  Token</strong></p>\n<ol>\n<li> <code>client_id + client_secret + </code>  Token </li>\n<li> Token </li>\n<li> Token</li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token</li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"> Authorization Code</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"> Implicit Grant</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"> Password Grant</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"> Client Credentials</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-oauth2-mode-selection.jpg\" alt=\"OAuth2.0 \"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> OAuth2.0 </p>\n<p> APP  H5  APP  H5  APP  H5 </p>\n<p> H5  Token  URL  H5 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <strong>*-  </strong>**</p>\n<p> APP  PC </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-scan-qrcode-login-workflow.jpg\" alt=\"\"></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong> 1~5  PC </p>\n<p> PC  <code>UUID</code>  ID UUID  <code>PC </code>  Redis  PC </p>\n<p> PC  ID  ID  <code></code>  PC  WebSocket /</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong> 6~10  PC PC </p>\n<p> IDToken ID </p>\n<p> <code>Token  ID</code> PC  Token Token  Token </p>\n<p>PC  PC </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong> 11~15 <code> Token</code>  PC  <code> Token</code> PC  Token </p>\n<p>PC  Token Token </p>\n<p> Token PC </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p> APP  H5  SIM  SDK </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-one-click-login-workflow.png\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>SDK  SDK  AppKey  AppSecret</li>\n<li> SDK SDK </li>\n<li>SDK  Token Token </li>\n<li> Token  Token </li>\n</ol>\n<p> SDK</p>\n<ul>\n<li><a href=\"https://help.aliyun.com/product/75010.html\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"http://shanyan.253.com/\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"https://www.jiguang.cn/identify\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"https://www.mob.com/mobService/secverify\" target=\"_blank\" rel=\"noopener\">mob - </a></li>\n</ul>\n<p> SIM </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>IdentificationAuthorizationAuthentication</p>\n<ul>\n<li>Authorization </li>\n<li>Authentication </li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> -&gt;  -&gt; </span><br></pre></td></tr></table></figure>\n<p> Linux </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Basic_access_authentication\" target=\"_blank\" rel=\"noopener\"> WikipediaBasic Access Authentication</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication\" target=\"_blank\" rel=\"noopener\"> HTTP  Authentication</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc7519\" target=\"_blank\" rel=\"noopener\"> RFC 7019 - JSON Web TokenJWT</a></li>\n<li><a href=\"https://apereo.github.io/cas/4.2.x/index.html\" target=\"_blank\" rel=\"noopener\"> CAS </a></li>\n<li><a href=\"https://juejin.im/entry/5ac175baf265da239e4e3999\" target=\"_blank\" rel=\"noopener\">  HTTP Basic </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/43527568\" target=\"_blank\" rel=\"noopener\">  JWT  Session</a></li>\n<li><a href=\"https://juejin.im/post/5cefad23e51d4510774a87f4#heading-4\" target=\"_blank\" rel=\"noopener\">  JWT  Session </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/85873228\" target=\"_blank\" rel=\"noopener\"> JWT </a></li>\n<li><a href=\"https://juejin.im/post/5a002b536fb9a045132a1727\" target=\"_blank\" rel=\"noopener\">  SSO  CAS </a></li>\n<li><a href=\"https://juejin.im/post/5b51f39b5188251a9f24a264\" target=\"_blank\" rel=\"noopener\">  SSO</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/102898335\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/60376970\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://www.cnblogs.com/ywlaker/p/6113927.html\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/92263756\" target=\"_blank\" rel=\"noopener\">  LDAP </a></li>\n<li><a href=\"https://www.zhihu.com/question/21387523\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://juejin.im/entry/5a93506e6fb9a0634c268da8\" target=\"_blank\" rel=\"noopener\"> OAuth2.0 </a></li>\n<li><a href=\"https://www.cnblogs.com/hellxz/p/oauth2_process.html\" target=\"_blank\" rel=\"noopener\"> OAuth 2.0 </a></li>\n<li><a href=\"https://juejin.im/post/5d15d3336fb9a07efb69994f\" target=\"_blank\" rel=\"noopener\">  H5  APP </a></li>\n<li><a href=\"https://juejin.im/post/5e83e716e51d4546c27bb559\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/gA0JQp4j2ym9qOyQkC3qkA\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://juejin.im/post/5d197adff265da1bb31c4fa9\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://learnku.com/articles/30704\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"http://www.hyhblog.cn/2018/04/25/user_login_auth_terms/\" target=\"_blank\" rel=\"noopener\"> </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p> SSO </p>\n<p>Authentication</p>\n<p></p>\n<p> Web </p>","more":"<p></p>\n<ul>\n<li>HTTP </li>\n<li>Session-Cookie <ul>\n<li>koa-session</li>\n</ul>\n</li>\n<li>Token <ul>\n<li>JWT </li>\n<li>koa-jwt</li>\n</ul>\n</li>\n<li>OAuth2 </li>\n<li>SSO </li>\n<li>LDAP </li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"HTTP-\"><a href=\"#HTTP-\" class=\"headerlink\" title=\"HTTP \"></a>HTTP </h2><p> HTTP Basic Access Authentication HTTP </p>\n<p></p>\n<ol>\n<li><code>uid</code> ID</li>\n<li><code>password</code></li>\n<li><code>realm</code></li>\n</ol>\n<p>HTTP  Authorization <code>Authorization: Basic &lt;&gt;</code> <code></code>  <code></code>  <strong>Base64 </strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GET /securefiles/ HTTP/1.1</span><br><span class=\"line\">Host: www.example.com</span><br><span class=\"line\">Authorization: Basic aHR0cHdhdGNoOmY=</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://img.mrsingsing.com/authentication-http-basic-access-authentication.jpg\" alt=\"HTTP \"></p>\n<ol>\n<li></li>\n<li> 401 UnauthorizedAccess Authentication<code>WWW-Authenticate</code>  <code>WWW-Authenticate: Basic realm=&quot;Secure Area&quot;</code><code>Basic</code>  <code>realm=&quot;Secure Area&quot;</code>  URI </li>\n<li></li>\n<li> <code>Authorization</code> </li>\n</ol>\n<ul>\n<li> <code>:</code> </li>\n<li> <code>WWW-Authenticate</code> </li>\n<li> Base64</li>\n<li> <code>Basic</code> <code>Authorization</code>  <code>admin</code> <code>password</code> <code>admin:password</code> Base64  <code>YWRtaW46cGFzc3dvcmQ=</code> HTTP <code>Authorization: Basic YWRtaW46cGFzc3dvcmQ=</code></li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Buffer.from(<span class=\"string\">'admin:password'</span>).toString(<span class=\"string\">'base64'</span>);</span><br><span class=\"line\"><span class=\"comment\">// YWRtaW46cGFzc3dvcmQ=</span></span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li> 401 </li>\n</ol>\n<p></p>\n<ol>\n<li> <code>realm</code></li>\n<li> Authorization </li>\n<li> <code>realm</code> </li>\n<li></li>\n</ol>\n<blockquote>\n<p></p>\n</blockquote>\n<p></p>\n<ul>\n<li></li>\n</ul>\n<p></p>\n<ul>\n<li></li>\n<li>Base64  HTTP </li>\n<li></li>\n<li>Basic </li>\n</ul>\n<blockquote>\n<p>HTTP  HTTPS / TLS </p>\n</blockquote>\n<p></p>\n<h2 id=\"Session-Cookie-\"><a href=\"#Session-Cookie-\" class=\"headerlink\" title=\"Session-Cookie \"></a>Session-Cookie </h2><p><code>Session-Cookie</code>  Session Cookie </p>\n<p> HTTP  Session  Session </p>\n<p>Cookie </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> Session-Cookie </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-session-cookie.jpg\" alt=\"Session-Cookie \"></p>\n<ol>\n<li> Session Session  Redis  Session  <code>session_id</code> <code>sid</code> <code>Set-Cookie</code> </li>\n<li> <code>sid</code>  <code>secret</code> </li>\n<li> <code>sid</code>  Cookie  HTTP  Cookie </li>\n<li> Cookie  <code>sid</code> <code>sid</code>  <code>sid</code></li>\n<li> ID</li>\n</ol>\n<blockquote>\n<p>  <code></code>  Cookie  APP  Cookie /</p>\n</blockquote>\n<p></p>\n<ol>\n<li>Cookie Cookie </li>\n<li>Session  JWT  Session </li>\n</ol>\n<p></p>\n<ol>\n<li>Cookie  CSRF </li>\n<li>Session </li>\n<li></li>\n</ol>\n<h3 id=\"koa-session\"><a href=\"#koa-session\" class=\"headerlink\" title=\"koa-session\"></a>koa-session</h3><p> Koa  <code>koa-session2</code>  Session-Cookie </p>\n<p> Redis  NoSQL </p>\n<p><code>koa-session2</code>  <code>koa-session2</code>  Redis  Session-Cookie </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Redis = <span class=\"built_in\">require</span>(<span class=\"string\">'ioredis'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; Store &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-session2'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisStore</span> <span class=\"keyword\">extends</span> <span class=\"title\">Store</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>();</span><br><span class=\"line\">    <span class=\"comment\">//  Redis</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.redis = <span class=\"keyword\">new</span> Redis();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  sid </span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"keyword\">get</span>(sid, ctx) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> data = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.redis.get(<span class=\"string\">`SESSION: <span class=\"subst\">$&#123;sid&#125;</span>`</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">JSON</span>.parse(data);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  sid </span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"keyword\">set</span>(session, &#123; sid = <span class=\"keyword\">this</span>.getID(<span class=\"number\">24</span>), maxAge = <span class=\"number\">1000000</span> &#125; = &#123;&#125;, ctx) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.redis.set(<span class=\"string\">`SESSION: <span class=\"subst\">$&#123;sid&#125;</span>`</span>, <span class=\"built_in\">JSON</span>.stringfy(session));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> sid;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> destroy(sid, ctx) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.redis.del(<span class=\"string\">`SESSION: <span class=\"subst\">$&#123;sid&#125;</span>`</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = RedisStore;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// app.js</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> session = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-session2'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> Store = <span class=\"built_in\">require</span>(<span class=\"string\">'./Store.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa();</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(</span><br><span class=\"line\">  session(&#123;</span><br><span class=\"line\">    <span class=\"comment\">//  Cookie </span></span><br><span class=\"line\">    key: <span class=\"string\">'SESSIONID'</span>,</span><br><span class=\"line\">    <span class=\"comment\">//  JS  Cookie</span></span><br><span class=\"line\">    httpOnly: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"comment\">// Cookie </span></span><br><span class=\"line\">    signed: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    store: <span class=\"keyword\">new</span> Store(),</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"params\">ctx</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Ignore favicon.ico</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (ctx.path === <span class=\"string\">'/favicon.ico'</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> user = <span class=\"keyword\">this</span>.session.user;</span><br><span class=\"line\"></span><br><span class=\"line\">  ctx.session.view = <span class=\"string\">'index'</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(<span class=\"function\"><span class=\"params\">ctx</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  ctx.session.refresh();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p> <code>koa-session</code>  Cookie  IP  ID </p>\n<p>Koa  Cookie  <code>signed</code>  <code>true</code>  Cookie  SHA256  <code>koa:sess=pjadZtLAVtiO6-Haw1vnZZWrRm8</code> Cookie </p>\n<p> Session <code>koa-session</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> encode = <span class=\"function\"><span class=\"params\">json</span> =&gt;</span> CrytoJS.AES.encrypt(json, <span class=\"string\">'Secret Passphrase'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> decode = <span class=\"function\"><span class=\"params\">encrypted</span> =&gt;</span> CryptoJS.AES.decrypt(encrypted, <span class=\"string\">'Secret Passphrase'</span>);</span><br></pre></td></tr></table></figure>\n<p><code>koa-session</code>  Koa </p>\n<p> <code>koa-session2</code>  Github </p>\n<ul>\n<li><a href=\"https://github.com/koajs/session\" target=\"_blank\" rel=\"noopener\">koa-session</a></li>\n<li><a href=\"https://github.com/Secbone/koa-session2\" target=\"_blank\" rel=\"noopener\">koa-session2</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000013039187\" target=\"_blank\" rel=\"noopener\">koa-session </a></li>\n<li><a href=\"https://www.jianshu.com/p/c1eff1b50d23\" target=\"_blank\" rel=\"noopener\">koa-session </a></li>\n<li><a href=\"https://juejin.im/post/5c148fd551882530544f341f\" target=\"_blank\" rel=\"noopener\"> koa-session  session </a></li>\n<li><a href=\"https://segmentfault.com/a/1190000012412299\" target=\"_blank\" rel=\"noopener\"> koa-session  cookie  session</a></li>\n</ul>\n<h2 id=\"Token-\"><a href=\"#Token-\" class=\"headerlink\" title=\"Token \"></a>Token </h2><p> Restful API Token Token  Session-Cookie  Session ID Token  <code></code> Token  TwitterQQGithub  API  OpenStackKubernetes  API  Token </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-token-authencation.jpg\" alt=\"Token \"></p>\n<p> Token </p>\n<ol>\n<li></li>\n<li></li>\n<li> <code></code> Token Token </li>\n<li> Token  localStorage  sessionStorage  Cookie </li>\n<li> Token  HTTP  Authorization </li>\n<li> Token</li>\n</ol>\n<p></p>\n<ul>\n<li><strong></strong>Token Session Token </li>\n<li><strong></strong> Token </li>\n<li></li>\n<li> Cookie  Token </li>\n<li> CSRF  Cookie XSS  Token  <code>httpOnly</code>  Cookie  JS  Cookie </li>\n</ul>\n<p></p>\n<ul>\n<li> <code>sid</code> </li>\n<li> Session-Cookie Token  Token  Token  SessionCookie </li>\n</ul>\n<blockquote>\n<p>Session-Cookie  Token </p>\n</blockquote>\n<p>Session-Cookie  Token  Token  Session-Cookie </p>\n<p>Session-Cookie  <code>sid</code>  <code>sid</code>  Session  Session-Cookie  Cookie  NativeAPP  Cookie </p>\n<p> Token  <code></code>  Cookie Web Storage Session-Cookie  Token </p>\n<p>Token  JWT  Token </p>\n<h3 id=\"JWT-\"><a href=\"#JWT-\" class=\"headerlink\" title=\"JWT \"></a>JWT </h3><p>JWTJSON Web Token Auth0  JSON  JSON  Token token </p>\n<p>JWT  JSON </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JSON Data + Signature = JWT</span><br></pre></td></tr></table></figure>\n<p>JWT </p>\n<ol>\n<li>Headerstypalg</li>\n</ol>\n<p> JWT </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"alg\"</span>: <span class=\"string\">\"HS256\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"typ\"</span>: <span class=\"string\">\"JWT\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> JWT HS256 </p>\n<ol start=\"2\">\n<li>Claims</li>\n</ol>\n<p></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">\"iss\"</span>: <span class=\"string\">\"Jehoshaphat Tse\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"iat\"</span>: <span class=\"number\">1441593502</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"exp\"</span>: <span class=\"number\">1441594722</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"aud\"</span>: <span class=\"string\">\"www.example.com\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"sub\"</span>: <span class=\"string\">\"mrsingsing@example.com\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"John Doe\"</span>,</span><br><span class=\"line\">  <span class=\"attr\">\"admin\"</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> JWT :</p>\n<ul>\n<li><code>iss</code> JWT </li>\n<li><code>sub</code> JWT </li>\n<li><code>aud</code> JWT </li>\n<li><code>exp</code>expires Unix </li>\n<li><code>iat</code>issued at Base64 </li>\n</ul>\n<ol start=\"3\">\n<li>Signature</li>\n</ol>\n<p> <code>alg</code> HS256Secret JWTHeader  Claims  Signature  JWT </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HMACSHA256(base64UrlEncode(Headers) + <span class=\"string\">'.'</span> + base64UrlEncode(Claims), SECREATE_KEY);</span><br></pre></td></tr></table></figure>\n<p></p>\n<ol>\n<li>RESTful API  Session </li>\n<li>JWT  JWT</li>\n</ol>\n<p></p>\n<ol>\n<li><strong></strong> Session  Token Token  JWT  JWT  JWT </li>\n<li><strong></strong> JWT  Claims  Base64  JWT </li>\n<li><strong></strong>JWT Cookie  4k JWT  LocalStorage  HTTP  JWT  Header HTTP  Header  Body </li>\n</ol>\n<h3 id=\"koa-jwt\"><a href=\"#koa-jwt\" class=\"headerlink\" title=\"koa-jwt\"></a>koa-jwt</h3><p> Koa  <code>koa-jwt</code>  Token </p>\n<p> Token</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-router'</span>)();</span><br><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-jwt'</span>);</span><br><span class=\"line\"><span class=\"comment\">//  MongoDB </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> userModel = <span class=\"built_in\">require</span>(<span class=\"string\">'../model/userModel'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> secretOrPublicKey = <span class=\"string\">'TOKEN_EXAMPLE'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">router.post(<span class=\"string\">'/login'</span>, <span class=\"keyword\">async</span> ctx =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> data = ctx.request.body;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> userInfo = <span class=\"keyword\">await</span> userModel.findOne(&#123; <span class=\"attr\">name</span>: data.name, <span class=\"attr\">password</span>: data.password &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (userInfo !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//  Token 2h</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> token = jwt.sign(&#123; <span class=\"attr\">name</span>: userInfo.name, <span class=\"attr\">_id</span>: userInfo._id &#125;, secretOrPublicKey, &#123;</span><br><span class=\"line\">      expiresIn: <span class=\"string\">'2h'</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    result = &#123;</span><br><span class=\"line\">      code: <span class=\"number\">200</span>,</span><br><span class=\"line\">      token: token,</span><br><span class=\"line\">      msg: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    result = &#123;</span><br><span class=\"line\">      code: <span class=\"number\">400</span>,</span><br><span class=\"line\">      token: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      msg: <span class=\"string\">''</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (ctx.body = result);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p> Token</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">login</span>(<span class=\"params\">userName, password</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> axios</span><br><span class=\"line\">    .post(<span class=\"string\">'/login'</span>, &#123;</span><br><span class=\"line\">      name: userName,</span><br><span class=\"line\">      password: password,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (res.code === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">        localStorage.setItem(<span class=\"string\">'access_token'</span>, res.data.token);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">''</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"params\">e</span> =&gt;</span> <span class=\"built_in\">console</span>.error(e));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  Token  API </span></span><br><span class=\"line\"><span class=\"comment\">//  Axios  Authorization </span></span><br><span class=\"line\">axios.interceptors.request.use(<span class=\"function\"><span class=\"params\">config</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> token = localStorage.getItem(<span class=\"string\">'token'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  config.headers.common[<span class=\"string\">'Authorization'</span>] = <span class=\"string\">'Bearer '</span> + token;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> koa = <span class=\"built_in\">require</span>(<span class=\"string\">'koa'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> jwt = <span class=\"built_in\">require</span>(<span class=\"string\">'koa-jwt'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> Koa();</span><br><span class=\"line\"><span class=\"keyword\">const</span> secretOrPublicKey = <span class=\"string\">'TOKEN_EXAMPLE'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">app</span><br><span class=\"line\">  .use(</span><br><span class=\"line\">    jwt(&#123;</span><br><span class=\"line\">      secret: secretOrPublicKey,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  )</span><br><span class=\"line\">  .unless(&#123;</span><br><span class=\"line\">    path: [<span class=\"regexp\">/\\register/</span>, /\\/login/],</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<p> <code>koa-jwt</code>  Token  Authorization</p>\n<ul>\n<li> <code>token</code>  Authorization Token  Bearer </li>\n<li> Token  401 </li>\n</ul>\n<p> <code>verify.js</code>  <code>jsonwebtoken</code>  <code>verify()</code> </p>\n<p><a href=\"https://github.com/auth0/node-jsonwebtoken\" target=\"_blank\" rel=\"noopener\">jsonwebtoken</a>  <code>sign()</code>  <code>token</code> <code>verify()</code>  <code>token</code> JWT  <code>koa-jwt</code>  <code>jsonwebtoken</code>  <code>verify()</code>  <code>token</code> <code>koa-jwt</code>  <code>index.js</code> <code>koa-jwt</code>  <code>koa-unless</code> </p>\n<ul>\n<li><a href=\"http://www.uxys.com/html/JavaScript/20190722/52733.html\" target=\"_blank\" rel=\"noopener\">Koa2  JWT </a></li>\n</ul>\n<h3 id=\"Token-\"><a href=\"#Token-\" class=\"headerlink\" title=\"Token \"></a>Token </h3><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Token </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>/</li>\n<li></li>\n</ul>\n<p> Token  Session-Cookie  Session  Token  Token </p>\n<p></p>\n<ul>\n<li><strong> Token </strong> Token  Redis  Token  Redis  Token  Token  DB  Token  JWT </li>\n<li><strong></strong> Token  Token  Token  Token </li>\n<li><strong> Secret</strong> Token <ul>\n<li> Token  Session </li>\n<li></li>\n</ul>\n</li>\n<li><strong></strong><ul>\n<li></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Token </p>\n<p>Token  Token  <code></code> Token </p>\n<p> Session-Cookie  Session  30  30  Session  30 </p>\n<ul>\n<li><strong> Session </strong> Token  Token </li>\n<li><strong> Token</strong></li>\n<li><strong>Token </strong></li>\n<li><strong> Token</strong> <code>accessToken</code> <code>refreshToken</code> 1  <code>accessToken</code>  <code>refreshToken</code>  <code>accessToken</code>  <code>accessToken</code>  <code>refreshToken</code>  <code>accessToken</code> <ul>\n<li></li>\n<li> Token </li>\n<li> Token  Token  <code>accessToken</code>  <code>refreshToken</code>  <code>accessToken</code></li>\n</ul>\n</li>\n</ul>\n<p>JWT  Token  Token  Session-Cookie </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong>Single Sign-on SSO</p>\n<p> All-in-one  Session </p>\n<p> Session  SessionIDTomcat  <code>JSESSIONID</code> SessionID </p>\n<p> Redis  Token  Redis  SSO  Redis  <code></code> </p>\n<p> SSO </p>\n<h3 id=\"-SSO\"><a href=\"#-SSO\" class=\"headerlink\" title=\" SSO\"></a> SSO</h3><p> A <code>a.abc.com</code>  B <code>b.abc.com</code>  SSO </p>\n<ol>\n<li> <code>a.abc.com</code> SSO </li>\n<li> Session  <code>Set-Cookie</code> </li>\n<li> B  A  B  <code>abc.com</code> Cookie Cookie </li>\n</ol>\n<p> Session-Cookie </p>\n<h3 id=\"-SSO\"><a href=\"#-SSO\" class=\"headerlink\" title=\" SSO\"></a> SSO</h3><p> SSO </p>\n<p><strong>CAS</strong>Central Authentication Service 1.0  2.0 1.0 2.0  Web </p>\n<p>CAS </p>\n<ul>\n<li>Client</li>\n<li>Server SSO </li>\n<li>Service A / B</li>\n</ul>\n<p>CAS </p>\n<ul>\n<li><code>/login</code></li>\n<li><code>/logout</code></li>\n<li><code>/validate</code></li>\n<li><code>/serviceValidate</code> Service </li>\n</ul>\n<p>CAS </p>\n<ul>\n<li><strong>TGTTicket Grangting Ticket</strong>TGT  CAS  <code></code> TGT CAS TGT  Cookie  Cookie  HTTP CAS  Cookie TGC <code>key</code>  TGT</li>\n<li><strong>TGCTicket Granting Cookie</strong>CAS Service  TGC  Session  TGC  Session SessionID Cookie  CAS Service </li>\n<li><strong>STService Ticket</strong>ST  CAS  Service  Service Service  ST CAS  ST CAS  ST CAS  TGT ST ST  ServiceService  ST  CAS </li>\n</ul>\n<p> TGC  TGT  <code>key-value</code>  ST </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-cas-workflow.png\" alt=\"CAS \"></p>\n<ol>\n<li> A  <code>a.abc.com</code> A  <code></code>  302 SSO  A  <code>sso.abc.com/login?service=https%3A%2F%2Fwww.a.abc.com</code></li>\n<li> SSO TGC SSO  <code></code>  SSO  SSO </li>\n<li>SSO  SSO  <code></code> <code></code>STSSO  A </li>\n</ol>\n<ul>\n<li> <code>query</code>  A </li>\n<li> <code>query</code>  SSO  ST</li>\n<li> HTTP  Cookie  Header Cookie  SSO  TGC</li>\n</ul>\n<ol start=\"5\">\n<li> A  URL  SSO  ST</li>\n<li> A  ST  SSO SSO  A  SSO  A  <code></code></li>\n<li> B  <code>b.abc.com</code> B  <code></code>  SSO  ST ST </li>\n<li>SSO  B </li>\n<li> B  SSO SSO  B</li>\n<li> B </li>\n</ol>\n<p> CAS  CAS Server  ST  ST  Hacker  Client  ST Hacker  ST ST  IPSessionID </p>\n<h3 id=\"LDAP-\"><a href=\"#LDAP-\" class=\"headerlink\" title=\"LDAP \"></a>LDAP </h3><p>LDAP  Lightweight Directory Access Protocol<strong></strong>IEFTRFC *<em> LDAP</em>-  JiraConfluenceOpenVPN  LDAP  LDAP  SSO</p>\n<ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li> LDAP  LDAP BIND </li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ol>\n<li> *<em></em>- </li>\n<li> *<em></em>- </li>\n</ol>\n<p>QQ </p>\n<p></p>\n<p> OAuth OAuth OAuth </p>\n<h2 id=\"OAuth2-\"><a href=\"#OAuth2-\" class=\"headerlink\" title=\"OAuth2 \"></a>OAuth2 </h2><p>OAuth <code></code>  <code></code> OAuth QQ</p>\n<p>OAuth  1.0  2.0 2.0 </p>\n<p></p>\n<p></p>\n<ul>\n<li>Authorization Code Grant</li>\n<li>Implicit Grant</li>\n<li>Resource Owner Password Credentials Grant</li>\n<li>Client Credentials Grant</li>\n</ul>\n<p><code></code><code></code><code></code> <code></code></p>\n<ul>\n<li>Resource Owner</li>\n<li>Third-party Application Web App Web </li>\n<li>Authorization Server</li>\n<li>Resource Server</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> OAuth 2.0 </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-authorization-code-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Client Side+</li>\n<li>Server Side</li>\n<li>Check Access Token + </li>\n</ol>\n<p> Token Token </p>\n<blockquote>\n<p></p>\n<ul>\n<li> IDclient_idclient_secret</li>\n<li> <code>scope</code><code>state</code>  Spring Security OAuth2 </li>\n</ul>\n</blockquote>\n<p><strong>Client Server </strong></p>\n<p></p>\n<ol>\n<li> <code>client_id + client_secret + grant_type+ redirect_uri</code>  URL </li>\n<li> <code></code></li>\n<li><code></code> </li>\n<li> <code></code></li>\n</ol>\n<p><strong>Server Side  Token</strong></p>\n<ol>\n<li> <code> + client_id + client_secret</code>  Token </li>\n<li> Token </li>\n<li> Token </li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token</li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<p> OAuth2.0  OAuth2.0  AppID  AppSecret</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.  code </span><br><span class=\"line\">2.  code  AppId  AppSecret  API  access_token</span><br><span class=\"line\">3.  access_token </span><br></pre></td></tr></table></figure>\n<p><img src=\"http://img.mrsingsing.com/authentication-wx-oauth2-access-token.png\" alt=\" OAuth2.0  access_token \"></p>\n<p> <a href=\"https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Development_Guide.html\" target=\"_blank\" rel=\"noopener\"> - </a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/authentication-implicit-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Client Side+</li>\n<li>Check Access Token + </li>\n</ol>\n<p> Token Token </p>\n<p><strong>Client Side  Token</strong></p>\n<ol>\n<li> <code>client_id + grant_type+ redirect_url</code>  URL </li>\n<li></li>\n<li></li>\n<li> <code></code>  Token </li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token </li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/authentication-resource-owner-password-credentials-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Client Side</li>\n<li>Check Access Token + </li>\n</ol>\n<p> Token Token </p>\n<p><strong>Client Server  Token</strong></p>\n<ol>\n<li></li>\n<li> <code>client_id + client_secret</code>  Token </li>\n<li><code>client_id</code>  <code>client_secret</code> Token </li>\n<li> Token</li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token</li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/authentication-client-credentials-grant.jpg\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>Server Side</li>\n<li>Check Access Token</li>\n</ol>\n<p> Token Token </p>\n<p><strong>Client Server  Token</strong></p>\n<ol>\n<li> <code>client_id + client_secret + </code>  Token </li>\n<li> Token </li>\n<li> Token</li>\n</ol>\n<p><strong>Check Access Token  Token </strong></p>\n<ol>\n<li> Token</li>\n<li> Token  Token</li>\n<li></li>\n</ol>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"> Authorization Code</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"> Implicit Grant</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"> Password Grant</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"> Client Credentials</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-oauth2-mode-selection.jpg\" alt=\"OAuth2.0 \"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> OAuth2.0 </p>\n<p> APP  H5  APP  H5  APP  H5 </p>\n<p> H5  Token  URL  H5 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <strong>*-  </strong>**</p>\n<p> APP  PC </p>\n<p><img src=\"http://img.mrsingsing.com/authentication-scan-qrcode-login-workflow.jpg\" alt=\"\"></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong> 1~5  PC </p>\n<p> PC  <code>UUID</code>  ID UUID  <code>PC </code>  Redis  PC </p>\n<p> PC  ID  ID  <code></code>  PC  WebSocket /</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong> 6~10  PC PC </p>\n<p> IDToken ID </p>\n<p> <code>Token  ID</code> PC  Token Token  Token </p>\n<p>PC  PC </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong></strong> 11~15 <code> Token</code>  PC  <code> Token</code> PC  Token </p>\n<p>PC  Token Token </p>\n<p> Token PC </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p> APP  H5  SIM  SDK </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/authentication-one-click-login-workflow.png\" alt=\"\"></p>\n<p></p>\n<ol>\n<li>SDK  SDK  AppKey  AppSecret</li>\n<li> SDK SDK </li>\n<li>SDK  Token Token </li>\n<li> Token  Token </li>\n</ol>\n<p> SDK</p>\n<ul>\n<li><a href=\"https://help.aliyun.com/product/75010.html\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"http://shanyan.253.com/\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"https://www.jiguang.cn/identify\" target=\"_blank\" rel=\"noopener\"> - </a></li>\n<li><a href=\"https://www.mob.com/mobService/secverify\" target=\"_blank\" rel=\"noopener\">mob - </a></li>\n</ul>\n<p> SIM </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>IdentificationAuthorizationAuthentication</p>\n<ul>\n<li>Authorization </li>\n<li>Authentication </li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> -&gt;  -&gt; </span><br></pre></td></tr></table></figure>\n<p> Linux </p>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Basic_access_authentication\" target=\"_blank\" rel=\"noopener\"> WikipediaBasic Access Authentication</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication\" target=\"_blank\" rel=\"noopener\"> HTTP  Authentication</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc7519\" target=\"_blank\" rel=\"noopener\"> RFC 7019 - JSON Web TokenJWT</a></li>\n<li><a href=\"https://apereo.github.io/cas/4.2.x/index.html\" target=\"_blank\" rel=\"noopener\"> CAS </a></li>\n<li><a href=\"https://juejin.im/entry/5ac175baf265da239e4e3999\" target=\"_blank\" rel=\"noopener\">  HTTP Basic </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/43527568\" target=\"_blank\" rel=\"noopener\">  JWT  Session</a></li>\n<li><a href=\"https://juejin.im/post/5cefad23e51d4510774a87f4#heading-4\" target=\"_blank\" rel=\"noopener\">  JWT  Session </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/85873228\" target=\"_blank\" rel=\"noopener\"> JWT </a></li>\n<li><a href=\"https://juejin.im/post/5a002b536fb9a045132a1727\" target=\"_blank\" rel=\"noopener\">  SSO  CAS </a></li>\n<li><a href=\"https://juejin.im/post/5b51f39b5188251a9f24a264\" target=\"_blank\" rel=\"noopener\">  SSO</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/102898335\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/60376970\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://www.cnblogs.com/ywlaker/p/6113927.html\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/92263756\" target=\"_blank\" rel=\"noopener\">  LDAP </a></li>\n<li><a href=\"https://www.zhihu.com/question/21387523\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://juejin.im/entry/5a93506e6fb9a0634c268da8\" target=\"_blank\" rel=\"noopener\"> OAuth2.0 </a></li>\n<li><a href=\"https://www.cnblogs.com/hellxz/p/oauth2_process.html\" target=\"_blank\" rel=\"noopener\"> OAuth 2.0 </a></li>\n<li><a href=\"https://juejin.im/post/5d15d3336fb9a07efb69994f\" target=\"_blank\" rel=\"noopener\">  H5  APP </a></li>\n<li><a href=\"https://juejin.im/post/5e83e716e51d4546c27bb559\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://mp.weixin.qq.com/s/gA0JQp4j2ym9qOyQkC3qkA\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://juejin.im/post/5d197adff265da1bb31c4fa9\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"https://learnku.com/articles/30704\" target=\"_blank\" rel=\"noopener\"> </a></li>\n<li><a href=\"http://www.hyhblog.cn/2018/04/25/user_login_auth_terms/\" target=\"_blank\" rel=\"noopener\"> </a></li>\n</ul>"},{"title":"","date":"2020-05-27T00:00:00.000Z","_content":"\n# \n\n H5 \n\n## \n\n### Chrome \n\nChrome \n\n1.  PC  Chrome  F12 \n2. \n3. \n4.  `Edit` \n\n\n\n### vConsole \n\n[vConsole](https://github.com/Tencent/vConsole) \n\n Web \n\n-  console \n- \n-  element \n-  CookielocalStorage  SessionStorage\n-  JavaScript \n- \n\n<!-- more -->\n\n PC  Chrome \n\n [vConsole ](https://github.com/Tencent/vConsole/blob/dev/doc/tutorial_CN.md)\n\n AlloyTeam  URL  vConsole  [AlloyLever](https://github.com/AlloyTeam/AlloyLever) \n\n [eruda](https://github.com/liriliri/eruda)\n\n#### \n\n JavaScript  Chrome DevTool \n\n `XHMLHttpRequest``fetch``console`  `Network`  `Console` \n\n CookieLocalStorageSessionStorage \n\n `Element`  DOM  `document.documentElement` \n\n### Charles \n\n\n\n1.  H5  IP \n2.  Web App \n3.  Web App \n\n Charles  Charles\n\n[Charles](https://www.charlesproxy.com/)  HTTP \n\n Charles \n\n-  HTTP  HTTPS  SSL \n- \n- \n- \n- \n- \n- \n\n#### \n\n Charles \n\n1. ` -> Help -> SSL Proxying -> Install Charles Root Certificate`\n\n![](http://img.mrsingsing.com/wireless-debugger-install-charles-certificate.jpg)\n\n2.  Charles \n\n![](http://img.mrsingsing.com/wireless-debugger-always-trust-certificate.jpg)\n\n3.  Charles `Proxy -> Proxy Setting``port`  `8888` `Enable transparent HTTP proxying`\n\n Mac  IP  `Charles -> Help -> Local IP Address` \n\n![Charles](http://img.mrsingsing.com/wireless-debugger-enable-charles-proxying.jpg)\n\n4.  iPhone \n\n-  iPhone Wifi iPhone  Mac  Wifi\n-  Wifi  `HTTP `\n-  `` `8888`\n\n5.  Charles  `Allow`\n\n6)  Safari `chls.pro/ssl`\n\n-  ` ->  -> `\n\n HTTP/HTTPS \n\n#### \n\n![Charles](http://img.mrsingsing.com/wireless-debugger-charles-principle.jpg)\n\n Charles  `` \n\n Charles  HTTPS Charles  HTTPS \n\n Charles \n\n- \n  - [Fiddler](https://www.telerik.com/fiddler)\n  - [Wireshark](https://www.wireshark.org/download.html)\n  - [Weinre](https://github.com/nupthale/weinre) Web Inspector  PC \n- \n  - [spy-debugger](https://github.com/wuchangming/spy-debugger) Webview USB  Charles \n  - [whistle](https://github.com/avwo/whistle) Node  WebSocket\n\n##  iOS \n\n### Safari +  \n\niPhone + MacBook +  Safari\n\n\n\n1.  iPhone ` -> Safari  ->  -> Web `\n2.  MacBook  Safari  ` ->  -> `\n3.  iPhone  MacBook ``  iPhone  Safari  MacBook  Safari  ` -> -> `\n4.  PC \n\n Safari  [Safari Technology Preview](https://developer.apple.com/safari/download/)\n\n##  Android \n\n### Chrome + USB \n\n Chrome  USB  PC  Chrome  Chrome \n\n\n\n1. Android  PC  Chrome \n2.  Android  ` ->  -> USB ` USB  USB \n3.  USB  Android  PC  USB  `` \n4.  PC  Chrome  `Console ->  Customize and control DevTools -> More tools -> Remote devices`\n5.  Inspect \n\n Google \n\n- [Android ](https://developers.google.com/web/tools/chrome-devtools/remote-debugging/)\n- [](https://developers.google.com/web/tools/chrome-devtools/remote-debugging/local-server)\n- [ WebView](https://developers.google.com/web/tools/chrome-devtools/remote-debugging/webviews)\n\n## \n\n### \n\n\n\n[](https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html)\n\n### \n\n\n\n1.  [http://debugx5.qq.com](http://debugx5.qq.com)\n2.  `Cookie`````  `DNS `\n\n## \n\n\n\n- [](https://yanshu.effirst.com/)\n- Charles Proxy on iOSiOS  Charles iPhone \n\n---\n\n****\n\n- [](https://yujiangshui.com/multidevice-frontend-debug/)\n- [](https://github.com/jieyou/remote_inspect_web_on_real_device)\n- [H5 ](https://zhuanlan.zhihu.com/p/51794821)\n- [](https://juejin.im/post/5b72e1f66fb9a009d018fb94)\n- [ App  H5 ](https://zhuanlan.zhihu.com/p/103642413)\n- [](https://www.zhihu.com/question/25456655)\n","source":"_posts/summary-of-common-development-and-debugging-methods-of-mobile-front-end.md","raw":"---\ntitle: \ndate: '2020-05-27'\n---\n\n# \n\n H5 \n\n## \n\n### Chrome \n\nChrome \n\n1.  PC  Chrome  F12 \n2. \n3. \n4.  `Edit` \n\n\n\n### vConsole \n\n[vConsole](https://github.com/Tencent/vConsole) \n\n Web \n\n-  console \n- \n-  element \n-  CookielocalStorage  SessionStorage\n-  JavaScript \n- \n\n<!-- more -->\n\n PC  Chrome \n\n [vConsole ](https://github.com/Tencent/vConsole/blob/dev/doc/tutorial_CN.md)\n\n AlloyTeam  URL  vConsole  [AlloyLever](https://github.com/AlloyTeam/AlloyLever) \n\n [eruda](https://github.com/liriliri/eruda)\n\n#### \n\n JavaScript  Chrome DevTool \n\n `XHMLHttpRequest``fetch``console`  `Network`  `Console` \n\n CookieLocalStorageSessionStorage \n\n `Element`  DOM  `document.documentElement` \n\n### Charles \n\n\n\n1.  H5  IP \n2.  Web App \n3.  Web App \n\n Charles  Charles\n\n[Charles](https://www.charlesproxy.com/)  HTTP \n\n Charles \n\n-  HTTP  HTTPS  SSL \n- \n- \n- \n- \n- \n- \n\n#### \n\n Charles \n\n1. ` -> Help -> SSL Proxying -> Install Charles Root Certificate`\n\n![](http://img.mrsingsing.com/wireless-debugger-install-charles-certificate.jpg)\n\n2.  Charles \n\n![](http://img.mrsingsing.com/wireless-debugger-always-trust-certificate.jpg)\n\n3.  Charles `Proxy -> Proxy Setting``port`  `8888` `Enable transparent HTTP proxying`\n\n Mac  IP  `Charles -> Help -> Local IP Address` \n\n![Charles](http://img.mrsingsing.com/wireless-debugger-enable-charles-proxying.jpg)\n\n4.  iPhone \n\n-  iPhone Wifi iPhone  Mac  Wifi\n-  Wifi  `HTTP `\n-  `` `8888`\n\n5.  Charles  `Allow`\n\n6)  Safari `chls.pro/ssl`\n\n-  ` ->  -> `\n\n HTTP/HTTPS \n\n#### \n\n![Charles](http://img.mrsingsing.com/wireless-debugger-charles-principle.jpg)\n\n Charles  `` \n\n Charles  HTTPS Charles  HTTPS \n\n Charles \n\n- \n  - [Fiddler](https://www.telerik.com/fiddler)\n  - [Wireshark](https://www.wireshark.org/download.html)\n  - [Weinre](https://github.com/nupthale/weinre) Web Inspector  PC \n- \n  - [spy-debugger](https://github.com/wuchangming/spy-debugger) Webview USB  Charles \n  - [whistle](https://github.com/avwo/whistle) Node  WebSocket\n\n##  iOS \n\n### Safari +  \n\niPhone + MacBook +  Safari\n\n\n\n1.  iPhone ` -> Safari  ->  -> Web `\n2.  MacBook  Safari  ` ->  -> `\n3.  iPhone  MacBook ``  iPhone  Safari  MacBook  Safari  ` -> -> `\n4.  PC \n\n Safari  [Safari Technology Preview](https://developer.apple.com/safari/download/)\n\n##  Android \n\n### Chrome + USB \n\n Chrome  USB  PC  Chrome  Chrome \n\n\n\n1. Android  PC  Chrome \n2.  Android  ` ->  -> USB ` USB  USB \n3.  USB  Android  PC  USB  `` \n4.  PC  Chrome  `Console ->  Customize and control DevTools -> More tools -> Remote devices`\n5.  Inspect \n\n Google \n\n- [Android ](https://developers.google.com/web/tools/chrome-devtools/remote-debugging/)\n- [](https://developers.google.com/web/tools/chrome-devtools/remote-debugging/local-server)\n- [ WebView](https://developers.google.com/web/tools/chrome-devtools/remote-debugging/webviews)\n\n## \n\n### \n\n\n\n[](https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html)\n\n### \n\n\n\n1.  [http://debugx5.qq.com](http://debugx5.qq.com)\n2.  `Cookie`````  `DNS `\n\n## \n\n\n\n- [](https://yanshu.effirst.com/)\n- Charles Proxy on iOSiOS  Charles iPhone \n\n---\n\n****\n\n- [](https://yujiangshui.com/multidevice-frontend-debug/)\n- [](https://github.com/jieyou/remote_inspect_web_on_real_device)\n- [H5 ](https://zhuanlan.zhihu.com/p/51794821)\n- [](https://juejin.im/post/5b72e1f66fb9a009d018fb94)\n- [ App  H5 ](https://zhuanlan.zhihu.com/p/103642413)\n- [](https://www.zhihu.com/question/25456655)\n","slug":"summary-of-common-development-and-debugging-methods-of-mobile-front-end","published":1,"updated":"2021-08-18T03:28:40.175Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckshc99z3000cv31psdt663jn","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> H5 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Chrome-\"><a href=\"#Chrome-\" class=\"headerlink\" title=\"Chrome \"></a>Chrome </h3><p>Chrome </p>\n<ol>\n<li> PC  Chrome  F12 </li>\n<li></li>\n<li></li>\n<li> <code>Edit</code> </li>\n</ol>\n<p></p>\n<h3 id=\"vConsole-\"><a href=\"#vConsole-\" class=\"headerlink\" title=\"vConsole \"></a>vConsole </h3><p><a href=\"https://github.com/Tencent/vConsole\" target=\"_blank\" rel=\"noopener\">vConsole</a> </p>\n<p> Web </p>\n<ul>\n<li> console </li>\n<li></li>\n<li> element </li>\n<li> CookielocalStorage  SessionStorage</li>\n<li> JavaScript </li>\n<li></li>\n</ul>\n<a id=\"more\"></a>\n<p> PC  Chrome </p>\n<p> <a href=\"https://github.com/Tencent/vConsole/blob/dev/doc/tutorial_CN.md\" target=\"_blank\" rel=\"noopener\">vConsole </a></p>\n<p> AlloyTeam  URL  vConsole  <a href=\"https://github.com/AlloyTeam/AlloyLever\" target=\"_blank\" rel=\"noopener\">AlloyLever</a> </p>\n<p> <a href=\"https://github.com/liriliri/eruda\" target=\"_blank\" rel=\"noopener\">eruda</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> JavaScript  Chrome DevTool </p>\n<p> <code>XHMLHttpRequest</code><code>fetch</code><code>console</code>  <code>Network</code>  <code>Console</code> </p>\n<p> CookieLocalStorageSessionStorage </p>\n<p> <code>Element</code>  DOM  <code>document.documentElement</code> </p>\n<h3 id=\"Charles-\"><a href=\"#Charles-\" class=\"headerlink\" title=\"Charles \"></a>Charles </h3><p></p>\n<ol>\n<li> H5  IP </li>\n<li> Web App </li>\n<li> Web App </li>\n</ol>\n<p> Charles  Charles</p>\n<p><a href=\"https://www.charlesproxy.com/\" target=\"_blank\" rel=\"noopener\">Charles</a>  HTTP </p>\n<p> Charles </p>\n<ul>\n<li> HTTP  HTTPS  SSL </li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Charles </p>\n<ol>\n<li><code> -&gt; Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate</code></li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/wireless-debugger-install-charles-certificate.jpg\" alt=\"\"></p>\n<ol start=\"2\">\n<li> Charles </li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/wireless-debugger-always-trust-certificate.jpg\" alt=\"\"></p>\n<ol start=\"3\">\n<li> Charles <code>Proxy -&gt; Proxy Setting</code><code>port</code>  <code>8888</code> <code>Enable transparent HTTP proxying</code></li>\n</ol>\n<p> Mac  IP  <code>Charles -&gt; Help -&gt; Local IP Address</code> </p>\n<p><img src=\"http://img.mrsingsing.com/wireless-debugger-enable-charles-proxying.jpg\" alt=\"Charles\"></p>\n<ol start=\"4\">\n<li> iPhone </li>\n</ol>\n<ul>\n<li> iPhone Wifi iPhone  Mac  Wifi</li>\n<li> Wifi  <code>HTTP </code></li>\n<li> <code></code> <code>8888</code></li>\n</ul>\n<ol start=\"5\">\n<li> Charles  <code>Allow</code></li>\n</ol>\n<p>6)  Safari <code>chls.pro/ssl</code></p>\n<ul>\n<li> <code> -&gt;  -&gt; </code></li>\n</ul>\n<p> HTTP/HTTPS </p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"http://img.mrsingsing.com/wireless-debugger-charles-principle.jpg\" alt=\"Charles\"></p>\n<p> Charles  <code></code> </p>\n<p> Charles  HTTPS Charles  HTTPS </p>\n<p> Charles </p>\n<ul>\n<li><ul>\n<li><a href=\"https://www.telerik.com/fiddler\" target=\"_blank\" rel=\"noopener\">Fiddler</a></li>\n<li><a href=\"https://www.wireshark.org/download.html\" target=\"_blank\" rel=\"noopener\">Wireshark</a></li>\n<li><a href=\"https://github.com/nupthale/weinre\" target=\"_blank\" rel=\"noopener\">Weinre</a> Web Inspector  PC </li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://github.com/wuchangming/spy-debugger\" target=\"_blank\" rel=\"noopener\">spy-debugger</a> Webview USB  Charles </li>\n<li><a href=\"https://github.com/avwo/whistle\" target=\"_blank\" rel=\"noopener\">whistle</a> Node  WebSocket</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-iOS-\"><a href=\"#-iOS-\" class=\"headerlink\" title=\" iOS \"></a> iOS </h2><h3 id=\"Safari--\"><a href=\"#Safari--\" class=\"headerlink\" title=\"Safari +  \"></a>Safari +  </h3><p>iPhone + MacBook +  Safari</p>\n<p></p>\n<ol>\n<li> iPhone <code> -&gt; Safari  -&gt;  -&gt; Web </code></li>\n<li> MacBook  Safari  <code> -&gt;  -&gt; </code></li>\n<li> iPhone  MacBook <code></code>  iPhone  Safari  MacBook  Safari  <code> -&gt; -&gt; </code></li>\n<li> PC </li>\n</ol>\n<p> Safari  <a href=\"https://developer.apple.com/safari/download/\" target=\"_blank\" rel=\"noopener\">Safari Technology Preview</a></p>\n<h2 id=\"-Android-\"><a href=\"#-Android-\" class=\"headerlink\" title=\" Android \"></a> Android </h2><h3 id=\"Chrome-USB-\"><a href=\"#Chrome-USB-\" class=\"headerlink\" title=\"Chrome + USB \"></a>Chrome + USB </h3><p> Chrome  USB  PC  Chrome  Chrome </p>\n<p></p>\n<ol>\n<li>Android  PC  Chrome </li>\n<li> Android  <code> -&gt;  -&gt; USB </code> USB  USB </li>\n<li> USB  Android  PC  USB  <code></code> </li>\n<li> PC  Chrome  <code>Console -&gt;  Customize and control DevTools -&gt; More tools -&gt; Remote devices</code></li>\n<li> Inspect </li>\n</ol>\n<p> Google </p>\n<ul>\n<li><a href=\"https://developers.google.com/web/tools/chrome-devtools/remote-debugging/\" target=\"_blank\" rel=\"noopener\">Android </a></li>\n<li><a href=\"https://developers.google.com/web/tools/chrome-devtools/remote-debugging/local-server\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://developers.google.com/web/tools/chrome-devtools/remote-debugging/webviews\" target=\"_blank\" rel=\"noopener\"> WebView</a></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><a href=\"https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html\" target=\"_blank\" rel=\"noopener\"></a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li> <a href=\"http://debugx5.qq.com\" target=\"_blank\" rel=\"noopener\">http://debugx5.qq.com</a></li>\n<li> <code>Cookie</code><code></code><code></code>  <code>DNS </code></li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><a href=\"https://yanshu.effirst.com/\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li>Charles Proxy on iOSiOS  Charles iPhone </li>\n</ul>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://yujiangshui.com/multidevice-frontend-debug/\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://github.com/jieyou/remote_inspect_web_on_real_device\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/51794821\" target=\"_blank\" rel=\"noopener\">H5 </a></li>\n<li><a href=\"https://juejin.im/post/5b72e1f66fb9a009d018fb94\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/103642413\" target=\"_blank\" rel=\"noopener\"> App  H5 </a></li>\n<li><a href=\"https://www.zhihu.com/question/25456655\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> H5 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"Chrome-\"><a href=\"#Chrome-\" class=\"headerlink\" title=\"Chrome \"></a>Chrome </h3><p>Chrome </p>\n<ol>\n<li> PC  Chrome  F12 </li>\n<li></li>\n<li></li>\n<li> <code>Edit</code> </li>\n</ol>\n<p></p>\n<h3 id=\"vConsole-\"><a href=\"#vConsole-\" class=\"headerlink\" title=\"vConsole \"></a>vConsole </h3><p><a href=\"https://github.com/Tencent/vConsole\" target=\"_blank\" rel=\"noopener\">vConsole</a> </p>\n<p> Web </p>\n<ul>\n<li> console </li>\n<li></li>\n<li> element </li>\n<li> CookielocalStorage  SessionStorage</li>\n<li> JavaScript </li>\n<li></li>\n</ul>","more":"<p> PC  Chrome </p>\n<p> <a href=\"https://github.com/Tencent/vConsole/blob/dev/doc/tutorial_CN.md\" target=\"_blank\" rel=\"noopener\">vConsole </a></p>\n<p> AlloyTeam  URL  vConsole  <a href=\"https://github.com/AlloyTeam/AlloyLever\" target=\"_blank\" rel=\"noopener\">AlloyLever</a> </p>\n<p> <a href=\"https://github.com/liriliri/eruda\" target=\"_blank\" rel=\"noopener\">eruda</a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> JavaScript  Chrome DevTool </p>\n<p> <code>XHMLHttpRequest</code><code>fetch</code><code>console</code>  <code>Network</code>  <code>Console</code> </p>\n<p> CookieLocalStorageSessionStorage </p>\n<p> <code>Element</code>  DOM  <code>document.documentElement</code> </p>\n<h3 id=\"Charles-\"><a href=\"#Charles-\" class=\"headerlink\" title=\"Charles \"></a>Charles </h3><p></p>\n<ol>\n<li> H5  IP </li>\n<li> Web App </li>\n<li> Web App </li>\n</ol>\n<p> Charles  Charles</p>\n<p><a href=\"https://www.charlesproxy.com/\" target=\"_blank\" rel=\"noopener\">Charles</a>  HTTP </p>\n<p> Charles </p>\n<ul>\n<li> HTTP  HTTPS  SSL </li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Charles </p>\n<ol>\n<li><code> -&gt; Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate</code></li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/wireless-debugger-install-charles-certificate.jpg\" alt=\"\"></p>\n<ol start=\"2\">\n<li> Charles </li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/wireless-debugger-always-trust-certificate.jpg\" alt=\"\"></p>\n<ol start=\"3\">\n<li> Charles <code>Proxy -&gt; Proxy Setting</code><code>port</code>  <code>8888</code> <code>Enable transparent HTTP proxying</code></li>\n</ol>\n<p> Mac  IP  <code>Charles -&gt; Help -&gt; Local IP Address</code> </p>\n<p><img src=\"http://img.mrsingsing.com/wireless-debugger-enable-charles-proxying.jpg\" alt=\"Charles\"></p>\n<ol start=\"4\">\n<li> iPhone </li>\n</ol>\n<ul>\n<li> iPhone Wifi iPhone  Mac  Wifi</li>\n<li> Wifi  <code>HTTP </code></li>\n<li> <code></code> <code>8888</code></li>\n</ul>\n<ol start=\"5\">\n<li> Charles  <code>Allow</code></li>\n</ol>\n<p>6)  Safari <code>chls.pro/ssl</code></p>\n<ul>\n<li> <code> -&gt;  -&gt; </code></li>\n</ul>\n<p> HTTP/HTTPS </p>\n<h4 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"http://img.mrsingsing.com/wireless-debugger-charles-principle.jpg\" alt=\"Charles\"></p>\n<p> Charles  <code></code> </p>\n<p> Charles  HTTPS Charles  HTTPS </p>\n<p> Charles </p>\n<ul>\n<li><ul>\n<li><a href=\"https://www.telerik.com/fiddler\" target=\"_blank\" rel=\"noopener\">Fiddler</a></li>\n<li><a href=\"https://www.wireshark.org/download.html\" target=\"_blank\" rel=\"noopener\">Wireshark</a></li>\n<li><a href=\"https://github.com/nupthale/weinre\" target=\"_blank\" rel=\"noopener\">Weinre</a> Web Inspector  PC </li>\n</ul>\n</li>\n<li><ul>\n<li><a href=\"https://github.com/wuchangming/spy-debugger\" target=\"_blank\" rel=\"noopener\">spy-debugger</a> Webview USB  Charles </li>\n<li><a href=\"https://github.com/avwo/whistle\" target=\"_blank\" rel=\"noopener\">whistle</a> Node  WebSocket</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-iOS-\"><a href=\"#-iOS-\" class=\"headerlink\" title=\" iOS \"></a> iOS </h2><h3 id=\"Safari--\"><a href=\"#Safari--\" class=\"headerlink\" title=\"Safari +  \"></a>Safari +  </h3><p>iPhone + MacBook +  Safari</p>\n<p></p>\n<ol>\n<li> iPhone <code> -&gt; Safari  -&gt;  -&gt; Web </code></li>\n<li> MacBook  Safari  <code> -&gt;  -&gt; </code></li>\n<li> iPhone  MacBook <code></code>  iPhone  Safari  MacBook  Safari  <code> -&gt; -&gt; </code></li>\n<li> PC </li>\n</ol>\n<p> Safari  <a href=\"https://developer.apple.com/safari/download/\" target=\"_blank\" rel=\"noopener\">Safari Technology Preview</a></p>\n<h2 id=\"-Android-\"><a href=\"#-Android-\" class=\"headerlink\" title=\" Android \"></a> Android </h2><h3 id=\"Chrome-USB-\"><a href=\"#Chrome-USB-\" class=\"headerlink\" title=\"Chrome + USB \"></a>Chrome + USB </h3><p> Chrome  USB  PC  Chrome  Chrome </p>\n<p></p>\n<ol>\n<li>Android  PC  Chrome </li>\n<li> Android  <code> -&gt;  -&gt; USB </code> USB  USB </li>\n<li> USB  Android  PC  USB  <code></code> </li>\n<li> PC  Chrome  <code>Console -&gt;  Customize and control DevTools -&gt; More tools -&gt; Remote devices</code></li>\n<li> Inspect </li>\n</ol>\n<p> Google </p>\n<ul>\n<li><a href=\"https://developers.google.com/web/tools/chrome-devtools/remote-debugging/\" target=\"_blank\" rel=\"noopener\">Android </a></li>\n<li><a href=\"https://developers.google.com/web/tools/chrome-devtools/remote-debugging/local-server\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://developers.google.com/web/tools/chrome-devtools/remote-debugging/webviews\" target=\"_blank\" rel=\"noopener\"> WebView</a></li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><a href=\"https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html\" target=\"_blank\" rel=\"noopener\"></a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li> <a href=\"http://debugx5.qq.com\" target=\"_blank\" rel=\"noopener\">http://debugx5.qq.com</a></li>\n<li> <code>Cookie</code><code></code><code></code>  <code>DNS </code></li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><a href=\"https://yanshu.effirst.com/\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li>Charles Proxy on iOSiOS  Charles iPhone </li>\n</ul>\n<hr>\n<p><strong></strong></p>\n<ul>\n<li><a href=\"https://yujiangshui.com/multidevice-frontend-debug/\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://github.com/jieyou/remote_inspect_web_on_real_device\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/51794821\" target=\"_blank\" rel=\"noopener\">H5 </a></li>\n<li><a href=\"https://juejin.im/post/5b72e1f66fb9a009d018fb94\" target=\"_blank\" rel=\"noopener\"></a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/103642413\" target=\"_blank\" rel=\"noopener\"> App  H5 </a></li>\n<li><a href=\"https://www.zhihu.com/question/25456655\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>"},{"title":" Base64 ","date":"2021-03-13T00:00:00.000Z","_content":"\n## \n\n Egret  HTML  WebGL DOM  `<canvas>`  `innerHTML`  HTML \n\n<!-- more -->\n\n## \n\n `egret.HtmlTextParser`  HTML  `egret.TextField#textFlow` \n\n\n\n1. SVG \n2.  HTML  CSS \n\n Egret  API \n\n1.  `<canvas>`  `z-index`  HTML \n2.  HTML Egret  UI\n3.  HTML  `html2canvas`  Egret \n\n Egret  HTML \n\n![cq-img1](http://img.mrsingsing.com/cq-img1.png)\n\n HTML \n\n SVG  SVG  XML  Egret \n\n AI  Electron  HTML  [html2canvas](https://github.com/niklasvh/html2canvas)  Base64  Egret \n\n## \n\n 10  10 \n\n```js\nexport function getBase64ByHtml2Canvas(dataInfo) {\n  return new Promise((resolve, reject) => {\n    (async () => {\n      try {\n        //  ID \n        const dataList = Object.values(dataInfo);\n\n        // \n        if (!isValidObjectArray(dataList)) {\n          resolve({});\n          return;\n        }\n\n        let result = {};\n        let groups = [];\n\n        //  10  10 \n        for (let x = 0; x < Math.ceil(dataList.length / 10); x++) {\n          let start = x * 10;\n          let end = start + 10;\n          groups.push(dataList.slice(start, end));\n        }\n\n        for (const taskList of groups) {\n          const taskResult = await createHtml2CanvasPromise(taskList);\n\n          result = Object.assign({}, result, taskResult);\n        }\n\n        resolve(result);\n      } catch (err) {\n        reject(err);\n      }\n    })();\n  });\n}\n\nfunction createHtml2CanvasPromise(dataList) {\n  return new Promise((resolve, reject) => {\n    try {\n      const root = document.getElementById('html2canvas');\n\n      // \n      root.innerHTML = '';\n\n      const documentFragment = document.createDocumentFragment();\n\n      dataList.forEach(item => {\n        const div = document.createElement('div');\n        div.classList.add('container');\n        // \n        div.innerHTML = item.questionContentTranslate;\n        div.dataset.id = item.questionId;\n\n        // \n        const tagNames: any = div.querySelectorAll('.spark-formula-frame');\n        if (tagNames.length > 0) {\n          tagNames.forEach(item => {\n            item.width = item.width * 2;\n            item.height = item.height * 2;\n            item.style.margin = '0 10px';\n          });\n        }\n\n        documentFragment.appendChild(div);\n      });\n\n      root.appendChild(documentFragment);\n\n      let images = Array.from(root.getElementsByTagName('img'));\n\n      const renderContent = function() {\n        // \n        const timer = setTimeout(() => {\n          images = images.filter(item => item && !item.complete);\n\n          if (images.length === 0) {\n            const clientRect = root.getBoundingClientRect();\n\n            //  html2canvas \n            html2canvasformula(root, {\n              backgroundColor: null,\n              useCORS: true,\n              width: clientRect.width,\n              height: clientRect.height,\n            })\n              .then(canvas => {\n                //  html2canvas  canvas \n                const ctx = canvas.getContext('2d');\n\n                document.body.append(canvas);\n\n                const result = dataList.reduce((acc, item, index) => {\n                  const elementRef = Array.from(root.children)[index];\n                  const clientRect = elementRef.getBoundingClientRect();\n\n                  // Base64\n                  const base64 = cutImg(ctx, index + 1, clientRect.width, clientRect.height);\n\n                  // \n                  const payload: any = {\n                    questionId: item.questionId,\n                    answer:\n                      item.questionExplains && isValidObjectArray(item.questionExplains)\n                        ? item.questionExplains[0].answerTranslate\n                        : null,\n                    audioUrl:\n                      item.audioList && isValidObjectArray(item.audioList)\n                        ? item.audioList[0].audioUrl\n                        : null,\n                    content: base64,\n                  };\n\n                  acc[item.questionId] = payload;\n\n                  return acc;\n                }, {});\n\n                resolve(result);\n              })\n              .catch(() => {\n                resolve({});\n              });\n\n            clearTimeout(timer);\n          } else {\n            renderContent();\n          }\n        }, 250);\n      };\n\n      renderContent();\n    } catch (err) {\n      reject(err);\n    }\n  });\n}\n\nfunction cutImg(ctx, index, width, height) {\n  //  Retina \n  let devicePixelRatio = 1;\n  if (window.devicePixelRatio) {\n    devicePixelRatio = window.devicePixelRatio;\n  }\n\n  // 1008\n  // 730\n  const imgWidth = (width || 1008) * devicePixelRatio;\n  const imgHeight = (height || 730) * devicePixelRatio;\n\n  const sw = index * imgWidth - imgWidth;\n  let imageData = ctx.getImageData(sw, 0, imgWidth, imgHeight);\n\n  const canvas = document.createElement('canvas');\n  canvas.width = imgWidth;\n  canvas.height = imgHeight;\n\n  const context = canvas.getContext('2d');\n  context.putImageData(imageData, 0, 0);\n\n  return canvas.toDataURL();\n}\n```\n\n## \n\n `html2canvas`  DOM  Canvas  `canvas.toDataURL`  Base64\n\n2021  2  html2canvasv1.0.0-rc.7 demo innerHTML  HTML  DOM 1980 \n\n html2canvas  canvas  html2canvas  `filter: invert(1)` \n\n canvas  toDataURL  Base64 \n\n![cq-img2](http://img.mrsingsing.com/cq-img2.png)\n\n[https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259](https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259)\n\n `html2canvas`  HTML  Canvas  `renderReplacedElement` `ctx.restore()`  `filter` \n\n```ts\nfunction filterImage(box: Bounds, filter: any) {\n  const devicePixelRatio = window.devicePixelRatio || 1;\n  // Retina \n  const finalBox: any = {\n    left: devicePixelRatio * box.left,\n    top: devicePixelRatio * box.top,\n    width: devicePixelRatio * box.width,\n    height: devicePixelRatio * box.height,\n  };\n\n  //\n  const imageData: ImageData = this.ctx.getImageData(\n    finalBox.left,\n    finalBox.top,\n    finalBox.width,\n    finalBox.height\n  );\n\n  const imgWidth = imageData.width,\n    imgHeight = imageData.height;\n\n  for (let i = 0; i < imgHeight; i++) {\n    for (let j = 0; j < imgWidth; j++) {\n      const index = i * 4 * imgWidth + j * 4;\n\n      let red = imageData.data[index];\n      let green = imageData.data[index + 1];\n      let blue = imageData.data[index + 2];\n\n      imageData.data[index] = 255 - 2 * red + red;\n      imageData.data[index + 1] = 255 - 2 * green + green;\n      imageData.data[index + 2] = 255 - 2 * blue + blue;\n    }\n  }\n\n  this.ctx.putImageData(imageData, fialBox.left, fialBox.top);\n}\n```\n\n Canvas  `ctx.getImageData`  ImageData \n\n `data``width`  `height` `data`  Uint8ClampedArray8 `data`  4  RGBAlpha \n\n RGB  255  RGB  RGB \n\n Canvas  Retina \n\n![cq-img3](http://img.mrsingsing.com/cq-img3.png)\n\n\n\n [patch-package](https://www.npmjs.com/package/patch-package)  npm  npm  git diff  [ node_modules ](https://zhuanlan.zhihu.com/p/310266801)\n\n `patch-package`  node_modules  npm  ES6  ES5 \n\n html2canvas  ES5  clone  npm \n\n Base64  Egret  egret.BitmapData \n\n\n\n```ts\nexport class QuestionContent extends eui.Component implements eui.UIComponent {\n  private initQuestionContent(): void {\n    const img: HTMLImageElement = new Image();\n    // this.questionInfo.content  Base64\n    img.src = this.questionInfo.content;\n    // \n    const isAudio = this.questionInfo.audioUrl;\n\n    // \n    img.onload = () => {\n      let width = 0,\n        height = 0;\n      // \n      const avaliableWidth = this.contentGroup.width;\n      let avaliableHeight = this.contentGroup.height;\n\n      if (isAudio) {\n        avaliableHeight = avaliableHeight - 130;\n      }\n\n      if (img.width > img.height) {\n        height = img.height * (avaliableWidth / img.width);\n        width = avaliableWidth;\n      } else {\n        width = img.width * (avaliableHeight / img.height);\n        height = avaliableHeight;\n      }\n\n      img.width = width;\n      img.height = height;\n      img['avaliable'] = true;\n\n      const bitmapdata: egret.BitmapData = new egret.BitmapData(img);\n      const texture: egret.Texture = new egret.Texture();\n      texture.disposeBitmapData = true;\n      texture.bitmapData = bitmapdata;\n\n      this.contentBitmap = new egret.Bitmap(texture);\n\n      //  103 \n      if (isAudio) {\n        this.contentBitmap.y = 103;\n      }\n\n      // \n      this.contentGroup.addChild(this.contentBitmap);\n    };\n  }\n}\n```\n\n\n\n![cq-img4](http://img.mrsingsing.com/cq-img4.png)\n\n![cq-img5](http://img.mrsingsing.com/cq-img5.png)\n\n\n\n- [html2canvas ](https://segmentfault.com/a/1190000038551328)\n- [ html2canvas ](https://segmentfault.com/a/1190000011478657)\n","source":"_posts/rich-text-and-base64.md","raw":"---\ntitle:  Base64 \ndate: '2021-03-13'\n---\n\n## \n\n Egret  HTML  WebGL DOM  `<canvas>`  `innerHTML`  HTML \n\n<!-- more -->\n\n## \n\n `egret.HtmlTextParser`  HTML  `egret.TextField#textFlow` \n\n\n\n1. SVG \n2.  HTML  CSS \n\n Egret  API \n\n1.  `<canvas>`  `z-index`  HTML \n2.  HTML Egret  UI\n3.  HTML  `html2canvas`  Egret \n\n Egret  HTML \n\n![cq-img1](http://img.mrsingsing.com/cq-img1.png)\n\n HTML \n\n SVG  SVG  XML  Egret \n\n AI  Electron  HTML  [html2canvas](https://github.com/niklasvh/html2canvas)  Base64  Egret \n\n## \n\n 10  10 \n\n```js\nexport function getBase64ByHtml2Canvas(dataInfo) {\n  return new Promise((resolve, reject) => {\n    (async () => {\n      try {\n        //  ID \n        const dataList = Object.values(dataInfo);\n\n        // \n        if (!isValidObjectArray(dataList)) {\n          resolve({});\n          return;\n        }\n\n        let result = {};\n        let groups = [];\n\n        //  10  10 \n        for (let x = 0; x < Math.ceil(dataList.length / 10); x++) {\n          let start = x * 10;\n          let end = start + 10;\n          groups.push(dataList.slice(start, end));\n        }\n\n        for (const taskList of groups) {\n          const taskResult = await createHtml2CanvasPromise(taskList);\n\n          result = Object.assign({}, result, taskResult);\n        }\n\n        resolve(result);\n      } catch (err) {\n        reject(err);\n      }\n    })();\n  });\n}\n\nfunction createHtml2CanvasPromise(dataList) {\n  return new Promise((resolve, reject) => {\n    try {\n      const root = document.getElementById('html2canvas');\n\n      // \n      root.innerHTML = '';\n\n      const documentFragment = document.createDocumentFragment();\n\n      dataList.forEach(item => {\n        const div = document.createElement('div');\n        div.classList.add('container');\n        // \n        div.innerHTML = item.questionContentTranslate;\n        div.dataset.id = item.questionId;\n\n        // \n        const tagNames: any = div.querySelectorAll('.spark-formula-frame');\n        if (tagNames.length > 0) {\n          tagNames.forEach(item => {\n            item.width = item.width * 2;\n            item.height = item.height * 2;\n            item.style.margin = '0 10px';\n          });\n        }\n\n        documentFragment.appendChild(div);\n      });\n\n      root.appendChild(documentFragment);\n\n      let images = Array.from(root.getElementsByTagName('img'));\n\n      const renderContent = function() {\n        // \n        const timer = setTimeout(() => {\n          images = images.filter(item => item && !item.complete);\n\n          if (images.length === 0) {\n            const clientRect = root.getBoundingClientRect();\n\n            //  html2canvas \n            html2canvasformula(root, {\n              backgroundColor: null,\n              useCORS: true,\n              width: clientRect.width,\n              height: clientRect.height,\n            })\n              .then(canvas => {\n                //  html2canvas  canvas \n                const ctx = canvas.getContext('2d');\n\n                document.body.append(canvas);\n\n                const result = dataList.reduce((acc, item, index) => {\n                  const elementRef = Array.from(root.children)[index];\n                  const clientRect = elementRef.getBoundingClientRect();\n\n                  // Base64\n                  const base64 = cutImg(ctx, index + 1, clientRect.width, clientRect.height);\n\n                  // \n                  const payload: any = {\n                    questionId: item.questionId,\n                    answer:\n                      item.questionExplains && isValidObjectArray(item.questionExplains)\n                        ? item.questionExplains[0].answerTranslate\n                        : null,\n                    audioUrl:\n                      item.audioList && isValidObjectArray(item.audioList)\n                        ? item.audioList[0].audioUrl\n                        : null,\n                    content: base64,\n                  };\n\n                  acc[item.questionId] = payload;\n\n                  return acc;\n                }, {});\n\n                resolve(result);\n              })\n              .catch(() => {\n                resolve({});\n              });\n\n            clearTimeout(timer);\n          } else {\n            renderContent();\n          }\n        }, 250);\n      };\n\n      renderContent();\n    } catch (err) {\n      reject(err);\n    }\n  });\n}\n\nfunction cutImg(ctx, index, width, height) {\n  //  Retina \n  let devicePixelRatio = 1;\n  if (window.devicePixelRatio) {\n    devicePixelRatio = window.devicePixelRatio;\n  }\n\n  // 1008\n  // 730\n  const imgWidth = (width || 1008) * devicePixelRatio;\n  const imgHeight = (height || 730) * devicePixelRatio;\n\n  const sw = index * imgWidth - imgWidth;\n  let imageData = ctx.getImageData(sw, 0, imgWidth, imgHeight);\n\n  const canvas = document.createElement('canvas');\n  canvas.width = imgWidth;\n  canvas.height = imgHeight;\n\n  const context = canvas.getContext('2d');\n  context.putImageData(imageData, 0, 0);\n\n  return canvas.toDataURL();\n}\n```\n\n## \n\n `html2canvas`  DOM  Canvas  `canvas.toDataURL`  Base64\n\n2021  2  html2canvasv1.0.0-rc.7 demo innerHTML  HTML  DOM 1980 \n\n html2canvas  canvas  html2canvas  `filter: invert(1)` \n\n canvas  toDataURL  Base64 \n\n![cq-img2](http://img.mrsingsing.com/cq-img2.png)\n\n[https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259](https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259)\n\n `html2canvas`  HTML  Canvas  `renderReplacedElement` `ctx.restore()`  `filter` \n\n```ts\nfunction filterImage(box: Bounds, filter: any) {\n  const devicePixelRatio = window.devicePixelRatio || 1;\n  // Retina \n  const finalBox: any = {\n    left: devicePixelRatio * box.left,\n    top: devicePixelRatio * box.top,\n    width: devicePixelRatio * box.width,\n    height: devicePixelRatio * box.height,\n  };\n\n  //\n  const imageData: ImageData = this.ctx.getImageData(\n    finalBox.left,\n    finalBox.top,\n    finalBox.width,\n    finalBox.height\n  );\n\n  const imgWidth = imageData.width,\n    imgHeight = imageData.height;\n\n  for (let i = 0; i < imgHeight; i++) {\n    for (let j = 0; j < imgWidth; j++) {\n      const index = i * 4 * imgWidth + j * 4;\n\n      let red = imageData.data[index];\n      let green = imageData.data[index + 1];\n      let blue = imageData.data[index + 2];\n\n      imageData.data[index] = 255 - 2 * red + red;\n      imageData.data[index + 1] = 255 - 2 * green + green;\n      imageData.data[index + 2] = 255 - 2 * blue + blue;\n    }\n  }\n\n  this.ctx.putImageData(imageData, fialBox.left, fialBox.top);\n}\n```\n\n Canvas  `ctx.getImageData`  ImageData \n\n `data``width`  `height` `data`  Uint8ClampedArray8 `data`  4  RGBAlpha \n\n RGB  255  RGB  RGB \n\n Canvas  Retina \n\n![cq-img3](http://img.mrsingsing.com/cq-img3.png)\n\n\n\n [patch-package](https://www.npmjs.com/package/patch-package)  npm  npm  git diff  [ node_modules ](https://zhuanlan.zhihu.com/p/310266801)\n\n `patch-package`  node_modules  npm  ES6  ES5 \n\n html2canvas  ES5  clone  npm \n\n Base64  Egret  egret.BitmapData \n\n\n\n```ts\nexport class QuestionContent extends eui.Component implements eui.UIComponent {\n  private initQuestionContent(): void {\n    const img: HTMLImageElement = new Image();\n    // this.questionInfo.content  Base64\n    img.src = this.questionInfo.content;\n    // \n    const isAudio = this.questionInfo.audioUrl;\n\n    // \n    img.onload = () => {\n      let width = 0,\n        height = 0;\n      // \n      const avaliableWidth = this.contentGroup.width;\n      let avaliableHeight = this.contentGroup.height;\n\n      if (isAudio) {\n        avaliableHeight = avaliableHeight - 130;\n      }\n\n      if (img.width > img.height) {\n        height = img.height * (avaliableWidth / img.width);\n        width = avaliableWidth;\n      } else {\n        width = img.width * (avaliableHeight / img.height);\n        height = avaliableHeight;\n      }\n\n      img.width = width;\n      img.height = height;\n      img['avaliable'] = true;\n\n      const bitmapdata: egret.BitmapData = new egret.BitmapData(img);\n      const texture: egret.Texture = new egret.Texture();\n      texture.disposeBitmapData = true;\n      texture.bitmapData = bitmapdata;\n\n      this.contentBitmap = new egret.Bitmap(texture);\n\n      //  103 \n      if (isAudio) {\n        this.contentBitmap.y = 103;\n      }\n\n      // \n      this.contentGroup.addChild(this.contentBitmap);\n    };\n  }\n}\n```\n\n\n\n![cq-img4](http://img.mrsingsing.com/cq-img4.png)\n\n![cq-img5](http://img.mrsingsing.com/cq-img5.png)\n\n\n\n- [html2canvas ](https://segmentfault.com/a/1190000038551328)\n- [ html2canvas ](https://segmentfault.com/a/1190000011478657)\n","slug":"rich-text-and-base64","published":1,"updated":"2021-09-29T16:51:03.489Z","_id":"cku5qg8he00006v1pp121fw1g","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Egret  HTML  WebGL DOM  <code>&lt;canvas&gt;</code>  <code>innerHTML</code>  HTML </p>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>egret.HtmlTextParser</code>  HTML  <code>egret.TextField#textFlow</code> </p>\n<p></p>\n<ol>\n<li>SVG </li>\n<li> HTML  CSS </li>\n</ol>\n<p> Egret  API </p>\n<ol>\n<li> <code>&lt;canvas&gt;</code>  <code>z-index</code>  HTML </li>\n<li> HTML Egret  UI</li>\n<li> HTML  <code>html2canvas</code>  Egret </li>\n</ol>\n<p> Egret  HTML </p>\n<p><img src=\"http://img.mrsingsing.com/cq-img1.png\" alt=\"cq-img1\"></p>\n<p> HTML </p>\n<p> SVG  SVG  XML  Egret </p>\n<p> AI  Electron  HTML  <a href=\"https://github.com/niklasvh/html2canvas\" target=\"_blank\" rel=\"noopener\">html2canvas</a>  Base64  Egret </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> 10  10 </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64ByHtml2Canvas</span>(<span class=\"params\">dataInfo</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    (<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ID </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> dataList = <span class=\"built_in\">Object</span>.values(dataInfo);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isValidObjectArray(dataList)) &#123;</span><br><span class=\"line\">          resolve(&#123;&#125;);</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> groups = [];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  10  10 </span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> x = <span class=\"number\">0</span>; x &lt; <span class=\"built_in\">Math</span>.ceil(dataList.length / <span class=\"number\">10</span>); x++) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> start = x * <span class=\"number\">10</span>;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> end = start + <span class=\"number\">10</span>;</span><br><span class=\"line\">          groups.push(dataList.slice(start, end));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> taskList <span class=\"keyword\">of</span> groups) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> taskResult = <span class=\"keyword\">await</span> createHtml2CanvasPromise(taskList);</span><br><span class=\"line\"></span><br><span class=\"line\">          result = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, result, taskResult);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        resolve(result);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        reject(err);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createHtml2CanvasPromise</span>(<span class=\"params\">dataList</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> root = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'html2canvas'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      root.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> documentFragment = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\"></span><br><span class=\"line\">      dataList.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">        div.classList.add(<span class=\"string\">'container'</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        div.innerHTML = item.questionContentTranslate;</span><br><span class=\"line\">        div.dataset.id = item.questionId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> tagNames: any = div.querySelectorAll(<span class=\"string\">'.spark-formula-frame'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tagNames.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          tagNames.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">            item.width = item.width * <span class=\"number\">2</span>;</span><br><span class=\"line\">            item.height = item.height * <span class=\"number\">2</span>;</span><br><span class=\"line\">            item.style.margin = <span class=\"string\">'0 10px'</span>;</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        documentFragment.appendChild(div);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      root.appendChild(documentFragment);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">let</span> images = <span class=\"built_in\">Array</span>.from(root.getElementsByTagName(<span class=\"string\">'img'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> renderContent = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">          images = images.filter(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item &amp;&amp; !item.complete);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (images.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> clientRect = root.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//  html2canvas </span></span><br><span class=\"line\">            html2canvasformula(root, &#123;</span><br><span class=\"line\">              backgroundColor: <span class=\"literal\">null</span>,</span><br><span class=\"line\">              useCORS: <span class=\"literal\">true</span>,</span><br><span class=\"line\">              width: clientRect.width,</span><br><span class=\"line\">              height: clientRect.height,</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">              .then(<span class=\"function\"><span class=\"params\">canvas</span> =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//  html2canvas  canvas </span></span><br><span class=\"line\">                <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"built_in\">document</span>.body.append(canvas);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> result = dataList.reduce(<span class=\"function\">(<span class=\"params\">acc, item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"keyword\">const</span> elementRef = <span class=\"built_in\">Array</span>.from(root.children)[index];</span><br><span class=\"line\">                  <span class=\"keyword\">const</span> clientRect = elementRef.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"comment\">// Base64</span></span><br><span class=\"line\">                  <span class=\"keyword\">const</span> base64 = cutImg(ctx, index + <span class=\"number\">1</span>, clientRect.width, clientRect.height);</span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"comment\">// </span></span><br><span class=\"line\">                  <span class=\"keyword\">const</span> payload: any = &#123;</span><br><span class=\"line\">                    questionId: item.questionId,</span><br><span class=\"line\">                    answer:</span><br><span class=\"line\">                      item.questionExplains &amp;&amp; isValidObjectArray(item.questionExplains)</span><br><span class=\"line\">                        ? item.questionExplains[<span class=\"number\">0</span>].answerTranslate</span><br><span class=\"line\">                        : <span class=\"literal\">null</span>,</span><br><span class=\"line\">                    audioUrl:</span><br><span class=\"line\">                      item.audioList &amp;&amp; isValidObjectArray(item.audioList)</span><br><span class=\"line\">                        ? item.audioList[<span class=\"number\">0</span>].audioUrl</span><br><span class=\"line\">                        : <span class=\"literal\">null</span>,</span><br><span class=\"line\">                    content: base64,</span><br><span class=\"line\">                  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                  acc[item.questionId] = payload;</span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"keyword\">return</span> acc;</span><br><span class=\"line\">                &#125;, &#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                resolve(result);</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">              .catch(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">                resolve(&#123;&#125;);</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            clearTimeout(timer);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            renderContent();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">250</span>);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      renderContent();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">      reject(err);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cutImg</span>(<span class=\"params\">ctx, index, width, height</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//  Retina </span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> devicePixelRatio = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.devicePixelRatio) &#123;</span><br><span class=\"line\">    devicePixelRatio = <span class=\"built_in\">window</span>.devicePixelRatio;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 1008</span></span><br><span class=\"line\">  <span class=\"comment\">// 730</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> imgWidth = (width || <span class=\"number\">1008</span>) * devicePixelRatio;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> imgHeight = (height || <span class=\"number\">730</span>) * devicePixelRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> sw = index * imgWidth - imgWidth;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> imageData = ctx.getImageData(sw, <span class=\"number\">0</span>, imgWidth, imgHeight);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">  canvas.width = imgWidth;</span><br><span class=\"line\">  canvas.height = imgHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">  context.putImageData(imageData, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> canvas.toDataURL();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>html2canvas</code>  DOM  Canvas  <code>canvas.toDataURL</code>  Base64</p>\n<p>2021  2  html2canvasv1.0.0-rc.7 demo innerHTML  HTML  DOM 1980 </p>\n<p> html2canvas  canvas  html2canvas  <code>filter: invert(1)</code> </p>\n<p> canvas  toDataURL  Base64 </p>\n<p><img src=\"http://img.mrsingsing.com/cq-img2.png\" alt=\"cq-img2\"></p>\n<p><a href=\"https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259\" target=\"_blank\" rel=\"noopener\">https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259</a></p>\n<p> <code>html2canvas</code>  HTML  Canvas  <code>renderReplacedElement</code> <code>ctx.restore()</code>  <code>filter</code> </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filterImage</span>(<span class=\"params\">box: Bounds, filter: <span class=\"built_in\">any</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> devicePixelRatio = <span class=\"built_in\">window</span>.devicePixelRatio || <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"comment\">// Retina </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalBox: <span class=\"built_in\">any</span> = &#123;</span><br><span class=\"line\">    left: devicePixelRatio * box.left,</span><br><span class=\"line\">    top: devicePixelRatio * box.top,</span><br><span class=\"line\">    width: devicePixelRatio * box.width,</span><br><span class=\"line\">    height: devicePixelRatio * box.height,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> imageData: ImageData = <span class=\"keyword\">this</span>.ctx.getImageData(</span><br><span class=\"line\">    finalBox.left,</span><br><span class=\"line\">    finalBox.top,</span><br><span class=\"line\">    finalBox.width,</span><br><span class=\"line\">    finalBox.height</span><br><span class=\"line\">  );</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> imgWidth = imageData.width,</span><br><span class=\"line\">    imgHeight = imageData.height;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; imgHeight; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt; imgWidth; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = i * <span class=\"number\">4</span> * imgWidth + j * <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">let</span> red = imageData.data[index];</span><br><span class=\"line\">      <span class=\"keyword\">let</span> green = imageData.data[index + <span class=\"number\">1</span>];</span><br><span class=\"line\">      <span class=\"keyword\">let</span> blue = imageData.data[index + <span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">      imageData.data[index] = <span class=\"number\">255</span> - <span class=\"number\">2</span> * red + red;</span><br><span class=\"line\">      imageData.data[index + <span class=\"number\">1</span>] = <span class=\"number\">255</span> - <span class=\"number\">2</span> * green + green;</span><br><span class=\"line\">      imageData.data[index + <span class=\"number\">2</span>] = <span class=\"number\">255</span> - <span class=\"number\">2</span> * blue + blue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.ctx.putImageData(imageData, fialBox.left, fialBox.top);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Canvas  <code>ctx.getImageData</code>  ImageData </p>\n<p> <code>data</code><code>width</code>  <code>height</code> <code>data</code>  Uint8ClampedArray8 <code>data</code>  4  RGBAlpha </p>\n<p> RGB  255  RGB  RGB </p>\n<p> Canvas  Retina </p>\n<p><img src=\"http://img.mrsingsing.com/cq-img3.png\" alt=\"cq-img3\"></p>\n<p></p>\n<p> <a href=\"https://www.npmjs.com/package/patch-package\" target=\"_blank\" rel=\"noopener\">patch-package</a>  npm  npm  git diff  <a href=\"https://zhuanlan.zhihu.com/p/310266801\" target=\"_blank\" rel=\"noopener\"> node_modules </a></p>\n<p> <code>patch-package</code>  node_modules  npm  ES6  ES5 </p>\n<p> html2canvas  ES5  clone  npm </p>\n<p> Base64  Egret  egret.BitmapData </p>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> QuestionContent <span class=\"keyword\">extends</span> eui.Component <span class=\"keyword\">implements</span> eui.UIComponent &#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> initQuestionContent(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> img: HTMLImageElement = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">    <span class=\"comment\">// this.questionInfo.content  Base64</span></span><br><span class=\"line\">    img.src = <span class=\"keyword\">this</span>.questionInfo.content;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> isAudio = <span class=\"keyword\">this</span>.questionInfo.audioUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    img.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> width = <span class=\"number\">0</span>,</span><br><span class=\"line\">        height = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> avaliableWidth = <span class=\"keyword\">this</span>.contentGroup.width;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> avaliableHeight = <span class=\"keyword\">this</span>.contentGroup.height;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isAudio) &#123;</span><br><span class=\"line\">        avaliableHeight = avaliableHeight - <span class=\"number\">130</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (img.width &gt; img.height) &#123;</span><br><span class=\"line\">        height = img.height * (avaliableWidth / img.width);</span><br><span class=\"line\">        width = avaliableWidth;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        width = img.width * (avaliableHeight / img.height);</span><br><span class=\"line\">        height = avaliableHeight;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      img.width = width;</span><br><span class=\"line\">      img.height = height;</span><br><span class=\"line\">      img[<span class=\"string\">'avaliable'</span>] = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> bitmapdata: egret.BitmapData = <span class=\"keyword\">new</span> egret.BitmapData(img);</span><br><span class=\"line\">      <span class=\"keyword\">const</span> texture: egret.Texture = <span class=\"keyword\">new</span> egret.Texture();</span><br><span class=\"line\">      texture.disposeBitmapData = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      texture.bitmapData = bitmapdata;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.contentBitmap = <span class=\"keyword\">new</span> egret.Bitmap(texture);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  103 </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isAudio) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.contentBitmap.y = <span class=\"number\">103</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.contentGroup.addChild(<span class=\"keyword\">this</span>.contentBitmap);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/cq-img4.png\" alt=\"cq-img4\"></p>\n<p><img src=\"http://img.mrsingsing.com/cq-img5.png\" alt=\"cq-img5\"></p>\n<p></p>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000038551328\" target=\"_blank\" rel=\"noopener\">html2canvas </a></li>\n<li><a href=\"https://segmentfault.com/a/1190000011478657\" target=\"_blank\" rel=\"noopener\"> html2canvas </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Egret  HTML  WebGL DOM  <code>&lt;canvas&gt;</code>  <code>innerHTML</code>  HTML </p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>egret.HtmlTextParser</code>  HTML  <code>egret.TextField#textFlow</code> </p>\n<p></p>\n<ol>\n<li>SVG </li>\n<li> HTML  CSS </li>\n</ol>\n<p> Egret  API </p>\n<ol>\n<li> <code>&lt;canvas&gt;</code>  <code>z-index</code>  HTML </li>\n<li> HTML Egret  UI</li>\n<li> HTML  <code>html2canvas</code>  Egret </li>\n</ol>\n<p> Egret  HTML </p>\n<p><img src=\"http://img.mrsingsing.com/cq-img1.png\" alt=\"cq-img1\"></p>\n<p> HTML </p>\n<p> SVG  SVG  XML  Egret </p>\n<p> AI  Electron  HTML  <a href=\"https://github.com/niklasvh/html2canvas\" target=\"_blank\" rel=\"noopener\">html2canvas</a>  Base64  Egret </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> 10  10 </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getBase64ByHtml2Canvas</span>(<span class=\"params\">dataInfo</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    (<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  ID </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> dataList = <span class=\"built_in\">Object</span>.values(dataInfo);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isValidObjectArray(dataList)) &#123;</span><br><span class=\"line\">          resolve(&#123;&#125;);</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> result = &#123;&#125;;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> groups = [];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  10  10 </span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> x = <span class=\"number\">0</span>; x &lt; <span class=\"built_in\">Math</span>.ceil(dataList.length / <span class=\"number\">10</span>); x++) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> start = x * <span class=\"number\">10</span>;</span><br><span class=\"line\">          <span class=\"keyword\">let</span> end = start + <span class=\"number\">10</span>;</span><br><span class=\"line\">          groups.push(dataList.slice(start, end));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> taskList <span class=\"keyword\">of</span> groups) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> taskResult = <span class=\"keyword\">await</span> createHtml2CanvasPromise(taskList);</span><br><span class=\"line\"></span><br><span class=\"line\">          result = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, result, taskResult);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        resolve(result);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        reject(err);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createHtml2CanvasPromise</span>(<span class=\"params\">dataList</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> root = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'html2canvas'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      root.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> documentFragment = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\"></span><br><span class=\"line\">      dataList.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">        div.classList.add(<span class=\"string\">'container'</span>);</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        div.innerHTML = item.questionContentTranslate;</span><br><span class=\"line\">        div.dataset.id = item.questionId;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> tagNames: any = div.querySelectorAll(<span class=\"string\">'.spark-formula-frame'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (tagNames.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          tagNames.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">            item.width = item.width * <span class=\"number\">2</span>;</span><br><span class=\"line\">            item.height = item.height * <span class=\"number\">2</span>;</span><br><span class=\"line\">            item.style.margin = <span class=\"string\">'0 10px'</span>;</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        documentFragment.appendChild(div);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      root.appendChild(documentFragment);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">let</span> images = <span class=\"built_in\">Array</span>.from(root.getElementsByTagName(<span class=\"string\">'img'</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> renderContent = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> timer = setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">          images = images.filter(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item &amp;&amp; !item.complete);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (images.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> clientRect = root.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//  html2canvas </span></span><br><span class=\"line\">            html2canvasformula(root, &#123;</span><br><span class=\"line\">              backgroundColor: <span class=\"literal\">null</span>,</span><br><span class=\"line\">              useCORS: <span class=\"literal\">true</span>,</span><br><span class=\"line\">              width: clientRect.width,</span><br><span class=\"line\">              height: clientRect.height,</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">              .then(<span class=\"function\"><span class=\"params\">canvas</span> =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//  html2canvas  canvas </span></span><br><span class=\"line\">                <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"built_in\">document</span>.body.append(canvas);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">const</span> result = dataList.reduce(<span class=\"function\">(<span class=\"params\">acc, item, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                  <span class=\"keyword\">const</span> elementRef = <span class=\"built_in\">Array</span>.from(root.children)[index];</span><br><span class=\"line\">                  <span class=\"keyword\">const</span> clientRect = elementRef.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"comment\">// Base64</span></span><br><span class=\"line\">                  <span class=\"keyword\">const</span> base64 = cutImg(ctx, index + <span class=\"number\">1</span>, clientRect.width, clientRect.height);</span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"comment\">// </span></span><br><span class=\"line\">                  <span class=\"keyword\">const</span> payload: any = &#123;</span><br><span class=\"line\">                    questionId: item.questionId,</span><br><span class=\"line\">                    answer:</span><br><span class=\"line\">                      item.questionExplains &amp;&amp; isValidObjectArray(item.questionExplains)</span><br><span class=\"line\">                        ? item.questionExplains[<span class=\"number\">0</span>].answerTranslate</span><br><span class=\"line\">                        : <span class=\"literal\">null</span>,</span><br><span class=\"line\">                    audioUrl:</span><br><span class=\"line\">                      item.audioList &amp;&amp; isValidObjectArray(item.audioList)</span><br><span class=\"line\">                        ? item.audioList[<span class=\"number\">0</span>].audioUrl</span><br><span class=\"line\">                        : <span class=\"literal\">null</span>,</span><br><span class=\"line\">                    content: base64,</span><br><span class=\"line\">                  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                  acc[item.questionId] = payload;</span><br><span class=\"line\"></span><br><span class=\"line\">                  <span class=\"keyword\">return</span> acc;</span><br><span class=\"line\">                &#125;, &#123;&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">                resolve(result);</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">              .catch(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">                resolve(&#123;&#125;);</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            clearTimeout(timer);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            renderContent();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">250</span>);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      renderContent();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">      reject(err);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">cutImg</span>(<span class=\"params\">ctx, index, width, height</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//  Retina </span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> devicePixelRatio = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.devicePixelRatio) &#123;</span><br><span class=\"line\">    devicePixelRatio = <span class=\"built_in\">window</span>.devicePixelRatio;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 1008</span></span><br><span class=\"line\">  <span class=\"comment\">// 730</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> imgWidth = (width || <span class=\"number\">1008</span>) * devicePixelRatio;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> imgHeight = (height || <span class=\"number\">730</span>) * devicePixelRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> sw = index * imgWidth - imgWidth;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> imageData = ctx.getImageData(sw, <span class=\"number\">0</span>, imgWidth, imgHeight);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">  canvas.width = imgWidth;</span><br><span class=\"line\">  canvas.height = imgHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">  context.putImageData(imageData, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> canvas.toDataURL();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>html2canvas</code>  DOM  Canvas  <code>canvas.toDataURL</code>  Base64</p>\n<p>2021  2  html2canvasv1.0.0-rc.7 demo innerHTML  HTML  DOM 1980 </p>\n<p> html2canvas  canvas  html2canvas  <code>filter: invert(1)</code> </p>\n<p> canvas  toDataURL  Base64 </p>\n<p><img src=\"http://img.mrsingsing.com/cq-img2.png\" alt=\"cq-img2\"></p>\n<p><a href=\"https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259\" target=\"_blank\" rel=\"noopener\">https://github.com/niklasvh/html2canvas/blob/3982df1492bdc40a8e5fa16877cc0291883c8e1a/src/render/canvas/canvas-renderer.ts#L259</a></p>\n<p> <code>html2canvas</code>  HTML  Canvas  <code>renderReplacedElement</code> <code>ctx.restore()</code>  <code>filter</code> </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filterImage</span>(<span class=\"params\">box: Bounds, filter: <span class=\"built_in\">any</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> devicePixelRatio = <span class=\"built_in\">window</span>.devicePixelRatio || <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"comment\">// Retina </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalBox: <span class=\"built_in\">any</span> = &#123;</span><br><span class=\"line\">    left: devicePixelRatio * box.left,</span><br><span class=\"line\">    top: devicePixelRatio * box.top,</span><br><span class=\"line\">    width: devicePixelRatio * box.width,</span><br><span class=\"line\">    height: devicePixelRatio * box.height,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> imageData: ImageData = <span class=\"keyword\">this</span>.ctx.getImageData(</span><br><span class=\"line\">    finalBox.left,</span><br><span class=\"line\">    finalBox.top,</span><br><span class=\"line\">    finalBox.width,</span><br><span class=\"line\">    finalBox.height</span><br><span class=\"line\">  );</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> imgWidth = imageData.width,</span><br><span class=\"line\">    imgHeight = imageData.height;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; imgHeight; i++) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> j = <span class=\"number\">0</span>; j &lt; imgWidth; j++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = i * <span class=\"number\">4</span> * imgWidth + j * <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">let</span> red = imageData.data[index];</span><br><span class=\"line\">      <span class=\"keyword\">let</span> green = imageData.data[index + <span class=\"number\">1</span>];</span><br><span class=\"line\">      <span class=\"keyword\">let</span> blue = imageData.data[index + <span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">      imageData.data[index] = <span class=\"number\">255</span> - <span class=\"number\">2</span> * red + red;</span><br><span class=\"line\">      imageData.data[index + <span class=\"number\">1</span>] = <span class=\"number\">255</span> - <span class=\"number\">2</span> * green + green;</span><br><span class=\"line\">      imageData.data[index + <span class=\"number\">2</span>] = <span class=\"number\">255</span> - <span class=\"number\">2</span> * blue + blue;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.ctx.putImageData(imageData, fialBox.left, fialBox.top);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Canvas  <code>ctx.getImageData</code>  ImageData </p>\n<p> <code>data</code><code>width</code>  <code>height</code> <code>data</code>  Uint8ClampedArray8 <code>data</code>  4  RGBAlpha </p>\n<p> RGB  255  RGB  RGB </p>\n<p> Canvas  Retina </p>\n<p><img src=\"http://img.mrsingsing.com/cq-img3.png\" alt=\"cq-img3\"></p>\n<p></p>\n<p> <a href=\"https://www.npmjs.com/package/patch-package\" target=\"_blank\" rel=\"noopener\">patch-package</a>  npm  npm  git diff  <a href=\"https://zhuanlan.zhihu.com/p/310266801\" target=\"_blank\" rel=\"noopener\"> node_modules </a></p>\n<p> <code>patch-package</code>  node_modules  npm  ES6  ES5 </p>\n<p> html2canvas  ES5  clone  npm </p>\n<p> Base64  Egret  egret.BitmapData </p>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> QuestionContent <span class=\"keyword\">extends</span> eui.Component <span class=\"keyword\">implements</span> eui.UIComponent &#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> initQuestionContent(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> img: HTMLImageElement = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">    <span class=\"comment\">// this.questionInfo.content  Base64</span></span><br><span class=\"line\">    img.src = <span class=\"keyword\">this</span>.questionInfo.content;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> isAudio = <span class=\"keyword\">this</span>.questionInfo.audioUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    img.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> width = <span class=\"number\">0</span>,</span><br><span class=\"line\">        height = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> avaliableWidth = <span class=\"keyword\">this</span>.contentGroup.width;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> avaliableHeight = <span class=\"keyword\">this</span>.contentGroup.height;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isAudio) &#123;</span><br><span class=\"line\">        avaliableHeight = avaliableHeight - <span class=\"number\">130</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (img.width &gt; img.height) &#123;</span><br><span class=\"line\">        height = img.height * (avaliableWidth / img.width);</span><br><span class=\"line\">        width = avaliableWidth;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        width = img.width * (avaliableHeight / img.height);</span><br><span class=\"line\">        height = avaliableHeight;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      img.width = width;</span><br><span class=\"line\">      img.height = height;</span><br><span class=\"line\">      img[<span class=\"string\">'avaliable'</span>] = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> bitmapdata: egret.BitmapData = <span class=\"keyword\">new</span> egret.BitmapData(img);</span><br><span class=\"line\">      <span class=\"keyword\">const</span> texture: egret.Texture = <span class=\"keyword\">new</span> egret.Texture();</span><br><span class=\"line\">      texture.disposeBitmapData = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      texture.bitmapData = bitmapdata;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.contentBitmap = <span class=\"keyword\">new</span> egret.Bitmap(texture);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  103 </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isAudio) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.contentBitmap.y = <span class=\"number\">103</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.contentGroup.addChild(<span class=\"keyword\">this</span>.contentBitmap);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/cq-img4.png\" alt=\"cq-img4\"></p>\n<p><img src=\"http://img.mrsingsing.com/cq-img5.png\" alt=\"cq-img5\"></p>\n<p></p>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000038551328\" target=\"_blank\" rel=\"noopener\">html2canvas </a></li>\n<li><a href=\"https://segmentfault.com/a/1190000011478657\" target=\"_blank\" rel=\"noopener\"> html2canvas </a></li>\n</ul>"},{"title":"","date":"2021-06-06T00:00:00.000Z","_content":"\n AI  AI \n\n## \n\n1. \n\n-  AI  4GB  Web  30  60 \n- \n\n2. \n\n- \n\n + \n\n<!-- more -->\n\n AI \n\n![web-video-editor-img1](http://img.mrsingsing.com/web-video-editor-img1.png)\n\n\n\n## \n\nAI \n\n![web-video-editor-infra-1](http://img.mrsingsing.com/web-video-editor-infra-img1.png)\n\n- \n- \n- \n\n\n\n![web-video-editor-infra-2](http://img.mrsingsing.com/web-video-editor-infra-img2.png)\n\n\n\n## \n\n- [ Web ](https://www.infoq.cn/article/M2JR9t57w75MvItd7FF3)\n","source":"_posts/web-video-editor-infra.md","raw":"---\ntitle: \ndate: '2021-06-06'\n---\n\n AI  AI \n\n## \n\n1. \n\n-  AI  4GB  Web  30  60 \n- \n\n2. \n\n- \n\n + \n\n<!-- more -->\n\n AI \n\n![web-video-editor-img1](http://img.mrsingsing.com/web-video-editor-img1.png)\n\n\n\n## \n\nAI \n\n![web-video-editor-infra-1](http://img.mrsingsing.com/web-video-editor-infra-img1.png)\n\n- \n- \n- \n\n\n\n![web-video-editor-infra-2](http://img.mrsingsing.com/web-video-editor-infra-img2.png)\n\n\n\n## \n\n- [ Web ](https://www.infoq.cn/article/M2JR9t57w75MvItd7FF3)\n","slug":"web-video-editor-infra","published":1,"updated":"2021-09-29T17:00:57.556Z","_id":"cku5qxpfn00016v1pubioffce","comments":1,"layout":"post","photos":[],"link":"","content":"<p> AI  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li></li>\n</ol>\n<ul>\n<li> AI  4GB  Web  30  60 </li>\n<li></li>\n</ul>\n<ol start=\"2\">\n<li></li>\n</ol>\n<ul>\n<li></li>\n</ul>\n<p> + </p>\n<a id=\"more\"></a>\n<p> AI </p>\n<p><img src=\"http://img.mrsingsing.com/web-video-editor-img1.png\" alt=\"web-video-editor-img1\"></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>AI </p>\n<p><img src=\"http://img.mrsingsing.com/web-video-editor-infra-img1.png\" alt=\"web-video-editor-infra-1\"></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/web-video-editor-infra-img2.png\" alt=\"web-video-editor-infra-2\"></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://www.infoq.cn/article/M2JR9t57w75MvItd7FF3\" target=\"_blank\" rel=\"noopener\"> Web </a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p> AI  AI </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li></li>\n</ol>\n<ul>\n<li> AI  4GB  Web  30  60 </li>\n<li></li>\n</ul>\n<ol start=\"2\">\n<li></li>\n</ol>\n<ul>\n<li></li>\n</ul>\n<p> + </p>","more":"<p> AI </p>\n<p><img src=\"http://img.mrsingsing.com/web-video-editor-img1.png\" alt=\"web-video-editor-img1\"></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>AI </p>\n<p><img src=\"http://img.mrsingsing.com/web-video-editor-infra-img1.png\" alt=\"web-video-editor-infra-1\"></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/web-video-editor-infra-img2.png\" alt=\"web-video-editor-infra-2\"></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><a href=\"https://www.infoq.cn/article/M2JR9t57w75MvItd7FF3\" target=\"_blank\" rel=\"noopener\"> Web </a></li>\n</ul>"},{"title":"","date":"2021-06-12T00:00:00.000Z","_content":"\n\n\n>  Angular  Angular \n\n## \n\n Web Web \n\n### \n\n\n\n```html\n<input multiple type=\"file\" accept=\"video/mp4\" (change)=\"handleVideoMaterialUpload\" />\n```\n\n```js\nimport axios from 'axios';\n\nfunction handleUpload(e) {\n  const uploadUrl = 'https://upload-url.com/';\n  const fileList = e.target.files;\n\n  // \n  // do something\n\n  // do something \n  const formData = new FormData();\n\n  formData.append('file', filesList[0]);\n\n  axios\n    .post(uploadUrl, formData)\n    .then(res => {\n      console.log('', res);\n    })\n    .catch(err => {\n      console.log('', err);\n    });\n}\n```\n\n\n\n<!-- more -->\n\n### \n\n `dragOver`  `drop`  `e.dataTransfer` \n\n```html\n<div class=\"drag-area\" (dragOver)=\"onDragOver\" (drop)=\"onDrop\"></div>\n```\n\n```js\nfunction onDragOver(e) {\n  const fileList = e.dataTransfer.files;\n\n  // do something \n}\n```\n\n\n\n### \n\n [  OSS](https://help.aliyun.com/product/31815.html)[  COS](https://cloud.tencent.com/document/product/436)\n\n OSS  OSS  OSS \n\n![upload-swim](http://img.mrsingsing.com/upload-swim.jpg)\n\n## \n\n `window.URL.createObjectURL`  Blob  `<video>`   `video`  `canplay`  Canvas \n\n `video.play`  `try...catch` \n\n```js\nconst captureImagePreview = async (videoFile: File) => {\n  return new Promise((resolve, reject) => {\n    \t(async () => {\n        const captureArea = document.getElementById('captureArea');\n      \t// \n      \tconst video = document.createElement('video');\n      \tvideo.muted = true;\n\n    \t\t//  blob \n      \tconst blobUrl = window.URL.createObjectURL(videoFile);\n\n      \tvideo.src = blobUrl;\n\n    \t\t//  video DOM \n      \tcaptureArea.appendChild(video);\n\n    \t\t// \n      \tvideo.addEventListener('canplay', e => {\n        \tlet imgHeight = 0,\n            imgWidth = 0,\n            videoWidth = 0,\n            videoHeight = 0;\n        \tconst video: any = e.target;\n\n        //  Canvas \n        const canvas = document.createElement('canvas');\n        const canvasCtx = canvas.getContext('2d');\n        const blobUrl = window.URL.createObjectURL(videoFile);\n\n        //  video \n        canvas.width = imgWidth = video.offsetWidth;\n        canvas.height = imgHeight = video.offsetHeight;\n\n        // \n        videoWidth = video.videoWidth;\n        videoHeight = video.videoHeight;\n\n        try {\n        \tawait (video as HTMLVideoElement).play();\n        } catch (err) {\n        \tthis.$notification('');\n\n          resolve(null);\n          return;\n        }\n\n        video.pause();\n\n        // canvas.drawImage  HTMLVideoElement \n        canvasCtx.drawImage(\n          video,\n          imgWidth - videoWidth,\n          (imgHeight - videoHeight) / 2,\n          videoWidth,\n          videoHeight,\n          imgWidth - videoWidth,\n          (imgHeight - videoHeight) / 2,\n          videoWidth,\n          videoHeight,\n        );\n\n        canvas.toBlob(blob => {\n          // \n          const url = URL.createObjectURL(blob);\n\n          const material: Material = {\n            // \n            duration: video.duration,\n            //  Blob \n            videoCoverUrl: url,\n            // \n            videoName: videoFile.name,\n            //  uuid  videoId\n            videoId: CommonUtils.generateUUID(),\n            // \n            status: MaterialStatus.Parse,\n            file: videoFile,\n            // \n            fileSize: videoFile.size,\n            //  ID\n            fileId: this.aiMatchBordcastService.fileId,\n            //  Blob \n            blobUrl: blobUrl,\n            // \n            createDttm: +new Date(),\n          };\n\n          resolve(material);\n\n          captureArea.removeChild(video);\n      \t})();\n      });\n  })\n}\n```\n\n## \n\n\n\n### \n\n![located-cursor](http://img.mrsingsing.com/located-cursor.gif)\n\n\n\n UI \n\n\n\n transform: translateX() \n\n```js\nconst CONSTANTS = {\n  /**  */\n  RULER_INTEGER_SPACING: 80,\n  /**  */\n  INDICATOR_WIDTH: 30,\n  /**  */\n  CURSOR_INITIAL_VALUE: 31,\n};\n\nconst handleLocatedCursoRedirect = ({\n    cursorShift = CONSTANTS.CURSOR_INITIAL_VALUE,\n    duration,\n    frameBeginTime,\n    framework,\n    anchor = null,\n  }) => {\n\t\tif (!cursorShift) return;\n\n    // \n    if (!this.videoTrackList.length) {\n      this.currentDuration = 0;\n      this.setLocatedCursor = null;\n      this.currentLocatedBeginTime = 0;\n      this.currentLocatedFramework = null;\n      this.currentLocatedAnchor = null;\n\n      this.setLocationInfo();\n\n      return;\n    }\n\n    let currentDuration = 0;\n    // \n    if (CommonUtils.isDefined(duration)) {\n      currentDuration = duration;\n    } else {\n      // \n      const mouseDuration =\n        ((((cursorShift - CONSTANTS.CURSOR_INITIAL_VALUE) / CONSTANTS.RULER_INTEGER_SPACING) * this.scaleRatio).toFixed(2) as any) * 1;\n\n      // \n      if (mouseDuration >= this.totalDuration) {\n        currentDuration = this.totalDuration;\n        cursorShift =\n          this.lastFrameworkClientRect.left - this.indicatorClientRect.left + this.lastFrameworkClientRect.width;\n      } else {\n        currentDuration = mouseDuration;\n      }\n    }\n\n    // \n    this.currentDuration = currentDuration;\n\n    // \n    this.setLocatedCursor = cursorShift;\n\n    // \n    if (!framework) {\n      try {\n        const { frameBeginTime, frameworkId, anchorId } = this.getFrameworkInfoByDuration(cursorShift);\n\n        this.currentLocatedBeginTime = frameBeginTime;\n        this.currentLocatedFramework = this.videoTrackList.find(item => item.id === frameworkId);\n        this.currentLocatedAnchor = anchorId\n          ? this.videoTrackList.find(item => item.id === frameworkId).dataList.find(item => `${item.id}` === anchorId)\n          : null;\n      } catch (err) {\n        console.log(err);\n      }\n    } else {\n      // \n      this.currentLocatedBeginTime = frameBeginTime;\n      // \n      this.currentLocatedFramework = framework;\n      // \n      this.currentLocatedAnchor = anchor;\n    }\n\n  \t// \n    this.setLocationInfo();\n\n  \t// \n    return currentDuration;\n}\n```\n\n### \n\n![preview-cursor](http://img.mrsingsing.com/preview-cursor.gif)\n\n `mousenter`  `mousemove`  `mouseleave` \n\n### \n\n![magnet-cursor](http://img.mrsingsing.com/magnet-cursor.gif)\n\n\n\n DOM \n\n `translate` \n\n![magnet-area](http://img.mrsingsing.com/magnet-area.png)\n\n\n\n```less\n// \n.magnet-area-item {\n  box-sizing: border-box;\n  position: absolute;\n  top: 0;\n  max-width: 80px;\n  height: 100%;\n  z-index: 1450;\n  /*  */\n  background-color: rgba(255, 0, 0, 0.3);\n\n  &.first {\n    transform: translate3d(0, 0, 0);\n\n    &.active {\n      .magnet-area-cursor {\n        left: 0;\n        transform: none;\n      }\n    }\n  }\n\n  &.last {\n    transform: translate3d(-100%, 0, 0);\n\n    &.active {\n      .magnet-area-cursor {\n        left: initial;\n        right: 0;\n        transform: none;\n      }\n    }\n  }\n\n  &.active {\n    // \n    .magnet-area-cursor {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 50%;\n      width: 2px;\n      height: 100%;\n      background-color: #1db368;\n      transform: translateX(-50%);\n    }\n  }\n}\n```\n\n```js\n  const initMagnetArea = () => {\n    this.currentMagnetAreaList = [];\n\n    //  DOM \n    const frameworkList = this.indicatorRef.nativeElement.parentElement.querySelectorAll(\n      '.framework-item',\n    ) as NodeListOf<HTMLDivElement>;\n\n    const indicatorLeft = this.indicatorClientRect.left;\n\n    this.currentMagnetAreaList = Array.from(frameworkList).reduce(\n      (acc: any, item: HTMLDivElement, index: number) => {\n\n        //  DOM \n        const frameworkRect = item.getBoundingClientRect();\n\n        // \n        // \n        // \n        //  30% \n        const currentWidth = frameworkRect.width * 0.3;\n        // \n        const areaWidth = index === 0 ? currentWidth : currentWidth + acc.prevWidth;\n        // \n        const areaShift = index === 0 ? 0 : (acc.prevWidth / areaWidth) * 100;\n\n        acc.list.push({\n          id: item.dataset.id,\n          areaWidth: areaWidth,\n          areaTranform: `translateX(-${areaShift}%)`,\n          areaLeft: frameworkRect.left - indicatorLeft + 'px',\n          cursorLeft: areaShift + '%',\n        });\n\n        //  30% \n        // \n        // \n        if (index === frameworkList.length - 1) {\n          acc.list.push({\n            id: null,\n            areaWidth: currentWidth,\n            areaTranform: 'translateX(-100%)',\n            areaLeft: frameworkRect.right - indicatorLeft + 'px',\n            cursorLeft: 'initial',\n          });\n        }\n\n        acc.prevWidth = currentWidth;\n\n        return acc;\n      },\n      {\n        list: [],\n        // \n        // 30% 60%\n        prevWidth: null,\n      },\n    ).list;\n  }\n```\n\n## \n\n Web \n\n1.  Canvas Bilibili \n2.  DOM  DOM \n\n![ruler1](http://img.mrsingsing.com/ruler1.gif)\n\n![ruler2](http://img.mrsingsing.com/ruler2.gif)\n\n\n\n1.  `<canvas>`  DPR \n2. \n3.  Canvas \n4. \n\n```ts\nexport class RecordVideoTimelineRulerComponent implements OnInit {\n  /**  */\n  @Input()\n  scaleRatio: number;\n  /**  */\n  @Input()\n  maxScaleValue: number;\n  /**  */\n  public canvasWidth: number;\n  /**  DOM  */\n  public canvasElement: HTMLCanvasElement;\n  /**  */\n  public canvasContext: CanvasRenderingContext2D;\n\n  ngOnInit(): void {\n    this.initCanvas();\n  }\n\n  ngOnChanges(changes: { [propName: string]: SimpleChange }) {\n    const scaleRatio = changes['scaleRatio'];\n\n    if (\n      scaleRatio &&\n      (!scaleRatio.previousValue || scaleRatio.previousValue !== scaleRatio.currentValue)\n    ) {\n      this.drawCanvas();\n    }\n  }\n\n  /**\n   * \n   */\n  initCanvas(): void {\n    const canvas = document.getElementById('canvas') as HTMLCanvasElement;\n    this.canvasElement = canvas;\n\n    const ctx = canvas.getContext('2d');\n    this.canvasContext = ctx;\n\n    const documentBodyWidth = document.body.clientWidth || document.documentElement.clientWidth;\n    this.canvasWidth = documentBodyWidth;\n\n    if (window.devicePixelRatio) {\n      const devicePixelRatio = window.devicePixelRatio;\n\n      canvas.width = devicePixelRatio * this.canvasWidth;\n      canvas.height = devicePixelRatio * 26;\n\n      // \n      ctx.scale(devicePixelRatio, devicePixelRatio);\n    }\n\n    this.drawCanvas();\n  }\n\n  /**\n   * \n   */\n  drawCanvas(): void {\n    const scrollX = 0;\n    const ctx = this.canvasContext;\n\n    if (!ctx) return;\n\n    const canvasWidth = this.canvasWidth;\n    const canvasHeight = 26;\n\n    // \n    const offsetX = (scrollX ? 30 - scrollX : 30) + 0.5;\n\n    // \n    const totalScaleValue = this.maxScaleValue;\n\n    const startCount = Math.max(parseInt('' + Math.floor((scrollX - 30) / 16), 10), 0);\n    const endCount = Math.min(\n      parseInt('' + Math.ceil((scrollX + canvasWidth - 30) / 16), 10) - 1,\n      totalScaleValue\n    );\n\n    //  \n    const division = 15;\n    // \n    const integerHeight = 14 || Math.floor(canvasHeight * 0.53);\n    // \n    const divisionHeight = 8 || Math.floor(canvasHeight * 0.3);\n    // \n    const textHeight = 21 || Math.floor(canvasHeight * 0.78);\n    // \n    const scaleRatio = this.scaleRatio;\n\n    ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n\n    // \n    // \n    for (let i = startCount; i < endCount; i++) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.strokeStyle = '#595959';\n      ctx.lineWidth = 1;\n      ctx.lineCap = 'round';\n\n      const moveTo = offsetX + i * (division + 1);\n      ctx.moveTo(moveTo, 0);\n\n      if (i % 5 === 0) {\n        ctx.lineTo(offsetX + i * (division + 1), integerHeight);\n      } else {\n        ctx.lineTo(offsetX + i * (division + 1), divisionHeight);\n      }\n\n      ctx.stroke();\n      ctx.restore();\n      ctx.closePath();\n    }\n\n    // \n    ctx.beginPath();\n    ctx.font = '10px Arial';\n    ctx.fillStyle = '#AAAAAA';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    const seperatedScaleValue = totalScaleValue / 5;\n    for (let i = 0; i < seperatedScaleValue; i++) {\n      const text = this.formatTimeScaleText(i, scaleRatio);\n      ctx.fillText(text, offsetX + 80 * i, textHeight);\n    }\n\n    ctx.closePath();\n  }\n\n  /**\n   * \n   * @param index  0 \n   * @param ratio \n   * @description  HH:MM:SS.ss \n   */\n  formatTimeScaleText(index: number, ratio: number): string {\n    const totalSeconds = index * ratio;\n\n    let hour: number | string = 0;\n    let minute: number | string = 0;\n    let second: number | string = 0;\n    const millisecond = '00';\n\n    hour = Math.floor(totalSeconds / 3600);\n    minute = Math.floor((totalSeconds - hour * 3600) / 60);\n    second = ratio >= 60 ? 0 : Math.floor(totalSeconds - hour * 3600 - minute * 60);\n\n    hour = this.fixZero(hour);\n    minute = this.fixZero(minute);\n    second = this.fixZero(second);\n\n    return `${hour}:${minute}:${second}.${millisecond}`;\n  }\n\n  /**\n   * \n   */\n  fixZero(value: any): string {\n    return value * 1 < 10 ? `0${value}` : `${value}`;\n  }\n}\n```\n\n\n\n\n\n1. 5  1  1  0.2s=200ms\n2. 5  1 =60s 1  0.2min=12s=12000ms\n3. 5  3 =180s 1  0.6min=36s=36000ms\n4. 5  6 =360s 1  1.2min=62s=62000ms\n\n## \n\n Web \n\n\n\n![drag-and-drop](http://img.mrsingsing.com/drag-and-drop.png)\n\n drag & drop  drag & drop  mouse  drag & drop  mouse \n\nHTML  API \n\n|      |   |                                                   |\n| :----------- | :-------- | :---------------------------------------------------- |\n|  | dragstart |                                   |\n|              | drag      |                                   |\n|              | dragend   |                                   |\n|    | dragenter |       |\n|              | dragover  |  100ms  |\n|              | dragleave |             |\n|              | drop      |                                   |\n\n### \n\n mouse  drag \n\n `mousedown`  `mousemove`  `mousemove`  `mousedown`  `dragTolerance` 5 5 \n\n HTML  draggable  true  false \n\n  `draggable`  `mousedown`  `draggable`  darggable  DOM  `mousedown` \n\n\n\n```ts\n@Directive({\n  selector: '[ssDraggable]',\n})\nexport class SSDraggableDirective implements OnInit {\n  constructor(public el: ElementRef, public zone: NgZone, public viewContainer: ViewContainerRef) {\n    this.currentElement = el.nativeElement;\n  }\n\n  public ngOnInit(): void {\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n  }\n\n  public ngAfterContentInit() {\n    if (this.currentElement) {\n      this.currentElement.onmousedown = this.onMouseDown.bind(this);\n    }\n  }\n\n  /**\n   * \n   */\n  private get currentElementDraggable() {\n    if (typeof this.draggable === 'function') {\n      return this.draggable({\n        // \n        data: this.data,\n        //  DOM \n        mousedownElement: this.mousedownElement,\n      });\n    }\n\n    return this.draggable;\n  }\n\n  /**\n   * \n   */\n  onMouseDown(e: MouseEvent): void {\n    e.preventDefault();\n\n    this.mousedownElement = e.target as HTMLElement;\n\n    if (!this.currentElementDraggable) return;\n\n    this.clicked = true;\n\n    // \n    this.startX = e.pageX;\n    this.startY = e.pageY;\n\n    document.defaultView?.addEventListener('mousemove', this.onMouseMove);\n    document.defaultView?.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  /**\n   * \n   */\n  onMouseMove(e: MouseEvent): void {\n    // do something\n  }\n\n  /**\n   * \n   */\n  onMouseUp(e: MouseEvent): void {\n    // do something\n  }\n}\n```\n\n mousedown  dragStart\n\n Angular  clone  DOM \n\n ng-template  HTML  DOM \n\n![drag-anchor](http://img.mrsingsing.com/drag-anchor.gif)\n\n```xml\n<!--  -->\n<ng-template #ssDraggableAnchorGhost>\n  <div\n    class=\"drag-anchor-ghost\"\n    [attr.data-type]=\"DragGhostElementType.ANCHOR\"\n  >\n    <div class=\"ghost-cursor\"></div>\n    <div class=\"ghost-placeholder\"></div>\n  </div>\n</ng-template>\n```\n\n DOM  DOM  `Node.cloneNode()`  DOM  DOM CSS \n\n DOM  getComputedStyle\n\n CSS \n\n![drag-video](http://img.mrsingsing.com/drag-video.gif)\n\n```ts\nexport class SSDraggableDirective implements OnInit {\n  /**\n   * \n   */\n  cloneGhostElement(element: Element): Element {\n    const clonedElement = element.cloneNode(true) as HTMLElement;\n\n    const originalStyles: CSSStyleDeclaration = document.defaultView.getComputedStyle(element, '');\n\n    for (const cssProperty of styleProperties) {\n      clonedElement.style[cssProperty] = originalStyles[cssProperty];\n    }\n\n    clonedElement.style.pointerEvents = 'none';\n\n    const originalElementChildren = element.getElementsByTagName('*') as HTMLCollectionOf<\n      HTMLElement\n    >;\n    const clonedElementChildren = clonedElement.getElementsByTagName('*') as HTMLCollectionOf<\n      HTMLElement\n    >;\n\n    for (let i = originalElementChildren.length - 1; i--; ) {\n      const originalChild = originalElementChildren[i];\n      const clonedChild = clonedElementChildren[i];\n      const originElementStyles = document.defaultView.getComputedStyle(originalChild, '');\n\n      for (const cssProperty of styleProperties) {\n        clonedChild.style[cssProperty] = originElementStyles[cssProperty];\n      }\n\n      clonedChild.style.pointerEvents = 'none';\n    }\n\n    return clonedElement;\n  }\n}\n```\n\n\n\n```ts\ninterface SSDraggableBaseEventArgs {\n  originalEvent: MouseEvent;\n  ghostElement: Nullable<HTMLElement>;\n  startX: number;\n  startY: number;\n  pageX: number;\n  pageY: number;\n  cancel: boolean;\n}\n\nexport class SSDraggableDirective implements OnInit {\n  /**\n   * \n   */\n  onMouseMove(e: MouseEvent) {\n    const { pageX, pageY } = e;\n\n    if (this.clicked) {\n      const totalMovedX = pageX - this.startX;\n      const totalMovedY = pageY - this.startY;\n\n      if (\n        !this.dragStarted &&\n        (Math.abs(totalMovedX) > this.dragTolerance || Math.abs(totalMovedY) > this.dragTolerance)\n      ) {\n        const dragStartArgs: SSDraggableBaseEventArgs = {\n          originalEvent: e,\n          ghostElement: this.ghostElement,\n          startX: this.startX,\n          startY: this.startY,\n          pageX,\n          pageY,\n          cancel: false,\n        };\n\n        this.zone.run(() => {\n          this.dragStart.emit(dragStartArgs);\n        });\n\n        if (dragStartArgs.cancel) {\n          this.destoryEventListener();\n\n          return;\n        }\n\n        const clientRect = this.currentElement.getBoundingClientRect();\n\n        this.baseX = clientRect.left;\n        this.baseY = clientRect.top;\n\n        this.dragStarted = true;\n\n        // \n        this.createGhostElement(pageX, pageY);\n      } else if (!this.dragStarted) {\n        return;\n      }\n\n      const dragMoveArgs: SSDraggableDragMoveArgs = {\n        originalEvent: e,\n        ghostElement: this.ghostElement,\n        startX: this.startX,\n        startY: this.startY,\n        pageX: this.lastX,\n        pageY: this.lastY,\n        nextPageX: e.pageX,\n        nextPageY: e.pageY,\n        cancel: false,\n      };\n\n      this.dragMove.emit(dragMoveArgs);\n\n      const setPageX = dragMoveArgs.nextPageX;\n      const setPageY = dragMoveArgs.nextPageY;\n\n      if (!dragMoveArgs.cancel) {\n        this.ghostLeft = this.dragDirection === DragDirection.VERTICAL ? this.baseX : setPageX;\n        this.ghostTop = this.dragDirection === DragDirection.HORIZONTAL ? this.baseY : setPageY;\n\n        this.dispatchDragEvent(pageX, pageY, e);\n      }\n\n      this.lastX = setPageX;\n      this.lastY = setPageY;\n    }\n  }\n\n  /**\n   * \n   */\n  createGhostElement(pageX: number, pageY: number) {\n    let dynamicGhostRef;\n    //\n    if (this.ghostTemplate) {\n      dynamicGhostRef = this.viewContainer.createEmbeddedView(this.ghostTemplate, null);\n      this.ghostElement = dynamicGhostRef.rootNodes[0];\n    } else {\n      const clonedElement = this.cloneGhostElement(this.currentElement);\n\n      const ghostContainer = document.createElement('div');\n      ghostContainer.appendChild(clonedElement);\n\n      if (this.currentElement.dataset) {\n        Object.entries(this.currentElement.dataset).forEach(([key, value]) => {\n          ghostContainer.setAttribute(`data-${key}`, value);\n        });\n      }\n\n      this.ghostElement = ghostContainer;\n    }\n\n    if (this.ghostElement) {\n      const createEventArgs = {\n        ghostElement: this.ghostElement,\n        cancel: false,\n      };\n\n      this.ghostCreate.emit(createEventArgs);\n\n      if (createEventArgs.cancel) {\n        this.ghostElement = null;\n\n        if (this.ghostTemplate && dynamicGhostRef) {\n          dynamicGhostRef.destroy();\n        }\n        return;\n      }\n\n      this.ghostElement.style.position = 'absolute';\n      this.ghostElement.style.pointerEvents = 'none';\n      this.ghostElement.style.zIndex = this.ghostIndex;\n      this.ghostElement.style.transform =\n        this.dragDirection === DragDirection.BOTH ? 'translate3d(-50%, -50%, 0)' : null;\n      //  left \n      this.ghostElement.style.left =\n        this.dragDirection === DragDirection.VERTICAL ? this.baseX + 'px' : pageX + 'px';\n      //  right \n      this.ghostElement.style.top =\n        this.dragDirection === DragDirection.HORIZONTAL ? this.baseY + 'px' : pageY + 'px';\n      this.ghostElement.style.width = 'auto';\n      this.ghostElement.style.height = 'auto';\n      this.ghostElement.style.cursor = 'grabbing';\n\n      document.body.appendChild(this.ghostElement);\n\n      this.ghostElement.addEventListener('pointerup', args => {\n        this.onMouseUp(args);\n      });\n    }\n  }\n}\n```\n\n mouseup  drop \n\n```ts\nexport class SSDrggableDirective implements OnInit {\n  /**\n   * \n   */\n  onMouseUp(e: MouseEvent) {\n    if (!this.clicked) return;\n\n    this.clicked = false;\n    this.dragStarted = false;\n\n    const dragEndArgs = {\n      originalEvent: e,\n      ghostElement: this.ghostElement,\n      startX: this.startX,\n      startY: this.startY,\n      pageX: e.pageX,\n      pageY: e.pageY,\n      data: this.data,\n      cancel: false,\n    };\n\n    this.zone.run(() => {\n      this.dragEnd.emit(dragEndArgs);\n    });\n\n    this.dispatchDropEvent(e.pageX, e.pageY, e);\n\n    if (this.ghostElement) {\n      this.ghostElement.parentNode?.removeChild(this.ghostElement);\n      this.ghostElement = null;\n    }\n\n    this.destoryEventListener();\n  }\n}\n```\n\n mouse  drag & drop  drag & drop  dataTransfer \n\n clickmousedownblur \n\n\n\n```ts\n// \nconst event = documet.createEvent('Event');\n\n//  build\nevent.initEvent('build', true, true);\n\n// \nevent.addEventListener(\n  'build',\n  function(e) {\n    // e.target\n  },\n  false\n);\n\n// \nelem.dispatchEvent(Event);\n```\n\n getElementsAtPoint \n\n drag  drop \n\n- dispatchDragEvent dragEnterdragLeave \n- dispatchDropEvent drop \n- dispatchEvent\n\n```ts\nexport class SSDraggableDirective implements OnInit {\n  dispatchDragEvent(pageX: number, pageY: number, originalEvent: MouseEvent) {\n    let dropArea;\n\n    const customEventArgs: SSDraggableCustomEventDetail = {\n      data: { ...this.data },\n      originalEvent,\n      ghostElement: this.ghostElement,\n      startX: this.startX,\n      startY: this.startY,\n      pageX,\n      pageY,\n      cancel: false,\n    };\n\n    // \n    const elementsFromPoint = this.getElementsAtPoint(pageX, pageY);\n    const dropAreaFlag = this.dropAreaFlag;\n\n    for (const element of elementsFromPoint) {\n      if (\n        element.getAttribute(dropAreaFlag) === 'true' &&\n        element !== this.ghostElement &&\n        element !== this.currentElement\n      ) {\n        dropArea = element;\n        break;\n      }\n    }\n\n    if (dropArea && (!this.lastDropArea || (this.lastDropArea && this.lastDropArea !== dropArea))) {\n      if (this.lastDropArea) {\n        this.dispatchEvent(this.lastDropArea, 'ssDragLeave', customEventArgs);\n      }\n\n      this.lastDropArea = dropArea;\n      this.dispatchEvent(dropArea, 'ssDragEnter', customEventArgs);\n    } else if (!dropArea && this.lastDropArea) {\n      this.dispatchEvent(this.lastDropArea, 'ssDragLeave', customEventArgs);\n      this.lastDropArea = null;\n      return;\n    }\n\n    if (dropArea) {\n      this.dispatchEvent(dropArea, 'ssDragOver', customEventArgs);\n    }\n  }\n\n  dispatchDropEvent(pageX: number, pageY: number, originalEvent: MouseEvent) {\n    const customEventArgs = {\n      ghostElement: this.ghostElement,\n      originalEvent,\n      startX: this.startX,\n      startY: this.startY,\n      pageX,\n      pageY,\n      data: this.data,\n      cancel: false,\n    };\n\n    this.dispatchEvent(this.lastDropArea, 'ssDrop', customEventArgs);\n  }\n\n  dispatchEvent(\n    target: Nullable<HTMLElement>,\n    eventName: string,\n    eventArgs: SSDraggableCustomEventDetail\n  ) {\n    if (target) {\n      const customEvent = document.createEvent('CustomEvent');\n      customEvent.initCustomEvent(eventName, false, false, eventArgs);\n      target.dispatchEvent(customEvent);\n    }\n  }\n\n  protected getElementsAtPoint(pageX: number, pageY: number) {\n    const viewPortX = pageX - window.pageXOffset;\n    const viewPortY = pageY - window.pageYOffset;\n\n    if (document['msElementsFromPoint']) {\n      const elements = document['msElementsFromPoint'](viewPortX, viewPortY);\n      return elements === null ? [] : elements;\n    } else {\n      return document.elementsFromPoint(viewPortX, viewPortY);\n    }\n  }\n}\n```\n\n Angular  mouse  drag  API \n\n| API           |                          |                      |\n| :------------ | :--------------------------- | :----------------------- |\n| data          |            | any                      |\n| draggable     |                    | boolean \\| () => boolean |\n| ghostTemplate |  | `TemplateRef<any>`       |\n| ghostIndex    |                | string                   |\n| dragTolerance |            | number                   |\n| dragDirection |                          | DragDirection            |\n| dropAreaFlag  |    | string                   |\n\n> dropAreaFlag  drop  drop  data-\\*  attribute\n\n|          |                |\n| :----------- | :----------------- |\n| dragStart    |      |\n| dragMove     |  |\n| dragEnd      |      |\n| ghostCreate  |  |\n| ghostDestory |  |\n\n### \n\n drop  drag \n\n```ts\n@Directive({\n  selector: '[ssDroppable]',\n})\nexport class SSDroppableDirective implements OnInit {\n  public currentElement: Nullable<HTMLElement> = null;\n\n  @Input()\n  public dropAreaFlag = 'ssdroppable';\n\n  @Output()\n  public dragEnter = new EventEmitter<CustomEvent>();\n\n  @Output()\n  public dragOver = new EventEmitter<CustomEvent>();\n\n  @Output()\n  public dragLeave = new EventEmitter<CustomEvent>();\n\n  @Output()\n  public drop = new EventEmitter<CustomEvent>();\n\n  constructor(public el: ElementRef, public zone: NgZone) {\n    this.currentElement = el.nativeElement;\n  }\n\n  public ngOnInit(): void {\n    this.onDragEnter = this.onDragEnter.bind(this);\n    this.onDragOver = this.onDragOver.bind(this);\n    this.onDragLeave = this.onDragLeave.bind(this);\n    this.onDrop = this.onDrop.bind(this);\n\n    if (!this.currentElement) return;\n\n    this.currentElement.setAttribute(this.dropAreaFlag, 'true');\n\n    this.currentElement.addEventListener('ssDragEnter', this.onDragEnter as EventListener);\n    this.currentElement.addEventListener('ssDragOver', this.onDragOver as EventListener);\n    this.currentElement.addEventListener('ssDragLeave', this.onDragLeave as EventListener);\n    this.currentElement.addEventListener('ssDrop', this.onDrop as EventListener);\n  }\n\n  /**\n   * \n   */\n  public onDragEnter(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.dragEnter.emit(e);\n    });\n  }\n\n  /**\n   * \n   */\n  public onDragOver(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.dragOver.emit(e);\n    });\n  }\n\n  /**\n   * \n   */\n  public onDragLeave(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.dragLeave.emit(e);\n    });\n  }\n\n  /**\n   * \n   */\n  public onDrop(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.drop.emit(e);\n    });\n  }\n}\n```\n\n## \n\n\n\n\n\n- \n- \n\n### \n\n video  play  Canvas  `toDataURL` \n\n```ts\nexport class SSVideoPreviewDirective implements OnInit {\n  @Input()\n  public previewList;\n\n  @Input()\n  public blobUrl;\n\n  /**  */\n  @Input()\n  public beginTime: number;\n\n  /**  */\n  @Input()\n  public duration: number;\n\n  /**  */\n  @Input()\n  public scaleRatio: number;\n\n  public ngOnInit(): void {\n    if (this.imgList && this.imgList.length > 0) {\n      this.renderVideoPreviewByImageList();\n    } else if (this.blobUrl) {\n      this.renderVideoPreviewByBlobUrl();\n    }\n  }\n\n  //  Blob Url\n  public renderVideoPreviewByBlobUrl() {\n    // \n    const count = Math.ceil(this.duration / this.scaleRatio);\n    const frag = document.createDocumentFragment();\n\n    const durationList = [];\n    for (let i = 0; i < count; i++) {\n      //  i \n      const currentTime = this.beginTime + i * this.scaleRatio;\n\n      durationList.push(currentTime);\n    }\n\n    const promise = this.videoPicture({ videoUrl: this.blobUrl, seconds: durationList });\n\n    promise.then((imgList: string[]) => {\n      imgList.forEach((base64: string) => {\n        const div = document.createElement('div');\n\n        div.style.display = 'inline-block';\n        div.style.width = '80px';\n        div.style.height = '44px';\n        div.style.backgroundRepeat = 'no-repeat';\n        div.style.backgroundImage = `url(\"${base64}\")`;\n        div.style.backgroundSize = 'contain';\n        div.style.flexShrink = '0';\n\n        frag.appendChild(div);\n      });\n\n      this.currentElement.innerHTML = '';\n      this.currentElement.appendChild(frag);\n    });\n  }\n\n  /**\n   * \n   *\n   * @param videoData \n   * @param width  80px* 8 \n   * @param height  44px* 8 \n   * @param seconds    [1,3,4,5,6] 1 3 4 5 6\n   */\n  videoPicture({\n    videoUrl,\n    videoData,\n    width = 80 * 8,\n    height = 44 * 8,\n    seconds,\n  }: {\n    videoUrl?: string;\n    videoData?: File;\n    width?: number;\n    height?: number;\n    seconds: number[];\n  }) {\n    // \n    const container = document.createElement('div');\n    container.className = 'video-picture';\n    container.style.position = 'absolute';\n    // container.style.visibility = 'hidden';\n    container.style.left = '-9999px';\n    const video = document.createElement('video');\n    video.width = width;\n    video.height = height;\n    video.src = videoUrl || window.URL.createObjectURL(videoData);\n    container.appendChild(video);\n\n    // canvas\n    const canvas = document.createElement('canvas');\n    canvas.width = width; //\n    canvas.height = height; //\n    container.appendChild(canvas);\n\n    // \n    return new Promise(resolve => {\n      video.addEventListener('loadeddata', () => {\n        video.currentTime = 1;\n        video.play();\n      });\n      video.addEventListener('playing', async () => {\n        video.pause();\n        const captureVideoPromises = [];\n        for (let i = 0; i < seconds.length; i++) {\n          const captureVideoPromise = await this.captureVideoPromise(canvas, video, seconds[i]);\n          captureVideoPromises.push(captureVideoPromise);\n        }\n        Promise.all(captureVideoPromises).then(allSrcs => {\n          container.remove();\n          allSrcs.sort((a, b) => a.beginTime - b.beginTime);\n          const srcs = allSrcs.map(val => val.src);\n          resolve(srcs);\n        });\n      });\n\n      document.body.appendChild(container);\n    });\n  }\n\n  /**\n   * \n   * @param canvas\n   * @param video\n   * @param beginTime \n   */\n  private captureVideoPromise(canvas, video, beginTime) {\n    const videoWidth = video.width;\n    const videoHeight = video.height;\n    // \n    const ctx = canvas.getContext('2d');\n    return new Promise(resolve => {\n      const cutImg = () => {\n        video.removeEventListener('timeupdate', cutImg);\n\n        ctx.drawImage(video, 0, 0, videoWidth, videoHeight);\n        const dataUrl = canvas.toDataURL('image/png');\n        resolve({ beginTime: beginTime, src: dataUrl });\n      };\n      video.addEventListener('timeupdate', cutImg);\n      video.currentTime = beginTime;\n    });\n  }\n}\n```\n\n### \n\n\n\n1. \n2.  DOM  background \n3. \n\n\n\n ----  0  100 \n\n![sprite-preview](http://img.mrsingsing.com/sprite-preview.png)\n\n> \n>\n> - duration \n> - scaleRatio \n> - beginTime \n> - imgList \n\n1. \n2.  120  120 \n3.  10x10  0-99  100-199  100 \n4.  100  0  100 \n5.  0 \n6.  `(index % 10) * width` \n7.  `Math.floor(index / 10) * height` \n\n```ts\nexport class SSVideoPreviewDirective implements OnInit {\n  public renderVideoPreviewByImageList(): void {\n    // \n    const count = Math.ceil(this.duration / this.scaleRatio);\n    const frag = document.createDocumentFragment();\n\n    for (let i = 0; i < count; i++) {\n      const div = document.createElement('div');\n\n      //  i \n      const currentTime = this.beginTime + i * this.scaleRatio;\n      // \n      const groupIndex = Math.floor(currentTime / 100);\n      // 100x100 \n      const remainder = parseInt(`${currentTime}`) % 100 === 0 ? 1 : Math.ceil(currentTime) % 100;\n      //  \n      const index = remainder === 0 ? 99 : remainder - 1;\n\n      const url = this.imgList[groupIndex];\n      const x = (index % 10) * 80;\n      const y = Math.floor(index / 10) * 44;\n\n      div.style.display = 'inline-block';\n      div.style.width = '80px';\n      div.style.height = '44px';\n      div.style.backgroundRepeat = 'no-repeat';\n      div.style.backgroundImage = `url(\"${url}\")`;\n      div.style.backgroundPosition = `-${x}px -${y}px`;\n      div.style.backgroundSize = '800px 440px';\n      div.style.flexShrink = '0';\n\n      frag.appendChild(div);\n    }\n\n    this.currentElement.innerHTML = '';\n    this.currentElement.appendChild(frag);\n  }\n}\n```\n\n\n\n DOM  background-image  background-position backgroud-size  background-image  background-position \n\n 1xn  background-image  10x10 \n\n![tencent-preview](http://img.mrsingsing.com/tencent-preview.png)\n\n 10 x 10 \n\n\n\n\n## \n\n### \n\n\n\n clickmousedownmousemovemouseupcontextmeu  poiner-events: none \n\n document  click  document\n\n document  click  click  path  click\n\n![contextmenu](http://img.mrsingsing.com/contextmenu.gif)\n\n### \n\n\n\n duration  scrollTo \n\n## \n\n\n\n Web \n\n\n","source":"_posts/web-video-editor-practise.md","raw":"---\ntitle: \ndate: '2021-06-12'\n---\n\n\n\n>  Angular  Angular \n\n## \n\n Web Web \n\n### \n\n\n\n```html\n<input multiple type=\"file\" accept=\"video/mp4\" (change)=\"handleVideoMaterialUpload\" />\n```\n\n```js\nimport axios from 'axios';\n\nfunction handleUpload(e) {\n  const uploadUrl = 'https://upload-url.com/';\n  const fileList = e.target.files;\n\n  // \n  // do something\n\n  // do something \n  const formData = new FormData();\n\n  formData.append('file', filesList[0]);\n\n  axios\n    .post(uploadUrl, formData)\n    .then(res => {\n      console.log('', res);\n    })\n    .catch(err => {\n      console.log('', err);\n    });\n}\n```\n\n\n\n<!-- more -->\n\n### \n\n `dragOver`  `drop`  `e.dataTransfer` \n\n```html\n<div class=\"drag-area\" (dragOver)=\"onDragOver\" (drop)=\"onDrop\"></div>\n```\n\n```js\nfunction onDragOver(e) {\n  const fileList = e.dataTransfer.files;\n\n  // do something \n}\n```\n\n\n\n### \n\n [  OSS](https://help.aliyun.com/product/31815.html)[  COS](https://cloud.tencent.com/document/product/436)\n\n OSS  OSS  OSS \n\n![upload-swim](http://img.mrsingsing.com/upload-swim.jpg)\n\n## \n\n `window.URL.createObjectURL`  Blob  `<video>`   `video`  `canplay`  Canvas \n\n `video.play`  `try...catch` \n\n```js\nconst captureImagePreview = async (videoFile: File) => {\n  return new Promise((resolve, reject) => {\n    \t(async () => {\n        const captureArea = document.getElementById('captureArea');\n      \t// \n      \tconst video = document.createElement('video');\n      \tvideo.muted = true;\n\n    \t\t//  blob \n      \tconst blobUrl = window.URL.createObjectURL(videoFile);\n\n      \tvideo.src = blobUrl;\n\n    \t\t//  video DOM \n      \tcaptureArea.appendChild(video);\n\n    \t\t// \n      \tvideo.addEventListener('canplay', e => {\n        \tlet imgHeight = 0,\n            imgWidth = 0,\n            videoWidth = 0,\n            videoHeight = 0;\n        \tconst video: any = e.target;\n\n        //  Canvas \n        const canvas = document.createElement('canvas');\n        const canvasCtx = canvas.getContext('2d');\n        const blobUrl = window.URL.createObjectURL(videoFile);\n\n        //  video \n        canvas.width = imgWidth = video.offsetWidth;\n        canvas.height = imgHeight = video.offsetHeight;\n\n        // \n        videoWidth = video.videoWidth;\n        videoHeight = video.videoHeight;\n\n        try {\n        \tawait (video as HTMLVideoElement).play();\n        } catch (err) {\n        \tthis.$notification('');\n\n          resolve(null);\n          return;\n        }\n\n        video.pause();\n\n        // canvas.drawImage  HTMLVideoElement \n        canvasCtx.drawImage(\n          video,\n          imgWidth - videoWidth,\n          (imgHeight - videoHeight) / 2,\n          videoWidth,\n          videoHeight,\n          imgWidth - videoWidth,\n          (imgHeight - videoHeight) / 2,\n          videoWidth,\n          videoHeight,\n        );\n\n        canvas.toBlob(blob => {\n          // \n          const url = URL.createObjectURL(blob);\n\n          const material: Material = {\n            // \n            duration: video.duration,\n            //  Blob \n            videoCoverUrl: url,\n            // \n            videoName: videoFile.name,\n            //  uuid  videoId\n            videoId: CommonUtils.generateUUID(),\n            // \n            status: MaterialStatus.Parse,\n            file: videoFile,\n            // \n            fileSize: videoFile.size,\n            //  ID\n            fileId: this.aiMatchBordcastService.fileId,\n            //  Blob \n            blobUrl: blobUrl,\n            // \n            createDttm: +new Date(),\n          };\n\n          resolve(material);\n\n          captureArea.removeChild(video);\n      \t})();\n      });\n  })\n}\n```\n\n## \n\n\n\n### \n\n![located-cursor](http://img.mrsingsing.com/located-cursor.gif)\n\n\n\n UI \n\n\n\n transform: translateX() \n\n```js\nconst CONSTANTS = {\n  /**  */\n  RULER_INTEGER_SPACING: 80,\n  /**  */\n  INDICATOR_WIDTH: 30,\n  /**  */\n  CURSOR_INITIAL_VALUE: 31,\n};\n\nconst handleLocatedCursoRedirect = ({\n    cursorShift = CONSTANTS.CURSOR_INITIAL_VALUE,\n    duration,\n    frameBeginTime,\n    framework,\n    anchor = null,\n  }) => {\n\t\tif (!cursorShift) return;\n\n    // \n    if (!this.videoTrackList.length) {\n      this.currentDuration = 0;\n      this.setLocatedCursor = null;\n      this.currentLocatedBeginTime = 0;\n      this.currentLocatedFramework = null;\n      this.currentLocatedAnchor = null;\n\n      this.setLocationInfo();\n\n      return;\n    }\n\n    let currentDuration = 0;\n    // \n    if (CommonUtils.isDefined(duration)) {\n      currentDuration = duration;\n    } else {\n      // \n      const mouseDuration =\n        ((((cursorShift - CONSTANTS.CURSOR_INITIAL_VALUE) / CONSTANTS.RULER_INTEGER_SPACING) * this.scaleRatio).toFixed(2) as any) * 1;\n\n      // \n      if (mouseDuration >= this.totalDuration) {\n        currentDuration = this.totalDuration;\n        cursorShift =\n          this.lastFrameworkClientRect.left - this.indicatorClientRect.left + this.lastFrameworkClientRect.width;\n      } else {\n        currentDuration = mouseDuration;\n      }\n    }\n\n    // \n    this.currentDuration = currentDuration;\n\n    // \n    this.setLocatedCursor = cursorShift;\n\n    // \n    if (!framework) {\n      try {\n        const { frameBeginTime, frameworkId, anchorId } = this.getFrameworkInfoByDuration(cursorShift);\n\n        this.currentLocatedBeginTime = frameBeginTime;\n        this.currentLocatedFramework = this.videoTrackList.find(item => item.id === frameworkId);\n        this.currentLocatedAnchor = anchorId\n          ? this.videoTrackList.find(item => item.id === frameworkId).dataList.find(item => `${item.id}` === anchorId)\n          : null;\n      } catch (err) {\n        console.log(err);\n      }\n    } else {\n      // \n      this.currentLocatedBeginTime = frameBeginTime;\n      // \n      this.currentLocatedFramework = framework;\n      // \n      this.currentLocatedAnchor = anchor;\n    }\n\n  \t// \n    this.setLocationInfo();\n\n  \t// \n    return currentDuration;\n}\n```\n\n### \n\n![preview-cursor](http://img.mrsingsing.com/preview-cursor.gif)\n\n `mousenter`  `mousemove`  `mouseleave` \n\n### \n\n![magnet-cursor](http://img.mrsingsing.com/magnet-cursor.gif)\n\n\n\n DOM \n\n `translate` \n\n![magnet-area](http://img.mrsingsing.com/magnet-area.png)\n\n\n\n```less\n// \n.magnet-area-item {\n  box-sizing: border-box;\n  position: absolute;\n  top: 0;\n  max-width: 80px;\n  height: 100%;\n  z-index: 1450;\n  /*  */\n  background-color: rgba(255, 0, 0, 0.3);\n\n  &.first {\n    transform: translate3d(0, 0, 0);\n\n    &.active {\n      .magnet-area-cursor {\n        left: 0;\n        transform: none;\n      }\n    }\n  }\n\n  &.last {\n    transform: translate3d(-100%, 0, 0);\n\n    &.active {\n      .magnet-area-cursor {\n        left: initial;\n        right: 0;\n        transform: none;\n      }\n    }\n  }\n\n  &.active {\n    // \n    .magnet-area-cursor {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 50%;\n      width: 2px;\n      height: 100%;\n      background-color: #1db368;\n      transform: translateX(-50%);\n    }\n  }\n}\n```\n\n```js\n  const initMagnetArea = () => {\n    this.currentMagnetAreaList = [];\n\n    //  DOM \n    const frameworkList = this.indicatorRef.nativeElement.parentElement.querySelectorAll(\n      '.framework-item',\n    ) as NodeListOf<HTMLDivElement>;\n\n    const indicatorLeft = this.indicatorClientRect.left;\n\n    this.currentMagnetAreaList = Array.from(frameworkList).reduce(\n      (acc: any, item: HTMLDivElement, index: number) => {\n\n        //  DOM \n        const frameworkRect = item.getBoundingClientRect();\n\n        // \n        // \n        // \n        //  30% \n        const currentWidth = frameworkRect.width * 0.3;\n        // \n        const areaWidth = index === 0 ? currentWidth : currentWidth + acc.prevWidth;\n        // \n        const areaShift = index === 0 ? 0 : (acc.prevWidth / areaWidth) * 100;\n\n        acc.list.push({\n          id: item.dataset.id,\n          areaWidth: areaWidth,\n          areaTranform: `translateX(-${areaShift}%)`,\n          areaLeft: frameworkRect.left - indicatorLeft + 'px',\n          cursorLeft: areaShift + '%',\n        });\n\n        //  30% \n        // \n        // \n        if (index === frameworkList.length - 1) {\n          acc.list.push({\n            id: null,\n            areaWidth: currentWidth,\n            areaTranform: 'translateX(-100%)',\n            areaLeft: frameworkRect.right - indicatorLeft + 'px',\n            cursorLeft: 'initial',\n          });\n        }\n\n        acc.prevWidth = currentWidth;\n\n        return acc;\n      },\n      {\n        list: [],\n        // \n        // 30% 60%\n        prevWidth: null,\n      },\n    ).list;\n  }\n```\n\n## \n\n Web \n\n1.  Canvas Bilibili \n2.  DOM  DOM \n\n![ruler1](http://img.mrsingsing.com/ruler1.gif)\n\n![ruler2](http://img.mrsingsing.com/ruler2.gif)\n\n\n\n1.  `<canvas>`  DPR \n2. \n3.  Canvas \n4. \n\n```ts\nexport class RecordVideoTimelineRulerComponent implements OnInit {\n  /**  */\n  @Input()\n  scaleRatio: number;\n  /**  */\n  @Input()\n  maxScaleValue: number;\n  /**  */\n  public canvasWidth: number;\n  /**  DOM  */\n  public canvasElement: HTMLCanvasElement;\n  /**  */\n  public canvasContext: CanvasRenderingContext2D;\n\n  ngOnInit(): void {\n    this.initCanvas();\n  }\n\n  ngOnChanges(changes: { [propName: string]: SimpleChange }) {\n    const scaleRatio = changes['scaleRatio'];\n\n    if (\n      scaleRatio &&\n      (!scaleRatio.previousValue || scaleRatio.previousValue !== scaleRatio.currentValue)\n    ) {\n      this.drawCanvas();\n    }\n  }\n\n  /**\n   * \n   */\n  initCanvas(): void {\n    const canvas = document.getElementById('canvas') as HTMLCanvasElement;\n    this.canvasElement = canvas;\n\n    const ctx = canvas.getContext('2d');\n    this.canvasContext = ctx;\n\n    const documentBodyWidth = document.body.clientWidth || document.documentElement.clientWidth;\n    this.canvasWidth = documentBodyWidth;\n\n    if (window.devicePixelRatio) {\n      const devicePixelRatio = window.devicePixelRatio;\n\n      canvas.width = devicePixelRatio * this.canvasWidth;\n      canvas.height = devicePixelRatio * 26;\n\n      // \n      ctx.scale(devicePixelRatio, devicePixelRatio);\n    }\n\n    this.drawCanvas();\n  }\n\n  /**\n   * \n   */\n  drawCanvas(): void {\n    const scrollX = 0;\n    const ctx = this.canvasContext;\n\n    if (!ctx) return;\n\n    const canvasWidth = this.canvasWidth;\n    const canvasHeight = 26;\n\n    // \n    const offsetX = (scrollX ? 30 - scrollX : 30) + 0.5;\n\n    // \n    const totalScaleValue = this.maxScaleValue;\n\n    const startCount = Math.max(parseInt('' + Math.floor((scrollX - 30) / 16), 10), 0);\n    const endCount = Math.min(\n      parseInt('' + Math.ceil((scrollX + canvasWidth - 30) / 16), 10) - 1,\n      totalScaleValue\n    );\n\n    //  \n    const division = 15;\n    // \n    const integerHeight = 14 || Math.floor(canvasHeight * 0.53);\n    // \n    const divisionHeight = 8 || Math.floor(canvasHeight * 0.3);\n    // \n    const textHeight = 21 || Math.floor(canvasHeight * 0.78);\n    // \n    const scaleRatio = this.scaleRatio;\n\n    ctx.clearRect(0, 0, canvasWidth, canvasHeight);\n\n    // \n    // \n    for (let i = startCount; i < endCount; i++) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.strokeStyle = '#595959';\n      ctx.lineWidth = 1;\n      ctx.lineCap = 'round';\n\n      const moveTo = offsetX + i * (division + 1);\n      ctx.moveTo(moveTo, 0);\n\n      if (i % 5 === 0) {\n        ctx.lineTo(offsetX + i * (division + 1), integerHeight);\n      } else {\n        ctx.lineTo(offsetX + i * (division + 1), divisionHeight);\n      }\n\n      ctx.stroke();\n      ctx.restore();\n      ctx.closePath();\n    }\n\n    // \n    ctx.beginPath();\n    ctx.font = '10px Arial';\n    ctx.fillStyle = '#AAAAAA';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    const seperatedScaleValue = totalScaleValue / 5;\n    for (let i = 0; i < seperatedScaleValue; i++) {\n      const text = this.formatTimeScaleText(i, scaleRatio);\n      ctx.fillText(text, offsetX + 80 * i, textHeight);\n    }\n\n    ctx.closePath();\n  }\n\n  /**\n   * \n   * @param index  0 \n   * @param ratio \n   * @description  HH:MM:SS.ss \n   */\n  formatTimeScaleText(index: number, ratio: number): string {\n    const totalSeconds = index * ratio;\n\n    let hour: number | string = 0;\n    let minute: number | string = 0;\n    let second: number | string = 0;\n    const millisecond = '00';\n\n    hour = Math.floor(totalSeconds / 3600);\n    minute = Math.floor((totalSeconds - hour * 3600) / 60);\n    second = ratio >= 60 ? 0 : Math.floor(totalSeconds - hour * 3600 - minute * 60);\n\n    hour = this.fixZero(hour);\n    minute = this.fixZero(minute);\n    second = this.fixZero(second);\n\n    return `${hour}:${minute}:${second}.${millisecond}`;\n  }\n\n  /**\n   * \n   */\n  fixZero(value: any): string {\n    return value * 1 < 10 ? `0${value}` : `${value}`;\n  }\n}\n```\n\n\n\n\n\n1. 5  1  1  0.2s=200ms\n2. 5  1 =60s 1  0.2min=12s=12000ms\n3. 5  3 =180s 1  0.6min=36s=36000ms\n4. 5  6 =360s 1  1.2min=62s=62000ms\n\n## \n\n Web \n\n\n\n![drag-and-drop](http://img.mrsingsing.com/drag-and-drop.png)\n\n drag & drop  drag & drop  mouse  drag & drop  mouse \n\nHTML  API \n\n|      |   |                                                   |\n| :----------- | :-------- | :---------------------------------------------------- |\n|  | dragstart |                                   |\n|              | drag      |                                   |\n|              | dragend   |                                   |\n|    | dragenter |       |\n|              | dragover  |  100ms  |\n|              | dragleave |             |\n|              | drop      |                                   |\n\n### \n\n mouse  drag \n\n `mousedown`  `mousemove`  `mousemove`  `mousedown`  `dragTolerance` 5 5 \n\n HTML  draggable  true  false \n\n  `draggable`  `mousedown`  `draggable`  darggable  DOM  `mousedown` \n\n\n\n```ts\n@Directive({\n  selector: '[ssDraggable]',\n})\nexport class SSDraggableDirective implements OnInit {\n  constructor(public el: ElementRef, public zone: NgZone, public viewContainer: ViewContainerRef) {\n    this.currentElement = el.nativeElement;\n  }\n\n  public ngOnInit(): void {\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n  }\n\n  public ngAfterContentInit() {\n    if (this.currentElement) {\n      this.currentElement.onmousedown = this.onMouseDown.bind(this);\n    }\n  }\n\n  /**\n   * \n   */\n  private get currentElementDraggable() {\n    if (typeof this.draggable === 'function') {\n      return this.draggable({\n        // \n        data: this.data,\n        //  DOM \n        mousedownElement: this.mousedownElement,\n      });\n    }\n\n    return this.draggable;\n  }\n\n  /**\n   * \n   */\n  onMouseDown(e: MouseEvent): void {\n    e.preventDefault();\n\n    this.mousedownElement = e.target as HTMLElement;\n\n    if (!this.currentElementDraggable) return;\n\n    this.clicked = true;\n\n    // \n    this.startX = e.pageX;\n    this.startY = e.pageY;\n\n    document.defaultView?.addEventListener('mousemove', this.onMouseMove);\n    document.defaultView?.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  /**\n   * \n   */\n  onMouseMove(e: MouseEvent): void {\n    // do something\n  }\n\n  /**\n   * \n   */\n  onMouseUp(e: MouseEvent): void {\n    // do something\n  }\n}\n```\n\n mousedown  dragStart\n\n Angular  clone  DOM \n\n ng-template  HTML  DOM \n\n![drag-anchor](http://img.mrsingsing.com/drag-anchor.gif)\n\n```xml\n<!--  -->\n<ng-template #ssDraggableAnchorGhost>\n  <div\n    class=\"drag-anchor-ghost\"\n    [attr.data-type]=\"DragGhostElementType.ANCHOR\"\n  >\n    <div class=\"ghost-cursor\"></div>\n    <div class=\"ghost-placeholder\"></div>\n  </div>\n</ng-template>\n```\n\n DOM  DOM  `Node.cloneNode()`  DOM  DOM CSS \n\n DOM  getComputedStyle\n\n CSS \n\n![drag-video](http://img.mrsingsing.com/drag-video.gif)\n\n```ts\nexport class SSDraggableDirective implements OnInit {\n  /**\n   * \n   */\n  cloneGhostElement(element: Element): Element {\n    const clonedElement = element.cloneNode(true) as HTMLElement;\n\n    const originalStyles: CSSStyleDeclaration = document.defaultView.getComputedStyle(element, '');\n\n    for (const cssProperty of styleProperties) {\n      clonedElement.style[cssProperty] = originalStyles[cssProperty];\n    }\n\n    clonedElement.style.pointerEvents = 'none';\n\n    const originalElementChildren = element.getElementsByTagName('*') as HTMLCollectionOf<\n      HTMLElement\n    >;\n    const clonedElementChildren = clonedElement.getElementsByTagName('*') as HTMLCollectionOf<\n      HTMLElement\n    >;\n\n    for (let i = originalElementChildren.length - 1; i--; ) {\n      const originalChild = originalElementChildren[i];\n      const clonedChild = clonedElementChildren[i];\n      const originElementStyles = document.defaultView.getComputedStyle(originalChild, '');\n\n      for (const cssProperty of styleProperties) {\n        clonedChild.style[cssProperty] = originElementStyles[cssProperty];\n      }\n\n      clonedChild.style.pointerEvents = 'none';\n    }\n\n    return clonedElement;\n  }\n}\n```\n\n\n\n```ts\ninterface SSDraggableBaseEventArgs {\n  originalEvent: MouseEvent;\n  ghostElement: Nullable<HTMLElement>;\n  startX: number;\n  startY: number;\n  pageX: number;\n  pageY: number;\n  cancel: boolean;\n}\n\nexport class SSDraggableDirective implements OnInit {\n  /**\n   * \n   */\n  onMouseMove(e: MouseEvent) {\n    const { pageX, pageY } = e;\n\n    if (this.clicked) {\n      const totalMovedX = pageX - this.startX;\n      const totalMovedY = pageY - this.startY;\n\n      if (\n        !this.dragStarted &&\n        (Math.abs(totalMovedX) > this.dragTolerance || Math.abs(totalMovedY) > this.dragTolerance)\n      ) {\n        const dragStartArgs: SSDraggableBaseEventArgs = {\n          originalEvent: e,\n          ghostElement: this.ghostElement,\n          startX: this.startX,\n          startY: this.startY,\n          pageX,\n          pageY,\n          cancel: false,\n        };\n\n        this.zone.run(() => {\n          this.dragStart.emit(dragStartArgs);\n        });\n\n        if (dragStartArgs.cancel) {\n          this.destoryEventListener();\n\n          return;\n        }\n\n        const clientRect = this.currentElement.getBoundingClientRect();\n\n        this.baseX = clientRect.left;\n        this.baseY = clientRect.top;\n\n        this.dragStarted = true;\n\n        // \n        this.createGhostElement(pageX, pageY);\n      } else if (!this.dragStarted) {\n        return;\n      }\n\n      const dragMoveArgs: SSDraggableDragMoveArgs = {\n        originalEvent: e,\n        ghostElement: this.ghostElement,\n        startX: this.startX,\n        startY: this.startY,\n        pageX: this.lastX,\n        pageY: this.lastY,\n        nextPageX: e.pageX,\n        nextPageY: e.pageY,\n        cancel: false,\n      };\n\n      this.dragMove.emit(dragMoveArgs);\n\n      const setPageX = dragMoveArgs.nextPageX;\n      const setPageY = dragMoveArgs.nextPageY;\n\n      if (!dragMoveArgs.cancel) {\n        this.ghostLeft = this.dragDirection === DragDirection.VERTICAL ? this.baseX : setPageX;\n        this.ghostTop = this.dragDirection === DragDirection.HORIZONTAL ? this.baseY : setPageY;\n\n        this.dispatchDragEvent(pageX, pageY, e);\n      }\n\n      this.lastX = setPageX;\n      this.lastY = setPageY;\n    }\n  }\n\n  /**\n   * \n   */\n  createGhostElement(pageX: number, pageY: number) {\n    let dynamicGhostRef;\n    //\n    if (this.ghostTemplate) {\n      dynamicGhostRef = this.viewContainer.createEmbeddedView(this.ghostTemplate, null);\n      this.ghostElement = dynamicGhostRef.rootNodes[0];\n    } else {\n      const clonedElement = this.cloneGhostElement(this.currentElement);\n\n      const ghostContainer = document.createElement('div');\n      ghostContainer.appendChild(clonedElement);\n\n      if (this.currentElement.dataset) {\n        Object.entries(this.currentElement.dataset).forEach(([key, value]) => {\n          ghostContainer.setAttribute(`data-${key}`, value);\n        });\n      }\n\n      this.ghostElement = ghostContainer;\n    }\n\n    if (this.ghostElement) {\n      const createEventArgs = {\n        ghostElement: this.ghostElement,\n        cancel: false,\n      };\n\n      this.ghostCreate.emit(createEventArgs);\n\n      if (createEventArgs.cancel) {\n        this.ghostElement = null;\n\n        if (this.ghostTemplate && dynamicGhostRef) {\n          dynamicGhostRef.destroy();\n        }\n        return;\n      }\n\n      this.ghostElement.style.position = 'absolute';\n      this.ghostElement.style.pointerEvents = 'none';\n      this.ghostElement.style.zIndex = this.ghostIndex;\n      this.ghostElement.style.transform =\n        this.dragDirection === DragDirection.BOTH ? 'translate3d(-50%, -50%, 0)' : null;\n      //  left \n      this.ghostElement.style.left =\n        this.dragDirection === DragDirection.VERTICAL ? this.baseX + 'px' : pageX + 'px';\n      //  right \n      this.ghostElement.style.top =\n        this.dragDirection === DragDirection.HORIZONTAL ? this.baseY + 'px' : pageY + 'px';\n      this.ghostElement.style.width = 'auto';\n      this.ghostElement.style.height = 'auto';\n      this.ghostElement.style.cursor = 'grabbing';\n\n      document.body.appendChild(this.ghostElement);\n\n      this.ghostElement.addEventListener('pointerup', args => {\n        this.onMouseUp(args);\n      });\n    }\n  }\n}\n```\n\n mouseup  drop \n\n```ts\nexport class SSDrggableDirective implements OnInit {\n  /**\n   * \n   */\n  onMouseUp(e: MouseEvent) {\n    if (!this.clicked) return;\n\n    this.clicked = false;\n    this.dragStarted = false;\n\n    const dragEndArgs = {\n      originalEvent: e,\n      ghostElement: this.ghostElement,\n      startX: this.startX,\n      startY: this.startY,\n      pageX: e.pageX,\n      pageY: e.pageY,\n      data: this.data,\n      cancel: false,\n    };\n\n    this.zone.run(() => {\n      this.dragEnd.emit(dragEndArgs);\n    });\n\n    this.dispatchDropEvent(e.pageX, e.pageY, e);\n\n    if (this.ghostElement) {\n      this.ghostElement.parentNode?.removeChild(this.ghostElement);\n      this.ghostElement = null;\n    }\n\n    this.destoryEventListener();\n  }\n}\n```\n\n mouse  drag & drop  drag & drop  dataTransfer \n\n clickmousedownblur \n\n\n\n```ts\n// \nconst event = documet.createEvent('Event');\n\n//  build\nevent.initEvent('build', true, true);\n\n// \nevent.addEventListener(\n  'build',\n  function(e) {\n    // e.target\n  },\n  false\n);\n\n// \nelem.dispatchEvent(Event);\n```\n\n getElementsAtPoint \n\n drag  drop \n\n- dispatchDragEvent dragEnterdragLeave \n- dispatchDropEvent drop \n- dispatchEvent\n\n```ts\nexport class SSDraggableDirective implements OnInit {\n  dispatchDragEvent(pageX: number, pageY: number, originalEvent: MouseEvent) {\n    let dropArea;\n\n    const customEventArgs: SSDraggableCustomEventDetail = {\n      data: { ...this.data },\n      originalEvent,\n      ghostElement: this.ghostElement,\n      startX: this.startX,\n      startY: this.startY,\n      pageX,\n      pageY,\n      cancel: false,\n    };\n\n    // \n    const elementsFromPoint = this.getElementsAtPoint(pageX, pageY);\n    const dropAreaFlag = this.dropAreaFlag;\n\n    for (const element of elementsFromPoint) {\n      if (\n        element.getAttribute(dropAreaFlag) === 'true' &&\n        element !== this.ghostElement &&\n        element !== this.currentElement\n      ) {\n        dropArea = element;\n        break;\n      }\n    }\n\n    if (dropArea && (!this.lastDropArea || (this.lastDropArea && this.lastDropArea !== dropArea))) {\n      if (this.lastDropArea) {\n        this.dispatchEvent(this.lastDropArea, 'ssDragLeave', customEventArgs);\n      }\n\n      this.lastDropArea = dropArea;\n      this.dispatchEvent(dropArea, 'ssDragEnter', customEventArgs);\n    } else if (!dropArea && this.lastDropArea) {\n      this.dispatchEvent(this.lastDropArea, 'ssDragLeave', customEventArgs);\n      this.lastDropArea = null;\n      return;\n    }\n\n    if (dropArea) {\n      this.dispatchEvent(dropArea, 'ssDragOver', customEventArgs);\n    }\n  }\n\n  dispatchDropEvent(pageX: number, pageY: number, originalEvent: MouseEvent) {\n    const customEventArgs = {\n      ghostElement: this.ghostElement,\n      originalEvent,\n      startX: this.startX,\n      startY: this.startY,\n      pageX,\n      pageY,\n      data: this.data,\n      cancel: false,\n    };\n\n    this.dispatchEvent(this.lastDropArea, 'ssDrop', customEventArgs);\n  }\n\n  dispatchEvent(\n    target: Nullable<HTMLElement>,\n    eventName: string,\n    eventArgs: SSDraggableCustomEventDetail\n  ) {\n    if (target) {\n      const customEvent = document.createEvent('CustomEvent');\n      customEvent.initCustomEvent(eventName, false, false, eventArgs);\n      target.dispatchEvent(customEvent);\n    }\n  }\n\n  protected getElementsAtPoint(pageX: number, pageY: number) {\n    const viewPortX = pageX - window.pageXOffset;\n    const viewPortY = pageY - window.pageYOffset;\n\n    if (document['msElementsFromPoint']) {\n      const elements = document['msElementsFromPoint'](viewPortX, viewPortY);\n      return elements === null ? [] : elements;\n    } else {\n      return document.elementsFromPoint(viewPortX, viewPortY);\n    }\n  }\n}\n```\n\n Angular  mouse  drag  API \n\n| API           |                          |                      |\n| :------------ | :--------------------------- | :----------------------- |\n| data          |            | any                      |\n| draggable     |                    | boolean \\| () => boolean |\n| ghostTemplate |  | `TemplateRef<any>`       |\n| ghostIndex    |                | string                   |\n| dragTolerance |            | number                   |\n| dragDirection |                          | DragDirection            |\n| dropAreaFlag  |    | string                   |\n\n> dropAreaFlag  drop  drop  data-\\*  attribute\n\n|          |                |\n| :----------- | :----------------- |\n| dragStart    |      |\n| dragMove     |  |\n| dragEnd      |      |\n| ghostCreate  |  |\n| ghostDestory |  |\n\n### \n\n drop  drag \n\n```ts\n@Directive({\n  selector: '[ssDroppable]',\n})\nexport class SSDroppableDirective implements OnInit {\n  public currentElement: Nullable<HTMLElement> = null;\n\n  @Input()\n  public dropAreaFlag = 'ssdroppable';\n\n  @Output()\n  public dragEnter = new EventEmitter<CustomEvent>();\n\n  @Output()\n  public dragOver = new EventEmitter<CustomEvent>();\n\n  @Output()\n  public dragLeave = new EventEmitter<CustomEvent>();\n\n  @Output()\n  public drop = new EventEmitter<CustomEvent>();\n\n  constructor(public el: ElementRef, public zone: NgZone) {\n    this.currentElement = el.nativeElement;\n  }\n\n  public ngOnInit(): void {\n    this.onDragEnter = this.onDragEnter.bind(this);\n    this.onDragOver = this.onDragOver.bind(this);\n    this.onDragLeave = this.onDragLeave.bind(this);\n    this.onDrop = this.onDrop.bind(this);\n\n    if (!this.currentElement) return;\n\n    this.currentElement.setAttribute(this.dropAreaFlag, 'true');\n\n    this.currentElement.addEventListener('ssDragEnter', this.onDragEnter as EventListener);\n    this.currentElement.addEventListener('ssDragOver', this.onDragOver as EventListener);\n    this.currentElement.addEventListener('ssDragLeave', this.onDragLeave as EventListener);\n    this.currentElement.addEventListener('ssDrop', this.onDrop as EventListener);\n  }\n\n  /**\n   * \n   */\n  public onDragEnter(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.dragEnter.emit(e);\n    });\n  }\n\n  /**\n   * \n   */\n  public onDragOver(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.dragOver.emit(e);\n    });\n  }\n\n  /**\n   * \n   */\n  public onDragLeave(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.dragLeave.emit(e);\n    });\n  }\n\n  /**\n   * \n   */\n  public onDrop(e: CustomEvent): void {\n    this.zone.run(() => {\n      this.drop.emit(e);\n    });\n  }\n}\n```\n\n## \n\n\n\n\n\n- \n- \n\n### \n\n video  play  Canvas  `toDataURL` \n\n```ts\nexport class SSVideoPreviewDirective implements OnInit {\n  @Input()\n  public previewList;\n\n  @Input()\n  public blobUrl;\n\n  /**  */\n  @Input()\n  public beginTime: number;\n\n  /**  */\n  @Input()\n  public duration: number;\n\n  /**  */\n  @Input()\n  public scaleRatio: number;\n\n  public ngOnInit(): void {\n    if (this.imgList && this.imgList.length > 0) {\n      this.renderVideoPreviewByImageList();\n    } else if (this.blobUrl) {\n      this.renderVideoPreviewByBlobUrl();\n    }\n  }\n\n  //  Blob Url\n  public renderVideoPreviewByBlobUrl() {\n    // \n    const count = Math.ceil(this.duration / this.scaleRatio);\n    const frag = document.createDocumentFragment();\n\n    const durationList = [];\n    for (let i = 0; i < count; i++) {\n      //  i \n      const currentTime = this.beginTime + i * this.scaleRatio;\n\n      durationList.push(currentTime);\n    }\n\n    const promise = this.videoPicture({ videoUrl: this.blobUrl, seconds: durationList });\n\n    promise.then((imgList: string[]) => {\n      imgList.forEach((base64: string) => {\n        const div = document.createElement('div');\n\n        div.style.display = 'inline-block';\n        div.style.width = '80px';\n        div.style.height = '44px';\n        div.style.backgroundRepeat = 'no-repeat';\n        div.style.backgroundImage = `url(\"${base64}\")`;\n        div.style.backgroundSize = 'contain';\n        div.style.flexShrink = '0';\n\n        frag.appendChild(div);\n      });\n\n      this.currentElement.innerHTML = '';\n      this.currentElement.appendChild(frag);\n    });\n  }\n\n  /**\n   * \n   *\n   * @param videoData \n   * @param width  80px* 8 \n   * @param height  44px* 8 \n   * @param seconds    [1,3,4,5,6] 1 3 4 5 6\n   */\n  videoPicture({\n    videoUrl,\n    videoData,\n    width = 80 * 8,\n    height = 44 * 8,\n    seconds,\n  }: {\n    videoUrl?: string;\n    videoData?: File;\n    width?: number;\n    height?: number;\n    seconds: number[];\n  }) {\n    // \n    const container = document.createElement('div');\n    container.className = 'video-picture';\n    container.style.position = 'absolute';\n    // container.style.visibility = 'hidden';\n    container.style.left = '-9999px';\n    const video = document.createElement('video');\n    video.width = width;\n    video.height = height;\n    video.src = videoUrl || window.URL.createObjectURL(videoData);\n    container.appendChild(video);\n\n    // canvas\n    const canvas = document.createElement('canvas');\n    canvas.width = width; //\n    canvas.height = height; //\n    container.appendChild(canvas);\n\n    // \n    return new Promise(resolve => {\n      video.addEventListener('loadeddata', () => {\n        video.currentTime = 1;\n        video.play();\n      });\n      video.addEventListener('playing', async () => {\n        video.pause();\n        const captureVideoPromises = [];\n        for (let i = 0; i < seconds.length; i++) {\n          const captureVideoPromise = await this.captureVideoPromise(canvas, video, seconds[i]);\n          captureVideoPromises.push(captureVideoPromise);\n        }\n        Promise.all(captureVideoPromises).then(allSrcs => {\n          container.remove();\n          allSrcs.sort((a, b) => a.beginTime - b.beginTime);\n          const srcs = allSrcs.map(val => val.src);\n          resolve(srcs);\n        });\n      });\n\n      document.body.appendChild(container);\n    });\n  }\n\n  /**\n   * \n   * @param canvas\n   * @param video\n   * @param beginTime \n   */\n  private captureVideoPromise(canvas, video, beginTime) {\n    const videoWidth = video.width;\n    const videoHeight = video.height;\n    // \n    const ctx = canvas.getContext('2d');\n    return new Promise(resolve => {\n      const cutImg = () => {\n        video.removeEventListener('timeupdate', cutImg);\n\n        ctx.drawImage(video, 0, 0, videoWidth, videoHeight);\n        const dataUrl = canvas.toDataURL('image/png');\n        resolve({ beginTime: beginTime, src: dataUrl });\n      };\n      video.addEventListener('timeupdate', cutImg);\n      video.currentTime = beginTime;\n    });\n  }\n}\n```\n\n### \n\n\n\n1. \n2.  DOM  background \n3. \n\n\n\n ----  0  100 \n\n![sprite-preview](http://img.mrsingsing.com/sprite-preview.png)\n\n> \n>\n> - duration \n> - scaleRatio \n> - beginTime \n> - imgList \n\n1. \n2.  120  120 \n3.  10x10  0-99  100-199  100 \n4.  100  0  100 \n5.  0 \n6.  `(index % 10) * width` \n7.  `Math.floor(index / 10) * height` \n\n```ts\nexport class SSVideoPreviewDirective implements OnInit {\n  public renderVideoPreviewByImageList(): void {\n    // \n    const count = Math.ceil(this.duration / this.scaleRatio);\n    const frag = document.createDocumentFragment();\n\n    for (let i = 0; i < count; i++) {\n      const div = document.createElement('div');\n\n      //  i \n      const currentTime = this.beginTime + i * this.scaleRatio;\n      // \n      const groupIndex = Math.floor(currentTime / 100);\n      // 100x100 \n      const remainder = parseInt(`${currentTime}`) % 100 === 0 ? 1 : Math.ceil(currentTime) % 100;\n      //  \n      const index = remainder === 0 ? 99 : remainder - 1;\n\n      const url = this.imgList[groupIndex];\n      const x = (index % 10) * 80;\n      const y = Math.floor(index / 10) * 44;\n\n      div.style.display = 'inline-block';\n      div.style.width = '80px';\n      div.style.height = '44px';\n      div.style.backgroundRepeat = 'no-repeat';\n      div.style.backgroundImage = `url(\"${url}\")`;\n      div.style.backgroundPosition = `-${x}px -${y}px`;\n      div.style.backgroundSize = '800px 440px';\n      div.style.flexShrink = '0';\n\n      frag.appendChild(div);\n    }\n\n    this.currentElement.innerHTML = '';\n    this.currentElement.appendChild(frag);\n  }\n}\n```\n\n\n\n DOM  background-image  background-position backgroud-size  background-image  background-position \n\n 1xn  background-image  10x10 \n\n![tencent-preview](http://img.mrsingsing.com/tencent-preview.png)\n\n 10 x 10 \n\n\n\n\n## \n\n### \n\n\n\n clickmousedownmousemovemouseupcontextmeu  poiner-events: none \n\n document  click  document\n\n document  click  click  path  click\n\n![contextmenu](http://img.mrsingsing.com/contextmenu.gif)\n\n### \n\n\n\n duration  scrollTo \n\n## \n\n\n\n Web \n\n\n","slug":"web-video-editor-practise","published":1,"updated":"2021-09-29T18:03:55.803Z","_id":"cku5qy23t00026v1psx937c9f","comments":1,"layout":"post","photos":[],"link":"","content":"<p></p>\n<blockquote>\n<p> Angular  Angular </p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Web Web </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">multiple</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"video/mp4\"</span> (<span class=\"attr\">change</span>)=<span class=\"string\">\"handleVideoMaterialUpload\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">'axios'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleUpload</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> uploadUrl = <span class=\"string\">'https://upload-url.com/'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fileList = e.target.files;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// do something </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\"></span><br><span class=\"line\">  formData.append(<span class=\"string\">'file'</span>, filesList[<span class=\"number\">0</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">  axios</span><br><span class=\"line\">    .post(uploadUrl, formData)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">''</span>, res);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">''</span>, err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<a id=\"more\"></a>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>dragOver</code>  <code>drop</code>  <code>e.dataTransfer</code> </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"drag-area\"</span> (<span class=\"attr\">dragOver</span>)=<span class=\"string\">\"onDragOver\"</span> (<span class=\"attr\">drop</span>)=<span class=\"string\">\"onDrop\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onDragOver</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fileList = e.dataTransfer.files;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// do something </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <a href=\"https://help.aliyun.com/product/31815.html\" target=\"_blank\" rel=\"noopener\">  OSS</a><a href=\"https://cloud.tencent.com/document/product/436\" target=\"_blank\" rel=\"noopener\">  COS</a></p>\n<p> OSS  OSS  OSS </p>\n<p><img src=\"http://img.mrsingsing.com/upload-swim.jpg\" alt=\"upload-swim\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>window.URL.createObjectURL</code>  Blob  <code>&lt;video&gt;</code>   <code>video</code>  <code>canplay</code>  Canvas </p>\n<p> <code>video.play</code>  <code>try...catch</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> captureImagePreview = <span class=\"keyword\">async</span> (videoFile: File) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    \t(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> captureArea = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'captureArea'</span>);</span><br><span class=\"line\">      \t<span class=\"comment\">// </span></span><br><span class=\"line\">      \t<span class=\"keyword\">const</span> video = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'video'</span>);</span><br><span class=\"line\">      \tvideo.muted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">//  blob </span></span><br><span class=\"line\">      \t<span class=\"keyword\">const</span> blobUrl = <span class=\"built_in\">window</span>.URL.createObjectURL(videoFile);</span><br><span class=\"line\"></span><br><span class=\"line\">      \tvideo.src = blobUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">//  video DOM </span></span><br><span class=\"line\">      \tcaptureArea.appendChild(video);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">// </span></span><br><span class=\"line\">      \tvideo.addEventListener(<span class=\"string\">'canplay'</span>, e =&gt; &#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">let</span> imgHeight = <span class=\"number\">0</span>,</span><br><span class=\"line\">            imgWidth = <span class=\"number\">0</span>,</span><br><span class=\"line\">            videoWidth = <span class=\"number\">0</span>,</span><br><span class=\"line\">            videoHeight = <span class=\"number\">0</span>;</span><br><span class=\"line\">        \t<span class=\"keyword\">const</span> video: any = e.target;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  Canvas </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvasCtx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> blobUrl = <span class=\"built_in\">window</span>.URL.createObjectURL(videoFile);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  video </span></span><br><span class=\"line\">        canvas.width = imgWidth = video.offsetWidth;</span><br><span class=\"line\">        canvas.height = imgHeight = video.offsetHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        videoWidth = video.videoWidth;</span><br><span class=\"line\">        videoHeight = video.videoHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">await</span> (video <span class=\"keyword\">as</span> HTMLVideoElement).play();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">this</span>.$notification(<span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">          resolve(<span class=\"literal\">null</span>);</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        video.pause();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// canvas.drawImage  HTMLVideoElement </span></span><br><span class=\"line\">        canvasCtx.drawImage(</span><br><span class=\"line\">          video,</span><br><span class=\"line\">          imgWidth - videoWidth,</span><br><span class=\"line\">          (imgHeight - videoHeight) / <span class=\"number\">2</span>,</span><br><span class=\"line\">          videoWidth,</span><br><span class=\"line\">          videoHeight,</span><br><span class=\"line\">          imgWidth - videoWidth,</span><br><span class=\"line\">          (imgHeight - videoHeight) / <span class=\"number\">2</span>,</span><br><span class=\"line\">          videoWidth,</span><br><span class=\"line\">          videoHeight,</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        canvas.toBlob(<span class=\"function\"><span class=\"params\">blob</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// </span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> url = URL.createObjectURL(blob);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">const</span> material: Material = &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            duration: video.duration,</span><br><span class=\"line\">            <span class=\"comment\">//  Blob </span></span><br><span class=\"line\">            videoCoverUrl: url,</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            videoName: videoFile.name,</span><br><span class=\"line\">            <span class=\"comment\">//  uuid  videoId</span></span><br><span class=\"line\">            videoId: CommonUtils.generateUUID(),</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            status: MaterialStatus.Parse,</span><br><span class=\"line\">            file: videoFile,</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            fileSize: videoFile.size,</span><br><span class=\"line\">            <span class=\"comment\">//  ID</span></span><br><span class=\"line\">            fileId: <span class=\"keyword\">this</span>.aiMatchBordcastService.fileId,</span><br><span class=\"line\">            <span class=\"comment\">//  Blob </span></span><br><span class=\"line\">            blobUrl: blobUrl,</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            createDttm: +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          resolve(material);</span><br><span class=\"line\"></span><br><span class=\"line\">          captureArea.removeChild(video);</span><br><span class=\"line\">      \t&#125;)();</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/located-cursor.gif\" alt=\"located-cursor\"></p>\n<p></p>\n<p> UI </p>\n<p></p>\n<p> transform: translateX() </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> CONSTANTS = &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  RULER_INTEGER_SPACING: <span class=\"number\">80</span>,</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  INDICATOR_WIDTH: <span class=\"number\">30</span>,</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  CURSOR_INITIAL_VALUE: <span class=\"number\">31</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> handleLocatedCursoRedirect = (&#123;</span><br><span class=\"line\">    cursorShift = CONSTANTS.CURSOR_INITIAL_VALUE,</span><br><span class=\"line\">    duration,</span><br><span class=\"line\">    frameBeginTime,</span><br><span class=\"line\">    framework,</span><br><span class=\"line\">    anchor = <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;) =&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!cursorShift) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.videoTrackList.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setLocatedCursor = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedBeginTime = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedFramework = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedAnchor = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setLocationInfo();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> currentDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (CommonUtils.isDefined(duration)) &#123;</span><br><span class=\"line\">      currentDuration = duration;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> mouseDuration =</span><br><span class=\"line\">        ((((cursorShift - CONSTANTS.CURSOR_INITIAL_VALUE) / CONSTANTS.RULER_INTEGER_SPACING) * <span class=\"keyword\">this</span>.scaleRatio).toFixed(<span class=\"number\">2</span>) <span class=\"keyword\">as</span> any) * <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (mouseDuration &gt;= <span class=\"keyword\">this</span>.totalDuration) &#123;</span><br><span class=\"line\">        currentDuration = <span class=\"keyword\">this</span>.totalDuration;</span><br><span class=\"line\">        cursorShift =</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.lastFrameworkClientRect.left - <span class=\"keyword\">this</span>.indicatorClientRect.left + <span class=\"keyword\">this</span>.lastFrameworkClientRect.width;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        currentDuration = mouseDuration;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentDuration = currentDuration;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setLocatedCursor = cursorShift;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!framework) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; frameBeginTime, frameworkId, anchorId &#125; = <span class=\"keyword\">this</span>.getFrameworkInfoByDuration(cursorShift);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.currentLocatedBeginTime = frameBeginTime;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.currentLocatedFramework = <span class=\"keyword\">this</span>.videoTrackList.find(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.id === frameworkId);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.currentLocatedAnchor = anchorId</span><br><span class=\"line\">          ? <span class=\"keyword\">this</span>.videoTrackList.find(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.id === frameworkId).dataList.find(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> <span class=\"string\">`<span class=\"subst\">$&#123;item.id&#125;</span>`</span> === anchorId)</span><br><span class=\"line\">          : <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedBeginTime = frameBeginTime;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedFramework = framework;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedAnchor = anchor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  \t<span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setLocationInfo();</span><br><span class=\"line\"></span><br><span class=\"line\">  \t<span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentDuration;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/preview-cursor.gif\" alt=\"preview-cursor\"></p>\n<p> <code>mousenter</code>  <code>mousemove</code>  <code>mouseleave</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/magnet-cursor.gif\" alt=\"magnet-cursor\"></p>\n<p></p>\n<p> DOM </p>\n<p> <code>translate</code> </p>\n<p><img src=\"http://img.mrsingsing.com/magnet-area.png\" alt=\"magnet-area\"></p>\n<p></p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"selector-class\">.magnet-area-item</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">max-width</span>: <span class=\"number\">80px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">1450</span>;</span><br><span class=\"line\">  <span class=\"comment\">/*  */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.3</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.first</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: translate3d(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">      <span class=\"selector-class\">.magnet-area-cursor</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: none;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.last</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: translate3d(-<span class=\"number\">100%</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">      <span class=\"selector-class\">.magnet-area-cursor</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: initial;</span><br><span class=\"line\">        <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: none;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"selector-class\">.magnet-area-cursor</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">content</span>: <span class=\"string\">''</span>;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">2px</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: <span class=\"number\">#1db368</span>;</span><br><span class=\"line\">      <span class=\"attribute\">transform</span>: translateX(-<span class=\"number\">50%</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> initMagnetArea = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.currentMagnetAreaList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  DOM </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> frameworkList = <span class=\"keyword\">this</span>.indicatorRef.nativeElement.parentElement.querySelectorAll(</span><br><span class=\"line\">    <span class=\"string\">'.framework-item'</span>,</span><br><span class=\"line\">  ) <span class=\"keyword\">as</span> NodeListOf&lt;HTMLDivElement&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> indicatorLeft = <span class=\"keyword\">this</span>.indicatorClientRect.left;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.currentMagnetAreaList = <span class=\"built_in\">Array</span>.from(frameworkList).reduce(</span><br><span class=\"line\">    (acc: any, <span class=\"attr\">item</span>: HTMLDivElement, <span class=\"attr\">index</span>: number) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  DOM </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> frameworkRect = item.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">//  30% </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> currentWidth = frameworkRect.width * <span class=\"number\">0.3</span>;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> areaWidth = index === <span class=\"number\">0</span> ? currentWidth : currentWidth + acc.prevWidth;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> areaShift = index === <span class=\"number\">0</span> ? <span class=\"number\">0</span> : (acc.prevWidth / areaWidth) * <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      acc.list.push(&#123;</span><br><span class=\"line\">        id: item.dataset.id,</span><br><span class=\"line\">        areaWidth: areaWidth,</span><br><span class=\"line\">        areaTranform: <span class=\"string\">`translateX(-<span class=\"subst\">$&#123;areaShift&#125;</span>%)`</span>,</span><br><span class=\"line\">        areaLeft: frameworkRect.left - indicatorLeft + <span class=\"string\">'px'</span>,</span><br><span class=\"line\">        cursorLeft: areaShift + <span class=\"string\">'%'</span>,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  30% </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === frameworkList.length - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        acc.list.push(&#123;</span><br><span class=\"line\">          id: <span class=\"literal\">null</span>,</span><br><span class=\"line\">          areaWidth: currentWidth,</span><br><span class=\"line\">          areaTranform: <span class=\"string\">'translateX(-100%)'</span>,</span><br><span class=\"line\">          areaLeft: frameworkRect.right - indicatorLeft + <span class=\"string\">'px'</span>,</span><br><span class=\"line\">          cursorLeft: <span class=\"string\">'initial'</span>,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      acc.prevWidth = currentWidth;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> acc;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      list: [],</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// 30% 60%</span></span><br><span class=\"line\">      prevWidth: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ).list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Web </p>\n<ol>\n<li> Canvas Bilibili </li>\n<li> DOM  DOM </li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/ruler1.gif\" alt=\"ruler1\"></p>\n<p><img src=\"http://img.mrsingsing.com/ruler2.gif\" alt=\"ruler2\"></p>\n<p></p>\n<ol>\n<li> <code>&lt;canvas&gt;</code>  DPR </li>\n<li></li>\n<li> Canvas </li>\n<li></li>\n</ol>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> RecordVideoTimelineRulerComponent <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  scaleRatio: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  maxScaleValue: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> canvasWidth: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"comment\">/**  DOM  */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> canvasElement: HTMLCanvasElement;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> canvasContext: CanvasRenderingContext2D;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.initCanvas();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnChanges(changes: &#123; [propName: <span class=\"built_in\">string</span>]: SimpleChange &#125;) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> scaleRatio = changes[<span class=\"string\">'scaleRatio'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      scaleRatio &amp;&amp;</span><br><span class=\"line\">      (!scaleRatio.previousValue || scaleRatio.previousValue !== scaleRatio.currentValue)</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.drawCanvas();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  initCanvas(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas'</span>) <span class=\"keyword\">as</span> HTMLCanvasElement;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.canvasElement = canvas;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.canvasContext = ctx;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> documentBodyWidth = <span class=\"built_in\">document</span>.body.clientWidth || <span class=\"built_in\">document</span>.documentElement.clientWidth;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.canvasWidth = documentBodyWidth;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.devicePixelRatio) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> devicePixelRatio = <span class=\"built_in\">window</span>.devicePixelRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">      canvas.width = devicePixelRatio * <span class=\"keyword\">this</span>.canvasWidth;</span><br><span class=\"line\">      canvas.height = devicePixelRatio * <span class=\"number\">26</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      ctx.scale(devicePixelRatio, devicePixelRatio);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.drawCanvas();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  drawCanvas(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> scrollX = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = <span class=\"keyword\">this</span>.canvasContext;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ctx) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvasWidth = <span class=\"keyword\">this</span>.canvasWidth;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvasHeight = <span class=\"number\">26</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> offsetX = (scrollX ? <span class=\"number\">30</span> - scrollX : <span class=\"number\">30</span>) + <span class=\"number\">0.5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> totalScaleValue = <span class=\"keyword\">this</span>.maxScaleValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> startCount = <span class=\"built_in\">Math</span>.max(<span class=\"built_in\">parseInt</span>(<span class=\"string\">''</span> + <span class=\"built_in\">Math</span>.floor((scrollX - <span class=\"number\">30</span>) / <span class=\"number\">16</span>), <span class=\"number\">10</span>), <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> endCount = <span class=\"built_in\">Math</span>.min(</span><br><span class=\"line\">      <span class=\"built_in\">parseInt</span>(<span class=\"string\">''</span> + <span class=\"built_in\">Math</span>.ceil((scrollX + canvasWidth - <span class=\"number\">30</span>) / <span class=\"number\">16</span>), <span class=\"number\">10</span>) - <span class=\"number\">1</span>,</span><br><span class=\"line\">      totalScaleValue</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> division = <span class=\"number\">15</span>;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> integerHeight = <span class=\"number\">14</span> || <span class=\"built_in\">Math</span>.floor(canvasHeight * <span class=\"number\">0.53</span>);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> divisionHeight = <span class=\"number\">8</span> || <span class=\"built_in\">Math</span>.floor(canvasHeight * <span class=\"number\">0.3</span>);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> textHeight = <span class=\"number\">21</span> || <span class=\"built_in\">Math</span>.floor(canvasHeight * <span class=\"number\">0.78</span>);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> scaleRatio = <span class=\"keyword\">this</span>.scaleRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">    ctx.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvasWidth, canvasHeight);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = startCount; i &lt; endCount; i++) &#123;</span><br><span class=\"line\">      ctx.beginPath();</span><br><span class=\"line\">      ctx.save();</span><br><span class=\"line\">      ctx.strokeStyle = <span class=\"string\">'#595959'</span>;</span><br><span class=\"line\">      ctx.lineWidth = <span class=\"number\">1</span>;</span><br><span class=\"line\">      ctx.lineCap = <span class=\"string\">'round'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> moveTo = offsetX + i * (division + <span class=\"number\">1</span>);</span><br><span class=\"line\">      ctx.moveTo(moveTo, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i % <span class=\"number\">5</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        ctx.lineTo(offsetX + i * (division + <span class=\"number\">1</span>), integerHeight);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ctx.lineTo(offsetX + i * (division + <span class=\"number\">1</span>), divisionHeight);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      ctx.stroke();</span><br><span class=\"line\">      ctx.restore();</span><br><span class=\"line\">      ctx.closePath();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    ctx.beginPath();</span><br><span class=\"line\">    ctx.font = <span class=\"string\">'10px Arial'</span>;</span><br><span class=\"line\">    ctx.fillStyle = <span class=\"string\">'#AAAAAA'</span>;</span><br><span class=\"line\">    ctx.textAlign = <span class=\"string\">'center'</span>;</span><br><span class=\"line\">    ctx.textBaseline = <span class=\"string\">'middle'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> seperatedScaleValue = totalScaleValue / <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; seperatedScaleValue; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> text = <span class=\"keyword\">this</span>.formatTimeScaleText(i, scaleRatio);</span><br><span class=\"line\">      ctx.fillText(text, offsetX + <span class=\"number\">80</span> * i, textHeight);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ctx.closePath();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param index  0 </span></span><br><span class=\"line\"><span class=\"comment\">   * @param ratio </span></span><br><span class=\"line\"><span class=\"comment\">   * @description  HH:MM:SS.ss </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  formatTimeScaleText(index: <span class=\"built_in\">number</span>, ratio: <span class=\"built_in\">number</span>): <span class=\"built_in\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> totalSeconds = index * ratio;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> hour: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> minute: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> second: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> millisecond = <span class=\"string\">'00'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    hour = <span class=\"built_in\">Math</span>.floor(totalSeconds / <span class=\"number\">3600</span>);</span><br><span class=\"line\">    minute = <span class=\"built_in\">Math</span>.floor((totalSeconds - hour * <span class=\"number\">3600</span>) / <span class=\"number\">60</span>);</span><br><span class=\"line\">    second = ratio &gt;= <span class=\"number\">60</span> ? <span class=\"number\">0</span> : <span class=\"built_in\">Math</span>.floor(totalSeconds - hour * <span class=\"number\">3600</span> - minute * <span class=\"number\">60</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    hour = <span class=\"keyword\">this</span>.fixZero(hour);</span><br><span class=\"line\">    minute = <span class=\"keyword\">this</span>.fixZero(minute);</span><br><span class=\"line\">    second = <span class=\"keyword\">this</span>.fixZero(second);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;hour&#125;</span>:<span class=\"subst\">$&#123;minute&#125;</span>:<span class=\"subst\">$&#123;second&#125;</span>.<span class=\"subst\">$&#123;millisecond&#125;</span>`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  fixZero(value: <span class=\"built_in\">any</span>): <span class=\"built_in\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value * <span class=\"number\">1</span> &lt; <span class=\"number\">10</span> ? <span class=\"string\">`0<span class=\"subst\">$&#123;value&#125;</span>`</span> : <span class=\"string\">`<span class=\"subst\">$&#123;value&#125;</span>`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p></p>\n<ol>\n<li>5  1  1  0.2s=200ms</li>\n<li>5  1 =60s 1  0.2min=12s=12000ms</li>\n<li>5  3 =180s 1  0.6min=36s=36000ms</li>\n<li>5  6 =360s 1  1.2min=62s=62000ms</li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Web </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/drag-and-drop.png\" alt=\"drag-and-drop\"></p>\n<p> drag &amp; drop  drag &amp; drop  mouse  drag &amp; drop  mouse </p>\n<p>HTML  API </p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragstart</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">drag</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragend</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragenter</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragover</td>\n<td style=\"text-align:left\"> 100ms </td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragleave</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">drop</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> mouse  drag </p>\n<p> <code>mousedown</code>  <code>mousemove</code>  <code>mousemove</code>  <code>mousedown</code>  <code>dragTolerance</code> 5 5 </p>\n<p> HTML  draggable  true  false </p>\n<p>  <code>draggable</code>  <code>mousedown</code>  <code>draggable</code>  darggable  DOM  <code>mousedown</code> </p>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Directive</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'[ssDraggable]'</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> el: ElementRef, <span class=\"keyword\">public</span> zone: NgZone, <span class=\"keyword\">public</span> viewContainer: ViewContainerRef</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement = el.nativeElement;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onMouseMove = <span class=\"keyword\">this</span>.onMouseMove.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onMouseUp = <span class=\"keyword\">this</span>.onMouseUp.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngAfterContentInit() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.currentElement) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentElement.onmousedown = <span class=\"keyword\">this</span>.onMouseDown.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">get</span> currentElementDraggable() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span>.draggable === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.draggable(&#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        data: <span class=\"keyword\">this</span>.data,</span><br><span class=\"line\">        <span class=\"comment\">//  DOM </span></span><br><span class=\"line\">        mousedownElement: <span class=\"keyword\">this</span>.mousedownElement,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.draggable;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseDown(e: MouseEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    e.preventDefault();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.mousedownElement = e.target <span class=\"keyword\">as</span> HTMLElement;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.currentElementDraggable) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.clicked = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.startX = e.pageX;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.startY = e.pageY;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.defaultView?.addEventListener(<span class=\"string\">'mousemove'</span>, <span class=\"keyword\">this</span>.onMouseMove);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.defaultView?.addEventListener(<span class=\"string\">'mouseup'</span>, <span class=\"keyword\">this</span>.onMouseUp);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseMove(e: MouseEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseUp(e: MouseEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> mousedown  dragStart</p>\n<p> Angular  clone  DOM </p>\n<p> ng-template  HTML  DOM </p>\n<p><img src=\"http://img.mrsingsing.com/drag-anchor.gif\" alt=\"drag-anchor\"></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ng-template</span> #<span class=\"attr\">ssDraggableAnchorGhost</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">class</span>=<span class=\"string\">\"drag-anchor-ghost\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    [<span class=\"attr\">attr.data-type</span>]=<span class=\"string\">\"DragGhostElementType.ANCHOR\"</span></span></span><br><span class=\"line\"><span class=\"tag\">  &gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ghost-cursor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ghost-placeholder\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ng-template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p> DOM  DOM  <code>Node.cloneNode()</code>  DOM  DOM CSS </p>\n<p> DOM  getComputedStyle</p>\n<p> CSS </p>\n<p><img src=\"http://img.mrsingsing.com/drag-video.gif\" alt=\"drag-video\"></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  cloneGhostElement(element: Element): Element &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> clonedElement = element.cloneNode(<span class=\"literal\">true</span>) <span class=\"keyword\">as</span> HTMLElement;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> originalStyles: CSSStyleDeclaration = <span class=\"built_in\">document</span>.defaultView.getComputedStyle(element, <span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> cssProperty of styleProperties) &#123;</span><br><span class=\"line\">      clonedElement.style[cssProperty] = originalStyles[cssProperty];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    clonedElement.style.pointerEvents = <span class=\"string\">'none'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> originalElementChildren = element.getElementsByTagName(<span class=\"string\">'*'</span>) <span class=\"keyword\">as</span> HTMLCollectionOf&lt;</span><br><span class=\"line\">      HTMLElement</span><br><span class=\"line\">    &gt;;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> clonedElementChildren = clonedElement.getElementsByTagName(<span class=\"string\">'*'</span>) <span class=\"keyword\">as</span> HTMLCollectionOf&lt;</span><br><span class=\"line\">      HTMLElement</span><br><span class=\"line\">    &gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = originalElementChildren.length - <span class=\"number\">1</span>; i--; ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> originalChild = originalElementChildren[i];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> clonedChild = clonedElementChildren[i];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> originElementStyles = <span class=\"built_in\">document</span>.defaultView.getComputedStyle(originalChild, <span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> cssProperty of styleProperties) &#123;</span><br><span class=\"line\">        clonedChild.style[cssProperty] = originElementStyles[cssProperty];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      clonedChild.style.pointerEvents = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> clonedElement;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> SSDraggableBaseEventArgs &#123;</span><br><span class=\"line\">  originalEvent: MouseEvent;</span><br><span class=\"line\">  ghostElement: Nullable&lt;HTMLElement&gt;;</span><br><span class=\"line\">  startX: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  startY: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  pageX: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  pageY: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  cancel: <span class=\"built_in\">boolean</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseMove(e: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; pageX, pageY &#125; = e;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.clicked) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> totalMovedX = pageX - <span class=\"keyword\">this</span>.startX;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> totalMovedY = pageY - <span class=\"keyword\">this</span>.startY;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        !<span class=\"keyword\">this</span>.dragStarted &amp;&amp;</span><br><span class=\"line\">        (<span class=\"built_in\">Math</span>.abs(totalMovedX) &gt; <span class=\"keyword\">this</span>.dragTolerance || <span class=\"built_in\">Math</span>.abs(totalMovedY) &gt; <span class=\"keyword\">this</span>.dragTolerance)</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> dragStartArgs: SSDraggableBaseEventArgs = &#123;</span><br><span class=\"line\">          originalEvent: e,</span><br><span class=\"line\">          ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">          startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">          startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">          pageX,</span><br><span class=\"line\">          pageY,</span><br><span class=\"line\">          cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.dragStart.emit(dragStartArgs);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dragStartArgs.cancel) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.destoryEventListener();</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> clientRect = <span class=\"keyword\">this</span>.currentElement.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.baseX = clientRect.left;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.baseY = clientRect.top;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragStarted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.createGhostElement(pageX, pageY);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.dragStarted) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> dragMoveArgs: SSDraggableDragMoveArgs = &#123;</span><br><span class=\"line\">        originalEvent: e,</span><br><span class=\"line\">        ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">        startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">        startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">        pageX: <span class=\"keyword\">this</span>.lastX,</span><br><span class=\"line\">        pageY: <span class=\"keyword\">this</span>.lastY,</span><br><span class=\"line\">        nextPageX: e.pageX,</span><br><span class=\"line\">        nextPageY: e.pageY,</span><br><span class=\"line\">        cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragMove.emit(dragMoveArgs);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> setPageX = dragMoveArgs.nextPageX;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> setPageY = dragMoveArgs.nextPageY;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!dragMoveArgs.cancel) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ghostLeft = <span class=\"keyword\">this</span>.dragDirection === DragDirection.VERTICAL ? <span class=\"keyword\">this</span>.baseX : setPageX;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ghostTop = <span class=\"keyword\">this</span>.dragDirection === DragDirection.HORIZONTAL ? <span class=\"keyword\">this</span>.baseY : setPageY;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dispatchDragEvent(pageX, pageY, e);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastX = setPageX;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastY = setPageY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  createGhostElement(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> dynamicGhostRef;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostTemplate) &#123;</span><br><span class=\"line\">      dynamicGhostRef = <span class=\"keyword\">this</span>.viewContainer.createEmbeddedView(<span class=\"keyword\">this</span>.ghostTemplate, <span class=\"literal\">null</span>);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement = dynamicGhostRef.rootNodes[<span class=\"number\">0</span>];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> clonedElement = <span class=\"keyword\">this</span>.cloneGhostElement(<span class=\"keyword\">this</span>.currentElement);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> ghostContainer = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">      ghostContainer.appendChild(clonedElement);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.currentElement.dataset) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Object</span>.entries(<span class=\"keyword\">this</span>.currentElement.dataset).forEach(<span class=\"function\">(<span class=\"params\">[key, value]</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          ghostContainer.setAttribute(<span class=\"string\">`data-<span class=\"subst\">$&#123;key&#125;</span>`</span>, value);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement = ghostContainer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostElement) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> createEventArgs = &#123;</span><br><span class=\"line\">        ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">        cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostCreate.emit(createEventArgs);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (createEventArgs.cancel) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ghostElement = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostTemplate &amp;&amp; dynamicGhostRef) &#123;</span><br><span class=\"line\">          dynamicGhostRef.destroy();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.position = <span class=\"string\">'absolute'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.pointerEvents = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.zIndex = <span class=\"keyword\">this</span>.ghostIndex;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.transform =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragDirection === DragDirection.BOTH ? <span class=\"string\">'translate3d(-50%, -50%, 0)'</span> : <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"comment\">//  left </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.left =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragDirection === DragDirection.VERTICAL ? <span class=\"keyword\">this</span>.baseX + <span class=\"string\">'px'</span> : pageX + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      <span class=\"comment\">//  right </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.top =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragDirection === DragDirection.HORIZONTAL ? <span class=\"keyword\">this</span>.baseY + <span class=\"string\">'px'</span> : pageY + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.width = <span class=\"string\">'auto'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.height = <span class=\"string\">'auto'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.cursor = <span class=\"string\">'grabbing'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.appendChild(<span class=\"keyword\">this</span>.ghostElement);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.addEventListener(<span class=\"string\">'pointerup'</span>, <span class=\"function\"><span class=\"params\">args</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.onMouseUp(args);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> mouseup  drop </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDrggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseUp(e: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.clicked) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.clicked = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.dragStarted = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> dragEndArgs = &#123;</span><br><span class=\"line\">      originalEvent: e,</span><br><span class=\"line\">      ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">      startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">      startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">      pageX: e.pageX,</span><br><span class=\"line\">      pageY: e.pageY,</span><br><span class=\"line\">      data: <span class=\"keyword\">this</span>.data,</span><br><span class=\"line\">      cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragEnd.emit(dragEndArgs);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.dispatchDropEvent(e.pageX, e.pageY, e);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostElement) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.parentNode?.removeChild(<span class=\"keyword\">this</span>.ghostElement);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.destoryEventListener();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> mouse  drag &amp; drop  drag &amp; drop  dataTransfer </p>\n<p> clickmousedownblur </p>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> event = documet.createEvent(<span class=\"string\">'Event'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  build</span></span><br><span class=\"line\">event.initEvent(<span class=\"string\">'build'</span>, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">event.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">'build'</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// e.target</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">elem.dispatchEvent(Event);</span><br></pre></td></tr></table></figure>\n<p> getElementsAtPoint </p>\n<p> drag  drop </p>\n<ul>\n<li>dispatchDragEvent dragEnterdragLeave </li>\n<li>dispatchDropEvent drop </li>\n<li>dispatchEvent</li>\n</ul>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  dispatchDragEvent(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>, originalEvent: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> dropArea;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> customEventArgs: SSDraggableCustomEventDetail = &#123;</span><br><span class=\"line\">      data: &#123; ...this.data &#125;,</span><br><span class=\"line\">      originalEvent,</span><br><span class=\"line\">      ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">      startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">      startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">      pageX,</span><br><span class=\"line\">      pageY,</span><br><span class=\"line\">      cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> elementsFromPoint = <span class=\"keyword\">this</span>.getElementsAtPoint(pageX, pageY);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> dropAreaFlag = <span class=\"keyword\">this</span>.dropAreaFlag;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> element of elementsFromPoint) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        element.getAttribute(dropAreaFlag) === <span class=\"string\">'true'</span> &amp;&amp;</span><br><span class=\"line\">        element !== <span class=\"keyword\">this</span>.ghostElement &amp;&amp;</span><br><span class=\"line\">        element !== <span class=\"keyword\">this</span>.currentElement</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        dropArea = element;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dropArea &amp;&amp; (!<span class=\"keyword\">this</span>.lastDropArea || (<span class=\"keyword\">this</span>.lastDropArea &amp;&amp; <span class=\"keyword\">this</span>.lastDropArea !== dropArea))) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.lastDropArea) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dispatchEvent(<span class=\"keyword\">this</span>.lastDropArea, <span class=\"string\">'ssDragLeave'</span>, customEventArgs);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastDropArea = dropArea;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dispatchEvent(dropArea, <span class=\"string\">'ssDragEnter'</span>, customEventArgs);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!dropArea &amp;&amp; <span class=\"keyword\">this</span>.lastDropArea) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dispatchEvent(<span class=\"keyword\">this</span>.lastDropArea, <span class=\"string\">'ssDragLeave'</span>, customEventArgs);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastDropArea = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dropArea) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dispatchEvent(dropArea, <span class=\"string\">'ssDragOver'</span>, customEventArgs);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  dispatchDropEvent(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>, originalEvent: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> customEventArgs = &#123;</span><br><span class=\"line\">      ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">      originalEvent,</span><br><span class=\"line\">      startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">      startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">      pageX,</span><br><span class=\"line\">      pageY,</span><br><span class=\"line\">      data: <span class=\"keyword\">this</span>.data,</span><br><span class=\"line\">      cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.dispatchEvent(<span class=\"keyword\">this</span>.lastDropArea, <span class=\"string\">'ssDrop'</span>, customEventArgs);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  dispatchEvent(</span><br><span class=\"line\">    target: Nullable&lt;HTMLElement&gt;,</span><br><span class=\"line\">    eventName: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    eventArgs: SSDraggableCustomEventDetail</span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (target) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> customEvent = <span class=\"built_in\">document</span>.createEvent(<span class=\"string\">'CustomEvent'</span>);</span><br><span class=\"line\">      customEvent.initCustomEvent(eventName, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, eventArgs);</span><br><span class=\"line\">      target.dispatchEvent(customEvent);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> getElementsAtPoint(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> viewPortX = pageX - <span class=\"built_in\">window</span>.pageXOffset;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> viewPortY = pageY - <span class=\"built_in\">window</span>.pageYOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>[<span class=\"string\">'msElementsFromPoint'</span>]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> elements = <span class=\"built_in\">document</span>[<span class=\"string\">'msElementsFromPoint'</span>](viewPortX, viewPortY);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> elements === <span class=\"literal\">null</span> ? [] : elements;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.elementsFromPoint(viewPortX, viewPortY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Angular  mouse  drag  API </p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">API</th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">data</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">any</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">draggable</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">boolean \\</td>\n<td>() =&gt; boolean</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostTemplate</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>TemplateRef&lt;any&gt;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostIndex</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">string</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragTolerance</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">number</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragDirection</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">DragDirection</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dropAreaFlag</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">string</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>dropAreaFlag  drop  drop  data-*  attribute</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">dragStart</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragMove</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragEnd</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostCreate</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostDestory</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> drop  drag </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Directive</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'[ssDroppable]'</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDroppableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> currentElement: Nullable&lt;HTMLElement&gt; = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dropAreaFlag = <span class=\"string\">'ssdroppable'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dragEnter = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dragOver = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dragLeave = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> drop = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> el: ElementRef, <span class=\"keyword\">public</span> zone: NgZone</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement = el.nativeElement;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDragEnter = <span class=\"keyword\">this</span>.onDragEnter.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDragOver = <span class=\"keyword\">this</span>.onDragOver.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDragLeave = <span class=\"keyword\">this</span>.onDragLeave.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDrop = <span class=\"keyword\">this</span>.onDrop.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.currentElement) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.setAttribute(<span class=\"keyword\">this</span>.dropAreaFlag, <span class=\"string\">'true'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDragEnter'</span>, <span class=\"keyword\">this</span>.onDragEnter <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDragOver'</span>, <span class=\"keyword\">this</span>.onDragOver <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDragLeave'</span>, <span class=\"keyword\">this</span>.onDragLeave <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDrop'</span>, <span class=\"keyword\">this</span>.onDrop <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDragEnter(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragEnter.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDragOver(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragOver.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDragLeave(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragLeave.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDrop(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.drop.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> video  play  Canvas  <code>toDataURL</code> </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSVideoPreviewDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> previewList;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> blobUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> beginTime: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> duration: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> scaleRatio: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.imgList &amp;&amp; <span class=\"keyword\">this</span>.imgList.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.renderVideoPreviewByImageList();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.blobUrl) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.renderVideoPreviewByBlobUrl();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  Blob Url</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> renderVideoPreviewByBlobUrl() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> count = <span class=\"built_in\">Math</span>.ceil(<span class=\"keyword\">this</span>.duration / <span class=\"keyword\">this</span>.scaleRatio);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> frag = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> durationList = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; count; i++) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//  i </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> currentTime = <span class=\"keyword\">this</span>.beginTime + i * <span class=\"keyword\">this</span>.scaleRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">      durationList.push(currentTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> promise = <span class=\"keyword\">this</span>.videoPicture(&#123; videoUrl: <span class=\"keyword\">this</span>.blobUrl, seconds: durationList &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    promise.then(<span class=\"function\">(<span class=\"params\">imgList: <span class=\"built_in\">string</span>[]</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      imgList.forEach(<span class=\"function\">(<span class=\"params\">base64: <span class=\"built_in\">string</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        div.style.display = <span class=\"string\">'inline-block'</span>;</span><br><span class=\"line\">        div.style.width = <span class=\"string\">'80px'</span>;</span><br><span class=\"line\">        div.style.height = <span class=\"string\">'44px'</span>;</span><br><span class=\"line\">        div.style.backgroundRepeat = <span class=\"string\">'no-repeat'</span>;</span><br><span class=\"line\">        div.style.backgroundImage = <span class=\"string\">`url(\"<span class=\"subst\">$&#123;base64&#125;</span>\")`</span>;</span><br><span class=\"line\">        div.style.backgroundSize = <span class=\"string\">'contain'</span>;</span><br><span class=\"line\">        div.style.flexShrink = <span class=\"string\">'0'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        frag.appendChild(div);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentElement.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentElement.appendChild(frag);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * @param videoData </span></span><br><span class=\"line\"><span class=\"comment\">   * @param width  80px* 8 </span></span><br><span class=\"line\"><span class=\"comment\">   * @param height  44px* 8 </span></span><br><span class=\"line\"><span class=\"comment\">   * @param seconds    [1,3,4,5,6] 1 3 4 5 6</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  videoPicture(&#123;</span><br><span class=\"line\">    videoUrl,</span><br><span class=\"line\">    videoData,</span><br><span class=\"line\">    width = <span class=\"number\">80</span> * <span class=\"number\">8</span>,</span><br><span class=\"line\">    height = <span class=\"number\">44</span> * <span class=\"number\">8</span>,</span><br><span class=\"line\">    seconds,</span><br><span class=\"line\">  &#125;: &#123;</span><br><span class=\"line\">    videoUrl?: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    videoData?: File;</span><br><span class=\"line\">    width?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    height?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    seconds: <span class=\"built_in\">number</span>[];</span><br><span class=\"line\">  &#125;) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> container = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    container.className = <span class=\"string\">'video-picture'</span>;</span><br><span class=\"line\">    container.style.position = <span class=\"string\">'absolute'</span>;</span><br><span class=\"line\">    <span class=\"comment\">// container.style.visibility = 'hidden';</span></span><br><span class=\"line\">    container.style.left = <span class=\"string\">'-9999px'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> video = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'video'</span>);</span><br><span class=\"line\">    video.width = width;</span><br><span class=\"line\">    video.height = height;</span><br><span class=\"line\">    video.src = videoUrl || <span class=\"built_in\">window</span>.URL.createObjectURL(videoData);</span><br><span class=\"line\">    container.appendChild(video);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// canvas</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    canvas.width = width; <span class=\"comment\">//</span></span><br><span class=\"line\">    canvas.height = height; <span class=\"comment\">//</span></span><br><span class=\"line\">    container.appendChild(canvas);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      video.addEventListener(<span class=\"string\">'loadeddata'</span>, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        video.currentTime = <span class=\"number\">1</span>;</span><br><span class=\"line\">        video.play();</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      video.addEventListener(<span class=\"string\">'playing'</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">        video.pause();</span><br><span class=\"line\">        <span class=\"keyword\">const</span> captureVideoPromises = [];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; seconds.length; i++) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> captureVideoPromise = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.captureVideoPromise(canvas, video, seconds[i]);</span><br><span class=\"line\">          captureVideoPromises.push(captureVideoPromise);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">Promise</span>.all(captureVideoPromises).then(<span class=\"function\"><span class=\"params\">allSrcs</span> =&gt;</span> &#123;</span><br><span class=\"line\">          container.remove();</span><br><span class=\"line\">          allSrcs.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.beginTime - b.beginTime);</span><br><span class=\"line\">          <span class=\"keyword\">const</span> srcs = allSrcs.map(<span class=\"function\"><span class=\"params\">val</span> =&gt;</span> val.src);</span><br><span class=\"line\">          resolve(srcs);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.appendChild(container);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param canvas</span></span><br><span class=\"line\"><span class=\"comment\">   * @param video</span></span><br><span class=\"line\"><span class=\"comment\">   * @param beginTime </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> captureVideoPromise(canvas, video, beginTime) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> videoWidth = video.width;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> videoHeight = video.height;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> cutImg = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        video.removeEventListener(<span class=\"string\">'timeupdate'</span>, cutImg);</span><br><span class=\"line\"></span><br><span class=\"line\">        ctx.drawImage(video, <span class=\"number\">0</span>, <span class=\"number\">0</span>, videoWidth, videoHeight);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> dataUrl = canvas.toDataURL(<span class=\"string\">'image/png'</span>);</span><br><span class=\"line\">        resolve(&#123; beginTime: beginTime, src: dataUrl &#125;);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      video.addEventListener(<span class=\"string\">'timeupdate'</span>, cutImg);</span><br><span class=\"line\">      video.currentTime = beginTime;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li></li>\n<li> DOM  background </li>\n<li></li>\n</ol>\n<p></p>\n<p> ----  0  100 </p>\n<p><img src=\"http://img.mrsingsing.com/sprite-preview.png\" alt=\"sprite-preview\"></p>\n<blockquote>\n<p></p>\n<ul>\n<li>duration </li>\n<li>scaleRatio </li>\n<li>beginTime </li>\n<li>imgList </li>\n</ul>\n</blockquote>\n<ol>\n<li></li>\n<li> 120  120 </li>\n<li> 10x10  0-99  100-199  100 </li>\n<li> 100  0  100 </li>\n<li> 0 </li>\n<li> <code>(index % 10) * width</code> </li>\n<li> <code>Math.floor(index / 10) * height</code> </li>\n</ol>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSVideoPreviewDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> renderVideoPreviewByImageList(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> count = <span class=\"built_in\">Math</span>.ceil(<span class=\"keyword\">this</span>.duration / <span class=\"keyword\">this</span>.scaleRatio);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> frag = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; count; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  i </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> currentTime = <span class=\"keyword\">this</span>.beginTime + i * <span class=\"keyword\">this</span>.scaleRatio;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> groupIndex = <span class=\"built_in\">Math</span>.floor(currentTime / <span class=\"number\">100</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 100x100 </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> remainder = <span class=\"built_in\">parseInt</span>(<span class=\"string\">`<span class=\"subst\">$&#123;currentTime&#125;</span>`</span>) % <span class=\"number\">100</span> === <span class=\"number\">0</span> ? <span class=\"number\">1</span> : <span class=\"built_in\">Math</span>.ceil(currentTime) % <span class=\"number\">100</span>;</span><br><span class=\"line\">      <span class=\"comment\">//  </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = remainder === <span class=\"number\">0</span> ? <span class=\"number\">99</span> : remainder - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> url = <span class=\"keyword\">this</span>.imgList[groupIndex];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> x = (index % <span class=\"number\">10</span>) * <span class=\"number\">80</span>;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> y = <span class=\"built_in\">Math</span>.floor(index / <span class=\"number\">10</span>) * <span class=\"number\">44</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      div.style.display = <span class=\"string\">'inline-block'</span>;</span><br><span class=\"line\">      div.style.width = <span class=\"string\">'80px'</span>;</span><br><span class=\"line\">      div.style.height = <span class=\"string\">'44px'</span>;</span><br><span class=\"line\">      div.style.backgroundRepeat = <span class=\"string\">'no-repeat'</span>;</span><br><span class=\"line\">      div.style.backgroundImage = <span class=\"string\">`url(\"<span class=\"subst\">$&#123;url&#125;</span>\")`</span>;</span><br><span class=\"line\">      div.style.backgroundPosition = <span class=\"string\">`-<span class=\"subst\">$&#123;x&#125;</span>px -<span class=\"subst\">$&#123;y&#125;</span>px`</span>;</span><br><span class=\"line\">      div.style.backgroundSize = <span class=\"string\">'800px 440px'</span>;</span><br><span class=\"line\">      div.style.flexShrink = <span class=\"string\">'0'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      frag.appendChild(div);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.appendChild(frag);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p> DOM  background-image  background-position backgroud-size  background-image  background-position </p>\n<p> 1xn  background-image  10x10 </p>\n<p><img src=\"http://img.mrsingsing.com/tencent-preview.png\" alt=\"tencent-preview\"></p>\n<p> 10 x 10 <br></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p> clickmousedownmousemovemouseupcontextmeu  poiner-events: none </p>\n<p> document  click  document</p>\n<p> document  click  click  path  click</p>\n<p><img src=\"http://img.mrsingsing.com/contextmenu.gif\" alt=\"contextmenu\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p> duration  scrollTo </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> Web </p>\n<p></p>\n","site":{"data":{}},"excerpt":"<p></p>\n<blockquote>\n<p> Angular  Angular </p>\n</blockquote>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Web Web </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">multiple</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">accept</span>=<span class=\"string\">\"video/mp4\"</span> (<span class=\"attr\">change</span>)=<span class=\"string\">\"handleVideoMaterialUpload\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> axios <span class=\"keyword\">from</span> <span class=\"string\">'axios'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleUpload</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> uploadUrl = <span class=\"string\">'https://upload-url.com/'</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fileList = e.target.files;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// </span></span><br><span class=\"line\">  <span class=\"comment\">// do something</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// do something </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> formData = <span class=\"keyword\">new</span> FormData();</span><br><span class=\"line\"></span><br><span class=\"line\">  formData.append(<span class=\"string\">'file'</span>, filesList[<span class=\"number\">0</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">  axios</span><br><span class=\"line\">    .post(uploadUrl, formData)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">''</span>, res);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">''</span>, err);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>","more":"<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <code>dragOver</code>  <code>drop</code>  <code>e.dataTransfer</code> </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"drag-area\"</span> (<span class=\"attr\">dragOver</span>)=<span class=\"string\">\"onDragOver\"</span> (<span class=\"attr\">drop</span>)=<span class=\"string\">\"onDrop\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onDragOver</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> fileList = e.dataTransfer.files;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// do something </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> <a href=\"https://help.aliyun.com/product/31815.html\" target=\"_blank\" rel=\"noopener\">  OSS</a><a href=\"https://cloud.tencent.com/document/product/436\" target=\"_blank\" rel=\"noopener\">  COS</a></p>\n<p> OSS  OSS  OSS </p>\n<p><img src=\"http://img.mrsingsing.com/upload-swim.jpg\" alt=\"upload-swim\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> <code>window.URL.createObjectURL</code>  Blob  <code>&lt;video&gt;</code>   <code>video</code>  <code>canplay</code>  Canvas </p>\n<p> <code>video.play</code>  <code>try...catch</code> </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> captureImagePreview = <span class=\"keyword\">async</span> (videoFile: File) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    \t(<span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> captureArea = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'captureArea'</span>);</span><br><span class=\"line\">      \t<span class=\"comment\">// </span></span><br><span class=\"line\">      \t<span class=\"keyword\">const</span> video = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'video'</span>);</span><br><span class=\"line\">      \tvideo.muted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">//  blob </span></span><br><span class=\"line\">      \t<span class=\"keyword\">const</span> blobUrl = <span class=\"built_in\">window</span>.URL.createObjectURL(videoFile);</span><br><span class=\"line\"></span><br><span class=\"line\">      \tvideo.src = blobUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">//  video DOM </span></span><br><span class=\"line\">      \tcaptureArea.appendChild(video);</span><br><span class=\"line\"></span><br><span class=\"line\">    \t\t<span class=\"comment\">// </span></span><br><span class=\"line\">      \tvideo.addEventListener(<span class=\"string\">'canplay'</span>, e =&gt; &#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">let</span> imgHeight = <span class=\"number\">0</span>,</span><br><span class=\"line\">            imgWidth = <span class=\"number\">0</span>,</span><br><span class=\"line\">            videoWidth = <span class=\"number\">0</span>,</span><br><span class=\"line\">            videoHeight = <span class=\"number\">0</span>;</span><br><span class=\"line\">        \t<span class=\"keyword\">const</span> video: any = e.target;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  Canvas </span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> canvasCtx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> blobUrl = <span class=\"built_in\">window</span>.URL.createObjectURL(videoFile);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//  video </span></span><br><span class=\"line\">        canvas.width = imgWidth = video.offsetWidth;</span><br><span class=\"line\">        canvas.height = imgHeight = video.offsetHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        videoWidth = video.videoWidth;</span><br><span class=\"line\">        videoHeight = video.videoHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">await</span> (video <span class=\"keyword\">as</span> HTMLVideoElement).play();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        \t<span class=\"keyword\">this</span>.$notification(<span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">          resolve(<span class=\"literal\">null</span>);</span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        video.pause();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// canvas.drawImage  HTMLVideoElement </span></span><br><span class=\"line\">        canvasCtx.drawImage(</span><br><span class=\"line\">          video,</span><br><span class=\"line\">          imgWidth - videoWidth,</span><br><span class=\"line\">          (imgHeight - videoHeight) / <span class=\"number\">2</span>,</span><br><span class=\"line\">          videoWidth,</span><br><span class=\"line\">          videoHeight,</span><br><span class=\"line\">          imgWidth - videoWidth,</span><br><span class=\"line\">          (imgHeight - videoHeight) / <span class=\"number\">2</span>,</span><br><span class=\"line\">          videoWidth,</span><br><span class=\"line\">          videoHeight,</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        canvas.toBlob(<span class=\"function\"><span class=\"params\">blob</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"comment\">// </span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> url = URL.createObjectURL(blob);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">const</span> material: Material = &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            duration: video.duration,</span><br><span class=\"line\">            <span class=\"comment\">//  Blob </span></span><br><span class=\"line\">            videoCoverUrl: url,</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            videoName: videoFile.name,</span><br><span class=\"line\">            <span class=\"comment\">//  uuid  videoId</span></span><br><span class=\"line\">            videoId: CommonUtils.generateUUID(),</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            status: MaterialStatus.Parse,</span><br><span class=\"line\">            file: videoFile,</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            fileSize: videoFile.size,</span><br><span class=\"line\">            <span class=\"comment\">//  ID</span></span><br><span class=\"line\">            fileId: <span class=\"keyword\">this</span>.aiMatchBordcastService.fileId,</span><br><span class=\"line\">            <span class=\"comment\">//  Blob </span></span><br><span class=\"line\">            blobUrl: blobUrl,</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            createDttm: +<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(),</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          resolve(material);</span><br><span class=\"line\"></span><br><span class=\"line\">          captureArea.removeChild(video);</span><br><span class=\"line\">      \t&#125;)();</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/located-cursor.gif\" alt=\"located-cursor\"></p>\n<p></p>\n<p> UI </p>\n<p></p>\n<p> transform: translateX() </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> CONSTANTS = &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  RULER_INTEGER_SPACING: <span class=\"number\">80</span>,</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  INDICATOR_WIDTH: <span class=\"number\">30</span>,</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  CURSOR_INITIAL_VALUE: <span class=\"number\">31</span>,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> handleLocatedCursoRedirect = (&#123;</span><br><span class=\"line\">    cursorShift = CONSTANTS.CURSOR_INITIAL_VALUE,</span><br><span class=\"line\">    duration,</span><br><span class=\"line\">    frameBeginTime,</span><br><span class=\"line\">    framework,</span><br><span class=\"line\">    anchor = <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;) =&gt; &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!cursorShift) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.videoTrackList.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setLocatedCursor = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedBeginTime = <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedFramework = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedAnchor = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setLocationInfo();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> currentDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (CommonUtils.isDefined(duration)) &#123;</span><br><span class=\"line\">      currentDuration = duration;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> mouseDuration =</span><br><span class=\"line\">        ((((cursorShift - CONSTANTS.CURSOR_INITIAL_VALUE) / CONSTANTS.RULER_INTEGER_SPACING) * <span class=\"keyword\">this</span>.scaleRatio).toFixed(<span class=\"number\">2</span>) <span class=\"keyword\">as</span> any) * <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (mouseDuration &gt;= <span class=\"keyword\">this</span>.totalDuration) &#123;</span><br><span class=\"line\">        currentDuration = <span class=\"keyword\">this</span>.totalDuration;</span><br><span class=\"line\">        cursorShift =</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.lastFrameworkClientRect.left - <span class=\"keyword\">this</span>.indicatorClientRect.left + <span class=\"keyword\">this</span>.lastFrameworkClientRect.width;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        currentDuration = mouseDuration;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentDuration = currentDuration;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setLocatedCursor = cursorShift;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!framework) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; frameBeginTime, frameworkId, anchorId &#125; = <span class=\"keyword\">this</span>.getFrameworkInfoByDuration(cursorShift);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.currentLocatedBeginTime = frameBeginTime;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.currentLocatedFramework = <span class=\"keyword\">this</span>.videoTrackList.find(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.id === frameworkId);</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.currentLocatedAnchor = anchorId</span><br><span class=\"line\">          ? <span class=\"keyword\">this</span>.videoTrackList.find(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> item.id === frameworkId).dataList.find(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> <span class=\"string\">`<span class=\"subst\">$&#123;item.id&#125;</span>`</span> === anchorId)</span><br><span class=\"line\">          : <span class=\"literal\">null</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedBeginTime = frameBeginTime;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedFramework = framework;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentLocatedAnchor = anchor;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  \t<span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setLocationInfo();</span><br><span class=\"line\"></span><br><span class=\"line\">  \t<span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentDuration;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/preview-cursor.gif\" alt=\"preview-cursor\"></p>\n<p> <code>mousenter</code>  <code>mousemove</code>  <code>mouseleave</code> </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"http://img.mrsingsing.com/magnet-cursor.gif\" alt=\"magnet-cursor\"></p>\n<p></p>\n<p> DOM </p>\n<p> <code>translate</code> </p>\n<p><img src=\"http://img.mrsingsing.com/magnet-area.png\" alt=\"magnet-area\"></p>\n<p></p>\n<figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"selector-class\">.magnet-area-item</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">  <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"attribute\">max-width</span>: <span class=\"number\">80px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">1450</span>;</span><br><span class=\"line\">  <span class=\"comment\">/*  */</span></span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: rgba(<span class=\"number\">255</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.3</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.first</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: translate3d(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">      <span class=\"selector-class\">.magnet-area-cursor</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: none;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.last</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">transform</span>: translate3d(-<span class=\"number\">100%</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">      <span class=\"selector-class\">.magnet-area-cursor</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: initial;</span><br><span class=\"line\">        <span class=\"attribute\">right</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"attribute\">transform</span>: none;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"selector-tag\">&amp;</span><span class=\"selector-class\">.active</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"selector-class\">.magnet-area-cursor</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">content</span>: <span class=\"string\">''</span>;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">2px</span>;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: <span class=\"number\">#1db368</span>;</span><br><span class=\"line\">      <span class=\"attribute\">transform</span>: translateX(-<span class=\"number\">50%</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> initMagnetArea = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.currentMagnetAreaList = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  DOM </span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> frameworkList = <span class=\"keyword\">this</span>.indicatorRef.nativeElement.parentElement.querySelectorAll(</span><br><span class=\"line\">    <span class=\"string\">'.framework-item'</span>,</span><br><span class=\"line\">  ) <span class=\"keyword\">as</span> NodeListOf&lt;HTMLDivElement&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> indicatorLeft = <span class=\"keyword\">this</span>.indicatorClientRect.left;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.currentMagnetAreaList = <span class=\"built_in\">Array</span>.from(frameworkList).reduce(</span><br><span class=\"line\">    (acc: any, <span class=\"attr\">item</span>: HTMLDivElement, <span class=\"attr\">index</span>: number) =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  DOM </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> frameworkRect = item.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">//  30% </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> currentWidth = frameworkRect.width * <span class=\"number\">0.3</span>;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> areaWidth = index === <span class=\"number\">0</span> ? currentWidth : currentWidth + acc.prevWidth;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> areaShift = index === <span class=\"number\">0</span> ? <span class=\"number\">0</span> : (acc.prevWidth / areaWidth) * <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      acc.list.push(&#123;</span><br><span class=\"line\">        id: item.dataset.id,</span><br><span class=\"line\">        areaWidth: areaWidth,</span><br><span class=\"line\">        areaTranform: <span class=\"string\">`translateX(-<span class=\"subst\">$&#123;areaShift&#125;</span>%)`</span>,</span><br><span class=\"line\">        areaLeft: frameworkRect.left - indicatorLeft + <span class=\"string\">'px'</span>,</span><br><span class=\"line\">        cursorLeft: areaShift + <span class=\"string\">'%'</span>,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  30% </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (index === frameworkList.length - <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        acc.list.push(&#123;</span><br><span class=\"line\">          id: <span class=\"literal\">null</span>,</span><br><span class=\"line\">          areaWidth: currentWidth,</span><br><span class=\"line\">          areaTranform: <span class=\"string\">'translateX(-100%)'</span>,</span><br><span class=\"line\">          areaLeft: frameworkRect.right - indicatorLeft + <span class=\"string\">'px'</span>,</span><br><span class=\"line\">          cursorLeft: <span class=\"string\">'initial'</span>,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      acc.prevWidth = currentWidth;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> acc;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      list: [],</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"comment\">// 30% 60%</span></span><br><span class=\"line\">      prevWidth: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ).list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Web </p>\n<ol>\n<li> Canvas Bilibili </li>\n<li> DOM  DOM </li>\n</ol>\n<p><img src=\"http://img.mrsingsing.com/ruler1.gif\" alt=\"ruler1\"></p>\n<p><img src=\"http://img.mrsingsing.com/ruler2.gif\" alt=\"ruler2\"></p>\n<p></p>\n<ol>\n<li> <code>&lt;canvas&gt;</code>  DPR </li>\n<li></li>\n<li> Canvas </li>\n<li></li>\n</ol>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> RecordVideoTimelineRulerComponent <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  scaleRatio: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  maxScaleValue: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> canvasWidth: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  <span class=\"comment\">/**  DOM  */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> canvasElement: HTMLCanvasElement;</span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> canvasContext: CanvasRenderingContext2D;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.initCanvas();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnChanges(changes: &#123; [propName: <span class=\"built_in\">string</span>]: SimpleChange &#125;) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> scaleRatio = changes[<span class=\"string\">'scaleRatio'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      scaleRatio &amp;&amp;</span><br><span class=\"line\">      (!scaleRatio.previousValue || scaleRatio.previousValue !== scaleRatio.currentValue)</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.drawCanvas();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  initCanvas(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'canvas'</span>) <span class=\"keyword\">as</span> HTMLCanvasElement;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.canvasElement = canvas;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.canvasContext = ctx;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> documentBodyWidth = <span class=\"built_in\">document</span>.body.clientWidth || <span class=\"built_in\">document</span>.documentElement.clientWidth;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.canvasWidth = documentBodyWidth;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.devicePixelRatio) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> devicePixelRatio = <span class=\"built_in\">window</span>.devicePixelRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">      canvas.width = devicePixelRatio * <span class=\"keyword\">this</span>.canvasWidth;</span><br><span class=\"line\">      canvas.height = devicePixelRatio * <span class=\"number\">26</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      ctx.scale(devicePixelRatio, devicePixelRatio);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.drawCanvas();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  drawCanvas(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> scrollX = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = <span class=\"keyword\">this</span>.canvasContext;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!ctx) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvasWidth = <span class=\"keyword\">this</span>.canvasWidth;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvasHeight = <span class=\"number\">26</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> offsetX = (scrollX ? <span class=\"number\">30</span> - scrollX : <span class=\"number\">30</span>) + <span class=\"number\">0.5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> totalScaleValue = <span class=\"keyword\">this</span>.maxScaleValue;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> startCount = <span class=\"built_in\">Math</span>.max(<span class=\"built_in\">parseInt</span>(<span class=\"string\">''</span> + <span class=\"built_in\">Math</span>.floor((scrollX - <span class=\"number\">30</span>) / <span class=\"number\">16</span>), <span class=\"number\">10</span>), <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> endCount = <span class=\"built_in\">Math</span>.min(</span><br><span class=\"line\">      <span class=\"built_in\">parseInt</span>(<span class=\"string\">''</span> + <span class=\"built_in\">Math</span>.ceil((scrollX + canvasWidth - <span class=\"number\">30</span>) / <span class=\"number\">16</span>), <span class=\"number\">10</span>) - <span class=\"number\">1</span>,</span><br><span class=\"line\">      totalScaleValue</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//  </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> division = <span class=\"number\">15</span>;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> integerHeight = <span class=\"number\">14</span> || <span class=\"built_in\">Math</span>.floor(canvasHeight * <span class=\"number\">0.53</span>);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> divisionHeight = <span class=\"number\">8</span> || <span class=\"built_in\">Math</span>.floor(canvasHeight * <span class=\"number\">0.3</span>);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> textHeight = <span class=\"number\">21</span> || <span class=\"built_in\">Math</span>.floor(canvasHeight * <span class=\"number\">0.78</span>);</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> scaleRatio = <span class=\"keyword\">this</span>.scaleRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">    ctx.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvasWidth, canvasHeight);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = startCount; i &lt; endCount; i++) &#123;</span><br><span class=\"line\">      ctx.beginPath();</span><br><span class=\"line\">      ctx.save();</span><br><span class=\"line\">      ctx.strokeStyle = <span class=\"string\">'#595959'</span>;</span><br><span class=\"line\">      ctx.lineWidth = <span class=\"number\">1</span>;</span><br><span class=\"line\">      ctx.lineCap = <span class=\"string\">'round'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> moveTo = offsetX + i * (division + <span class=\"number\">1</span>);</span><br><span class=\"line\">      ctx.moveTo(moveTo, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (i % <span class=\"number\">5</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        ctx.lineTo(offsetX + i * (division + <span class=\"number\">1</span>), integerHeight);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ctx.lineTo(offsetX + i * (division + <span class=\"number\">1</span>), divisionHeight);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      ctx.stroke();</span><br><span class=\"line\">      ctx.restore();</span><br><span class=\"line\">      ctx.closePath();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    ctx.beginPath();</span><br><span class=\"line\">    ctx.font = <span class=\"string\">'10px Arial'</span>;</span><br><span class=\"line\">    ctx.fillStyle = <span class=\"string\">'#AAAAAA'</span>;</span><br><span class=\"line\">    ctx.textAlign = <span class=\"string\">'center'</span>;</span><br><span class=\"line\">    ctx.textBaseline = <span class=\"string\">'middle'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> seperatedScaleValue = totalScaleValue / <span class=\"number\">5</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; seperatedScaleValue; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> text = <span class=\"keyword\">this</span>.formatTimeScaleText(i, scaleRatio);</span><br><span class=\"line\">      ctx.fillText(text, offsetX + <span class=\"number\">80</span> * i, textHeight);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ctx.closePath();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param index  0 </span></span><br><span class=\"line\"><span class=\"comment\">   * @param ratio </span></span><br><span class=\"line\"><span class=\"comment\">   * @description  HH:MM:SS.ss </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  formatTimeScaleText(index: <span class=\"built_in\">number</span>, ratio: <span class=\"built_in\">number</span>): <span class=\"built_in\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> totalSeconds = index * ratio;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> hour: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> minute: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> second: <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> millisecond = <span class=\"string\">'00'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    hour = <span class=\"built_in\">Math</span>.floor(totalSeconds / <span class=\"number\">3600</span>);</span><br><span class=\"line\">    minute = <span class=\"built_in\">Math</span>.floor((totalSeconds - hour * <span class=\"number\">3600</span>) / <span class=\"number\">60</span>);</span><br><span class=\"line\">    second = ratio &gt;= <span class=\"number\">60</span> ? <span class=\"number\">0</span> : <span class=\"built_in\">Math</span>.floor(totalSeconds - hour * <span class=\"number\">3600</span> - minute * <span class=\"number\">60</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    hour = <span class=\"keyword\">this</span>.fixZero(hour);</span><br><span class=\"line\">    minute = <span class=\"keyword\">this</span>.fixZero(minute);</span><br><span class=\"line\">    second = <span class=\"keyword\">this</span>.fixZero(second);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">`<span class=\"subst\">$&#123;hour&#125;</span>:<span class=\"subst\">$&#123;minute&#125;</span>:<span class=\"subst\">$&#123;second&#125;</span>.<span class=\"subst\">$&#123;millisecond&#125;</span>`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  fixZero(value: <span class=\"built_in\">any</span>): <span class=\"built_in\">string</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> value * <span class=\"number\">1</span> &lt; <span class=\"number\">10</span> ? <span class=\"string\">`0<span class=\"subst\">$&#123;value&#125;</span>`</span> : <span class=\"string\">`<span class=\"subst\">$&#123;value&#125;</span>`</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p></p>\n<ol>\n<li>5  1  1  0.2s=200ms</li>\n<li>5  1 =60s 1  0.2min=12s=12000ms</li>\n<li>5  3 =180s 1  0.6min=36s=36000ms</li>\n<li>5  6 =360s 1  1.2min=62s=62000ms</li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Web </p>\n<p></p>\n<p><img src=\"http://img.mrsingsing.com/drag-and-drop.png\" alt=\"drag-and-drop\"></p>\n<p> drag &amp; drop  drag &amp; drop  mouse  drag &amp; drop  mouse </p>\n<p>HTML  API </p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragstart</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">drag</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragend</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragenter</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragover</td>\n<td style=\"text-align:left\"> 100ms </td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">dragleave</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">drop</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> mouse  drag </p>\n<p> <code>mousedown</code>  <code>mousemove</code>  <code>mousemove</code>  <code>mousedown</code>  <code>dragTolerance</code> 5 5 </p>\n<p> HTML  draggable  true  false </p>\n<p>  <code>draggable</code>  <code>mousedown</code>  <code>draggable</code>  darggable  DOM  <code>mousedown</code> </p>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Directive</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'[ssDraggable]'</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> el: ElementRef, <span class=\"keyword\">public</span> zone: NgZone, <span class=\"keyword\">public</span> viewContainer: ViewContainerRef</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement = el.nativeElement;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onMouseMove = <span class=\"keyword\">this</span>.onMouseMove.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onMouseUp = <span class=\"keyword\">this</span>.onMouseUp.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngAfterContentInit() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.currentElement) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentElement.onmousedown = <span class=\"keyword\">this</span>.onMouseDown.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"keyword\">get</span> currentElementDraggable() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span>.draggable === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.draggable(&#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        data: <span class=\"keyword\">this</span>.data,</span><br><span class=\"line\">        <span class=\"comment\">//  DOM </span></span><br><span class=\"line\">        mousedownElement: <span class=\"keyword\">this</span>.mousedownElement,</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.draggable;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseDown(e: MouseEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    e.preventDefault();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.mousedownElement = e.target <span class=\"keyword\">as</span> HTMLElement;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.currentElementDraggable) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.clicked = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.startX = e.pageX;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.startY = e.pageY;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">document</span>.defaultView?.addEventListener(<span class=\"string\">'mousemove'</span>, <span class=\"keyword\">this</span>.onMouseMove);</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.defaultView?.addEventListener(<span class=\"string\">'mouseup'</span>, <span class=\"keyword\">this</span>.onMouseUp);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseMove(e: MouseEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseUp(e: MouseEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> mousedown  dragStart</p>\n<p> Angular  clone  DOM </p>\n<p> ng-template  HTML  DOM </p>\n<p><img src=\"http://img.mrsingsing.com/drag-anchor.gif\" alt=\"drag-anchor\"></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ng-template</span> #<span class=\"attr\">ssDraggableAnchorGhost</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">class</span>=<span class=\"string\">\"drag-anchor-ghost\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    [<span class=\"attr\">attr.data-type</span>]=<span class=\"string\">\"DragGhostElementType.ANCHOR\"</span></span></span><br><span class=\"line\"><span class=\"tag\">  &gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ghost-cursor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"ghost-placeholder\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ng-template</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p> DOM  DOM  <code>Node.cloneNode()</code>  DOM  DOM CSS </p>\n<p> DOM  getComputedStyle</p>\n<p> CSS </p>\n<p><img src=\"http://img.mrsingsing.com/drag-video.gif\" alt=\"drag-video\"></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  cloneGhostElement(element: Element): Element &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> clonedElement = element.cloneNode(<span class=\"literal\">true</span>) <span class=\"keyword\">as</span> HTMLElement;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> originalStyles: CSSStyleDeclaration = <span class=\"built_in\">document</span>.defaultView.getComputedStyle(element, <span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> cssProperty of styleProperties) &#123;</span><br><span class=\"line\">      clonedElement.style[cssProperty] = originalStyles[cssProperty];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    clonedElement.style.pointerEvents = <span class=\"string\">'none'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> originalElementChildren = element.getElementsByTagName(<span class=\"string\">'*'</span>) <span class=\"keyword\">as</span> HTMLCollectionOf&lt;</span><br><span class=\"line\">      HTMLElement</span><br><span class=\"line\">    &gt;;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> clonedElementChildren = clonedElement.getElementsByTagName(<span class=\"string\">'*'</span>) <span class=\"keyword\">as</span> HTMLCollectionOf&lt;</span><br><span class=\"line\">      HTMLElement</span><br><span class=\"line\">    &gt;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = originalElementChildren.length - <span class=\"number\">1</span>; i--; ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> originalChild = originalElementChildren[i];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> clonedChild = clonedElementChildren[i];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> originElementStyles = <span class=\"built_in\">document</span>.defaultView.getComputedStyle(originalChild, <span class=\"string\">''</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> cssProperty of styleProperties) &#123;</span><br><span class=\"line\">        clonedChild.style[cssProperty] = originElementStyles[cssProperty];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      clonedChild.style.pointerEvents = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> clonedElement;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> SSDraggableBaseEventArgs &#123;</span><br><span class=\"line\">  originalEvent: MouseEvent;</span><br><span class=\"line\">  ghostElement: Nullable&lt;HTMLElement&gt;;</span><br><span class=\"line\">  startX: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  startY: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  pageX: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  pageY: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">  cancel: <span class=\"built_in\">boolean</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseMove(e: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; pageX, pageY &#125; = e;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.clicked) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> totalMovedX = pageX - <span class=\"keyword\">this</span>.startX;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> totalMovedY = pageY - <span class=\"keyword\">this</span>.startY;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        !<span class=\"keyword\">this</span>.dragStarted &amp;&amp;</span><br><span class=\"line\">        (<span class=\"built_in\">Math</span>.abs(totalMovedX) &gt; <span class=\"keyword\">this</span>.dragTolerance || <span class=\"built_in\">Math</span>.abs(totalMovedY) &gt; <span class=\"keyword\">this</span>.dragTolerance)</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> dragStartArgs: SSDraggableBaseEventArgs = &#123;</span><br><span class=\"line\">          originalEvent: e,</span><br><span class=\"line\">          ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">          startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">          startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">          pageX,</span><br><span class=\"line\">          pageY,</span><br><span class=\"line\">          cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.dragStart.emit(dragStartArgs);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dragStartArgs.cancel) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">this</span>.destoryEventListener();</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> clientRect = <span class=\"keyword\">this</span>.currentElement.getBoundingClientRect();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.baseX = clientRect.left;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.baseY = clientRect.top;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragStarted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.createGhostElement(pageX, pageY);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.dragStarted) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> dragMoveArgs: SSDraggableDragMoveArgs = &#123;</span><br><span class=\"line\">        originalEvent: e,</span><br><span class=\"line\">        ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">        startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">        startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">        pageX: <span class=\"keyword\">this</span>.lastX,</span><br><span class=\"line\">        pageY: <span class=\"keyword\">this</span>.lastY,</span><br><span class=\"line\">        nextPageX: e.pageX,</span><br><span class=\"line\">        nextPageY: e.pageY,</span><br><span class=\"line\">        cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragMove.emit(dragMoveArgs);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> setPageX = dragMoveArgs.nextPageX;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> setPageY = dragMoveArgs.nextPageY;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!dragMoveArgs.cancel) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ghostLeft = <span class=\"keyword\">this</span>.dragDirection === DragDirection.VERTICAL ? <span class=\"keyword\">this</span>.baseX : setPageX;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ghostTop = <span class=\"keyword\">this</span>.dragDirection === DragDirection.HORIZONTAL ? <span class=\"keyword\">this</span>.baseY : setPageY;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dispatchDragEvent(pageX, pageY, e);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastX = setPageX;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastY = setPageY;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  createGhostElement(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> dynamicGhostRef;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostTemplate) &#123;</span><br><span class=\"line\">      dynamicGhostRef = <span class=\"keyword\">this</span>.viewContainer.createEmbeddedView(<span class=\"keyword\">this</span>.ghostTemplate, <span class=\"literal\">null</span>);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement = dynamicGhostRef.rootNodes[<span class=\"number\">0</span>];</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> clonedElement = <span class=\"keyword\">this</span>.cloneGhostElement(<span class=\"keyword\">this</span>.currentElement);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> ghostContainer = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">      ghostContainer.appendChild(clonedElement);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.currentElement.dataset) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">Object</span>.entries(<span class=\"keyword\">this</span>.currentElement.dataset).forEach(<span class=\"function\">(<span class=\"params\">[key, value]</span>) =&gt;</span> &#123;</span><br><span class=\"line\">          ghostContainer.setAttribute(<span class=\"string\">`data-<span class=\"subst\">$&#123;key&#125;</span>`</span>, value);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement = ghostContainer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostElement) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> createEventArgs = &#123;</span><br><span class=\"line\">        ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">        cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostCreate.emit(createEventArgs);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (createEventArgs.cancel) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ghostElement = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostTemplate &amp;&amp; dynamicGhostRef) &#123;</span><br><span class=\"line\">          dynamicGhostRef.destroy();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.position = <span class=\"string\">'absolute'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.pointerEvents = <span class=\"string\">'none'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.zIndex = <span class=\"keyword\">this</span>.ghostIndex;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.transform =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragDirection === DragDirection.BOTH ? <span class=\"string\">'translate3d(-50%, -50%, 0)'</span> : <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"comment\">//  left </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.left =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragDirection === DragDirection.VERTICAL ? <span class=\"keyword\">this</span>.baseX + <span class=\"string\">'px'</span> : pageX + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      <span class=\"comment\">//  right </span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.top =</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dragDirection === DragDirection.HORIZONTAL ? <span class=\"keyword\">this</span>.baseY + <span class=\"string\">'px'</span> : pageY + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.width = <span class=\"string\">'auto'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.height = <span class=\"string\">'auto'</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.style.cursor = <span class=\"string\">'grabbing'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.appendChild(<span class=\"keyword\">this</span>.ghostElement);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.addEventListener(<span class=\"string\">'pointerup'</span>, <span class=\"function\"><span class=\"params\">args</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.onMouseUp(args);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> mouseup  drop </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDrggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  onMouseUp(e: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.clicked) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.clicked = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.dragStarted = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> dragEndArgs = &#123;</span><br><span class=\"line\">      originalEvent: e,</span><br><span class=\"line\">      ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">      startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">      startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">      pageX: e.pageX,</span><br><span class=\"line\">      pageY: e.pageY,</span><br><span class=\"line\">      data: <span class=\"keyword\">this</span>.data,</span><br><span class=\"line\">      cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragEnd.emit(dragEndArgs);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.dispatchDropEvent(e.pageX, e.pageY, e);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.ghostElement) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement.parentNode?.removeChild(<span class=\"keyword\">this</span>.ghostElement);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.ghostElement = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.destoryEventListener();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> mouse  drag &amp; drop  drag &amp; drop  dataTransfer </p>\n<p> clickmousedownblur </p>\n<p></p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\"><span class=\"keyword\">const</span> event = documet.createEvent(<span class=\"string\">'Event'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  build</span></span><br><span class=\"line\">event.initEvent(<span class=\"string\">'build'</span>, <span class=\"literal\">true</span>, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">event.addEventListener(</span><br><span class=\"line\">  <span class=\"string\">'build'</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// e.target</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"literal\">false</span></span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">elem.dispatchEvent(Event);</span><br></pre></td></tr></table></figure>\n<p> getElementsAtPoint </p>\n<p> drag  drop </p>\n<ul>\n<li>dispatchDragEvent dragEnterdragLeave </li>\n<li>dispatchDropEvent drop </li>\n<li>dispatchEvent</li>\n</ul>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDraggableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  dispatchDragEvent(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>, originalEvent: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> dropArea;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> customEventArgs: SSDraggableCustomEventDetail = &#123;</span><br><span class=\"line\">      data: &#123; ...this.data &#125;,</span><br><span class=\"line\">      originalEvent,</span><br><span class=\"line\">      ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">      startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">      startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">      pageX,</span><br><span class=\"line\">      pageY,</span><br><span class=\"line\">      cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> elementsFromPoint = <span class=\"keyword\">this</span>.getElementsAtPoint(pageX, pageY);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> dropAreaFlag = <span class=\"keyword\">this</span>.dropAreaFlag;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> element of elementsFromPoint) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        element.getAttribute(dropAreaFlag) === <span class=\"string\">'true'</span> &amp;&amp;</span><br><span class=\"line\">        element !== <span class=\"keyword\">this</span>.ghostElement &amp;&amp;</span><br><span class=\"line\">        element !== <span class=\"keyword\">this</span>.currentElement</span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        dropArea = element;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dropArea &amp;&amp; (!<span class=\"keyword\">this</span>.lastDropArea || (<span class=\"keyword\">this</span>.lastDropArea &amp;&amp; <span class=\"keyword\">this</span>.lastDropArea !== dropArea))) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.lastDropArea) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.dispatchEvent(<span class=\"keyword\">this</span>.lastDropArea, <span class=\"string\">'ssDragLeave'</span>, customEventArgs);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastDropArea = dropArea;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dispatchEvent(dropArea, <span class=\"string\">'ssDragEnter'</span>, customEventArgs);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!dropArea &amp;&amp; <span class=\"keyword\">this</span>.lastDropArea) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dispatchEvent(<span class=\"keyword\">this</span>.lastDropArea, <span class=\"string\">'ssDragLeave'</span>, customEventArgs);</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.lastDropArea = <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (dropArea) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dispatchEvent(dropArea, <span class=\"string\">'ssDragOver'</span>, customEventArgs);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  dispatchDropEvent(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>, originalEvent: MouseEvent) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> customEventArgs = &#123;</span><br><span class=\"line\">      ghostElement: <span class=\"keyword\">this</span>.ghostElement,</span><br><span class=\"line\">      originalEvent,</span><br><span class=\"line\">      startX: <span class=\"keyword\">this</span>.startX,</span><br><span class=\"line\">      startY: <span class=\"keyword\">this</span>.startY,</span><br><span class=\"line\">      pageX,</span><br><span class=\"line\">      pageY,</span><br><span class=\"line\">      data: <span class=\"keyword\">this</span>.data,</span><br><span class=\"line\">      cancel: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.dispatchEvent(<span class=\"keyword\">this</span>.lastDropArea, <span class=\"string\">'ssDrop'</span>, customEventArgs);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  dispatchEvent(</span><br><span class=\"line\">    target: Nullable&lt;HTMLElement&gt;,</span><br><span class=\"line\">    eventName: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">    eventArgs: SSDraggableCustomEventDetail</span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (target) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> customEvent = <span class=\"built_in\">document</span>.createEvent(<span class=\"string\">'CustomEvent'</span>);</span><br><span class=\"line\">      customEvent.initCustomEvent(eventName, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, eventArgs);</span><br><span class=\"line\">      target.dispatchEvent(customEvent);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> getElementsAtPoint(pageX: <span class=\"built_in\">number</span>, pageY: <span class=\"built_in\">number</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> viewPortX = pageX - <span class=\"built_in\">window</span>.pageXOffset;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> viewPortY = pageY - <span class=\"built_in\">window</span>.pageYOffset;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>[<span class=\"string\">'msElementsFromPoint'</span>]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> elements = <span class=\"built_in\">document</span>[<span class=\"string\">'msElementsFromPoint'</span>](viewPortX, viewPortY);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> elements === <span class=\"literal\">null</span> ? [] : elements;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.elementsFromPoint(viewPortX, viewPortY);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Angular  mouse  drag  API </p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">API</th>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">data</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">any</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">draggable</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">boolean \\</td>\n<td>() =&gt; boolean</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostTemplate</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><code>TemplateRef&lt;any&gt;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostIndex</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">string</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragTolerance</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">number</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragDirection</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">DragDirection</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dropAreaFlag</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">string</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>dropAreaFlag  drop  drop  data-*  attribute</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"></th>\n<th style=\"text-align:left\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">dragStart</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragMove</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">dragEnd</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostCreate</td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ghostDestory</td>\n<td style=\"text-align:left\"></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> drop  drag </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Directive</span>(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">'[ssDroppable]'</span>,</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSDroppableDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> currentElement: Nullable&lt;HTMLElement&gt; = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dropAreaFlag = <span class=\"string\">'ssdroppable'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dragEnter = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dragOver = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> dragLeave = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Output</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> drop = <span class=\"keyword\">new</span> EventEmitter&lt;CustomEvent&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> el: ElementRef, <span class=\"keyword\">public</span> zone: NgZone</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement = el.nativeElement;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDragEnter = <span class=\"keyword\">this</span>.onDragEnter.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDragOver = <span class=\"keyword\">this</span>.onDragOver.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDragLeave = <span class=\"keyword\">this</span>.onDragLeave.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.onDrop = <span class=\"keyword\">this</span>.onDrop.bind(<span class=\"keyword\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.currentElement) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.setAttribute(<span class=\"keyword\">this</span>.dropAreaFlag, <span class=\"string\">'true'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDragEnter'</span>, <span class=\"keyword\">this</span>.onDragEnter <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDragOver'</span>, <span class=\"keyword\">this</span>.onDragOver <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDragLeave'</span>, <span class=\"keyword\">this</span>.onDragLeave <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.addEventListener(<span class=\"string\">'ssDrop'</span>, <span class=\"keyword\">this</span>.onDrop <span class=\"keyword\">as</span> EventListener);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDragEnter(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragEnter.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDragOver(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragOver.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDragLeave(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.dragLeave.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> onDrop(e: CustomEvent): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.zone.run(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.drop.emit(e);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> video  play  Canvas  <code>toDataURL</code> </p>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSVideoPreviewDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> previewList;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> blobUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> beginTime: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> duration: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**  */</span></span><br><span class=\"line\">  <span class=\"meta\">@Input</span>()</span><br><span class=\"line\">  <span class=\"keyword\">public</span> scaleRatio: <span class=\"built_in\">number</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> ngOnInit(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.imgList &amp;&amp; <span class=\"keyword\">this</span>.imgList.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.renderVideoPreviewByImageList();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.blobUrl) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.renderVideoPreviewByBlobUrl();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  Blob Url</span></span><br><span class=\"line\">  <span class=\"keyword\">public</span> renderVideoPreviewByBlobUrl() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> count = <span class=\"built_in\">Math</span>.ceil(<span class=\"keyword\">this</span>.duration / <span class=\"keyword\">this</span>.scaleRatio);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> frag = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> durationList = [];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; count; i++) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//  i </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> currentTime = <span class=\"keyword\">this</span>.beginTime + i * <span class=\"keyword\">this</span>.scaleRatio;</span><br><span class=\"line\"></span><br><span class=\"line\">      durationList.push(currentTime);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> promise = <span class=\"keyword\">this</span>.videoPicture(&#123; videoUrl: <span class=\"keyword\">this</span>.blobUrl, seconds: durationList &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    promise.then(<span class=\"function\">(<span class=\"params\">imgList: <span class=\"built_in\">string</span>[]</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      imgList.forEach(<span class=\"function\">(<span class=\"params\">base64: <span class=\"built_in\">string</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        div.style.display = <span class=\"string\">'inline-block'</span>;</span><br><span class=\"line\">        div.style.width = <span class=\"string\">'80px'</span>;</span><br><span class=\"line\">        div.style.height = <span class=\"string\">'44px'</span>;</span><br><span class=\"line\">        div.style.backgroundRepeat = <span class=\"string\">'no-repeat'</span>;</span><br><span class=\"line\">        div.style.backgroundImage = <span class=\"string\">`url(\"<span class=\"subst\">$&#123;base64&#125;</span>\")`</span>;</span><br><span class=\"line\">        div.style.backgroundSize = <span class=\"string\">'contain'</span>;</span><br><span class=\"line\">        div.style.flexShrink = <span class=\"string\">'0'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        frag.appendChild(div);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentElement.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.currentElement.appendChild(frag);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * @param videoData </span></span><br><span class=\"line\"><span class=\"comment\">   * @param width  80px* 8 </span></span><br><span class=\"line\"><span class=\"comment\">   * @param height  44px* 8 </span></span><br><span class=\"line\"><span class=\"comment\">   * @param seconds    [1,3,4,5,6] 1 3 4 5 6</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  videoPicture(&#123;</span><br><span class=\"line\">    videoUrl,</span><br><span class=\"line\">    videoData,</span><br><span class=\"line\">    width = <span class=\"number\">80</span> * <span class=\"number\">8</span>,</span><br><span class=\"line\">    height = <span class=\"number\">44</span> * <span class=\"number\">8</span>,</span><br><span class=\"line\">    seconds,</span><br><span class=\"line\">  &#125;: &#123;</span><br><span class=\"line\">    videoUrl?: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">    videoData?: File;</span><br><span class=\"line\">    width?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    height?: <span class=\"built_in\">number</span>;</span><br><span class=\"line\">    seconds: <span class=\"built_in\">number</span>[];</span><br><span class=\"line\">  &#125;) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> container = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\">    container.className = <span class=\"string\">'video-picture'</span>;</span><br><span class=\"line\">    container.style.position = <span class=\"string\">'absolute'</span>;</span><br><span class=\"line\">    <span class=\"comment\">// container.style.visibility = 'hidden';</span></span><br><span class=\"line\">    container.style.left = <span class=\"string\">'-9999px'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> video = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'video'</span>);</span><br><span class=\"line\">    video.width = width;</span><br><span class=\"line\">    video.height = height;</span><br><span class=\"line\">    video.src = videoUrl || <span class=\"built_in\">window</span>.URL.createObjectURL(videoData);</span><br><span class=\"line\">    container.appendChild(video);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// canvas</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\">    canvas.width = width; <span class=\"comment\">//</span></span><br><span class=\"line\">    canvas.height = height; <span class=\"comment\">//</span></span><br><span class=\"line\">    container.appendChild(canvas);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      video.addEventListener(<span class=\"string\">'loadeddata'</span>, <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        video.currentTime = <span class=\"number\">1</span>;</span><br><span class=\"line\">        video.play();</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      video.addEventListener(<span class=\"string\">'playing'</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">        video.pause();</span><br><span class=\"line\">        <span class=\"keyword\">const</span> captureVideoPromises = [];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; seconds.length; i++) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> captureVideoPromise = <span class=\"keyword\">await</span> <span class=\"keyword\">this</span>.captureVideoPromise(canvas, video, seconds[i]);</span><br><span class=\"line\">          captureVideoPromises.push(captureVideoPromise);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">Promise</span>.all(captureVideoPromises).then(<span class=\"function\"><span class=\"params\">allSrcs</span> =&gt;</span> &#123;</span><br><span class=\"line\">          container.remove();</span><br><span class=\"line\">          allSrcs.sort(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a.beginTime - b.beginTime);</span><br><span class=\"line\">          <span class=\"keyword\">const</span> srcs = allSrcs.map(<span class=\"function\"><span class=\"params\">val</span> =&gt;</span> val.src);</span><br><span class=\"line\">          resolve(srcs);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"built_in\">document</span>.body.appendChild(container);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   * @param canvas</span></span><br><span class=\"line\"><span class=\"comment\">   * @param video</span></span><br><span class=\"line\"><span class=\"comment\">   * @param beginTime </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> captureVideoPromise(canvas, video, beginTime) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> videoWidth = video.width;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> videoHeight = video.height;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> cutImg = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        video.removeEventListener(<span class=\"string\">'timeupdate'</span>, cutImg);</span><br><span class=\"line\"></span><br><span class=\"line\">        ctx.drawImage(video, <span class=\"number\">0</span>, <span class=\"number\">0</span>, videoWidth, videoHeight);</span><br><span class=\"line\">        <span class=\"keyword\">const</span> dataUrl = canvas.toDataURL(<span class=\"string\">'image/png'</span>);</span><br><span class=\"line\">        resolve(&#123; beginTime: beginTime, src: dataUrl &#125;);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">      video.addEventListener(<span class=\"string\">'timeupdate'</span>, cutImg);</span><br><span class=\"line\">      video.currentTime = beginTime;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li></li>\n<li> DOM  background </li>\n<li></li>\n</ol>\n<p></p>\n<p> ----  0  100 </p>\n<p><img src=\"http://img.mrsingsing.com/sprite-preview.png\" alt=\"sprite-preview\"></p>\n<blockquote>\n<p></p>\n<ul>\n<li>duration </li>\n<li>scaleRatio </li>\n<li>beginTime </li>\n<li>imgList </li>\n</ul>\n</blockquote>\n<ol>\n<li></li>\n<li> 120  120 </li>\n<li> 10x10  0-99  100-199  100 </li>\n<li> 100  0  100 </li>\n<li> 0 </li>\n<li> <code>(index % 10) * width</code> </li>\n<li> <code>Math.floor(index / 10) * height</code> </li>\n</ol>\n<figure class=\"highlight ts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> SSVideoPreviewDirective <span class=\"keyword\">implements</span> OnInit &#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> renderVideoPreviewByImageList(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// </span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> count = <span class=\"built_in\">Math</span>.ceil(<span class=\"keyword\">this</span>.duration / <span class=\"keyword\">this</span>.scaleRatio);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> frag = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; count; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> div = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'div'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//  i </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> currentTime = <span class=\"keyword\">this</span>.beginTime + i * <span class=\"keyword\">this</span>.scaleRatio;</span><br><span class=\"line\">      <span class=\"comment\">// </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> groupIndex = <span class=\"built_in\">Math</span>.floor(currentTime / <span class=\"number\">100</span>);</span><br><span class=\"line\">      <span class=\"comment\">// 100x100 </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> remainder = <span class=\"built_in\">parseInt</span>(<span class=\"string\">`<span class=\"subst\">$&#123;currentTime&#125;</span>`</span>) % <span class=\"number\">100</span> === <span class=\"number\">0</span> ? <span class=\"number\">1</span> : <span class=\"built_in\">Math</span>.ceil(currentTime) % <span class=\"number\">100</span>;</span><br><span class=\"line\">      <span class=\"comment\">//  </span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = remainder === <span class=\"number\">0</span> ? <span class=\"number\">99</span> : remainder - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">const</span> url = <span class=\"keyword\">this</span>.imgList[groupIndex];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> x = (index % <span class=\"number\">10</span>) * <span class=\"number\">80</span>;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> y = <span class=\"built_in\">Math</span>.floor(index / <span class=\"number\">10</span>) * <span class=\"number\">44</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      div.style.display = <span class=\"string\">'inline-block'</span>;</span><br><span class=\"line\">      div.style.width = <span class=\"string\">'80px'</span>;</span><br><span class=\"line\">      div.style.height = <span class=\"string\">'44px'</span>;</span><br><span class=\"line\">      div.style.backgroundRepeat = <span class=\"string\">'no-repeat'</span>;</span><br><span class=\"line\">      div.style.backgroundImage = <span class=\"string\">`url(\"<span class=\"subst\">$&#123;url&#125;</span>\")`</span>;</span><br><span class=\"line\">      div.style.backgroundPosition = <span class=\"string\">`-<span class=\"subst\">$&#123;x&#125;</span>px -<span class=\"subst\">$&#123;y&#125;</span>px`</span>;</span><br><span class=\"line\">      div.style.backgroundSize = <span class=\"string\">'800px 440px'</span>;</span><br><span class=\"line\">      div.style.flexShrink = <span class=\"string\">'0'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">      frag.appendChild(div);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.currentElement.appendChild(frag);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p> DOM  background-image  background-position backgroud-size  background-image  background-position </p>\n<p> 1xn  background-image  10x10 </p>\n<p><img src=\"http://img.mrsingsing.com/tencent-preview.png\" alt=\"tencent-preview\"></p>\n<p> 10 x 10 <br></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p> clickmousedownmousemovemouseupcontextmeu  poiner-events: none </p>\n<p> document  click  document</p>\n<p> document  click  click  path  click</p>\n<p><img src=\"http://img.mrsingsing.com/contextmenu.gif\" alt=\"contextmenu\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p> duration  scrollTo </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> Web </p>\n<p></p>"}],"PostAsset":[],"PostCategory":[],"PostTag":[],"Tag":[]}}